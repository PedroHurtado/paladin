"use strict";var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e};function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function o(a,n){try{var i=t[a](n),s=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(s).then(function(e){o("next",e)},function(e){o("throw",e)});e(s)}("next")})}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){if("IntersectionObserver"in e&&"IntersectionObserverEntry"in e&&"intersectionRatio"in e.IntersectionObserverEntry.prototype)"isIntersecting"in e.IntersectionObserverEntry.prototype||Object.defineProperty(e.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var r=[];a.prototype.THROTTLE_TIMEOUT=100,a.prototype.POLL_INTERVAL=null,a.prototype.USE_MUTATION_OBSERVER=!0,a.prototype.observe=function(e){if(!this._observationTargets.some(function(t){return t.element==e})){if(!e||1!=e.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:e,entry:null}),this._monitorIntersections(),this._checkForIntersections()}},a.prototype.unobserve=function(e){this._observationTargets=this._observationTargets.filter(function(t){return t.element!=e}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},a.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},a.prototype.takeRecords=function(){var e=this._queuedEntries.slice();return this._queuedEntries=[],e},a.prototype._initThresholds=function(e){var t=e||[0];return Array.isArray(t)||(t=[t]),t.sort().filter(function(e,t,r){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return e!==r[t-1]})},a.prototype._parseRootMargin=function(e){var t=(e||"0px").split(/\s+/).map(function(e){var t=/^(-?\d*\.?\d+)(px|%)$/.exec(e);if(!t)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(t[1]),unit:t[2]}});return t[1]=t[1]||t[0],t[2]=t[2]||t[0],t[3]=t[3]||t[1],t},a.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(n(e,"resize",this._checkForIntersections,!0),n(t,"scroll",this._checkForIntersections,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in e&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},a.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,i(e,"resize",this._checkForIntersections,!0),i(t,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},a.prototype._checkForIntersections=function(){var t=this._rootIsInDom(),r=t?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach(function(a){var n=a.element,i=s(n),u=this._rootContainsTarget(n),c=a.entry,l=t&&u&&this._computeTargetAndRootIntersection(n,r),d=a.entry=new o({time:e.performance&&performance.now&&performance.now(),target:n,boundingClientRect:i,rootBounds:r,intersectionRect:l});c?t&&u?this._hasCrossedThreshold(c,d)&&this._queuedEntries.push(d):c&&c.isIntersecting&&this._queuedEntries.push(d):this._queuedEntries.push(d)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},a.prototype._computeTargetAndRootIntersection=function(r,o){if("none"!=e.getComputedStyle(r).display){for(var a,n,i,u,l,d,g,p,f=s(r),h=c(r),m=!1;!m;){var _=null,v=1==h.nodeType?e.getComputedStyle(h):{};if("none"==v.display)return;if(h==this.root||h==t?(m=!0,_=o):h!=t.body&&h!=t.documentElement&&"visible"!=v.overflow&&(_=s(h)),_&&(a=_,n=f,void 0,void 0,void 0,void 0,void 0,void 0,i=Math.max(a.top,n.top),u=Math.min(a.bottom,n.bottom),l=Math.max(a.left,n.left),d=Math.min(a.right,n.right),p=u-i,!(f=(g=d-l)>=0&&p>=0&&{top:i,bottom:u,left:l,right:d,width:g,height:p})))break;h=c(h)}return f}},a.prototype._getRootRect=function(){var e;if(this.root)e=s(this.root);else{var r=t.documentElement,o=t.body;e={top:0,left:0,right:r.clientWidth||o.clientWidth,width:r.clientWidth||o.clientWidth,bottom:r.clientHeight||o.clientHeight,height:r.clientHeight||o.clientHeight}}return this._expandRectByRootMargin(e)},a.prototype._expandRectByRootMargin=function(e){var t=this._rootMarginValues.map(function(t,r){return"px"==t.unit?t.value:t.value*(r%2?e.width:e.height)/100}),r={top:e.top-t[0],right:e.right+t[1],bottom:e.bottom+t[2],left:e.left-t[3]};return r.width=r.right-r.left,r.height=r.bottom-r.top,r},a.prototype._hasCrossedThreshold=function(e,t){var r=e&&e.isIntersecting?e.intersectionRatio||0:-1,o=t.isIntersecting?t.intersectionRatio||0:-1;if(r!==o)for(var a=0;a<this.thresholds.length;a++){var n=this.thresholds[a];if(n==r||n==o||n<r!=n<o)return!0}},a.prototype._rootIsInDom=function(){return!this.root||u(t,this.root)},a.prototype._rootContainsTarget=function(e){return u(this.root||t,e)},a.prototype._registerInstance=function(){r.indexOf(this)<0&&r.push(this)},a.prototype._unregisterInstance=function(){var e=r.indexOf(this);-1!=e&&r.splice(e,1)},e.IntersectionObserver=a,e.IntersectionObserverEntry=o}function o(e){this.time=e.time,this.target=e.target,this.rootBounds=e.rootBounds,this.boundingClientRect=e.boundingClientRect,this.intersectionRect=e.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0},this.isIntersecting=!!e.intersectionRect;var t=this.boundingClientRect,r=t.width*t.height,o=this.intersectionRect,a=o.width*o.height;this.intersectionRatio=r?a/r:this.isIntersecting?1:0}function a(e,t){var r,o,a,n=t||{};if("function"!=typeof e)throw new Error("callback must be a function");if(n.root&&1!=n.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=(r=this._checkForIntersections.bind(this),o=this.THROTTLE_TIMEOUT,a=null,function(){a||(a=setTimeout(function(){r(),a=null},o))}),this._callback=e,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(n.rootMargin),this.thresholds=this._initThresholds(n.threshold),this.root=n.root||null,this.rootMargin=this._rootMarginValues.map(function(e){return e.value+e.unit}).join(" ")}function n(e,t,r,o){"function"==typeof e.addEventListener?e.addEventListener(t,r,o||!1):"function"==typeof e.attachEvent&&e.attachEvent("on"+t,r)}function i(e,t,r,o){"function"==typeof e.removeEventListener?e.removeEventListener(t,r,o||!1):"function"==typeof e.detatchEvent&&e.detatchEvent("on"+t,r)}function s(e){var t;try{t=e.getBoundingClientRect()}catch(e){}return t?(t.width&&t.height||(t={top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.right-t.left,height:t.bottom-t.top}),t):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function u(e,t){for(var r=t;r;){if(r==e)return!0;r=c(r)}return!1}function c(e){var t=e.parentNode;return t&&11==t.nodeType&&t.host?t.host:t}}(window,document);var app=angular.module("paladinApp",["ui.router","ngMeta","zendeskWidget","pascalprecht.translate","paladinPopups","angularReverseGeocode","ngLocationUpdate","ngMaterial","ngMessages","material.svgAssetsCache","ngCookies","uiGmapgoogle-maps","ngMap","base64","ngRoute","angularMoment","ngMaterialDateRangePicker","credit-cards","jkAngularRatingStars"]);app.config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider","ZendeskWidgetProvider","$mdThemingProvider","enums",function(e,t,r,o,a,n,i){var s=n.extendPalette("green",{500:"#69C187",200:"#01b3eb",A200:"rgba(255,255,255,0.05)",A300:"#484848",A400:"rgba(72,72,72,0.5)",A500:"#ffffff",A600:"#f6f6f6",A700:"#000"});n.definePalette("rentOrderStatusTheme",{50:"#69C187",100:"#fb814a",200:"#ee4e4a",300:"#4ec07e",400:"#0d87f6",500:"#8d72f4",600:"#fff",700:"#fff",800:"#fff",900:"#fff",A100:"#fff",A200:"#fff",A400:"#fff",A700:"#000000"});n.definePalette("paladinTheme",s),n.theme("default").primaryPalette("paladinTheme").accentPalette("paladinTheme"),n.theme("rentOrderStatus").primaryPalette("rentOrderStatusTheme").accentPalette("rentOrderStatusTheme"),a.init({accountUrl:"paladintrue.zendesk.com",beforePageLoad:function(e){e.hide()}}),o.html5Mode(!0),delete r.defaults.headers.common["X-Requested-With"],e.state("app",{url:"/:languageCode",templateUrl:"./views/routes/app.html",controller:"appController",isPublic:!0,abstract:!0,params:{languageCode:localStorage.getItem(i.localStorageKeys.preferredLanguage)||"it"}}).state("app.home",{url:"/",templateUrl:"./views/routes/homeV2.html",controller:"homeV2Controller",isPublic:!0,data:{isCollapsingHeader:!0},resolve:{validReferralCode:function(){return!1}}}).state("app.emailVerification",{url:"/email-validation",templateUrl:"./views/routes/homeV2.html",controller:"homeV2Controller",isPublic:!0,data:{isCollapsingHeader:!0}}).state("app.referredRegistration",{url:"/r/:referralNameCode",templateUrl:"./views/routes/homeV2.html",controller:"homeV2Controller",isPublic:!0,resolve:{validReferralCode:["$stateParams","appStateManager","referralsService",function(e,t,r){return r.validateReferralCode(e.referralNameCode)}]}}).state("app.browse",{url:"/categorie/:category/:subCategory/:city?search&sortBy&pageIndex",templateUrl:"./views/routes/home.html",controller:"homeController",reloadOnSearch:!1,isPublic:!0,isCustomSEO:!0,params:{category:{squash:!0,value:null},subCategory:{squash:!0,value:null},city:{squash:!0,value:null},search:{squash:!0,value:null},sortBy:{squash:!0,value:null},pageIndex:{squash:!0,value:null},isTryAndBuy:!0,isResetSearch:!1}}).state("app.browsePrivate",{url:"/categorie/privato/:category/:subCategory/:city?search&sortBy&pageIndex",templateUrl:"./views/routes/home.html",controller:"homeController",reloadOnSearch:!1,isPublic:!0,isCustomSEO:!0,params:{category:{squash:!0,value:null},subCategory:{squash:!0,value:null},city:{squash:!0,value:null},search:{squash:!0,value:null},sortBy:{squash:!0,value:null},pageIndex:{squash:!0,value:null},isTryAndBuy:!1,isResetSearch:!1}}).state("app.products",{url:"/product",abstract:!0}).state("app.products.selectedProduct",{url:"/:productNameAndId",templateUrl:"./views/routes/productDetailed.html",controller:"productDetailedController",isPublic:!0,params:{productNameAndId:void 0,productId:0}}).state("app.products.newProduct",{url:"/new",templateUrl:"./views/routes/newProduct.html",controller:"newProductController"}).state("app.products.productReview",{url:"/review/:bookingId",templateUrl:"./views/routes/productReview.html",controller:"productReviewController",isPublic:!0,resolve:{prereqData:["$stateParams","appStateManager",function(e,t){return console.log("$state productReview params",e),{userId:e.Borrower_Id,productId:null,currentLang:t.getCurrentLang()}}]}}).state("app.profiles",{url:"/profiles",abstract:!0}).state("app.profiles.myProfile",{url:"/myProfile",templateUrl:"./views/routes/userProfile.html",controller:"userProfileController",params:{userId:null}}).state("app.profiles.publicProfile",{url:"/:userId",templateUrl:"./views/routes/userProfile.html",controller:"userProfileController",isPublic:!0,params:{userId:null}}).state("app.myListings",{url:"/myListings",templateUrl:"./views/routes/myListings.html",controller:"myListingsController",isPublic:!0}).state("app.bookings",{url:"/my-rentals",abstract:!0}).state("app.bookings.userBookings",{url:"",templateUrl:"./views/routes/userBookings.html",controller:"userBookingsController"}).state("app.bookings.bookingDetailed",{url:"/:bookingId",templateUrl:"./views/routes/bookingDetailed.html",controller:"bookingDetailedController",params:{bookingId:null}}).state("app.bookings.paymentDetailed",{url:"/payment",templateUrl:"./views/routes/paymentDetailed.html",controller:"paymentDetailedController",params:{productId:{squash:!0,value:null},startDate:{squash:!0,value:null},endDate:{squash:!0,value:null},purchase:{squash:!0,value:null},bookingId:{squash:!0,value:null}}}).state("verification",{url:"/:languageCode/verification",params:{languageCode:localStorage.getItem(i.localStorageKeys.preferredLanguage)||"it"},template:'<div ui-view flex="100" layout="row" layout-align="start center" layout-fill></div>'}).state("verification.user",{url:"/verifyMe/:bookingId",templateUrl:"./views/routes/userVerification.html",controller:"userVerificationController",params:{bookingId:null}}).state("app.chat",{url:"/messaging/:chatId",params:{languageCode:localStorage.getItem(i.localStorageKeys.preferredLanguage)||"it",chatId:null},templateUrl:"./views/routes/chat.html",controller:"chatController",data:{isHeaderHidden:!0}}),t.rule(function(e,t){var r=t.path(),o=r.split("/")[1],a=window.globals.SUPPORTED_LANGS.find(function(e){return e.code===o.toLowerCase()});return a?a.code!=localStorage.getItem(i.localStorageKeys.preferredLanguage)?(localStorage.setItem(i.localStorageKeys.preferredLanguage,a.code),location.reload(),r.replace(o,a.code)):void 0:"/"+(localStorage.getItem(i.localStorageKeys.preferredLanguage)||"it")+r}),t.otherwise(function(e,t){if(!t.path().includes("/blog")){var r=t.path().split("/")[1],o=window.globals.SUPPORTED_LANGS.find(function(e){return e.code===r.toLowerCase()});return"/"+(localStorage.getItem(i.localStorageKeys.preferredLanguage)||o||"it")+"/"}})}]).run(["ngMeta","$window","$rootScope","$location","facebook","enums","$trace","$transitions","$state","navigationService","dataService","chatService","appStateManager",function(e,t,r,o,a,n,i,s,u,c,l,d,g){e.init(),l.init(),d.init(),r.facebook_user={},r.facebookApiLoaded=!1,r.$emit(n.busEvents.facebookApiLoad,{isLoaded:!1}),t.fbAsyncInit=function(){FB.init({appId:"1156274361103964",channelUrl:"app/channel.html",status:!0,cookie:!0,xfbml:!0,version:"v2.12"}),FB.Event.subscribe("auth.authResponseChange",function(e){"connected"===e.status&&FB.api("/me",{fields:["first_name","last_name","email","id","address","location","name"]},function(e){r.$emit(n.busEvents.facebookApiLoad,{isLoaded:!0}),r.$apply(function(){r.facebook_user=e,r.facebookApiLoaded=!0})})})},r.stateData={isCollapsingHeader:!0,isHeaderHidden:!1},window.globals.isProd()||(i.enable("TRANSITION"),s.onStart({},function(e){console.log("$transitions.onStart",e)}),r.$on("$stateChangeStart",function(){console.log("$stateChangeStart",arguments)})),s.onBefore({},function(e){if(!e.to().isPublic&&!g.getUserId())return l.forceLogin(e),e.router.stateService.target("app.home")}),s.onSuccess({},function(e){var t=e.to();r.isMenuOpen={value:!1},r.currentState={value:u.current.name},u.current.data&&(r.stateData.isCollapsingHeader=u.current.data.isCollapsingHeader||!1,r.stateData.isHeaderHidden=u.current.data.isHeaderHidden||!1),t.isCustomSEO||l.updateGeneralSEO()})}]),angular.module("paladinApp").factory("facebook",function(){return"done"}),angular.module("paladinApp").directive("fbButton",function(){return{restrict:"A",link:function(e,t,r){var o="en_EN";"it"==e.currentLang?o="it_IT":"de"==e.currentLang&&(o="de_DE"),function(e){var r,a="facebook-jssdk",n=e.getElementsByTagName("script")[0];((r=e.createElement("script")).id=a,r.async=!0,r.src="//connect.facebook.net/"+o+"/sdk.js",e.getElementById(a))?(n.parentNode.replaceChild(r,e.getElementById(a)),document.getElementsByTagName("head")[0].appendChild(r)):n.parentNode.insertBefore(r,n);"undefined"!=typeof FB&&FB&&FB.XFBML.parse(t[0].parent)}(document)}}}),angular.module("paladinApp").run(["$route","$rootScope","$location",function(e,t,r){var o=r.path;r.path=function(a,n){if(!1===n)var i=e.current,s=t.$on("$locationChangeSuccess",function(){e.current=i,s()});return o.apply(r,[a])}}]),function(e){var t={ENV:"test",IS_PROMO:!0,START_DATE:"7",END_DATE:"8 Novembre",COUPON_VALUE:"25",COUPON_CODE:"SWEETHOME25",isProd:function(){return"prod"===t.ENV},SUPPORTED_LANGS:[{code:"en",name:"English",defaultLocation:"milan italy",tryAndBuyWordPressPath:"try-our-brands"},{code:"it",name:"Italiano",defaultLocation:"milan italy",tryAndBuyWordPressPath:"prova-i-nostri-brand"}],RENT_NOW_URL:"https://qx87h.app.goo.gl/?link=https://paladintrue.com/{0}/?product-detail?{1}&apn=com.a2l.paladin&isi=1129780407&ibi=com.a2l.paladin&efr=1",RENT_URL:"https://qx87h.app.goo.gl/?link=https://paladintrue.com/it&apn=com.a2l.paladin&isi=1129780407&ibi=com.a2l.paladin"};"prod"===t.ENV?(t.ROOT_PATH="https://rent.paladintrue.com/",t.BASE_URL="https://live.v1.paladintrue.com/",t.PROFILE_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/livepaladinimages/ProfileImage/",t.PRODUCT_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/livepaladinimages/ProductImage/",t.CATEGORY_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/livepaladinimages/CategoryImage/",t.LOG_LEVEL="none",t.STRIPE_SK="sk_live_n1ODuFHO82iZulfbRIBQ0WUa"):(t.ROOT_PATH="https://webtest.paladintrue.com/",t.BASE_URL="https://staging.paladintrue.com/",t.PROFILE_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/staggingimages/ProfileImage/",t.PRODUCT_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/staggingimages/ProductImage/",t.CATEGORY_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/staggingimages/CategoryImage/",t.LOG_LEVEL="verbose",t.STRIPE_SK="sk_test_Qxfl7rPTVALyVnrMRUkb2l3F"),t.API_URL=t.BASE_URL+"api/Paladin/",t.TOKEN_URL=t.BASE_URL+"Token",t.STRIPE_URL="https://api.stripe.com/v1",t.PROMO_SIGNUP_TIMER=1e4,e.globals=t}(window),angular.module("paladinApp").constant("enums",{busEvents:{onAppOnlineState:"PT_BE_onAppOnlineState",$routeChangeError:"$routeChangeError",userLogin:"PT_BE_userLogin",userSignup:"PT_BE_userSignup",userLogout:"PT_BE_userLogout",preferredLanguageChange:"PT_BE_preferredLanguageChange",updatedUser:"PT_BE_updatedUser",facebookApiLoad:"PT_BE_facebookApiLoad",tokenRefresh:"PT_BE_tokenRefresh",triggerEmailValidation:"PT_BE_triggerEmailValidation",locationUpdate:"PT_BE_locationUpdate",categoriesUpdate:"PT_BE_categoriesUpdate",googlePlacesAutocompletePlaceChanged:"PT_BE_googlePlacesAutocompletePlaceChanged",reloadDetailedBooking:"PT_BE_reloadDetailedBooking",footerExtraHeight:"PT_BE_footerExtraHeight",scrollMainScrollerToTop:"PT_BE_scrollMainScrollerToTop",rentalRequestPickerUpdateDates:"PT_BE_rentalRequestPicker"},busNavigation:{homePage:"PT_BN_homePage",productDetailed:"PT_BN_productDetailed",browseCategory:"PT_BN_browseCategory",browseKeyword:"PT_BN_browseKeyword",browseSort:"PT_BN_browseSort",switchBrowseMode:"PT_BN_browseModeSwitch",userProfile:"PT_BN_userProfile",userListings:"PT_BN_userListings",newProduct:"PT_BN_newProduct",rentals:"PT_BN_rentals",transactionDetailed:"PT_BN_transactionDetailed",idVerification:"PT_BN_idVerification",userReview:"PT_BN_userReview",paymentDetailed:"PT_BN_paymentDetailed",chat:"PT_BN_chat"},busChatEvents:{updateUnreadCount:"PT_BCE_updateUnreadCount",newMessage:"PT_BCE_newMessage",detailedChatSelected:"PT_BCE_detailedChatSelected",startNewMessagesPoller:"PT_BCE_startNewMessagesPoller",selectPendingChat:"PT_BCE_selectPendingChat"},ngMetaValues:{currentUrl:function(e){return"currentUrl_"+e}},categoriesBannersPaths:{all:{en:"/assets/banner-try-and-buy-en.jpg",it:"/assets/banner-try-and-buy-it.jpg"},promo:"/assets/promo-banner.jpg",addProduct:"/assets/all-categories-banner-3.png",allP2P:"/assets/all-categories-banner-3.png"},localStorageKeys:{jwtToken:"PT_LSK_jwt_token",refreshToken:"PT_LSK_refreshToken",preferredLanguage:"PT_LSK_preferredLanguage",userId:"PT_persistAuth",locationLatLong:"PT_LSK_locationLatLong",pendingPrivateState:"PT_LSK_pendingPrivateState"},allCategories:{en:"All Categories",it:"Tutte le Categorie",de:"Alle Kategorien"},secret:"d05ac55661e27663c025aca7047c825908ae1562",inAppSideNavsIds:{mainMobileNav:"main-mobile-side-nav",chatSideNav:"chat-list-side-nav"},categoriesIds:{tryAndBuy:window.globals.isProd()?11:15,outdoor:window.globals.isProd()?20:12,homeAppliance:window.globals.isProd()?18:8,hiTech:window.globals.isProd()?17:2,smartMobility:window.globals.isProd()?19:4},productsSortOptions:{geoLocation:"SortByGeoLocation",popularity:"SortByPopularity",bestProduct:"SortByBestProduct",review:"SortByReview",lowPrice:"SortByLowPrice",highPrice:"SortByHighPrice",recent:"SortByRecent"},productsSortByTextCode:{SortByPopularity:"POPULARITY",SortByRecent:"MREC",SortByGeoLocation:"NEAREST",SortByBestProduct:"RELEVANCE",SortByLowPrice:"LP",SortByHighPrice:"HP"},userProductsFilter:{borrowedProducts:"BorrowedProduct",lentProduct:"LentProduct",allProducts:"AllProduct",myProductsToBorrow:"MyProductsToBorrow"},productRentalStatus:{available:-1,requested:1,notVerified:2,verified:3,timeout:4,denied:5,canceled:6,accepted:7,started:8,ended:9,criticalCancel:10,moderateCancel:11,canceledByLender:12,timeoutByBorrower:13,verifying:14,booked:15},productRentalStatusNames:{requested:"requested",notVerified:"notverified",verified:"verified",timeout:"timeout",denied:"denied",cancelled:"cancelled",criticalCancel:"cancellation-Critical",moderateCancel:"cancellation-Moderate",accepted:"accepted",started:"started",ended:"ended",canceledByLender:"cancelled-By-Lender",timeoutByBorrower:"card_not_verified_timeout"},trackingStep:{pending:0,success:1,failure:2},bookingReviewStatus:{noReview:0,reviewByBorrower:1,reviewByLender:2,reviewByBoth:3},idVerificationMethod:{passport:"passport",driverLicense:"driverLicense",id:"id"},acuantImageSource:{mobileCropped:101,scanShellTwain:102,SnapShell:103,Other:105},acuantRegions:{USA:0,Canada:1,SouthAmerica:2,Europe:3,Australia:4,Asia:5,GeneralDocs:6,Africa:7}}),angular.module("paladinApp").filter("capitalize",function(){return function(e){if(e){if(-1!==e.indexOf(" ")){var t,r;for(t=(e=e.toLowerCase()).split(" "),r=0;r<t.length;r++)t[r]=o(t[r].trim());return t.toString().replace(/,/g," ")}return o(e=e.toLowerCase())}function o(e){return e.substring(0,1).toUpperCase()+e.substring(1)}return e}}),angular.module("paladinApp").filter("ptCurrency",function(){return function(e){return"â‚¬ "+e}}),angular.module("paladinApp").filter("ptTruncate",function(){return function(e,t){return e&&e.length>t?e.slice(0,t-3)+"...":e}}),angular.module("paladinApp").filter("ptHtmlToPlainText",function(){return function(e){return e?String(e).replace(/<[^>]+>/gm,""):e}}),angular.module("paladinApp").service("chatService",["$rootScope","appStateManager","apiService","enums","$base64","toastService",function(e,t,r,o,a,n){var i=this;i.CHAT_HASH="ZDA1YWM1NTY2MWUyNzY2M2MwMjVhY2E3MDQ3YzgyNTkwOGFlMTU2MjpQYWxhZGluXzEyMzEyMzEyMw==",i.userDialogs={},window.globals.isProd()?(i.kApplicationID=48979,i.kAuthKey="s64NxQBAMrmGYXz",i.kAuthSecret="wxqqXZAfdYpsEvd",i.kAccountKey="7awzEayyEjqP2LQuppJj"):(i.kApplicationID=58169,i.kAuthKey="u3n3guWwktMpCsU",i.kAuthSecret="yV26WrfkrBMZC2n",i.kAccountKey="7awzEayyEjqP2LQuppJj");var s=function(t,r){if(r&&r.body){var a=r;a.isMe=t==i.chatUser.id,a.message=r.body,a._id=r.id,"attachment"===a.message&&a.extension&&a.extension.attachments&&a.extension.attachments.length>0&&(a.message="",a.img=QB.content.privateUrl(a.extension.attachments[0].uid)),e.$emit(o.busChatEvents.newMessage,a)}},u=function(){console.warn("onDisconnectedListener")},c=function(){console.warn("onReconnectListener")},l=function(){return new Promise(function(e,t){i.chatAppSession?e(i.chatAppSession):QB.createSession(function(r,o){console.log(r,o),o&&o.token?(i.chatAppSession=o,e(o)):t("could not create app session")})})},d=function(){var e=a.decode(i.CHAT_HASH).split(":")[1],r=t.user,o=(r.User_Email,r.User_FacebookId),n=r.User_UserName;return void 0!=o&&""!=o?{login:o,password:e}:{login:n,password:e}},g=function(){return new Promise(function(e,t){l().then(function(r){var o=_extends({},d(),{token:r.token});QB.users.create(o,function(r,o){console.log(r,o),o?(i.chatUser=o,e(o),p()):t(r)})}).catch(t)})},p=function(){r.users.editProfile({User_QBId:i.chatUser.id,User_Id:t.getUserId()}).then(function(e){return console.log("SUCCESSFULLY UPDATED PROFILE")}).catch(function(e){return console.error("ERROR UPDATING PROFILE")})},f=function(){return new Promise(function(e,t){var r=Object.keys(i.userDialogs);Promise.all(r.map(function(e){return h(e)})).then(function(t){t.forEach(function(e){i.userDialogs[e.dialogId]=e.count||0}),e(i.userDialogs)}).catch(function(e){t(e)})})},h=function(e){return new Promise(function(t){QB.chat.message.unreadCount({chat_dialog_ids:e},function(r,o){t(r?0:{dialogId:e,count:(o||{})[e]||0})})})};return{init:function(){QB.init(i.kApplicationID,i.kAuthKey,i.kAuthSecret,{debug:{mode:window.globals.isProd()?0:1},chatProtocol:{active:2}}),QB.chat.onDisconnectedListener=u,QB.chat.onReconnectListener=c,QB.chat.onMessageListener=s,l()},loginToChat:function(){return new Promise(function(e,t){l().then(function(r){var o=_extends({},d(),{token:r.token});QB.login(o,function(r,o){r?401===r.code?g().then(e).catch(t):t(r):(i.chatUser=o,e(o),p())})}).catch(t)})},createOrStartChat:function(e){var t=e.lenderId,o=e.borrowerId,a=e.lenderQBId,n=e.borrowerQBId,i=e.productId,s=e.productName,u=e.chatRoomId,c=void 0===u?null:u,l=e.bookingId,d=void 0===l?null:l;return new Promise(function(e,u){if(c)r.chats.startBookingChat({lenderId:t,borrowerId:o,productId:i,chatRoomId:c,bookingId:d}).then(function(t){e(t.Data)}).catch(function(e){u(e)});else{var l={name:s,type:2,occupants_ids:[a,n]};QB.chat.dialog.create(l,function(a,n){if(a)u(a);else{var s=n._id;r.chats.startBookingChat({lenderId:t,borrowerId:o,productId:i,chatRoomId:s,bookingId:d}).then(function(t){e(t.Data)}).catch(function(e){n(e)})}})}})},setUserTyping:function(e,t){return new Promise(function(r){r(e+" is now "+(t?"Typing..":"Idle"))})},uploadMedia:function(e){return new Promise(function(e){e("Media file uploaded!")})},getChatList:function(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise(function(s,u){r.chats.getChatsList({userId:a,pageIndex:n}).then(function(r){if(r.Data){var a=r.Data.Chat_Borrow.concat(r.Data.Chat_Lent).map(function(e){return e.thumbnail=e.Lender_UserId==t.user.User_Id?e.Borrower_ProfileImage:e.Lender_ProfileImage,e.recipient=e.Lender_UserId==t.user.User_Id?e.Borrower_FullName:e.Lender_FullName,e.initialBadge=(i.userDialogs||{})[e.Chat_QBRoomId]||0,e.lastUpdatedDate=new Date(e.ChatLastUpdated),e.isLent=e.Lender_UserId==t.user.User_Id,e});a=a.sort(function(e,t){return e.lastUpdatedDate-t.lastUpdatedDate}),s(a),i.pendingChatToJoin&&(e.$emit(o.busChatEvents.selectPendingChat,{chatId:i.pendingChatToJoin}),i.pendingChatToJoin=void 0)}else u(Error("No data"))}).catch(u)})},getChatDetailed:function(e){return new Promise(function(t,o){r.chats.getChatByQBId({chatQbId:e}).then(function(e){return t(e.Data)}).catch(o)})},getChatHistory:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise(function(r,o){QB.chat.message.list({chat_dialog_id:e,skip:t,limit:10,sort_desc:"date_sent"},function(e,t){if(e)o(e);else{var a=t.items.map(function(e){return e.isMe=e.sender_id==i.chatUser.id,e.thumbnail="tofyk5Tv55ghu7pacsjz5a4stKjQj",e.dateSent=new Date(1e3*e.date_sent),"attachment"===e.message&&e.attachments&&e.attachments.length>0&&(e.message="",e.img=QB.content.privateUrl(e.attachments[0].uid)),e});r(a.reverse())}})})},signupToChat:g,connectToChat:function(){return new Promise(function(t,r){l().then(function(a){var n=_extends({},d(),{token:a.token});QB.createSession(n,function(a,s){s?(i.userToken=s.token,QB.chat.connect({userId:i.chatUser.id,password:n.password},function(a,n){a?r(a):(t(n),i.pendingChatToJoin&&(e.$emit(o.busChatEvents.selectPendingChat,{chatId:i.pendingChatToJoin}),i.pendingChatToJoin=void 0))})):r(a)})}).catch(r)})},disconnectChat:function(){QB.chat.disconnect()},syncDialogList:function(){return new Promise(function(e,t){QB.chat.dialog.list(null,function(r,o){o?(o.items.forEach(function(e){i.userDialogs[e._id]=i.userDialogs[e._id]||0}),f().then(e).catch(t)):t(r)})})},sendMessage:function(e){var t=e.dialogId,r=e.text,o=e.productId,a=e.input;return new Promise(function(e,n){var i=QB.chat.helpers.getRoomJidFromDialogId(t);if(a&&a.files.length>0){var s=a.files[0],u={name:s.name,file:s,type:s.type,size:s.size,public:!1};QB.content.createAndUpload(u,function(r,a){if(r)console.error(r),n(r);else{var s=a.uid,u={type:"groupchat",body:"attachment",ProductId:o,extension:{save_to_history:1,attachments:[{uid:s,type:"photo"}],ProductId:o,dialogID:t,isBot:"0"},markable:1};QB.chat.send(i,u),e()}})}else QB.chat.send(i,{type:"groupchat",body:r,extension:{save_to_history:1,ProductId:o,dialogID:t,isBot:"0"},markable:1}),e()})},joinChat:function(e){var t=QB.chat.helpers.getRoomJidFromDialogId(e);return new Promise(function(e,r){QB.chat.muc.join(t,function(t){e()})})},leaveChat:function(e){var t=QB.chat.helpers.getRoomJidFromDialogId(e);return new Promise(function(e,r){QB.chat.muc.leave(t,function(t){e()})})},notifyUser:function(e){var t=e.userId,r=e.dialogId,o=e.isNewChat,a=void 0!==o&&o;return new Promise(function(e,o){var n={type:"chat",extension:{notification_type:a?1:2,_id:r}};QB.chat.send(t,n),e()})},getUnreadMessage:f,clearUnreadBadgesForDialog:function(t){i.userDialogs[t]=0;var r=0;Object.keys(i.userDialogs).forEach(function(e){r+=i.userDialogs[e]}),e.$emit(o.busChatEvents.updateUnreadCount,{total:r,detailedDict:i.userDialogs})},activateChatWhenReady:function(e){i.pendingChatToJoin=e}}}]),angular.module("paladinPopups",["ngMaterial","ngMessages","ngMaterialDateRangePicker","angularMoment","720kb.socialshare"]).config(["$mdDialogProvider",function(e){e.addPreset("confirmPreset",{options:function(){return{templateUrl:"./views/popups/confirm.popup.html",controller:"confirmPopup",bindToController:!0,controllerAs:"confirmCtrl",clickOutsideToClose:!0,escapeToClose:!0}}}),e.addPreset("loginSignup",{options:function(){return{templateUrl:"./views/popups/loginSignup.popup.html",controller:"loginSignUpPopup",bindToController:!0,controllerAs:"loginSignupCtrl",clickOutsideToClose:!0,escapeToClose:!0}}}),e.addPreset("forgotPassword",{options:function(){return{templateUrl:"./views/popups/forgotPassword.popup.html",controller:"forgotPasswordPopup",controllerAs:"forgotPasswordCtrl",clickOutsideToClose:!0,escapeToClose:!0}}}),e.addPreset("idVerificationFailureHandler",{options:function(){return{templateUrl:"./views/popups/idVerificationFailureHandler.popup.html",controller:"idVerificationFailureHandlerPopup",controllerAs:"idVerificationFailureHandlerPopup",clickOutsideToClose:!1,escapeToClose:!1}}}),e.addPreset("emailVerification",{options:function(){return{templateUrl:"./views/popups/emailVerification.popup.html",controller:"emailVerificationPopup",controllerAs:"emailVerificationCtrl",clickOutsideToClose:!1,escapeToClose:!1}}}),e.addPreset("shareReferralLink",{options:function(){return{templateUrl:"./views/popups/shareToSocialMedia.popup.html",controller:"shareToSocialMediaPopup",controllerAs:"shareToSocialMediaCtrl",clickOutsideToClose:!0,escapeToClose:!0}}}),e.addPreset("changePassword",{options:function(){return{templateUrl:"./views/popups/changePassword.popup.html",controller:"changePasswordPopup",controllerAs:"changePasswordCtrl",clickOutsideToClose:!0,escapeToClose:!0}}}),e.addPreset("transactionStatusChange",{options:function(){return{templateUrl:"./views/popups/transactionStatusChange.popup.html",controller:"transactionStatusChangePopup",controllerAs:"transactionStatusChangeCtrl",clickOutsideToClose:!1,escapeToClose:!1}}}),e.addPreset("inputField",{options:function(){return{templateUrl:"./views/popups/inputField.popup.html",controller:"inputFieldPopup",controllerAs:"inputFieldCtrl",clickOutsideToClose:!1,escapeToClose:!1}}}),e.addPreset("loader",{options:function(){return{templateUrl:"./views/popups/loader.popup.html",controller:"loaderPopup",controllerAs:"loaderCtrl",panelClass:"loaderOverlay",clickOutsideToClose:!1,escapeToClose:!1}}}),e.addPreset("bookingTrackerInfoMobile",{options:function(){return{templateUrl:"./views/popups/bookingTrackerInfoMobile.popup.html",controller:"bookingTrackerInfoMobilePopup",controllerAs:"bookingTrackerInfoMobilePopupCtrl",clickOutsideToClose:!1,escapeToClose:!1}}})}]).service("popupService",["$mdDialog","$mdDateRangePicker","moment","ptUtils",function(e,t,r,o){this.showAlert=function(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POPUP_OK";return new Promise(function(a,n){var i=e.confirmPreset({locals:{title:t,message:r,isConfirm:!1,okBtn:o}});e.show(i).then(a).catch(n)})},this.showConfirm=function(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POPUP_YES",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"POPUP_NO";return new Promise(function(n,i){var s=e.confirmPreset({locals:{title:t,message:r,yesButton:o,noButton:a,isConfirm:!0}});e.show(s).then(n).catch(i)})},this.showLoginSignupPopup=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(r,o){var a=e.loginSignup({locals:{selectedTab:t?1:0}});e.show(a).then(r).catch(o)})},this.showForgotPassword=function(){return new Promise(function(t,r){e.show(e.forgotPassword()).then(t).catch(r)})},this.showIdVerificationFailureHandler=function(t){return console.log("idVerificationFailureHandler locals ",t),new Promise(function(r,o){var a=e.idVerificationFailureHandler({locals:t});e.show(a).then(r).catch(o)})},this.showEmailVerification=function(t){return new Promise(function(r,o){var a=e.emailVerification({locals:{userId:t}});e.show(a).then(r).catch(o)})},this.showShareReferralLink=function(t){return new Promise(function(r,o){var a=e.shareReferralLink({locals:{referralLink:t}});e.show(a).then(r).catch(function(e){console.log("close modal err ",e)})})},this.showDateRangePicker=function(e,a){return new Promise(function(n,i){var s=o.getBookedDateRanges(e);t.show({onePanel:!0,autoConfirm:!0,model:{},localizationMap:o.getTranslationDictForDatePicker(),maxRange:a.MaxRentalPeriod||void 0,isDisabledDate:function(e){for(var t=r(e),o=0;o<s.length;o++)if(t.isBetween(s[o].startDate,s[o].endDate)||t.isSame(s[o].startDate)||t.isSame(s[o].endDate))return!0;return!r().isBefore(e)}}).then(function(e){n(e)}).catch(function(){i()})})},this.showChangePassword=function(){return new Promise(function(t,r){var o=e.changePassword({locals:{wot:"no"}});e.show(o).then(t).catch(r)})},this.showTransactionStatusChange=function(t){var r=t.booking,o=t.apiMethod,a=t.title;return new Promise(function(t,n){var i=e.transactionStatusChange({locals:{booking:r,apiMethod:o,title:a}});e.show(i).then(t).catch(n)})},this.showInputField=function(t){var r=t.title,o=t.message,a=t.initialValue,n=t.inputRegexValidation,i=void 0===n?void 0:n,s=t.validationErrorMessage,u=void 0===s?"PLEASE_ENTER_A_VALID_INPUT":s;return new Promise(function(t,n){var s=e.inputField({locals:{title:r,message:o,value:a,inputRegexValidation:i,validationErrorMessage:u}});e.show(s).then(t).catch(n)})},this.showLoader=function(){e.show(e.loader())},this.hideLoader=function(){e.hide()},this.showBookingTrackerInfoMobilePopup=function(t){return new Promise(function(r){var o=e.bookingTrackerInfoMobile({locals:{booking:t}});e.show(o).then(r).catch(r)})}}]),angular.module("paladinApp").service("ptLog",[function(){this.log=function(){"verbose"===window.globals.LOG_LEVEL&&console.log.apply(this,["PALADIN LOG:"].concat(Array.prototype.slice.call(arguments)))},this.warn=function(){"verbose"===window.globals.LOG_LEVEL&&console.warn.apply(this,["PALADIN WARN:"].concat(Array.prototype.slice.call(arguments)))},this.error=function(){console.error.apply(this,["PALADIN ERROR:"].concat(Array.prototype.slice.call(arguments)))}}]),angular.module("paladinApp").service("apiService",["$rootScope","$q","$http","$base64","enums","ptLog","appStateManager",function(e,t,r,o,a,n,i){var s=this;s.ENV=window.globals.API_URL.slice(0,-1),s.timeoutCounter=0,s.maxTimeouts=5,s.raiseTimeout=function(){s.timeoutCounter<=s.maxTimeouts&&(s.timeoutCounter+=1),s.timeoutCounter>s.maxTimeouts&&e.isAppOnline&&e.$emit(a.busEvents.onAppOnlineState,!1)},s.loweTimeout=function(){s.timeoutCounter>0&&(s.timeoutCounter-=1),s.timeoutCounter<s.maxTimeouts&&!e.isAppOnline&&e.$emit(a.busEvents.onAppOnlineState,!0)},s.getHttpConfig=function(e,t){var r={headers:{"Access-Control-Allow-Origin":"*","X-Requested":null,"Content-Type":"application/json; charset=utf-8","Access-Control-Allow-Methods":"GET, POST, PATCH, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin, Content-Type, X-Auth-Token"}};return localStorage.getItem(a.localStorageKeys.jwtToken)&&(r.headers.Authorization=localStorage.getItem(a.localStorageKeys.jwtToken)),t&&Object.keys(t).forEach(function(e){r.headers[e]=t[e]}),e&&(r.params=e),r},s.getDefaultParams=function(){return{LanguageCode:i.getCurrentLang()}};return s.getRequest=function(o,i,u,c){var l=t.defer();return r.get(s.ENV+o,s.getHttpConfig(i,u)).then(function(e){s.loweTimeout(),e&&e.data&&"error"!=e.data.Status?l.resolve(e.data):l.reject(e)},function(t){if(!t)return console.warn("R_U"),void l.reject();if(401===t.status&&localStorage.getItem(a.localStorageKeys.refreshToken))n.log("Refreshing Token"),s.apiMethods.users.refreshToken(localStorage.getItem(a.localStorageKeys.refreshToken)).then(function(t){n.log("Refreshing Token success"),e.$emit(a.busEvents.tokenRefresh,t.data),setTimeout(function(){s.getRequest(o,i,u,c).then(l.resolve).catch(l.reject)},500)}).catch(l.reject);else if(423===t.status){if(c||(c=0),c<5)c++,setTimeout(function(){s.getRequest(o,i,u,c).then(function(e){return l.resolve(e.data)}).catch(l.reject)},500*c);else l.reject(t)}else 0!==t.status&&-1!==t.status||s.raiseTimeout(),l.reject(t)}),l.promise},s.postRequest=function(o,i,u,c){var l=t.defer();return r.post(s.ENV+o,i,s.getHttpConfig(null,u)).then(function(e){s.loweTimeout(),e&&e.data&&"error"!=e.data.Status?l.resolve(e.data):l.reject(e)},function(t){if(!t)return console.warn("R_U"),void l.reject();if(401===t.status&&localStorage.getItem(a.localStorageKeys.refreshToken))n.log("Refreshing Token"),s.apiMethods.users.refreshToken(localStorage.getItem(a.localStorageKeys.refreshToken)).then(function(t){n.log("Refreshing Token success"),e.$emit(a.busEvents.tokenRefresh,t.data),setTimeout(function(){s.postRequest(o,i,u,c).then(l.resolve).catch(l.reject)},500)}).catch(l.reject);else if(423===t.status){if(c||(c=0),c<5)c++,setTimeout(function(){s.postRequest(o,i,u,c).then(function(e){return l.resolve(e.data)}).catch(l.reject)},500*c);else l.reject(t)}else 0!==t.status&&-1!==t.status||s.raiseTimeout(),l.reject(t)}),l.promise},s.putRequest=function(o,i,u,c){var l=t.defer();return r.put(s.ENV+o,i,s.getHttpConfig(null,u)).then(function(e){s.loweTimeout(),e&&e.data&&"error"!=e.data.Status?l.resolve(e.data):l.reject(e)},function(t){if(!t)return console.warn("R_U"),void l.reject();if(401===t.status&&localStorage.getItem(a.localStorageKeys.refreshToken))n.log("Refreshing Token"),s.apiMethods.users.refreshToken(localStorage.getItem(a.localStorageKeys.refreshToken)).then(function(t){n.log("Refreshing Token success"),e.$emit(a.busEvents.tokenRefresh,t.data),setTimeout(function(){s.postRequest(o,i,u,c).then(l.resolve).catch(l.reject)},500)}).catch(l.reject);else if(423===t.status){if(c||(c=0),c<5)c++,setTimeout(function(){s.putRequest(o,i,u,c).then(function(e){return l.resolve(e.data)}).catch(l.reject)},500*c);else l.reject(t)}else 0!==t.status&&-1!==t.status||s.raiseTimeout(),l.reject(t)}),l.promise},s.apiMethods={categories:{getCategories:function(){return s.getRequest("/GetCategories?LanguageCode="+i.getCurrentLang())}},pages:{getHomePageData:function(e){var t={};return t.LanguageCode=i.getCurrentLang(),t.Categories=e,s.getRequest("/GetHomePageData",t)},getProductDetailData:function(e){var t={};return t.LanguageCode=i.getCurrentLang(),t.Product_Id=e,s.getRequest("/GetProductDetailData",t)}},products:{getSearchedProducts:function(e){var t=e.keyword,r=e.isShop,o=e.categoryId,a=e.subCategoryId,n=e.sortBy,u=e.minPriceRange,c=e.maxPriceRange,l=e.city,d=e.lat,g=e.lng,p=e.range,f=e.page,h=e.productPerPage,m=e.isWeb,_=e.productIDs,v=e.isTryAndBuy,y={LanguageCode:i.getCurrentLang()};t&&(y.KeywordProduct=encodeURIComponent(t));var I=i.getUserId();return null!=i.user&&null!=I&&(y.User_Id=I),o&&(y.Category_Id=o),a&&(y.SubCategory_Id=a),r&&(y.IsShop=r),n&&(y[n]=!0),u&&(y.MinPriceRange=u),c&&(y.MaxPriceRange=c),d&&g&&(y.Latitude=d,y.Longitude=g),l&&(y.Product_City=l),p&&(y.Range=p),m&&(y.IsWeb=m),f&&(y.PageIndex=f),h&&(y.productPerPage=h),_&&(y.productIDs=_),v&&(y.isTryAndBuy=v),s.getRequest("/GetSearchedProduct",y)},getPopularTryAndBuy:function(){return s.apiMethods.products.getSearchedProducts({productPerPage:20,sortBy:a.productsSortOptions.bestProduct,isTryAndBuy:!0})},getSuggestions:function(e){var t=s.getDefaultParams();return t.Keyword=encodeURIComponent(e),s.getRequest("/Suggestion",t)},getDetailedProduct:function(e){var t=s.getDefaultParams(),r=_extends({Product_Id:e},t),o=i.getUserId();return o&&(r.User_Id=o),s.getRequest("/GetProductDetail",r)},getUserProducts:function(e){var t=e.userId,r=e.productsFilter,o=e.pageIndex,a=void 0===o?0:o,n=s.getDefaultParams(),i=_extends({},n,{User_Id:t,PageIndex:a});return i[r]=!0,s.getRequest("/GetMyProducts",i)},getProductBookingDetails:function(e){var t=e.productId,r=e.userId,o=s.getDefaultParams(),a=_extends({},o,{User_Id:r,Product_Id:t});return s.getRequest("/ProductBookingDetail",a)},addProduct:function(e){var t=e.Product_ItemCategory_Id,r=e.Product_Title,o=e.Product_Description,a=e.Product_Price_Perday,n=e.Product_IsShop,i=e.Product_City,u=e.Product_ShopURL,c=e.Price1Day,l=e.Price15Day,d=e.Product_TryAndBuy,g=e.MinRentalPeriod,p=e.MaxRentalPeriod,f=e.Product_Longitude,h=e.Product_Latitude,m=e.ProductImage_Image1,_=e.Product_LenduserId,v=_extends({},s.getDefaultParams(),{Product_ItemCategory_Id:t,Product_Title:r,Product_Description:o,Product_Price_Perday:a,Product_IsShop:n,Product_City:i,Product_ShopURL:u,Price1Day:c,Price15Day:l,Product_TryAndBuy:d,MinRentalPeriod:g,MaxRentalPeriod:p,Product_Longitude:f,Product_Latitude:h,ProductImage_Image1:m,Product_LenduserId:_});return s.postRequest("/AddProduct",v)}},reviews:{submitTransactionReview:function(e){return s.postRequest("/AddBookingReview",e)}},users:{signUp:function(e){var t=e.email,r=e.username,o=e.password,a={User_UserName:r,User_Email:t,User_Address:e.location,User_Password:o,User_UDIDType:3,LanguageCode:e.currentLang,ReferralCode:e.referralCode};return s.postRequest("/SignUp",a)},signupFacebook:function(e){var t=e.facebookName,r=e.email,o=e.address,a=e.currentLang,n=e.facebookUserId,i=e.referralCode,u={User_UserName:t.replace(" ","-"),User_Email:r,User_Address:o,User_Password:"",User_UDIDType:3,LanguageCode:a,User_DisplayPicturePath:"https://graph.facebook.com/"+n+"/picture?type=large",User_DisplayPicture:"https://graph.facebook.com/"+n+"/picture?type=large",User_FacebookId:n,User_FullName:t,User_QBId:"",ReferralCode:i};return s.postRequest("/Signup",u)},signUpReferred:function(e){var t={ReferralCode:e,LanguageCode:i.getCurrentLang()};return s.getRequest("/VerifyReferralCode",t)},login:function(e){var t=e.username,r=void 0===t?"":t,o=e.email,a={User_UserName:r,User_Email:void 0===o?"":o,User_Mobile:"",User_UDIDType:3,User_Password:e.password,User_FacebookId:"",LanguageCode:e.currentLang};return s.postRequest("/Login",a)},forgotPassword:function(e){var t=e.email,r=(e.currentLang,_extends({},s.getDefaultParams(),{User_Email:t}));return s.postRequest("/ForgetPassword",r,{Authorization:o.encode("Paladin:Paladin123")})},changePassword:function(e){var t=e.userId,r=e.newPassword,o=e.oldPassword,a=_extends({},s.getDefaultParams(),{User_Id:t,User_NewPassword:r,User_OldPassword:o});return s.postRequest("/ChangePassword",a)},emailVerification:function(e){var t=e.userId;return s.getRequest("/EmailVerfication/?User_Id="+t,void 0,{Authorization:o.encode("Paladin:Paladin123")})},getUserProfile:function(e){var t=e.userId,r=_extends({},s.getDefaultParams(),{User_Id:t});return s.getRequest("/GetUserProfile",r)},getUserCredit:function(e){var t=e.userId,r=_extends({},s.getDefaultParams(),{User_Id:t});return s.getRequest("/GetUserCredit",r)},refreshToken:function(e){return r({method:"POST",url:window.globals.TOKEN_URL,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var r in e)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")},data:{grant_type:"refresh_token",refresh_token:e}})},editProfile:function(e){var t=_extends({},s.getDefaultParams(),e);return s.putRequest("/EditProfile",t)},updateNotificaton:function(e){var t=e.userId,r=e.emailNotif,o=e.chatNotif,a=_extends({},s.getDefaultParams(),{Notification_Chat:o,Notification_Push:o,Notification_Email:r,Notification_UserId:t});return s.postRequest("/UpdateNotification",a)},deleteAccount:function(e){var t=_extends({},s.getDefaultParams(),{User_Id:e});return s.getRequest("/DeleteUser",t)}},bookings:{getUserBookings:function(e){var t=_extends({},s.getDefaultParams(),{User_Id:e});return s.getRequest("/GetUserBookings",t)},getBookingDetailed:function(e){var t=e.bookingId,r=e.userId,o=_extends({},s.getDefaultParams(),{User_Id:r,BookingId:t});return s.getRequest("/GetBookingDetail",o)},acceptBookingRequest:function(e){var t=e.bookingId,r=e.userId,o=_extends({},s.getDefaultParams(),{Lender_Id:r,BookingId:t});return s.getRequest("/AcceptBookingRequest",o)},rejectBookingRequest:function(e){var t=e.bookingId,r=e.userId,o=_extends({},s.getDefaultParams(),{User_Id:r,BookingId:t});return s.getRequest("/RejectBookingRequest",o)},cancelBookingRequest:function(e){var t=e.bookingId,r=e.userId,o=e.reason,a=_extends({},s.getDefaultParams(),{User_Id:r,BookingId:t,Reason:o});return s.getRequest("/CancelBookingRequest",a)},startRental:function(e){var t=e.bookingId,r=e.userId,o=_extends({},s.getDefaultParams(),{User_Id:r,BookingId:t});return s.getRequest("/StartRentalBookingRequest",o)},endRental:function(e){var t=e.bookingId,r=e.userId,o=_extends({},s.getDefaultParams(),{User_Id:r,BookingId:t});return s.getRequest("/EndRentalBookingRequest",o)},bookProduct:function(e){var t=e.stripeEmail,r=e.borrowerId,o=e.lenderId,a=e.productId,n=e.startDate,i=e.endDate,u=e.noOfDays,c=e.coupon,l=e.stripeCustomerId,d=e.isSaveCard,g=e.idVerified,p=e.isPickUp,f=e.deliveryLat,h=e.deliveryLng,m=e.deliveryAddress,_=e.deliveryName,v=e.deliveryPhone,y=e.deliveryBell,I=e.isTryAndBuy,S=_extends({},s.getDefaultParams(),{Stripe_Email:t,Borrower_UserId:r,Lender_UserId:o,Product_Id:a,StartDate:n,EndDate:i,NoOfDays:u,CouponNumber:c,CustomerAccountId:l,SaveCard:d,IdVerfied:g,Booking_PickupProduct:p,Delivery_Latitude:f,Delivery_Longitude:h,Delivery_Address:m,Complete_Borrower_Name:_,Phone_Number:v,House_Name:y});return s.postRequest(I?"/BookTryAndBuyProduct":"/BookProduct",S)}},payments:{createUserStripeAccount:function(e){var t=e.userId,r=e.bookingId,o=e.email,a=e.country,n=_extends({},s.getDefaultParams(),{User_Id:t,Booking_Id:r,User_Email:o,User_Country:a});return s.postRequest("/CreateBookingStripeAccount",n)},verifyCoupon:function(e){var t=e.coupon,r=e.userId,o=_extends({},s.getDefaultParams(),{Coupon:t,User_Id:r});return s.getRequest("/VerifyCoupon",o)},createStripeCustomer:function(e){var t=e.email,r=e.cardToken,o=_extends({},s.getDefaultParams(),{Email:r,TokenId:t});return s.getRequest("/CreateStripeCustomer",o)}},purchase:{buyProduct:function(e){var t=e.stripeEmail,r=e.bookingId,o=e.purchaseAmount,a=e.borrowerId,n=e.lenderId,i=e.productId,u=e.stripeCustomerId,c=e.isSaveCard,l=e.isPickUp,d=e.deliveryLat,g=e.deliveryLng,p=e.deliveryAddress,f=e.deliveryName,h=e.deliveryPhone,m=e.deliveryBell,_=_extends({},s.getDefaultParams(),{Stripe_Email:t,Borrower_UserId:a,Lender_UserId:n,Stripe_Amount:o,Product_Id:i,Booking_Id:r,CustomerAccountId:u,SaveCard:c,Booking_PickupProduct:l,Delivery_Latitude:d,Delivery_Longitude:g,Delivery_Address:p,Complete_Borrower_Name:f,Phone_Number:h,House_Name:m});return s.postRequest("/BuyProduct",_)}},verification:{uploadPassport:function(e){var t=e.passportImage,r=e.selfie,o=e.userId,a=_extends({},s.getDefaultParams(),{PassPort:t,User_Selfie:r,User_Id:o});return s.postRequest("/IDVerficationDocument",a)},sendToManualVerification:function(e){var t=_extends({},s.getDefaultParams(),{PassPort:e.passportImage,User_Id:e.userId,NICFront:e.NICDLFront,NICBack:e.NICDLBack,User_Selfie:e.selfie,BookingId:e.bookingId});return s.postRequest("/IDManualVerficationDocument",t)},uploadNICDL:function(e){var t=e.NICDLFront,r=e.NICDLBack,o=e.selfie,a=e.userId,n=_extends({},s.getDefaultParams(),{User_Id:a,NICFront:t,NICBack:r,User_Selfie:o});return s.postRequest("/IDVerficationDocument",n)}},chats:{getChatsList:function(e){var t=e.userId,r=e.pageIndex,o=void 0===r?0:r,a=_extends({},s.getDefaultParams(),{User_Id:t,PageIndex:o});return s.getRequest("/GetChatList",a)},getChatDetailed:function(e){var t=e.chatId,r=_extends({},s.getDefaultParams(),{Chat_Id:t,ChatDone:0});return s.getRequest("/GetChatDetail",r)},getChatByQBId:function(e){var t=e.chatQbId,r=_extends({},s.getDefaultParams(),{Chat_QBRoomId:t,ChatDone:0});return s.getRequest("/GetChatInfoByQBId",r)},startBookingChat:function(e){var t=e.lenderId,r=e.borrowerId,o=e.productId,a=e.chatRoomId,n=void 0===a?null:a,i=e.bookingId,u=void 0===i?null:i,c=_extends({},s.getDefaultParams(),{User_UDIDType:3,Lender_Id:t,Borrower_Id:r,Product_Id:o,BookingId:u,Chat_QBRoomId:n});return s.postRequest("/StartBookingChat",c)}}},s.apiMethods}]),angular.module("paladinApp").factory("ngTranslateErrorHandler",["ptLog",function(e){return function(t,r){return e.warn('Translation for key "'+t+'" not found when using: '+r+", using key instead"),t}}]),angular.module("paladinApp").config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"/translations/locale-",suffix:".json"}).preferredLanguage(localStorage.getItem("PT_LSK_preferredLanguage")||"it").useMissingTranslationHandler("ngTranslateErrorHandler").useSanitizeValueStrategy("escapeParameters")}]),angular.module("paladinApp").factory("Filters",["$http","$base64","$rootScope","$q",function(e,t,r,o){var a={getHeaders:function(){return{"Access-Control-Allow-Origin":"*","X-Requested":null,"Content-Type":"application/json; charset=utf-8"}},get:function(t,o){r.categoriesMap&&r.categoriesMap.get(t)||e.get(window.globals.API_URL+"GetCategories?LanguageCode="+this.formatLanguageCode(t)).then(o)},getCategoryById:function(e,t){if(r.categoriesMap&&r.categoriesMap.get(t))for(var o=r.categoriesMap.get(t),a=0;a<o.length;a++)if(o[a].Category_Id==e)return o[a]},getSubcategoryById:function(e,t){if(r.categoriesMap&&r.categoriesMap.get(t))for(var o=r.categoriesMap.get(t),a=0;a<o.length;a++)for(var n=0;n<o[a].Category_SubCatrgories.length;n++)if(o[a].Category_SubCatrgories[n].SubCategory_Id==e)return o[a].Category_SubCatrgories[n]},getCategoryByName:function(e,t,o){if(r.categoriesMap&&r.categoriesMap.get(t))for(var a=r.categoriesMap.get(t),n=0;n<a.length;n++)if(o==a[n].IsTryAndBuy&&a[n].Category_Name&&a[n].Category_Name.toLowerCase().replace(/ /g,"-")==e.toLowerCase())return a[n]},getSubcategoryByName:function(e,t){if(r.categoriesMap&&r.categoriesMap.get(t))for(var o=r.categoriesMap.get(t),a=0;a<o.length;a++)for(var n=0;n<o[a].Category_SubCatrgories.length;n++)if(o[a].Category_SubCatrgories[n].SubCategory_Name&&o[a].Category_SubCatrgories[n].SubCategory_Name.toLowerCase().replace(/ /g,"-")==e.toLowerCase())return o[a].Category_SubCatrgories[n]},findByName:function(t,r,o){this.getHeaders();e.get(window.globals.API_URL+"GetCategories?LanguageCode="+this.formatLanguageCode(r)).then(function(e){for(var r=e.data.Data,a=0;a<r.length;a++){var n=r[a];if(n.Category_Name&&n.Category_Name.toLowerCase().replace(/ /g,"-")==t.toLowerCase())return void o(n)}o(null)})},getSuggestions:function(t,r){return e.get(window.globals.API_URL+"Suggestion?Keyword="+t+"&&LanguageCode="+this.formatLanguageCode(r)).then(function(e){return e.data.Data.map(function(e){return e.Keyword})})},getCategoriesUrl:function(e,t,r,o){var a=window.globals.ROOT_PATH+o+"/categorie/"+(r?"":"privato/");return null==t?a+=e:a=a+e+"/"+t+(filter.glCity?"/"+filter.glCity:""),a.split(" ").join("-")},formatLanguageCode:function(e){return"it"==e?"it-IT":e}};return a}]),angular.module("paladinApp").factory("Products",["$http","$base64","enums",function(e,t,r){var o={getHeaders:function(){return{"Access-Control-Allow-Origin":"*","X-Requested":null,"Content-Type":"application/json; charset=utf-8"}},getAll:function(t){return t.languageCode||(t.languageCode="it-IT"),e.get(window.globals.API_URL+"GetSearchedProduct?"+this.searchProductParam(t))},getTotalPageCount:function(t){t.languageCode||(t.languageCode="en");this.getHeaders();return e.get(window.globals.API_URL+"GetPageCount?"+this.searchProductParam(t))},encryptProductURL:function(e){return e.trim().split(" ").join("-").split("/").join("-")},getDetail:function(t,r,a){this.getHeaders();r||(LanguageCode="en"),isNaN(t)?e.get(window.globals.API_URL+"GetProductDetail?User_Id=0&Product_Title="+encodeURIComponent(o.decryptProductURL(t))).then(a):e.get(window.globals.API_URL+"GetProductDetail?User_Id=0&Product_Id="+t).then(a)},formatLanguageCode:function(e){return"it"==e?"it-IT":e},searchProductParam:function(e){for(var t=Object.keys(e),o="",a=0;a<t.length;a++){var n=t[a],i=e[n];if("languageCode"==n&&i)o+="LanguageCode="+encodeURIComponent(this.formatLanguageCode(i));else if("category"==n&&i)i.selectedCategoryId&&(o+="Category_Id="+encodeURIComponent(i.selectedCategoryId)),i.selectedSubCategoryId&&(o+="&SubCategory_Id="+encodeURIComponent(i.selectedSubCategoryId)),void 0!=i.isTryAndBuy&&(o+="&"==o[o.length-1]?"isTryAndBuy="+encodeURIComponent(i.isTryAndBuy):"&isTryAndBuy="+encodeURIComponent(i.isTryAndBuy));else if("sortBy"==n&&i)"SortByPopularity"==i?o+="SortByPopularity=true":"SortByRecent"==i?o+="SortByRecent=true":"SortByGeoLocation"==i?o+="SortByGeoLocation=true":"SortByLowPrice"==i?o+="SortByLowPrice=true":"SortByHighPrice"==i?o+="SortByHighPrice=true":"SortByBestProduct"==i&&(o+="SortByBestProduct=true");else if("priceRange"==n&&i){var s=i[0],u=i[1];o+="MinPriceRange="+encodeURIComponent(s)+"&MaxPriceRange="+encodeURIComponent(u)}else if("currentPage"==n&&i)o+="PageIndex="+encodeURIComponent(i-1);else if("search"==n&&i){var c="";i.searchStr&&(c+="KeywordProduct="+encodeURIComponent(i.searchStr),i.lat&&(c+="&")),i.lat&&e.sortByCode==r.productsSortByTextCode.SortByGeoLocation&&(c+="Latitude="+encodeURIComponent(i.lat),i.lng&&(c+="&")),i.lng&&e.sortByCode==r.productsSortByTextCode.SortByGeoLocation&&(c+="Longitude="+encodeURIComponent(i.lng)),o+=c}else if("distanceRange"==n&&i&&e.sortByCode==r.productsSortByTextCode.SortByGeoLocation){i<=50&&(o+="Range="+encodeURIComponent(i))}else"currentPage"==n&&i&&(o+="PageIndex="+(i-1));a<t.length-1&&o&&"&"!=o.slice(-1)&&(o+="&")}return o.endsWith("&")&&(o=o.substring(0,o.length-1)),o+="&isWeb=true"}};return o}]),angular.module("paladinApp").service("productReviewService",["$state","$stateParams","$window","enums","apiService",function(e,t,r,o,a){var n=this;n.booking=null;return{startReviewFlow:function(t,r){n.booking=t,e.go("app.products.productReview",{bookingId:t.Booking_Id})},leaveProductReviewPage:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];r.history.back()},submitTransactionReview:function(e){a.reviews.submitTransactionReview(e).then(function(e){toastService.simpleToast($translate.instant("REVIEW_ADDED_SUCCESSFULLY"))})},getBookingToReview:function(){return n.booking}}}]),angular.module("paladinApp").factory("pager",["$rootScope","$location",function(e,t){var r={GetPager:function(e,t,r){t=t||1;var o,a,n=e*(r=r||10);e<=10?(o=1,a=e):t<=6?(o=1,a=10):t+4>=e?(o=e-9,a=e):(o=t-5,a=t+4);var i=(t-1)*r;return{totalItems:n,currentPage:t,pageSize:r,totalPages:e,startPage:o,endPage:a,startIndex:i,endIndex:Math.min(i+r-1,n-1),pages:_.range(o,a+1)}}};return r}]),angular.module("paladinApp").service("appStateManager",["enums","$base64",function(e,t){var r={currentLang:localStorage.getItem(e.localStorageKeys.preferredLanguage)||"it",getCurrentLang:function(){return"it"==r.currentLang?"it-IT":r.currentLang},user:null,chatUser:null,getUserId:function(){var r=localStorage.getItem(e.localStorageKeys.userId);return t.decode(r).split(":")[1]||void 0},location:null,categoriesDict:null};return r}]),angular.module("paladinApp").service("dataService",["$rootScope","enums","appStateManager","$translate","ptLog","$base64","apiService","$state","popupService","$timeout","geoLocationService","chatService","$interval","ngMeta","$location",function(e,t,r,o,a,n,i,s,u,c,l,d,g,p,f){var h="dataService || ",m=!1,_=function(){e.$on(t.busEvents.userLogin,function(e,t){var r=t.oAuthToken;S(r),I(t.User_Id),D()}),e.$on(t.busEvents.userSignup,function(e,t){}),e.$on(t.busEvents.tokenRefresh,function(e,t){S(t)}),e.$on(t.busEvents.preferredLanguageChange,function(e,a){localStorage.setItem(t.localStorageKeys.preferredLanguage,a.currentLang),r.currentLang=a.currentLang,o.preferredLanguage(a.currentLang),o.use(a.currentLang),o.refresh();var n=location.pathname.replace(location.pathname.split("/")[1],a.currentLang);location.replace(n)}),e.$on(t.busEvents.userLogout,function(o){d.disconnectChat(),localStorage.clear(),localStorage.setItem(t.localStorageKeys.preferredLanguage,r.currentLang),r.user=null,e.$emit(t.busEvents.updatedUser,null),s.go("app.home",{languageCode:r.currentLang})}),e.$on(t.busEvents.triggerEmailValidation,function(e,t){u.showEmailVerification(t.userId).then(function(){s.go("app.home")}).catch(function(){s.go("app.home")})}),e.$on("$destroy",function(){console.log("ROOT SCOPE IS DEAD")})},v=function(){return new Promise(function(e,t){a.log(h,"Starting location update"),l.getLocation().then(function(t){y(t),a.log("Successfully got location"),e(t)}).catch(function(e){a.error(h,"error getting location",JSON.stringify(e)),t(e)})})},y=function(o){r.location=o;var a={lat:o.geometry.location.lat(),lng:o.geometry.location.lng()};localStorage.setItem(t.localStorageKeys.locationLatLong,JSON.stringify(a)),e.$emit(t.busEvents.locationUpdate,a)},I=function(e){localStorage.setItem(t.localStorageKeys.userId,n.encode(t.secret+":"+e))},S=function(e){e&&e.access_token&&e.token_type&&e.refresh_token?(localStorage.setItem(t.localStorageKeys.jwtToken,e.token_type+" "+e.access_token),localStorage.setItem(t.localStorageKeys.refreshToken,e.refresh_token)):a.error(h,"Sign up successful but access token was not provided!")},C=function(){return r.getUserId()},P=void 0,b=function(){d.syncDialogList().then(function(r){console.log(r);var o=0;Object.keys(r).forEach(function(e){o+=r[e]}),e.$emit(t.busChatEvents.updateUnreadCount,{total:o,detailedDict:r})}).catch(function(r){404==r.code?e.$emit(t.busChatEvents.updateUnreadCount,{total:0,detailedDict:{}}):a.error(r)})},D=function(){var o=C();o?i.users.getUserProfile({userId:o}).then(function(o){r.user=o.Data,a.log(h,"Fetched user profile"),e.$emit(t.busEvents.updatedUser,r.user),T(),d.loginToChat().then(function(){d.connectToChat().then(function(){d.syncDialogList(),function(e){if(e){if(P)return new Error("message poller already active");P=g(b,3e4)}else{if(!P)return new Error("message poller already deactivated");g.cancel(P),P=void 0}}(!0)}).catch(function(e){console.error("Could not connect to chat",JSON.stringify(e))})})}).catch(function(e){a.error(h,JSON.stringify(e))}):a.log(h,"User Id not found")},k=function(e){if(e){var r=n.encode(t.secret+"|:"+JSON.stringify(e));localStorage.setItem(t.localStorageKeys.pendingPrivateState,r)}else localStorage.removeItem(t.localStorageKeys.pendingPrivateState)},T=function(){var e=localStorage.getItem(t.localStorageKeys.pendingPrivateState);if(e){var r=JSON.parse(n.decode(e).split("|:")[1]);r&&(k(null),s.go(r.name,r.params,r.options))}};return{init:function(){m||(m=!0,_()),o.preferredLanguage(localStorage.getItem(t.localStorageKeys.preferredLanguage)||"it"),C()&&D()},setUserId:I,getUserId:C,getCategories:function(){i.categories.getCategories().then(function(o){var a={};o.Data.forEach(function(e){return a[e.Category_Id]=e}),r.categoriesDict=a,e.$emit(t.busEvents.categoriesUpdate,a)}).catch(function(e){a.error(e)})},getGeoLocationForApp:function(){return new Promise(function(e,o){if(r.location)e(r.location);else if(localStorage.getItem(t.localStorageKeys.locationLatLong)){var a=JSON.parse(localStorage.getItem(t.localStorageKeys.locationLatLong)),n=a.lat,i=a.lng;e({lat:n,lng:i})}else v().then(function(t){var r=t.geometry.location.lat(),o=t.geometry.location.lng();e({lat:r,lng:o})}).catch(o)})},forceLogin:function(e){var t=e.targetState(),r={name:t.identifier().name,params:t.params(),options:t.options().current()};k(r),u.showLoginSignupPopup(!1).catch(function(e){k(null)})},updateGeneralSEO:function(){var e=r.currentLang;window.globals.SUPPORTED_LANGS.forEach(function(r){p.setTag(t.ngMetaValues.currentUrl(r.code),f.absUrl().replace("/"+e+"/","/"+r.code+"/"))})}}}]),angular.module("paladinApp").service("menusService",["$rootScope","appStateManager","$translate","popupService","$mdToast","$state","enums","ZendeskWidget",function(e,t,r,o,a,n,i,s){return{commonMenus:{aboutMenu:{title:"ABOUT",list:[{itemId:"menu-item-try-n-buy",title:"TRY_AND_BUY",link:"https://paladintrue.com/"+t.currentLang+"/"+window.globals.SUPPORTED_LANGS.find(function(e){return t.currentLang==e.code}).tryAndBuyWordPressPath+"/"},{itemId:"menu-item-blog",title:"BLOG",link:"https://paladintrue.com/"+t.currentLang+"/blog/"},{itemId:"menu-item-faq",title:"FAQ",link:"https://paladintrue.com/"+t.currentLang+"/faq/"}]},accountLoggedOut:{title:"HEADER_MY_ACCOUNT",shouldHide:function(){return null!=t.user},list:[{itemId:"menu-item-login",title:"HEADER_LOGIN",BL:function(){return o.showLoginSignupPopup(!1)}},{itemId:"menu-item-signup",title:"HEADER_SIGNUP",BL:function(){return o.showLoginSignupPopup(!0)}}]},accountLoggedIn:{title:"HEADER_MY_ACCOUNT",shouldHide:function(){return null==t.user},list:[{itemId:"menu-item-my-profile",title:"MY_PROFILE",BL:function(){e.$emit(i.busNavigation.userProfile,{userId:t.user.User_Id})}},{itemId:"menu-item-message",title:"MESSAGES",BL:function(){return e.$emit(i.busNavigation.chat)}},{itemId:"menu-item-logout",title:"HEADER_LOGOUT",BL:function(){return e.$emit(i.busEvents.userLogout)}}]},linksMenu:{title:"LINKS",list:[{itemId:"menu-item-contact",title:"CONTACT",link:r.instant("URL_CONTACT")},{itemId:"menu-item-terms-n-conditions",title:"TANDC",link:"https://paladintrue.com/"+t.currentLang+"/terms-and-conditions/"},{itemId:"menu-item-privacy-policy",title:"PRIVACY_POLICY",link:"https://paladintrue.com/"+t.currentLang+"/privacy-policy/"},{itemId:"menu-item-help-support",title:"SUPPORT",BL:function(){s.activate()}}]},common:{title:"",list:[{itemId:"menu-item-browse",title:"BORROW",BL:function(){return n.go("app.browse")},link:window.globals.ROOT_PATH+t.currentLang+"/categorie/"+("it"==t.currentLang?"Tutte-le-Categorie":"All-Categories")+"?sortBy=SortByBestProduct&pageIndex=1"},{itemId:"menu-item-lend",title:"LEND",BL:function(){null==t.user?o.showLoginSignupPopup(!1):e.$emit(i.busNavigation.userListings)}},{itemId:"menu-item-my-rentals",title:"MY_RENTAL",BL:function(){null==t.user?o.showLoginSignupPopup(!1):e.$emit(i.busNavigation.rentals)}}]}},menuClickHandlerMethod:function(e){e.BL?e.BL():e.link&&window.open(e.link,"_self")},shouldShowMenuItem:function(e){return void 0==e.shouldHide||!e.shouldHide()}}}]),angular.module("paladinApp").service("geoLocationService",["$rootScope","appStateManager","ptLog",function(e,t,r){var o="geoLocationService || ",a=new google.maps.Geocoder,n=function(e){return new Promise(function(t,r){a.geocode(e,function(e,o){e&&e.length>0?t(e[0]):r({status:o})})})},i=function(){var e=window.globals.SUPPORTED_LANGS.find(function(e){return e.code===t.currentLang});return e?{address:e.defaultLocation}:{address:"milan italy"}};return{getLocation:function(){return new Promise(function(e,t){r.log("GET USER LOCATION"),new Promise(function(e,t){navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t):t({message:"goeLocation not supported by browser"})}).then(function(r){var o={location:{lat:r.coords.latitude,lng:r.coords.longitude}};n(o).then(function(t){e(t)}).catch(t)}).catch(function(a){r.error(o,JSON.stringify(a)),r.log(o,"Getting default location");var s=i();n(s).then(function(t){e(t)}).catch(t)})})},getUserCountryFromUserAddress:function(e){return new Promise(function(t,r){a.geocode({address:e},function(e,o){if("OK"==o)if(e&&e.length>0){var a=e[0].address_components;if(a&&a.length>0){var n=a.find(function(e){var t=e.types;return!!(t&&t.length>0)&&"country"===t[0].toLowerCase()});n?t(n):r(new Error("Country not found"))}else r(new Error("Address not found"))}else r(new Error("No results found"));else r(new Error("Could not geocode address"))})})},getUserAddressFromCoordinates:function(e){var t=e.lat,r=e.lng;return new Promise(function(e,o){a.geocode({location:{lat:t,lng:r}},function(t,r){if("OK"===r)if(t&&t.length>0){var a=t.find(function(e){var t=e.types;return!!(t&&t.length>0)&&"street_address"===t[0].toLowerCase()});a?e(a.formatted_address):o(new Error("Address not found"))}else o(new Error("No results found"));else o(new Error("Could not geocode coordinates"))})})}}}]),angular.module("paladinApp").service("toastService",["$mdToast",function(e){this.simpleToast=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.show(e.simple().textContent(t).hideDelay(r).position(o?"bottom right":"bottom left"))}}]),angular.module("paladinApp").service("navigationService",["$rootScope","$state","enums","ptLog","ptUtils","toastService",function(e,t,r,o,a,n){e.$on(r.busNavigation.homePage,function(){return t.go("app.home")}),e.$on(r.busNavigation.productDetailed,function(e,n){var i=n.product;i?t.go("app.products.selectedProduct",{productNameAndId:a.getProductNameAndId(i)}):o.error("navigationService ||",r.busNavigation.productDetailed,"NO PRODUCT")}),e.$on(r.busNavigation.browseCategory,function(e,o){var a=o.categoryId,n=o.subCategoryName,i=o.categoryName,s={};a?s.category=a:i&&(s.category=i.replace(/\ /g,"-")),n&&(s.subCategory=n.replace(/\ /g,"-")),s.sortBy=r.productsSortOptions.bestProduct,s.isResetSearch=!0,t.go("app.browse",s)}),e.$on(r.busNavigation.browseKeyword,function(e,r){t.go("app.browse",{search:r.keyword})}),e.$on(r.busNavigation.switchBrowseMode,function(e,r){r.isTryAndBuy?t.go("app.browse"):t.go("app.browsePrivate")}),e.$on(r.busNavigation.browseSort,function(e,r){t.go("app.browse",{sortBy:r.sortBy,search:"",isResetSearch:!0})}),e.$on(r.busNavigation.userProfile,function(e,r){var o=r.userId,a=r.replace;t.go("app.profiles.publicProfile",{userId:o},a?{location:"replace"}:void 0)}),e.$on(r.busNavigation.userListings,function(){return t.go("app.myListings")}),e.$on(r.busNavigation.newProduct,function(){return t.go("app.products.newProduct")}),e.$on(r.busNavigation.rentals,function(){return t.go("app.bookings.userBookings")}),e.$on(r.busNavigation.transactionDetailed,function(e,r){var o=r.bookingId,a=r.replace;t.go("app.bookings.bookingDetailed",{bookingId:o},a?{location:"replace"}:void 0)}),e.$on(r.busNavigation.idVerification,function(e,r){var o=r.bookingId,a=r.replace;t.go("verification.user",{bookingId:o||void 0},a?{location:"replace"}:void 0)}),e.$on(r.busNavigation.userReview,function(e,r){r.bookingId,r.isLender;t.go("app.products.productReview",{bookingId:booking.Booking_Id})}),e.$on(r.busNavigation.paymentDetailed,function(e,r){var o=r.startDate,a=r.endDate,n=r.productId,i=r.purchase,s=r.bookingId;t.go("app.bookings.paymentDetailed",{startDate:o,endDate:a,productId:n,purchase:i,bookingId:s})}),e.$on(r.busNavigation.chat,function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;r&&r.chatId?t.go("app.chat",{chatId:r.chatId}):t.go("app.chat")})}]),angular.module("paladinApp").service("uploadHandler",[function(){this.convertInputElementToBas64=function(t){return new Promise(function(r,o){if(t&&t.files&&t.files.length>0)return e(t.files[0]).then(r).catch(o);o("no file uploaded")})};var e=function(e){return new Promise(function(t,r){var o=new FileReader;o.onloadend=function(){if(o.result){var a=o.result.replace("data:"+e.type+";base64,","");t({original64:o.result,serverParsed64:a})}else r("error uploading image")},o.readAsDataURL(e)})}}]),angular.module("paladinApp").service("ptUtils",["$rootScope","enums","moment","$translate","$timeout","ptLog","geoLocationService","$sce",function(e,t,r,o,a,n,i,s){var u=function(e){var t=e.startRentDate,o=e.endRentDate,a=r.isMoment(t)?t:r(new Date(t));return(r.isMoment(o)?o:r(new Date(o))).diff(a,"days")+1},c=function(e){var t=e.ProductBookingDetail;if(t&&t.length>0){var o=[];return t.forEach(function(e){o.push({endDate:r(e.EndDate),startDate:r(e.StartDate)})}),o}return[]},l=function(e,t){return e.isBetween(t.startDate,t.endDate)||e.isSame(t.startDate)||e.isSame(t.endDate)},d={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return d.Android()||d.BlackBerry()||d.iOS()||d.Opera()||d.Windows()}},g=function(e){var r=e.Product_CategoryId,o=e.Product_TryAndBuy;return t.categoriesIds.tryAndBuy==r||o},p=function(e){return(e.Product_Title+" "+e.Product_Id).replace(/\ /g,"-")},f=function(e){var t=e.object,r=e.addressFieldName,o=e.latFieldName,a=e.lngFieldName;return new Promise(function(e,n){var s=t[r],u=Number(t[o]||0),c=Number(t[a]||0);!s&&u&&c?i.getUserAddressFromCoordinates({lat:u,lng:c}).then(function(t){e({address:t,lat:u,lng:c})}).catch(n):e({address:s,lat:u,lng:c})})};return{stringToDate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD/MM/YYYY HH:mm",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:":",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:" ",n=-1!=t.indexOf("HH")&&-1!=t.indexOf("mm");n&&e.split(a);var i=(n?t.split(a)[0]:t).split(r),s=(n?e.split(a)[0]:e).split(r),u=i.indexOf(i.find(function(e){return-1!=e.indexOf("Y")})),c=i.indexOf("MM"),l=i.indexOf("DD"),d=void 0,g=void 0;if(n){var p=e.split(a)[1].split(o),f=t.split(a)[1].split(o);return d=f.indexOf("HH"),g=f.indexOf("mm"),new Date(s[u],parseInt(s[c])-1,s[l],p[d],p[g])}return new Date(s[u],parseInt(s[c])-1,s[l])},getDisplayDataForTransactionStatus:function(e){var r=void 0,o=void 0;switch(e){case t.productRentalStatus.available:r="PRODUCT_STATUS_AVAILABLE",o="rentOrderStatus-primary-50";break;case t.productRentalStatus.requested:o="rentOrderStatus-primary-100",r="PRODUCT_STATUS_REQUESTED";break;case t.productRentalStatus.timeout:case t.productRentalStatus.timeoutByBorrower:o="rentOrderStatus-primary-200",r="PRODUCT_STATUS_TIMEOUT";break;case t.productRentalStatus.canceled:case t.productRentalStatus.criticalCancel:case t.productRentalStatus.moderateCancel:case t.productRentalStatus.canceledByLender:o="rentOrderStatus-primary-200",r="PRODUCT_STATUS_CANCELED";break;case t.productRentalStatus.denied:o="rentOrderStatus-primary-200",r="PRODUCT_STATUS_DECLINED";break;case t.productRentalStatus.accepted:o="rentOrderStatus-primary-300",r="PRODUCT_STATUS_ACCEPTED";break;case t.productRentalStatus.started:o="rentOrderStatus-primary-400",r="PRODUCT_STATUS_STARTED";break;case t.productRentalStatus.ended:o="rentOrderStatus-primary-500",r="PRODUCT_STATUS_ENDED";break;case t.productRentalStatus.verified:o="rentOrderStatus-primary-50",r="PRODUCT_STATUS_VERIFIED";break;case t.productRentalStatus.notVerified:o="rentOrderStatus-primary-100",r="PRODUCT_STATUS_NOT_VERIFIED";break;case t.productRentalStatus.verifying:o="rentOrderStatus-primary-100",r="PRODUCT_STATUS_VERIFYING";break;case t.productRentalStatus.booked:o="rentOrderStatus-primary-300",r="PRODUCT_STATUS_BOOKED"}return{text:r,color:o}},getPriceForRentalPeriod:function e(r,o){var a=r.Price1Day,n=r.Price3Day,i=r.Price5Day,s=r.Price7Day,u=r.Price10Day,c=r.Price15Day,l=r.Product_TryAndBuy,d=r.Product_CategoryId,g=r.Product_Price_Perday,p=0;return t.categoriesIds.tryAndBuy==d||l?c>0&&o>=15?(p=o-15)>0?c+e(r,p):c:u>0&&o>=10?(p=o-10)>0?u+e(r,p):u:s>0&&o>=7?(p=o-7)>0?s+e(r,p):s:i>0&&o>=5?(p=o-5)>0?i+e(r,p):i:n>0&&o>=3?(p=o-3)>0?n+e(r,p):n:a>0&&o>=1?(p=o-1)>0?a+e(r,p):a:g*o:g*o},calculatePricingListForProduct:function(e,r,a,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return new Promise(function(d,g){if(e&&r&&!l){var p=u({startRentDate:e,endRentDate:r}),f=[],h=a.Product_CategoryId,m=a.Product_TryAndBuy,_=a.MinRentalPeriod,v=a.MaxRentalPeriod,y=n.DeliveryAndPickupDetail,I=y.Delivery_Fee,S=(y.PickUp_Address,t.categoriesIds.tryAndBuy==h||m),C=function(e,r){var o=e.Price3Day,a=e.Price5Day,n=e.Price7Day,i=e.Price10Day,s=e.Price15Day,u=e.Product_TryAndBuy,c=e.Product_CategoryId,l=e.Product_Price_Perday,d=0,g=void 0;return(t.categoriesIds.tryAndBuy==c||u)&&(s>0&&r>=15?(d=r-15,g=s):i>0&&r>=10?(d=r-10,g=i):n>0&&r>=7?(d=r-7,g=n):a>0&&r>=5?(d=r-5,g=a):o>0&&r>=3&&(d=r-3,g=o)),g?d>0?g+d*l:g:l*r}(a,p),P=""+p;if(S){if(_>0&&p<_)return g({code:-2,message:o.instant("INVALID_MIN_RENTAL_PERIOD",{days:_})});v>0&&p>v&&g({code:-3,message:o.instant("INVALID_MAX_RENTAL_PERIOD",{days:v})})}f=[{price:C,description:P+" "+o.instant(1==p?"DAY":"DAYS")},{price:0,description:o.instant("SERVICE_FEE"),tooltip:o.instant("SERVICE_FEE_FREE")}],S&&i&&f.push({price:I||0,description:o.instant("DELIVERY_FEE")});var b=(S&&i&&I||0)+C;if(c){c.Coupon;var D=c.CouponValue,k=c.CouponIsPercentage;if(c.CouponIsFixed)b=D,f.push({description:o.instant("FIX_COUPON_DISCOUNT"),isCoupon:!0,price:""+D});else{var T=k?b*(D/100):D;(b-=T)<0&&(b=0),f.push({description:o.instant("COUPON"),isCoupon:!0,price:"-"+T})}}else if(s&&s.User_Credit){var w=s.User_Credit,L=w>=b-5?b-5:w;b-=L,f.push({description:o.instant("CREDIT"),isCredit:!1,price:"-"+L})}f.push({description:o.instant("TOTAL"),price:b}),d(f)}else if(l){var A=[];A.push({description:o.instant("RETAIL_PRICE"),price:a.Product_PurchasePrice}),i&&A.push({description:o.instant("DELIVERY_FEE"),price:a.Product_Process_Fee});var R=a.Product_Process_Fee+a.Product_PurchasePrice;A.push({description:o.instant("TOTAL"),price:R}),d(A)}})},getPriceCalculatedDescriptionForRentalPeriod:function(e,r){for(var o=e.Price1Day,a=e.Price3Day,n=e.Price5Day,i=e.Price7Day,s=e.Price10Day,u=e.Price15Day,c=e.Product_TryAndBuy,l=e.Product_CategoryId,d=e.Product_Price_Perday,g={},p=r;p>0;){var f=0,h=0;t.categoriesIds.tryAndBuy==l||c?u>0&&p>=15?(f=15,h=u):s>0&&p>=10?(f=10,h=s):i>0&&p>=7?(f=7,h=i):n>0&&p>=5?(f=5,h=n):a>0&&p>=3?(f=3,h=a):o>0&&p>=1?(f=1,h=o):(f=1,h=d):(f=1,h=d),g[h]=(g[h]||0)+1,p-=f}var m="";for(var _ in g)m+=(""===m?"":"+")+_+"x"+g[_];return m},getBookedDateRanges:c,isBookingDateBookedForDateRange:l,getProductFirstAvailableDatesToRent:function(e){for(var t=c(e),o={startDate:r(),endDate:r().add(1,"day")},a=0;a<t.length;a++)(l(o.startDate,t[a])||l(o.endDate,t[a]))&&(o.startDate=r(t[a].endDate).add(1,"day"),o.endDate=r(o.startDate).add(1,"day"));return o},regexPatterns:{email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,numbersOnly:/^[0-9]+$/,minMaxLength:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new RegExp(".{"+e+","+(t||"")+"}")}},sorters:{bookingLastModifiedEpoch:function(e,t){return t.Last_Modified-e.Last_Modified}},isProductTryAndBuy:g,playErrorSound:function(){try{var e=new AudioContext,t=e.createOscillator(),r=e.createGain();t.type="sine",t.connect(r),r.connect(e.destination),t.start(),r.gain.exponentialRampToValueAtTime(1e-4,e.currentTime+1)}catch(e){n.error("AudioContext not supported")}},dataUrlToBlob:function(e){for(var t=atob(e.split(",")[1]),r=[],o=0;o<t.length;o++)r.push(t.charCodeAt(o));return new Blob([new Uint8Array(r)],{type:"image/jpg"})},isMobile:d,isCrawler:function(){return/bot|prerender|googlebot|crawler|spider|robot|crawling/i.test(navigator.userAgent)},extractAndGeoLocateAddressFromObjectForFieldNames:f,getAddressToDisplayForBooking:function(e){var t=e.product,r=e.productBookingDetails,o=e.booking;return new Promise(function(e,a){var n=g(t),i={title:"PICK_UP",address:void 0,lat:void 0,lng:void 0};if(!t)return a("product must not be undefined");if(i.address=t.Lender_User_Address,i.lat=t.Product_Latitude,i.lng=t.Product_Longitude,n&&r&&o){var s=o.Booking_PickupProduct,u=o.Delivery_Latitude,c=o.Delivery_Longitude,l=o.Delivery_Address;if(s){var d=r.PickUp_Address,p=r.PickUp_Latitude,h=r.PickUp_Longitude;i.address=d,i.lat=p,i.lng=h}else i.title="DELIVERY_ADDRESS",i.address=l,i.lat=u,i.lng=c}f({object:i,addressFieldName:"address",latFieldName:"lat",lngFieldName:"lng"}).then(function(t){e(_extends({},t,{title:i.title}))}).catch(a)})},getRentalPeriodInDays:u,calculatePriceingListForBooking:function(e){return new Promise(function(t){var r=e.Booking_PickupProduct,a=e.FullEndDate,n=e.FullStartDate,i=e.Discount,s=e.DeliveryAndPickupDetail,c=e.RentAmount,l=e.Fix_Amount_Coupon,d=e.AmountCharge,g=s.Delivery_Fee,p=u({startRentDate:new Date(n),endRentDate:new Date(a)}),f=!r,h=[{price:f?c-g:c,description:p+" "+o.instant(1==p?"DAY":"DAYS")},{price:0,description:o.instant("SERVICE_FEE"),tooltip:o.instant("SERVICE_FEE_FREE")}];f&&h.push({price:g||0,description:o.instant("DELIVERY_FEE")}),i&&h.push({price:-i,description:o.instant("DISCOUNT")}),l>0&&h.push({price:l,description:o.instant("FIX_COUPON_DISCOUNT")}),h.push({price:d,description:o.instant("TOTAL")}),t(h)})},parseBookingStepTutorialHTMLTemplateForTranslationId:function(e){var t=o.instant(e);if(-1!=t.indexOf("|")){var r="<div>";return o.instant(e).split("|").forEach(function(e,t){r+=0==t?"<span>"+e+"</span> <ol>":"<li>"+e+"</li>"}),r+="</ol><div>",s.trustAsHtml(r)}return n.warn("ptUtils","parseBookingStepTutorialHTMLTemplateForTranslationId","failed to parse translationId:",e),t},getTranslationIdForBookingStatus:function(e,r,o){return e===t.productRentalStatus.notVerified||e===t.productRentalStatus.verified?"BookingStatusNotVerified_"+(r?"Lender":"Borrower"):e===t.productRentalStatus.verifying?"BookingStatusVerifying_Borrower":e===t.productRentalStatus.requested?"BookingStatusRequested_"+(r?"Lender":"Borrower"):e===t.productRentalStatus.accepted?"BookingStatusAccepted_"+(r?"Lender":"Borrower"):e===t.productRentalStatus.booked?"BookingStatusBooked_Borrower":e===t.productRentalStatus.timeout?"BookingStatusTimeout_"+(r?"Lender":"Borrower"):e===t.productRentalStatus.denied?"BookingStatusDenied_"+(r?"Lender":"Borrower"):e===t.productRentalStatus.canceled?"BookingStatusCancelled_"+(r?"Lender":"Borrower"):e===t.productRentalStatus.criticalCancel?"BookingStatusCriticalCancelled_"+(r?"Lender":"Borrower"):e===t.productRentalStatus.moderateCancel?"BookingStatusModerateCancelled_"+(r?"Lender":"Borrower"):e===t.productRentalStatus.canceledByLender?"BookingStatusCancelledLender_"+(r?"Lender":"Borrower"):e===t.productRentalStatus.started?o?r?"BookingStatusStarted_Lender":"BookingStatusStarted_Borrower_TnB":"BookingStatusStarted_"+(r?"Lender":"Borrower"):e===t.productRentalStatus.ended?o?r?"BookingStatusEnded_Lender":"BookingStatusEnded_Borrower_TnB":"BookingStatusEnded_"+(r?"Lender":"Borrower"):void 0},getTranslationDictForDatePicker:function(){return{Month:o.instant("Month"),Year:o.instant("Year"),"Date Range Template":o.instant("Date Range Template"),"Custom Date Range":o.instant("Custom Date Range"),Today:o.instant("Today"),Yesterday:o.instant("Yesterday"),"This Week":o.instant("Week"),"Last Week":o.instant("Week"),"This Month":o.instant("Month"),"Last Month":o.instant("Month"),"This Year":o.instant("Year"),"Last Year":o.instant("Year"),Cancel:o.instant("Cancel"),Clear:o.instant("Clear"),Ok:o.instant("Ok"),Sunday:o.instant("Sunday"),Monday:o.instant("Monday"),Tuesday:o.instant("Tuesday"),Wednesday:o.instant("Wednesday"),Thursday:o.instant("Thursday"),Friday:o.instant("Friday"),Saturday:o.instant("Saturday"),Sun:o.instant("Sunday"),Mon:o.instant("Monday"),Tue:o.instant("Tuesday"),Wed:o.instant("Wednesday"),Thu:o.instant("Thursday"),Fri:o.instant("Friday"),Sat:o.instant("Saturday"),January:o.instant("January"),February:o.instant("February"),March:o.instant("March"),April:o.instant("April"),May:o.instant("May"),June:o.instant("June"),July:o.instant("July"),August:o.instant("August"),September:o.instant("September"),October:o.instant("October"),November:o.instant("November"),December:o.instant("December"),Week:o.instant("Week")}},getProductDetailUrl:function(e){return window.globals.ROOT_PATH+o.use()+"/product/"+p(e)},getProductNameAndId:p,getCategoriesUrl:function(e,t,r,o){var a=window.globals.ROOT_PATH+o+"/categorie/"+(r?"":"privato/");return null==t?a+=e:a=a+e+"/"+t,a.split(" ").join("-")}}}]),angular.module("paladinApp").service("transactionService",["$rootScope","appStateManager","enums","apiService","popupService","geoLocationService","ptLog","ptUtils","$translate","gtmService","productReviewService","moment",function(e,t,r,o,a,n,i,s,u,c,l,d){var g=function e(r){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new Promise(function(c,l){var d=t.user,g=d.User_Address,p=d.User_Email,f=d.User_Id;if(!g)return l({isMissingAddress:!0});n.getUserCountryFromUserAddress(g).then(function(n){var i=n.short_name;o.payments.createUserStripeAccount({userId:f,email:void 0==u?p:u,bookingId:r.Booking_Id,country:i}).then(c).catch(function(o){a.showInputField({title:"ERROR",message:"BOOKING_END_RENTAL_STRIPE_ACCOUNT_DUPLICATE_ERROR",initialValue:t.user.User_Email,inputRegexValidation:s.regexPatterns.email}).then(function(t){a.showTransactionStatusChange({booking:r,apiMethod:function(){return e(r,t.value)},title:"END_RENTAL"}).then(c).catch(l)}).catch(l)})}).catch(function(e){i.error("transactionService || , error getting user country, "+JSON.stringify(e)),l(e)})})},p=function(t){a.showAlert("ERROR","BOOKING_INVALID_OPERATION","REFRESH").finally(function(){e.$emit(r.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id})})};return{acceptRental:function(t){return new Promise(function(n,i){a.showTransactionStatusChange({booking:t,apiMethod:function n(){return new Promise(function(i,s){o.bookings.acceptBookingRequest({bookingId:t.Booking_Id,userId:t.Lender_Id}).then(function(o){c.trackEvent("rental-status","request-accepted"),a.showAlert("SUCCESS","BOOKING_ACCEPTED_SUCCESS").finally(function(){e.$emit(r.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id}),i()})}).catch(function(e){if(e&&e.data&&e.data.Data&&403==e.data.Data)return p(t);a.showConfirm("ERROR","BOOKING_ACCEPTED_FAILURE","POPUP_TRY_AGAIN","POPUP_CANCEL").then(function(){n().then(i).catch(s)}).catch(function(){i()})})})},title:"ACCEPT_REQUEST"}).then(n).catch(i)})},rejectRental:function(t,n){return new Promise(function(i,s){var u=function i(){return new Promise(function(s,u){var l=n?t.Lender_Id:t.Borrower_Id;o.bookings.rejectBookingRequest({bookingId:t.Booking_Id,userId:l,reason:""}).then(function(o){c.trackEvent("rental-status",n?"request-declined":"request-cancelled-prior-approval"),a.showAlert("SUCCESS","BOOKING_CANCELED_SUCCESS").finally(function(){e.$emit(r.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id}),s()})}).catch(function(e){if(e&&e.data&&e.data.Data&&403==e.data.Data)return p(t);a.showConfirm("ERROR","BOOKING_CANCELED_FAILURE","POPUP_TRY_AGAIN","POPUP_CANCEL").then(function(){i().then(s).catch(u)}).catch(function(){s()})})})};a.showConfirm("CONFIRM",n?"BOOKING_REJECT_WARNING":"CANCEL_REQUEST_WARNING").then(function(){a.showTransactionStatusChange({booking:t,apiMethod:u,title:n?"DECLINE_REQUEST":"CANCEL_REQUEST"}).then(i).catch(function(e){console.log("...... ERR ",e," .... ",s),s()})}).catch(function(){i()})})},cancelRental:function(t,n){return new Promise(function(i,s){var u=function i(){return new Promise(function(s,u){var l=n?t.Lender_Id:t.Borrower_Id;o.bookings.cancelBookingRequest({bookingId:t.Booking_Id,userId:l,reason:""}).then(function(o){c.trackEvent("rental-status",n?"booking-cancelled-by-lender":"booking-cancelled-by-borrower"),a.showAlert("SUCCESS","BOOKING_CANCELED_SUCCESS").finally(function(){e.$emit(r.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id}),s()})}).catch(function(e){if(e&&e.data&&e.data.Data&&403==e.data.Data)return p(t);a.showConfirm("ERROR","BOOKING_CANCELED_FAILURE","POPUP_TRY_AGAIN","POPUP_CANCEL").then(function(){return i().then(s).catch(u)}).catch(function(){s()})})})},l=t.FullStartDate,g="BOOKING_CANCELLATION_MODERATE_WARNING";d(new Date(l)).diff(d(),"days")<=1&&(g="BOOKING_CANCELLATION_CRITICAL_WARNING"),a.showConfirm("CONFIRM",g).then(function(){a.showTransactionStatusChange({booking:t,apiMethod:u,title:"CANCEL_REQUEST"}).then(i).catch(s)}).catch(function(){i()})})},startRental:function(t){return new Promise(function(n,i){var s=function n(){return new Promise(function(i,s){o.bookings.startRental({bookingId:t.Booking_Id,userId:t.Borrower_Id}).then(function(){c.trackEvent("rental-status","rental-started"),a.showAlert("SUCCESS","BOOKING_START_RENTAL_SUCCESS").finally(function(){i(),e.$emit(r.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id})})}).catch(function(e){if(e&&e.data&&e.data.Data&&403==e.data.Data)return p(t);a.showConfirm("ERROR","BOOKING_START_RENTAL_FAILURE","POPUP_TRY_AGAIN","POPUP_CANCEL").then(function(){return n().then(i).catch(s)}).catch(s)})})};a.showConfirm("CONFIRM","BOOKING_START_RENTAL_WARNING").then(function(){a.showTransactionStatusChange({booking:t,apiMethod:s,title:"START_RENTAL"}).then(n).catch(i)})})},endRental:function(n){return new Promise(function(i,s){var u=function i(){return new Promise(function(s,u){var l=t.user;o.bookings.endRental({bookingId:n.Booking_Id,userId:n.Lender_Id}).then(function(t){c.trackEvent("rental-status","rental-ended"),l.User_StripeAccount?a.showAlert("SUCCESS","BOOKING_END_RENTAL_SUCCESS_PAYMENT").finally(function(){s(),e.$emit(r.busEvents.reloadDetailedBooking,{bookingId:n.Booking_Id})}):g(n).then(function(t){c.trackEvent("rental-status","stripe-account-created"),a.showAlert("SUCCESS","BOOKING_END_RENTAL_SUCCESS_PAYMENT").finally(function(){s(),e.$emit(r.busEvents.reloadDetailedBooking,{bookingId:n.Booking_Id})})}).catch(function(e){e&&e.isMissingAddress?a.showAlert("ERROR","PAYOUT_MISSING_ADDRESS").finally(function(){u()}):u()})}).catch(function(e){if(e&&e.data&&e.data.Data&&403==e.data.Data)return p(n);a.showConfirm("ERROR","BOOKING_END_RENTAL_FAILURE").then(function(){return i().then(s).catch(u)}).catch(function(){s()})})})};a.showConfirm("CONFIRM","BOOKING_END_RENTAL_WARNING").then(function(){a.showTransactionStatusChange({booking:n,apiMethod:u,title:"END_RENTAL"}).then(i).catch(s)})})},createUserStripeAccount:g,endRentalForStripeAccountOnly:function(t){return new Promise(function(o,n){a.showTransactionStatusChange({booking:t,apiMethod:function(){return g(t)},title:"CREATE_STRIPE_ACCOUNT"}).then(function(){c.trackEvent("rental-status","stripe-account-created"),a.showAlert("SUCCESS","CREATE_STRIPE_ACCOUNT_SUCCESS").then(function(){e.$emit(r.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id}),o()})}).catch(function(n){n&&n.isMissingAddress?a.showAlert("ERROR","PAYOUT_MISSING_ADDRESS").finally(function(){o()}):a.showAlert("ERROR","CREATE_STRIPE_ACCOUNT_FAILURE").then(function(){e.$emit(r.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id}),o()})})})}}}]),angular.module("paladinApp").service("stripeService",["$rootScope","enums","appStateManager","$q","$http",function(e,t,r,o,a){var n=this;return n.ENV=window.globals.STRIPE_URL,n.JSON_to_URLEncoded=function(e,t,r){if(r=r||[],"object"==(void 0===e?"undefined":_typeof(e)))for(var o in e)n.JSON_to_URLEncoded(e[o],t?t+"["+o+"]":o,r);else r.push(t+"="+encodeURIComponent(e));return r.join("&")},n.getHttpConfig=function(e,t){var r={headers:{"Access-Control-Allow-Origin":"*","X-Requested":null,"Content-Type":"application/x-www-form-urlencoded; charset=utf-8","Access-Control-Allow-Methods":"GET, POST, PATCH, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin, Content-Type, X-Auth-Token",Authorization:"Bearer "+window.globals.STRIPE_SK}};return t&&Object.keys(t).forEach(function(e){r.headers[e]=t[e]}),e&&(r.params=e),r},n.postRequest=function(e,t,r){var o=n.getHttpConfig(null,r);return a({method:"POST",url:n.ENV+e,headers:o.headers,params:o.params,transformRequest:function(e){return n.JSON_to_URLEncoded(e)},data:t})},n.getRequest=function(e,t,r){var o=n.getHttpConfig(null,r);return a({method:"GET",url:n.ENV+e,headers:o.headers,params:o.params,transformRequest:function(e){return n.JSON_to_URLEncoded(e)}})},n.apiMethods={createToken:function(e){var t=e.number,r=e.exp_month,o=e.exp_year,a=e.cvc,i=e.name;return n.postRequest("/tokens",{card:{number:t,exp_month:r,exp_year:o,cvc:a,name:i}})},getCustomer:function(e){return n.getRequest("/customers/"+e)},getCustomerSources:function(e){return n.getRequest("/customers/"+e+"/sources")}},n.apiMethods}]),angular.module("paladinApp").service("acuantService",["$rootScope","$http","$base64",function(e,t,r){var o="https://cssnwebservices.com/CSSNService/CardProcessor",a=r.encode(window.globals.isProd()?"A0E66E952D88":"E265037472E6"),n=function(e,r){return t({method:"POST",url:o+e,headers:{"Content-Type":"application/octet-stream; charset=utf-8;",Authorization:"LicenseKey "+a},dataType:"json",data:r})};return{processPassportImage:function(e){var t=e.imageToProcess,r=e.imageSource,o=e.usePreprocessing;return n("/ProcessPassport/true/true/true/0/150/"+o.toString()+"/"+r.toString()+"/true/false",t)},processNICDLDuplexImage:function(e){var r,n,i=e.frontImage,s=e.backImage,u=e.selectedRegion,c=e.imageSource,l=e.usePreprocessing,d=new FormData;return d.append("frontImage",i),d.append("backImage",s),r="/ProcessDLDuplex/"+u+"/true/-1/true/false/true/0/150/"+c.toString()+"/"+l.toString()+"/true/false",n=d,t({method:"POST",url:o+r,transformRequest:angular.identity,headers:{"Content-Type":void 0,Authorization:"LicenseKey "+a},dataType:"json",data:n})},processFacialMatch:function(e){var t=e.idFaceImage,r=e.selfie,o=new FormData;return o.append("idFaceImage",t),o.append("selfie",r),n("/FacialMatch",o)},processDriversLicense:function(e){var t=e.imageToProcess,r=e.selectedRegion,o=e.imageSource,a=e.usePreprocessing;return n("/ProcessDriversLicense/"+r+"/true/-1/true/true/true/0/150/"+a.toString()+"/"+o.toString()+"/true/false",t)}}}]),angular.module("paladinApp").service("gtmService",["$window",function(e){this.trackEvent=function(t,r,o,a){if(window.globals.isProd()){if(void 0==t||void 0==r)throw Error("GTMService.trackEvent: Missing required property. Aborting hit.");e.dataLayer.push({event:"ngTrackEvent",attributes:{category:t,action:r,label:o||null,value:a||null,nonInteraction:!0}}),console.log("DataLayer Event fired "+t+" "+r)}}}]),angular.module("paladinApp").service("referralsService",["$q","$location","apiService",function(e,t,r){var o=this;this.userName=null,this.referralCode=null,this.validateReferralCode=function(a){var n=o,i=a,s=a.split("-");s.pop();var u=s.join(" ");return e(function(e,o){return r.users.signUpReferred(i).then(function(t){n.userName=u,n.referralCode=i,e({userName:n.userName,referralCode:n.referralCode})},function(e){t.path("/"),o(e)})},function(e){console.info("Validating the referralCode was rejected with reason: ",e)})},this.getReferralData=function(){return{userName:o.userName,code:o.referralCode}}}]);var FilterComponent=function(){function e(t,r,o,a,n,i,s){_classCallCheck(this,e),this.scope=t,this.Filters=o,this.translate=n,this.enums=s,this.rootScope=a,this.categoryImageBaseUrl=window.globals.CATEGORY_IMAGE_URL,this.location=i,this.sce=r,this.slider={},this.showCategoriesDiv=!1,this.slider.priceSliderOption={options:{orientation:"horizontal",min:0,max:240,step:10,range:!0}},this.slider.distanceSliderOption={options:{orientation:"horizontal",min:0,max:240,step:10,range:!1}}}return e.$inject=["$scope","$sce","Filters","$rootScope","$translate","$location","enums"],_createClass(e,[{key:"$onInit",value:function(){this.scope.priceRange=[0,1e3],this.count=0,this.selectedTab=1==this.filter.category.isTryAndBuy?0:1,this.customCategoriesTnB=this.getCategories(!0),this.customCategoriesP2P=this.getCategories(!1);var e=this;this.scope.$watch("priceRange",function(){e.filter.priceRange[0]==e.scope.priceRange[0]&&e.filter.priceRange[1]==e.scope.priceRange[1]||(e.filter.priceRange=e.scope.priceRange,e.refreshProducts())}),this.scope.$on("languageChanged",function(t,r){e.filter.languageCode=e.getCurrentLanguageCode(),null!=e.filter.category.selectedSubCategoryId?e.refreshCategories(e.filter.category.selectedCategoryId,e.filter.category.selectedSubCategoryId,e.filter.languageCode):null!=e.filter.category.selectedCategoryId?e.refreshCategories(e.filter.category.selectedCategoryId,null,e.filter.languageCode):e.refreshCategories(null,null,e.filter.languageCode)})}},{key:"selectCategories",value:function(e,t,r){null==e?this.selectCategory(this.enums.allCategories[r],!1):(this.selectCategory(this.Filters.getCategoryById(e,r),!1),null!=t&&this.selectSubCategory(this.Filters.getSubcategoryById(t,r),!1))}},{key:"refreshCategories",value:function(e,t,r){this.filter.categories=this.rootScope.categoriesMap.get(r),this.selectCategories(e,t,r)}},{key:"getCategories",value:function(e){var t={},r=0;return this.rootScope.categoriesMap.get(this.getCurrentLanguageCode()).forEach(function(o){(e&&o.IsTryAndBuy||!e&&!o.IsTryAndBuy)&&(t[r++]=o)}),t}},{key:"toggleDiv",value:function(){this.showCategoriesDiv=!this.showCategoriesDiv}},{key:"getCurrentLanguageCode",value:function(){return this.translate.use()}},{key:"selectCategory",value:function(e,t){"string"!=typeof e?(this.filter.category.selectedCategoryId=e.Category_Id,this.filter.category.selectedCategoryDesc=this.sce.trustAsHtml(e.Category_Description),this.filter.category.selectedCategoryName=this.sce.trustAsHtml(e.Category_Name),this.filter.category.selectedCategoryImagePath=e.Category_ImagePath,this.filter.category.selectedCategoryBannerImage=e.Category_BannerPath,this.filter.category.isTryAndBuy=e.IsTryAndBuy,this.rootScope.category=this.filter.category.selectedCategoryName):(this.filter.category.selectedCategoryId=null,this.filter.category.selectedCategoryDesc=this.sce.trustAsHtml(e),this.filter.category.selectedCategoryName=e,this.filter.category.selectedCategoryImagePath=null,this.filter.category.isTryAndBuy=this.rootScope.isTryAndBuy,this.filter.category.selectedCategoryBannerImage=window.globals.IS_PROMO?this.enums.categoriesBannersPaths.promo:this.enums.categoriesBannersPaths.all[this.getCurrentLanguageCode()],this.rootScope.category=e),this.selectSubCategory(null,!1),t&&this.refreshProducts()}},{key:"onTabSelected",value:function(){0==this.selectedTab?this.rootScope.$emit(this.enums.busNavigation.switchBrowseMode,{isTryAndBuy:!0}):this.rootScope.$emit(this.enums.busNavigation.switchBrowseMode,{isTryAndBuy:!1})}},{key:"selectSubCategory",value:function(e,t){e?(this.filter.category.selectedSubCategoryId=e.SubCategory_Id,this.filter.category.selectedSubCategoryDesc=this.sce.trustAsHtml(e.SubCategory_Description),this.filter.category.selectedSubCategoryName=this.sce.trustAsHtml(e.SubCategory_Name),this.filter.category.selectedSubCategoryImagePath=e.SubCategory_ImagePath,this.filter.category.selectedSubCategoryBannerImage=e.SubCategory_BannerPath,this.rootScope.subcategory=this.filter.category.selectedSubCategoryName):(this.filter.category.selectedSubCategoryId=null,this.filter.category.selectedSubCategoryDesc=null,this.filter.category.selectedSubCategoryName=null,this.filter.category.selectedSubCategoryImagePath=null,this.filter.category.selectedSubCategoryBannerImage=null,this.rootScope.subcategory=null),this.filter.search.searchStr="",this.filter.search.currentSearchStr="",this.rootScope.searchKey=null,this.location.search("search",null),null!=this.rootScope.searchKey&&(this.rootScope.searchKey=null),this.filter.currentPage=1,t&&this.refreshProducts()}},{key:"getCategoryUrl",value:function(e,t,r){return this.Filters.getCategoriesUrl(0==e?this.translate.instant("ACTG"):e.Category_Name,null==t?null:t.SubCategory_Name,r,this.translate.use())}},{key:"refreshProducts",value:function(){this.rootScope.$broadcast("filtersUpdated",this.filter)}},{key:"increment",value:function(){this.count++}},{key:"decrement",value:function(){this.count--}}]),e}();angular.module("paladinApp").component("filters",{bindings:{categories:"<",filter:"=",count:"="},controller:FilterComponent,templateUrl:"./views/templates/filter.tpl.html"}),angular.module("paladinApp").directive("footer",["$rootScope","menusService","appStateManager","enums","$mdMedia","$state",function(e,t,r,o,a,n){return{restrict:"E",templateUrl:"./views/templates/footer.tpl.html",scope:{},link:function(i,s,u){i.extraStyle={height:"150px"},i.aboutMenu=t.commonMenus.aboutMenu,i.linksMenu=t.commonMenus.linksMenu,i.menuLists=[t.commonMenus.aboutMenu,t.commonMenus.accountLoggedIn,t.commonMenus.accountLoggedOut,t.commonMenus.linksMenu],i.supportedLanguages=window.globals.SUPPORTED_LANGS,i.selectedLanguage=i.supportedLanguages.find(function(e){return e.code===r.currentLang}),i.menuClick=function(e){t.menuClickHandlerMethod(e)},i.getMenuItemLink=function(e){return e.link||"#"},i.filterMenuItems=function(e){return t.shouldShowMenuItem(e)},i.onSelectLanguage=function(t){i.selectedLanguage=i.supportedLanguages.find(function(e){return e.code===t}),e.$emit(o.busEvents.preferredLanguageChange,{currentLang:t}),e.$broadcast("languageChanged",t)};var c=[];c.push(e.$on(o.busEvents.footerExtraHeight,function(e,t){i.extraStyle.height=t.height||i.extraStyle.height})),c.push(i.$watch(function(){return a("gt-sm")},function(e){var t="0";e||(n.includes("app.products.newProduct")||n.includes("app.products.selectedProduct")||n.includes("app.bookings.bookingDetailed")||n.includes("app.bookings.paymentDetailed")||n.includes("app.bookings.bookingDetailed")||n.includes("verification.user"))&&(t="150px"),function(e){e!=i.extraStyle.height&&(i.extraStyle.height=e)}(t)})),i.$on("$destroy",function(){for(;c.length;)c.pop()()})}}}]),angular.module("paladinApp").component("header",{bindings:{user:"="},controller:function(){function e(t,r,o,a,n,i,s,u,c,l){_classCallCheck(this,e),this.base64=t,this.scope=r,this.rootScope=o,this.translate=a,this.baseUrl=window.globals.API_URL,this.supportedLanguages=window.globals.SUPPORTED_LANGS,this.profileImageBaseUrl=window.globals.PROFILE_IMAGE_URL,this.mdDialog=n,this.http=i,this.btnStatus=10,this.signupMessage="",this.signupStatus="",this.signupFacebookStatus="",this.signupacebookMessage="",this.loginFacebookStatus="",this.loginFacebookMessage="",this.loginStatus="",this.loginMessage="",this.cookies=s,this.userStatus=!1,this.timeout=u,this.popupService=c,this.enums=l,this.user=null,this.registerBusEvents()}return e.$inject=["$base64","$scope","$rootScope","$translate","$mdDialog","$http","$cookies","$timeout","popupService","enums"],_createClass(e,[{key:"registerBusEvents",value:function(){var e=this,t=[];t.push(this.rootScope.$on(this.enums.busEvents.updatedUser,function(t,r){e.user=r,e.userStatus=null!=e.user})),this.scope.$on("$destroy",function(){for(;t.length;)t.pop()()})}},{key:"$onInit",value:function(){this.profileDefaultImage="../../assets/profile.png";var e=this;this.currentLang=this.translate.proposedLanguage()?this.translate.proposedLanguage():this.translate.preferredLanguage(),this.currentLang=this.rootScope.lang,this.translate.use(this.rootScope.lang),this.scope.$on("updateLanguage",function(t,r){e.changeLanguage(r,!1)}),void 0!=this.cookies.getObject("globals")&&void 0!=this.cookies.getObject("globals").currentUser&&void 0!=this.cookies.getObject("globals").currentUser.username&&(this.userStatus=!0),this.rootScope.$on("registeredSuccess",function(t,r){e.userStatus=!0})}},{key:"changeLanguage",value:function(e,t){this.rootScope.lang=e.code,this.translate.use(e.code),this.currentLang=e.code,t&&(this.rootScope.$broadcast("languageChanged",e.code),this.rootScope.$emit(this.enums.busEvents.preferredLanguageChange,{currentLang:e.code}))}},{key:"hide",value:function(){this.mdDialog.hide()}},{key:"cancel",value:function(){this.mdDialog.cancel()}},{key:"answer",value:function(e){this.mdDialog.hide(e)}},{key:"forgotPassword",value:function(e){var t=this;this.btnForgotPasswordStatus=1;var r={User_Email:e,LanguageCode:"it"==this.currentLang?"it-IT":this.currentLang};this.http.defaults.headers.common.Authorization="Basic "+this.base64.encode("Paladin:Paladin123"),this.http.defaults.headers.common.Charset="UTF-8",this.http.defaults.headers.common["Content-Type"]="application/json",this.http.post(this.baseUrl+"ForgetPassword/",JSON.stringify(r)).then(function(e){t.btnForgotPasswordStatus=10,t.forgotpasswordStatus=e.data.Status,t.forgotPasswordMessage=e.data.Message})}},{key:"showTabDialogForgotPassword",value:function(e){var t=this;this.mdDialog.show({controller:function(){return t},controllerAs:"ctrl",templateUrl:"tabDialogForgotPassword",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,http:this.http})}},{key:"register",value:function(e,t,r,o){var a=this;this.btnStatus=1;var n={User_UserName:e,User_Email:r,User_Address:o,User_Password:t,User_UDIDType:3,LanguageCode:"it"==this.currentLang?"it-IT":this.currentLang};this.http.post(this.baseUrl+"SignUp/",n).then(function(e){a.btnStatus=10,a.signupStatus=e.data.Status,"error"==e.data.Status&&(a.signupMessage=e.data.Message)})}},{key:"registerFacebook",value:function(){var e=this;if(this.rootScope.facebookApiLoaded){this.btnStatus=1;var t={User_UserName:this.rootScope.facebook_user.name.replace(" ","-"),User_Email:this.rootScope.facebook_user.email,User_Address:this.rootScope.facebook_user.address,User_Password:"",User_UDIDType:3,LanguageCode:"it"==this.currentLang?"it-IT":this.currentLang,User_DisplayPicturePath:"http://graph.facebook.com/"+this.rootScope.facebook_user.id+"/picture?type=small",User_DisplayPicture:"http://graph.facebook.com/"+this.rootScope.facebook_user.id+"/picture?type=small",User_FacebookId:this.rootScope.facebook_user.id,User_FullName:this.rootScope.facebook_user.name,User_QBId:""};this.http.post(this.baseUrl+"SignUp/",t).then(function(t){if(e.btnStatus=10,e.signupFacebookStatus=t.data.Status,"error"==t.data.Status)e.signupFacebookMessage=t.data.Message;else{e.rootScope.globals={currentUser:{username:t.data.Data.User_UserName,token_type:t.data.Data.oAuthToken.token_type,access_token:t.data.Data.oAuthToken.access_token,refresh_token:t.data.Data.oAuthToken.refresh_token,User_Id:t.data.Data.User_Id,User_DisplayPicturePath:"http://graph.facebook.com/"+e.rootScope.facebook_user.id+"/picture?type=small",User_DisplayPicture:"http://graph.facebook.com/"+e.rootScope.facebook_user.id+"/picture?type=small"}};var r=new Date;r.setDate(r.getDate()+t.data.Data.oAuthToken.expires_in),e.cookies.putObject("globals",e.rootScope.globals,{expires:r}),e.http.defaults.headers.common.Authorization=e.cookies.getObject("globals").currentUser.token_type+" "+e.cookies.getObject("globals").currentUser.access_token,e.hide(),e.userStatus=!0}})}else{this.signupFacebookStatus="error",this.signupFacebookMessage=this.translate.instant("FACEBOOK_LOADING");var r=this;this.timeout(function(){r.registerFacebook()},2e3)}}},{key:"logout",value:function(){this.userStatus=!1,this.cookies.remove("globals"),this.http.defaults.headers.common.Authorization=""}},{key:"login",value:function(e,t){var r=this;this.btnStatus=1;var o={User_UserName:e,User_Email:"",User_Mobile:"",User_Password:t,User_FacebookId:"",LanguageCode:"it"==this.currentLang?"it-IT":this.currentLang};this.http.post(this.baseUrl+"Login/",o).then(function(e){if(r.btnStatus=10,"error"!=e.data.Status){r.loginStatus=e.data.Status,console.log(e.data.Data),r.rootScope.globals={currentUser:{username:e.data.Data.User_UserName,token_type:e.data.Data.oAuthToken.token_type,access_token:e.data.Data.oAuthToken.access_token,refresh_token:e.data.Data.oAuthToken.refresh_token,User_Id:e.data.Data.User_Id,User_DisplayPicturePath:e.data.Data.User_DisplayPicturePath}};var t=new Date;t.setDate(t.getDate()+e.data.Data.oAuthToken.expires_in),r.cookies.putObject("globals",r.rootScope.globals,{expires:t}),r.http.defaults.headers.common.Authorization=r.cookies.getObject("globals").currentUser.token_type+" "+r.cookies.getObject("globals").currentUser.access_token,r.http.get(r.baseUrl+"GetUserProfile?User_Id="+r.cookies.getObject("globals").currentUser.User_Id+"&LanguageCode="+r.currentLang).then(function(e){console.log(e),r.hide(),r.userStatus=!0})}else console.log(JSON.stringify(e,null,4)),r.loginStatus=e.data.Status,r.loginMessage=e.data.Message})}},{key:"showTabDialog",value:function(e){this.popupService.showLoginSignupPopup()}}]),e}(),templateUrl:"./views/templates/header.tpl.html"}),angular.module("paladinApp").directive("headerV2",["$rootScope","appStateManager","popupService","$mdMenu","$translate","enums","$mdSidenav","$window","menusService","apiService","$state","$transitions","$mdComponentRegistry",function(e,t,r,o,a,n,i,s,u,c,l,d,g){return{restrict:"E",scope:{},templateUrl:"./views/templates/headerV2.tpl.html",link:function(o,s,p){o.isScrollOffsetZero=(l.current.data||{}).isCollapsingHeader||!1,o.searchText="",o.searchItems=["one","two","three","four","five"],o.unreadBadge=0,o.aboutMenu=u.commonMenus.aboutMenu.list,o.profileMenu=u.commonMenus.accountLoggedIn.list,o.loggedOutMenu=u.commonMenus.accountLoggedOut.list,o.commonMenu=u.commonMenus.common.list,o.linksMenu=u.commonMenus.linksMenu,o.loggedInMenu=[{title:a.instant("LENT_BORROWED"),BL:function(){return alert("Navigate to "+a.instant("LENT_BORROWED"))}},{title:a.instant("LISTINGS"),BL:function(){return alert("Navigate to "+a.instant("LISTINGS"))}},{title:a.instant("MESSAGES"),BL:function(){return alert("Navigate to "+a.instant("MESSAGES"))}}],o.loginSignUpPopupClick=function(e){r.showLoginSignupPopup(e)},o.querySearch=function(e){var t=e.toLowerCase();return c.products.getSuggestions(t).then(function(t){return[{Rank:1/0,Keyword:e}].concat(_toConsumableArray(t.Data.sort(function(e,t){return t.Rank-e.Rank})))})},o.headerMenuClick=function(e){o.close(),u.menuClickHandlerMethod(e)},o.getMenuItemLink=function(e){return e.link||"#"},o.initiateSearch=function(t){t&&""!=t&&e.$emit(n.busNavigation.browseKeyword,{keyword:t})},o.searchBarOnKeyPress=function(e){13==e.which&&e.target.value&&""!=e.target.value&&(o.initiateSearch(e.target.value),e.preventDefault())},o.toggleSideNav=function(){g.get(n.inAppSideNavsIds.chatSideNav)&&i(n.inAppSideNavsIds.chatSideNav).isOpen()&&i(n.inAppSideNavsIds.chatSideNav).toggle(),i(n.inAppSideNavsIds.mainMobileNav).toggle()},o.close=function(){i(n.inAppSideNavsIds.mainMobileNav).close()},t.user&&(o.user=t.user),o.updateCreditButton=function(){var e=t.getUserId();e&&c.users.getUserCredit({userId:e}).then(function(e){o.currentCredit=e.Data.User_Credit,o.currentCreditText=o.currentCredit&&o.currentCredit>0?a.instant("CREDIT_MENU_ITEM")+": "+o.currentCredit+"â‚¬":a.instant("GET_FREE_CREDIT")},function(e){console.log("getUserCredit failed because: ",e)})},o.creditMenuClick=function(){o.close(),e.$emit(n.busNavigation.userProfile,{userId:o.user.User_Id})};var f=[];f.push(e.$on(n.busEvents.updatedUser,function(e,r){o.user=t.user,o.updateCreditButton()})),f.push(e.$on(n.busChatEvents.updateUnreadCount,function(e,t){o.unreadBadge=t.total||0,o.$apply()})),d.onSuccess({to:"app.**"},function(){o.isScrollOffsetZero=(l.current.data||{}).isCollapsingHeader||!1,o.hideSearch=l.includes("app.browse")}),angular.element(document.getElementById("main-ui-view")).bind("scroll",function(){var e=o.isScrollOffsetZero,t=void 0;(t=!(this.scrollTop>50)&&((l.current.data||{}).isCollapsingHeader||!1))!==e&&o.$evalAsync(function(){o.isScrollOffsetZero=t})}),o.$on("$destroy",function(){for(angular.element(document.getElementById("main-ui-view")).unbind("scroll");f.length;)f.pop()()}),o.updateCreditButton()}}}]),angular.module("paladinApp").component("search",{bindings:{filter:"="},controller:function(){function e(t,r,o,a,n){_classCallCheck(this,e),this.scope=t,this.rootScope=r,this.translate=o,this.apiService=a,this.enums=n}return e.$inject=["$scope","$rootScope","$translate","apiService","enums"],_createClass(e,[{key:"$onInit",value:function(){var e=this;this.scope.distanceDropDown=[{l_id:1,distance:1,name:"VC"},{l_id:2,distance:5,name:"NB"},{l_id:3,distance:10,name:"IC"},{l_id:4,distance:50,name:"IA"},{l_id:5,distance:200,name:"FA"}],this.scope.distanceRange=200,this.selectedRange={l_id:5,distance:200,name:"FA"},this.scope.myModelVal=this.scope.distanceDropDown[4],this.scope.$on("distanceChanged",function(t,r){r&&e.changeDistanceFilter(),e.loading=!1}),this.selectedItem=""}},{key:"initiateSearch",value:function(e){e&&""!=e&&$rootScope.$emit(enums.busNavigation.browseKeyword,{keyword:e})}},{key:"searchBarOnKeyPress",value:function(e){13==e.which&&e.target.value&&""!=e.target.value&&(this.initiateSearch(e.target.value),e.preventDefault())}},{key:"querySearch",value:function(e){var t=e.toLowerCase();return this.apiService.products.getSuggestions(t).then(function(t){return[{Rank:1/0,Keyword:e}].concat(_toConsumableArray(t.Data.sort(function(e,t){return t.Rank-e.Rank})))})}},{key:"showLocation",value:function(){return this.filter.sortBy===this.enums.productsSortOptions.geoLocation}},{key:"onSelectedSuggestion",value:function(e,t,r,o){this.filter.search.searchStr=e,o.stopPropagation()}},{key:"onKeyPressed",value:function(e,t){13==e.keyCode&&applySearch(),38!=e.keyCode&&40!=e.keyCode||(this.filter.search.searchStr=t)}},{key:"changeDistanceFilter",value:function(){this.filter&&(this.filter.distanceRange=this.selectedRange.distance,this.applySearch())}},{key:"applySearch",value:function(){this.filter.currentPage=1,this.filter.search.currentSearchStr=this.filter.search.searchStr,this.rootScope.$broadcast("filtersUpdated")}},{key:"addSuggestionToSearch",value:function(e,t){this.filter.search.searchStr=e,applySearch()}},{key:"smallScreen",value:function(){return window.innerWidth<768}}]),e}(),templateUrl:"./views/templates/search.tpl.html"}),angular.module("paladinApp").component("productlist",{bindings:{filter:"=",pages:"<",totalPages:"<",productsList:"=?",count:"<",isLoading:"=?"},controller:function(){function e(t,r,o,a,n,i,s,u,c,l){_classCallCheck(this,e),this.rootScope=r,this.scope=t,this.Products=a,this.profileImageBaseUrl=window.globals.PROFILE_IMAGE_URL,this.productImageBaseUrl=window.globals.PRODUCT_IMAGE_URL,this.ngMeta=n,this.pager=i,this.anchorScroll=s,this.translate=u,this.location=o,this.enums=c,this.ptUtils=l}return e.$inject=["$scope","$rootScope","$location","Products","ngMeta","pager","$anchorScroll","$translate","enums","ptUtils"],_createClass(e,[{key:"$onInit",value:function(){this.count=0,this.totalPages=0,this.productsList=null,this.isLoading=!1,this.anchorScroll.yOffset=0,this.profileDefaultImage="../../assets/profile.png";var e=this;this.scope.$on("filtersUpdated",function(t){e.onFilterChange(!1)}),this.scope.$on("languageChanged",function(t,r){e.filter.languageCode=r,e.onFilterChange(!1)}),this.rootScope.filter&&this.onFilterChange(!1)}},{key:"updateMetaTags",value:function(){this.ngMeta.setTitle(this.getPageTitle()),this.ngMeta.setTag("description",this.getMetaTags()),this.ngMeta.setTag("imagePath","../../assets/paladin-logo-300x300.png")}},{key:"getPageTitle",value:function(){if(!this.filter.category.selectedCategoryId)return this.translate.instant("HOME_TITLE");var e=this.translate.instant("RENT")+" ";this.filter.category&&this.filter.category.selectedCategoryName&&!this.filter.category.selectedSubCategoryName?e+=this.filter.category.selectedCategoryName:this.filter.category&&this.filter.category.selectedSubCategoryName&&(e+=this.filter.category.selectedSubCategoryName);var t=this.filter.glCity;return t&&(e+=this.translate.instant("IN")+" "+t.split(",")[0]),e}},{key:"getPricePerDayLabel",value:function(){return this.translate.instant(window.innerWidth<768?"PD":"PPD")}},{key:"getMetaTags",value:function(){if(this.filter.category.selectedCategoryName==this.enums.allCategories[this.filter.languageCode])return this.translate.instant("DEFAULT_META_DESC");var e=this.translate.instant("RENT_AND_LEND")+" ";this.filter.category&&this.filter.category.selectedCategoryName?e+=this.filter.category.selectedCategoryName:this.filter.category&&this.filter.category.selectedSubCategoryName&&(e+=this.filter.category.selectedSubCategoryName);var t=this.filter.glCity;return t&&(e+=this.translate.instant("IN")+" "+t.split(",")[0]),e+=" "+this.translate.instant("WITH")+" Paladin!"}},{key:"getDistanceLabel",value:function(e){return"< "+Math.ceil(this.getDistanceFromLatLonInKm(e.Product_Latitude,e.Product_Longitude,this.rootScope.filter.search.lat,this.rootScope.filter.search.lng))+" "+this.translate.instant("KM_FROM_YOU")}},{key:"getDistanceFromLatLonInKm",value:function(e,t,r,o){var a=this.deg2rad(r-e),n=this.deg2rad(o-t),i=Math.sin(a/2)*Math.sin(a/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(r))*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}},{key:"deg2rad",value:function(e){return e*(Math.PI/180)}},{key:"navigateToProduct",value:function(e){this.rootScope.$emit(this.enums.busNavigation.productDetailed,{product:e})}},{key:"getProductDetailUrl",value:function(e){var t="/";return e&&(t+=this.filter.languageCode?this.filter.languageCode:"",t+="/product",t+="/"+this.Products.encryptProductURL(e.Product_Id),t+="-"+e.Product_Id),t}},{key:"goToProductPage",value:function(e){this.location.url(getProductDetailUrl(e))}},{key:"goTo",value:function(e){this.filter.currentPage=e,this.onFilterChange(!0)}},{key:"isFirstPage",value:function(){return 1==this.filter.currentPage}},{key:"setPage",value:function(e){e>=1&&e<=this.totalPages&&(this.filter.currentPage=e,this.refreshPageList(),this.onFilterChange(!0))}},{key:"refreshPageList",value:function(){this.pages=this.pager.GetPager(this.totalPages,this.filter.currentPage,5),this.isLoading=!1,this.ngMeta.setTag("prevUrl",void 0),this.ngMeta.setTag("nextUrl",void 0),this.filter.currentPage>1&&this.ngMeta.setTag("prevUrl",this.location.absUrl().replace("pageIndex="+this.filter.currentPage,"pageIndex="+(this.filter.currentPage-1))),this.filter.currentPage<this.totalPages&&this.ngMeta.setTag("nextUrl",this.location.absUrl().replace("pageIndex="+this.filter.currentPage,"pageIndex="+(this.filter.currentPage+1)))}},{key:"scrollToAnchor",value:function(){var e=this.location.hash();this.location.hash("breadcrumb"),this.anchorScroll(),this.location.hash(e)}},{key:"getProductUrl",value:function(e){return e?this.ptUtils.getProductDetailUrl(e):"#"}},{key:"isParentCategorySelected",value:function(){return this.filter.category.selectedCategoryId&&null==this.filter.category.selectedSubCategoryId}},{key:"onFilterChange",value:function(e){var t=this;(this.rootScope.filter&&!this.isParentCategorySelected()&&window.innerWidth<768||e)&&this.scrollToAnchor(),this.isLoading=!0,this.productsList=[],this.updateMetaTags(),this.scope.$evalAsync(function(){t.productsList=[],Promise.all([t.Products.getAll(t.filter),t.Products.getTotalPageCount(t.filter)]).then(function(e){t.scope.$evalAsync(function(){t.isLoading=!1,t.productsList=e[0].data.Data[0],t.totalPages=e[1].data.Data,t.refreshPageList()})}).catch(function(e){t.scope.$evalAsync(function(){t.isLoading=!1,t.productsList=[],t.totalPages=0})})})}},{key:"increment",value:function(){this.count++}},{key:"decrement",value:function(){this.count--}}]),e}(),templateUrl:"./views/templates/product_list.tpl.html"}),angular.module("paladinApp").component("products",{bindings:{filter:"=",count:"<",loading:"<"},controller:function(){function e(t,r,o,a,n,i,s,u,c){_classCallCheck(this,e),this.scope=t,this.sce=r,this.Filters=o,this.rootScope=a,this.ngMeta=i,this.loading=!0,this.translate=s,this.window=u,this.location=c,this.enums=n}return e.$inject=["$scope","$sce","Filters","$rootScope","enums","ngMeta","$translate","$window","$location"],_createClass(e,[{key:"$onInit",value:function(){this.count=0,this.loading=!0;var e=this;this.scope.$on("showSpinner",function(t){e.loading=!0}),this.scope.$on("hideSpinner",function(t){e.loading=!1})}},{key:"getCurrentCategory",value:function(){return this.translate.instant("ACTG")}},{key:"isNotAllCategory",value:function(){return this.filter.category.defaultCategoryName!=this.filter.category.selectedCategoryName&&this.filter.category.selectedCategoryName!=this.getCurrentCategory()}},{key:"refreshProducts",value:function(){this.rootScope.$broadcast("filtersUpdated",this.filter)}},{key:"sortBy",value:function(e,t){this.filter.sortBy=e,this.filter.sortByCode=t,this.filter.currentPage=1,this.refreshProducts()}},{key:"getBannerImageUrl",value:function(){return(this.isNotAllCategory()?window.globals.CATEGORY_IMAGE_URL:"")+(this.filter.category.selectedSubCategoryBannerImage?this.filter.category.selectedSubCategoryBannerImage:this.filter.category.selectedCategoryBannerImage)}},{key:"getCategoryDescription",value:function(){if(this.filter.category.selectedCategoryId)return null!=this.filter.category.selectedSubCategoryId?this.filter.category.selectedSubCategoryDesc:this.filter.category.selectedCategoryDesc;var e=this.translate.instant("ALL_CATEGORIES_DESC");return e.length>0?this.sce.trustAsHtml(e):null}},{key:"switchCategoryToAll",value:function(e){this.filter.category.selectedCategoryId=null,this.filter.category.selectedCategoryDesc=this.sce.trustAsHtml(this.translate.instant("ACTG")),this.filter.category.selectedCategoryName=this.translate.instant("ACTG"),this.filter.category.selectedCategoryImagePath=null,this.filter.category.selectedCategoryBannerImage=window.globals.IS_PROMO?this.enums.categoriesBannersPaths.promo:this.enums.categoriesBannersPaths.all[this.translate.use()],this.removeSubCategory(),this.refreshProducts()}},{key:"getH1",value:function(){var e="",t=this.filter.category&&this.filter.category.selectedSubCategoryName?this.filter.category.selectedSubCategoryName:this.filter.category.selectedCategoryName;e+=this.isNotAllCategory()?this.translate.instant("FIND_THE_BEST")+" ":this.translate.instant("RENT")+" ",this.filter.search.currentSearchStr&&this.filter.search.currentSearchStr.length>0&&(e+='"'+this.filter.search.currentSearchStr+'" '+this.translate.instant("WITHIN")+" "),e+=t;var r=this.filter.glCity;return r&&(e+=this.translate.instant("IN")+" "+r.split(",")[0]),e}},{key:"getH2",value:function(){var e=this.translate.instant("RENT_AT_BEST_PRICE")+" ";this.filter.category&&this.filter.category.selectedCategoryName&&!this.filter.category.selectedSubCategoryName?e+=this.filter.category.selectedCategoryName:this.filter.category&&this.filter.category.selectedSubCategoryName&&(e+=this.filter.category.selectedSubCategoryName);var t=this.filter.glCity;return t&&(e+=this.translate.instant("IN")+" "+t.split(",")[0]),e}},{key:"getCategoriesUrl",value:function(e,t){return this.Filters.getCategoriesUrl(e,t,this.rootScope.isTryAndBuy,this.translate.use())}},{key:"removeSubCategory",value:function(){this.filter.category.selectedSubCategoryId=null,this.filter.category.selectedSubCategoryDesc=null,this.filter.category.selectedSubCategoryName=null,this.filter.category.selectedSubCategoryImagePath=null,this.filter.category.selectedSubCategoryBannerImage=null}},{key:"switchMainCategory",value:function(){this.removeSubCategory(),this.refreshProducts()}},{key:"switchSubCategory",value:function(){this.refreshProducts()}}]),e}(),templateUrl:"./views/templates/products.tpl.html"}),angular.module("paladinApp").directive("userAvatar",[function(){return{restrict:"E",scope:{user:"<?",userId:"<?",picSize:"<?",userImage:"<?"},templateUrl:"./views/templates/userAvatar.tpl.html",link:function(e,t,r){var o=function(){e.picSize=e.picSize||30,e.picSizeParsed=e.picSize+"px",e.sizeStyle="width: "+e.picSize+"px; height: "+e.picSize+"px;",e.imgServerPath=window.globals.PROFILE_IMAGE_URL;var t=e.userImage;e.userImage="",e.user?e.userImage=e.user.User_DisplayPicturePath:t&&(e.userImage=t)};o();var a=[];a.push(e.$watch("userImage",function(){o()})),a.push(e.$watch("user",function(){o()})),e.$on("destroy",function(){for(;a.length;)a.pop()()})}}}]),angular.module("paladinApp").directive("loaderContainer",[function(){return{restrict:"E",transclude:!0,templateUrl:"./views/templates/loaderContainer.tpl.html",link:function(e,t,r){e.loaderSize=e.loaderSize||50}}}]),angular.module("paladinApp").directive("homeStepsTutorial",["$rootScope","$sce",function(e,t){return{restrict:"E",scope:{stepsList:"<",imgUrl:"<",tutorialTitle:"<",tutorialDescription:"<"},templateUrl:"./views/templates/homeStepsTutorial.tpl.html",link:function(e,r,o){e.tutorialTitle=t.trustAsHtml(e.tutorialTitle)}}}]),angular.module("paladinApp").directive("productsTeaser",["$rootScope","apiService","enums","dataService","appStateManager","toastService","$timeout",function(e,t,r,o,a,n,i){return{restrict:"E",templateUrl:"./views/templates/productsTeaser.tpl.html",scope:{customTitle:"<?",categoryId:"<?",categoryName:"<?",subCategoryId:"<?",categoryDescription:"<?",descriptionLink:"<?",isPopularItems:"<?",isRecentItems:"<?",isTryAndBuy:"<?",productIds:"<?",userId:"<?",products:"<?",currentProductId:"<?"},link:function(n,s,u){n.isLoading=!0,n.isPopularItems=n.isPopularItems||!1,n.isRecentItems=n.isRecentItems||!1,n.category=null,n.products=n.products||[],n.scrollArrows={isRightVisible:!1,isLeftVisible:!1};var c=function(){if(n.products)return n.isLoading=!1,void i(function(){n.validateScrollingArrows()},300);if(n.categoryId){if(!a.categoriesDict)return o.getCategories();n.category=a.categoriesDict[n.categoryId]}l()},l=function(){n.isLoading=!0,function(){if(!n.products){if(n.productIds)return t.products.getSearchedProducts({productPerPage:20,sortBy:r.productsSortOptions.bestProduct,productIDs:n.productIds});if(n.isTryAndBuy)return t.products.getPopularTryAndBuy();if(n.userId){var e={userId:n.userId,productsFilter:r.userProductsFilter.myProductsToBorrow};return t.products.getUserProducts(e).then(function(e){return{Data:[e.Data.User_AllProducts]}})}var o={productPerPage:20};return n.categoryId?(o.categoryId=n.categoryId,o.sortBy=r.productsSortOptions.bestProduct,n.subCategoryId&&(o.subCategoryId=n.subCategoryId)):n.isPopularItems?o.sortBy=r.productsSortOptions.popularity:n.isRecentItems&&(o.sortBy=r.productsSortOptions.recent),t.products.getSearchedProducts(o)}}().then(function(e){n.isLoading=!1,n.products=e.Data[0].filter(function(e){return e.Product_Id!=n.currentProductId}),i(function(){n.validateScrollingArrows()},300)}).catch(function(e){n.isLoading=!1,n.products=[]})};n.onSwipe=function(e,t,r){var o=r.current.parentElement.parentElement.parentElement;if(o){var a=o.clientWidth,i=o.scrollWidth-a,s=o.scrollLeft,u=r.current.clientWidth,c=a/u,l=e?s+(a-u/c):s-(a-u/c);l>i?l=i:l<0&&(l=0);var d=0,g=(s>l?s-l:l-s)/30,p=s<l?s+g:s-g,f=setInterval(function(){p=s<l?p+g:p-g,o.scrollTo(p,o.scrollTop),30==d&&(clearInterval(f),n.validateScrollingArrows()),d++},.4*g)}},n.onArrowClick=function(e){var t=angular.element(document.querySelector("#productTeaserItem-"+n.products[0].Product_Id+" .products-teaser-list-item-v2 .button-overlay"))[0];n.onSwipe(e,null,{current:t})},n.validateScrollingArrows=function(){if(n.instantiateScroller(),n.products.length>0){angular.element(document.querySelector("#productTeaserItem-"+n.products[0].Product_Id+" .products-teaser-list-item-v2 .button-overlay"))[0];var e=angular.element(document.getElementById("productsTeaserList"+(n.categoryId||(n.isRecentItems?"Recent":n.isPopularItems?"Popular":""))));if(e[0]){var t=e[0].clientWidth,r=e[0].scrollWidth-t,o=e[0].scrollLeft;n.$evalAsync(function(){n.scrollArrows.isLeftVisible=0!=Math.round(o),n.scrollArrows.isRightVisible=Math.round(o)!=r})}}else n.$evalAsync(function(){n.scrollArrows.isLeftVisible=!1,n.scrollArrows.isRightVisible=!1})},n.seeAll=function(){n.categoryId?e.$emit(r.busNavigation.browseCategory,{categoryName:n.categoryName}):n.isPopularItems||n.isRecentItems?e.$emit(r.busNavigation.browseSort,{sortBy:n.isRecentItems?r.productsSortOptions.recent:r.productsSortOptions.popularity}):n.userId?e.$emit(r.busNavigation.userProfile,{userId:n.userId}):void 0!=n.isTryAndBuy&&e.$emit(r.busNavigation.switchBrowseMode,{isTryAndBuy:n.isTryAndBuy})},n.getHrefLink=function(){var e="";return n.categoryId?e=window.globals.ROOT_PATH+a.currentLang+"/categorie/"+n.categoryName:void 0!=n.isTryAndBuy?e=window.globals.ROOT_PATH+a.currentLang+"/categorie/"+(n.isTryAndBuy?"":"privato/")+("it"==a.currentLang?"Tutte-le-Categorie":"All-Categories")+"?sortBy=SortByBestProduct&pageIndex=1":n.userId,e.length>0?e.split(" ").join("-"):"javascript:void(0);"},n.instantiateScroller=function(){n.scroller||(n.scroller=angular.element(document.getElementById("productsTeaserList"+(n.categoryId||(n.isRecentItems?"Recent":n.isPopularItems?"Popular":"")))),n.scroller.bind("resize",function(){n.validateScrollingArrows()}))};var d=[];d.push(e.$on(r.busEvents.categoriesUpdate,function(e,t){c()})),n.$on("$destroy",function(){for(n.scroller&&n.scroller.unbind("resize");d.length;)d.pop()()}),c()}}}]),angular.module("paladinApp").directive("lazyLoading",[function(){return{restrict:"A",link:function(e,t,r){var o=function(e,t){for(var o="",a=1;a<=5;a++)t&&a%2==0||(o=o+e+r.lazyLoading+"_"+a+"00 "+a+"00w, ");return o.length>0&&(o=o+e+r.lazyLoading+" 600w"),o};angular.element(t)[0].src="/assets/empty-image.png";var a=function(){var e="";return r.imageType&&("product"==r.imageType?e=window.globals.PRODUCT_IMAGE_URL:"profile"==r.imageType&&(e=r.lazyLoading.length>0?window.globals.PROFILE_IMAGE_URL:"/assets/profile.png")),e};var n=new IntersectionObserver(function(e){e.forEach(function(e){if(e.intersectionRatio>0){var t=a();e.target.src=t+r.lazyLoading,r.imageType&&("product"==r.imageType||"profile"==r.imageType&&r.lazyLoading.length>0)&&(e.target.srcset=o(t,"profile"==r.imageType))}})}),i=angular.element(t)[0];n.observe(i)}}}]),angular.module("paladinApp").directive("profileImage",[function(){return{restrict:"A",link:function(e,t,r){var o=function(){t&&t[0]&&(""==r.profileImage?t[0].src="/assets/profile.png":t[0].src=window.globals.PROFILE_IMAGE_URL+r.profileImage)};o();var a=[];a.push(e.$watch("profileImage",function(){o()})),e.$on("$destroy",function(){for(;a.length;)a.pop()()})}}}]),angular.module("paladinApp").directive("productTeaserListItem",["$rootScope","enums","ptUtils",function(e,t,r){return{restrict:"E",scope:{product:"<",onSwipe:"&"},templateUrl:"./views/templates/productTeaserListItem.tpl.html",link:function(o,a,n){o.onItemClick=function(){e.$emit(t.busNavigation.productDetailed,{product:o.product})},o.getProductUrl=function(){return o.product?r.getProductDetailUrl(o.product):"#"},o.onItemSwipe=function(e,t,r){o.onSwipe&&o.onSwipe()(e,t,r)}}}}]),angular.module("paladinApp").directive("ratingView",[function(){return{restrict:"E",scope:{rating:"=",count:"<?",readOnly:"<?",onRating:"&"},templateUrl:"./views/templates/ratingView.tpl.html",link:function(e,t,r){e.onRatingSet=function(t){e.onRating&&e.onRating({rating:t})}}}}]),angular.module("paladinApp").directive("userItem",["$rootScope","enums","appStateManager",function(e,t,r){return{restrict:"E",templateUrl:"./views/templates/userItem.tpl.html",scope:{userId:"=?",userName:"=?",userImage:"=?",reviews:"=?",stars:"=?",picSize:"=?"},link:function(r,o,a){r.picSize=r.picSize||50,r.goToProfile=function(){r.userId&&e.$emit(t.busNavigation.userProfile,{userId:r.userId})}}}}]),angular.module("paladinApp").directive("reviewsList",["$rootScope","appStateManager",function(e,t){return{restrict:"E",templateUrl:"./views/templates/reviewsList.tpl.html",scope:{reviews:"="},link:function(e,t,r){}}}]),angular.module("paladinApp").directive("reviewsListItem",["$rootScope",function(e){return{restrict:"E",templateUrl:"./views/templates/reviewsListItem.tpl.html",scope:{review:"="},link:function(e,t,r){}}}]),angular.module("paladinApp").directive("rentalRequestPicker",["$rootScope","appStateManager","enums","apiService","moment","$translate","ptUtils","gtmService",function(e,t,r,o,a,n,i,s){return{restrict:"E",templateUrl:"./views/templates/rentalRequestPicker.tpl.html",scope:{product:"=",productBookingDetails:"=",onRequestRent:"&",onDatesUpdated:"&"},link:function(a,n,u){console.log("rentalRequestPicker: ",n[0].id),a.userCredit=null,a.calculatePrice=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a.statusError=void 0;var r=t.getUserId();r&&o.users.getUserCredit({userId:r}).then(function(t){a.userCredit=t.Data,i.calculatePricingListForProduct(a.startDate,a.endDate,a.product,a.productBookingDetails,!0,a.userCredit).then(function(e){a.$evalAsync(function(){a.statusError=void 0,a.prices=e})}).catch(function(t){a.$evalAsync(function(){a.prices=[],e&&t&&t.message&&(a.statusError=t.message)})})}).catch(function(e){console.error("getuserCredit failed ",e)})},a.bookingPickerId=u.id+"-bookingPicker",a.init=function(){a.statusError=void 0,a.startDate=void 0,a.endDate=void 0,a.calculatePrice(!1)},a.onDatesSelected=function(e){var t=e.startDate,r=e.endDate;a.startDate==t&&a.endDate==r||(a.startDate=t,a.endDate=r,a.calculatePrice(),a.onDatesUpdated&&a.onDatesUpdated()({startDate:a.startDate,endDate:a.endDate,componentId:n[0].id}))},a.onBuyBtnClicked=function(){e.$emit(r.busNavigation.paymentDetailed,{productId:a.product.Product_Id,purchase:!0})},a.onRequestRentBtnClicked=function(){void 0!=a.prices&&0!=a.prices.length?(a.onRequestRent()({startDate:a.startDate,endDate:a.endDate,componentId:n[0].id}),s.trackEvent("booking","request-now-button-post-calendar","productDetailpage","value")):a.$$postDigest(function(){angular.element(document.querySelector("#"+n[0].id+" #desktopPicker span.md-select-value"))[0].click()})},a.init();var c=[];c.push(e.$on(r.busEvents.rentalRequestPickerUpdateDates,function(e,t){t&&t.startDate&&t.endDate&&t.componentId==n[0].id&&a.onDatesSelected(t)})),a.$on("$destroy",function(){for(;c.length;)c.pop()()})}}}]),angular.module("paladinApp").directive("rentalRequestHowTo",[function(){return{restrict:"E",templateUrl:"./views/templates/rentalRequestHowTo.tpl.html",scope:{isTryAndBuy:"=?",isBuy:"=?"},link:function(e,t,r){}}}]),angular.module("paladinApp").directive("bookingDatePicker",["$rootScope","moment","popupService","ptUtils","$mdMedia",function(e,t,r,o,a){return{restrict:"E",templateUrl:"./views/templates/bookingDatePicker.tpl.html",scope:{resultCallback:"&",defaultValue:"=?",startDate:"=?",endDate:"=?",dateRange:"=?",productBookingDetails:"=?",product:"=?"},link:function(e,n,i){var s=function(){null!=e.productBookingDetails&&(u=o.getBookedDateRanges(e.productBookingDetails))},u=[];s(),e.isDateAvailable=function(e){for(var r=t(e),o=0;o<u.length;o++)if(r.isBetween(u[o].startDate,u[o].endDate)||r.isSame(u[o].startDate)||r.isSame(u[o].endDate))return!0;return!t().isBefore(e)},e.startDate=e.startDate||void 0,e.endDate=e.endDate||void 0,e.dateRange={},e.advancedModel={selectedTemplate:"Last 3 Days"},e.pickerModel={selectedTemplate:!1,dateStart:e.startDate,dateEnd:void 0},e.pickerTranslations=o.getTranslationDictForDatePicker(),e.selectDate=function(){a("gt-sm")?e.$$postDigest(function(){angular.element(document.querySelector("#"+n[0].id+" #desktopPicker span.md-select-value"))[0].click()}):r.showDateRangePicker(e.productBookingDetails,e.product).then(function(r){e.resultCallback&&e.resultCallback()({startDate:t(r.dateStart),endDate:t(r.dateEnd)})}).catch(function(){return console.log("canceled date picking")})},e.onDesktopSelect=function(r){if(r&&r.length>0){var o=t(r[0]),a=t(r[r.length-1]);e.pickerModel.dateStart=void 0,e.pickerModel.dateEnd=void 0,e.resultCallback&&e.resultCallback()({startDate:t(o),endDate:t(a)})}};var c=[];c.push(e.$watch("productBookingDetails",function(){s()})),e.$on("$destroy",function(){for(;c.length;)c.pop()()})}}}]),angular.module("paladinApp").directive("userListingsListItem",["$rootScope","enums",function(e,t){return{restrict:"E",templateUrl:"./views/templates/userListingsListItem.tpl.html",scope:{product:"<",isMinified:"=?"},link:function(e,t,r){e.isMinified=e.isMinified||!1}}}]),angular.module("paladinApp").directive("userListingsList",["$rootScope","enums","apiService",function(e,t,r){return{restrict:"E",templateUrl:"./views/templates/userListingsList.tpl.html",scope:{userId:"=",isMinified:"=?"},link:function(o,a,n){o.isMinified=o.isMinified||!1,o.isLoading=!1,o.userProducts=[],o.fetchUserListings=function(){o.isLoading=!0,r.products.getUserProducts({productsFilter:t.userProductsFilter.lentProduct,userId:o.userId}).then(function(e){o.userProducts=e.Data.User_AllProducts,o.isLoading=!1})},o.listItemClick=function(r){e.$emit(t.busNavigation.productDetailed,{product:r})},o.fetchUserListings()}}}]),angular.module("paladinApp").directive("productStatusLabel",["$rootScope","enums","ptUtils",function(e,t,r){return{restrict:"E",templateUrl:"./views/templates/productStatusLabel.tpl.html",scope:{statusId:"="},link:function(e,t,o){e.setDataForStatusId=function(){var t=r.getDisplayDataForTransactionStatus(e.statusId),o=t.text,a=t.color;e.mainColor=a,e.statusLabel=o},e.setDataForStatusId()}}}]),angular.module("paladinApp").directive("bookingListItem",["$rootScope","enums","appStateManager",function(e,t,r){return{restrict:"E",templateUrl:"./views/templates/bookingsListItem.tpl.html",scope:{booking:"=",isLent:"=?"},link:function(e,t,o){e.isLent=r.getUserId()==e.booking.Lender_Id}}}]),angular.module("paladinApp").directive("bookingTrackerInfo",["$rootScope","enums","appStateManager","apiService","ptUtils","$sce","$translate","productReviewService",function(e,t,r,o,a,n,i,s){return{restrict:"E",templateUrl:"./views/templates/bookingTrackerInfo.tpl.html",scope:{booking:"="},link:function(e,o,n){var i=function(e){return a.parseBookingStepTutorialHTMLTemplateForTranslationId(e)};e.getStaticBookingStepsP2P=function(e){return e?[{label:"BOOKING_TRACK_INFO_REQUEST_RECEIVED",status:t.trackingStep.pending,description:i("BookingStatusRequested_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.requested]},{label:"BOOKING_TRACK_INFO_REQUEST_ACCEPTED",status:t.trackingStep.pending,description:i("BookingStatusAccepted_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.accepted]},{label:"BOOKING_TRACK_INFO_START",status:t.trackingStep.pending,description:i("BookingStatusStarted_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.started]},{label:"BOOKING_TRACK_INFO_END",status:t.trackingStep.pending,description:i("BookingStatusEnded_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.ended]}]:[{label:"BOOKING_TRACK_INFO_CARD_VERIFICATION",status:t.trackingStep.failure,description:i("BookingStatusNotVerified_Borrower"),date:void 0,isCurrent:!0,rentalStatus:[t.productRentalStatus.verified,t.productRentalStatus.verifying]},{label:"BOOKING_TRACK_INFO_REQUEST_SENT",status:t.trackingStep.pending,description:i("BookingStatusRequested_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.requested]},{label:"BOOKING_TRACK_INFO_AWAIT_ACCEPT",status:t.trackingStep.pending,description:i("BookingStatusAccepted_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.accepted]},{label:"BOOKING_TRACK_INFO_START",status:t.trackingStep.pending,description:i("BookingStatusStarted_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.started]},{label:"BOOKING_TRACK_INFO_END",status:t.trackingStep.pending,description:i("BookingStatusEnded_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.ended]}]},e.getStaticBookingStepsTnB=function(e){return e?[{label:"BOOKING_TRACK_INFO_BOOKED",status:t.trackingStep.pending,description:i("BookingStatusBooked_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.booked]},{label:"BOOKING_TRACK_INFO_START",status:t.trackingStep.pending,description:i("BookingStatusStarted_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.started]},{label:"BOOKING_TRACK_INFO_END",status:t.trackingStep.pending,description:i("BookingStatusEnded_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.ended]}]:[{label:"BOOKING_TRACK_INFO_CARD_VERIFICATION",status:t.trackingStep.failure,description:i("BookingStatusNotVerified_Borrower_TnB"),date:void 0,isCurrent:!0,rentalStatus:[t.productRentalStatus.verified,t.productRentalStatus.verifying]},{label:"BOOKING_TRACK_INFO_BOOKED",status:t.trackingStep.pending,description:i("BookingStatusBooked_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.booked]},{label:"BOOKING_TRACK_INFO_START",status:t.trackingStep.pending,description:i("BookingStatusStarted_Borrower_TnB"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.started]},{label:"BOOKING_TRACK_INFO_END",status:t.trackingStep.pending,description:i("BookingStatusEnded_Borrower_TnB"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.ended]}]};t.productRentalStatus.timeout,t.productRentalStatus.denied,t.productRentalStatus.canceled,t.productRentalStatus.criticalCancel,t.productRentalStatus.moderateCancel;e.setStaticStepAtIndexAsCurrent=function(e,t){e.forEach(function(e,r){e.isCurrent=r===t})},e.getCurrentStep=function(){return e.steps.find(function(e){return 1==e.isCurrent})},e.updateSteps=function(r){var o=e.booking.BookingStatus;if(o[o.length-1].Status_TrackId==t.productRentalStatus.verifying){var n=o[o.length-1];return r[0].status=t.trackingStep.pending,r[0].date=a.stringToDate(n.CreatedDate+" "+n.CreatedTime),r[0].label="BOOKING_TRACK_INFO_ID_VERIFICATION",r[0].description=i("BookingStatusVerifying_Borrower"),e.setStaticStepAtIndexAsCurrent(r,0),r}for(var s=0;s<o.length;s++)for(var u=o[s],c=0;c<r.length;c++)if(r[c].rentalStatus.includes(u.Status_TrackId)){r[c].status=t.trackingStep.success,r[c].date=a.stringToDate(u.CreatedDate+" "+u.CreatedTime),s==o.length-1&&e.setStaticStepAtIndexAsCurrent(r,c);break}return r},e.init=function(){e.userId=r.getUserId(),e.isLender=e.userId==e.booking.Lender_Id,e.isTryAndBuy=e.booking.IsTryAndBuy;var t=angular.copy(e.booking.IsTryAndBuy?e.getStaticBookingStepsTnB(e.isLender):e.getStaticBookingStepsP2P(e.isLender));e.steps=e.updateSteps(t)},e.init()}}}]),angular.module("paladinApp").directive("bookingDetailedStatus",["$rootScope","enums","appStateManager","apiService","ptUtils",function(e,t,r,o,a){return{restrict:"E",templateUrl:"./views/templates/bookingDetailedStatus.tpl.html",scope:{booking:"="},link:function(e,r,o){e.prices=[],e.youWontBeChargedText=void 0;e.booking&&e.booking.BookingStatus&&e.booking.BookingStatus.length>0&&(e.youWontBeChargedText=e.booking.BookingStatus[e.booking.BookingStatus.length-1].Status_TrackId==t.productRentalStatus.requested?"YOU_WONT_BE_CHARGED_MSG":void 0),a.calculatePriceingListForBooking(e.booking).then(function(t){e.$evalAsync(function(){e.prices=t})})}}}]),angular.module("paladinApp").directive("bookingDetailedCtaButton",["$rootScope","enums","appStateManager","apiService","ptUtils","toastService","ptLog","transactionService","productReviewService",function(e,t,r,o,a,n,i,s,u){return{restrict:"E",templateUrl:"./views/templates/bookingDetailedCTAButton.tpl.html",scope:{booking:"="},link:function(o,n,i){o.btns=[];o.init=function(){var n=r.getUserId(),i=o.booking.Lender_Id==n,c=o.booking.BookingStatus[o.booking.BookingStatus.length-1].Status_TrackId,l=a.getDisplayDataForTransactionStatus(c),d=l.color;l.text;o.mainColor=d,function(r,a,n,i){switch(o.btns=[],r){case t.productRentalStatus.notVerified:a||o.btns.push({text:"VERIFY_ID",BL:function(r){e.$emit(t.busNavigation.idVerification,{bookingId:r.Booking_Id})},isEnabled:!0});break;case t.productRentalStatus.requested:a?(o.btns.push({text:"DECLINE_REQUEST",BL:function(e){return s.rejectRental(e,!0)},isEnabled:!0,isDestructive:!0}),o.btns.push({text:"ACCEPT_REQUEST",BL:function(e){return s.acceptRental(e)},isEnabled:!0})):o.btns.push({text:"CANCEL_REQUEST",BL:function(e){return s.rejectRental(e,!1)},isEnabled:!0,isDestructive:!0});break;case t.productRentalStatus.canceled:a||o.btns.push({text:"REQUEST_AGAIN",BL:function(r){return e.$emit(t.busNavigation.productDetailed,{product:r})},isEnabled:!0});break;case t.productRentalStatus.accepted:a?o.btns.push({text:"CANCEL_BOOKING",BL:function(e){return s.cancelRental(e,!0)},isEnabled:!0,isDestructive:!0}):(o.btns.push({text:"CANCEL_BOOKING",BL:function(e){return s.cancelRental(e,!1)},isEnabled:!0,isDestructive:!0}),o.btns.push({text:"START_RENTAL",BL:function(e){return s.startRental(e)},isEnabled:!0}));break;case t.productRentalStatus.timeout:a||(n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByBorrower&&n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByBoth?o.btns.push({text:"REVIEW_LENDER",BL:function(e){return u.startReviewFlow(e,!0)},isEnabled:!0}):o.btns.push({text:"REQUEST_AGAIN",BL:function(r){return e.$emit(t.busNavigation.productDetailed,{product:r})},isEnabled:!0}));break;case t.productRentalStatus.denied:o.btns.push({text:"REQUEST_AGAIN",BL:function(r){return e.$emit(t.busNavigation.productDetailed,{product:r})},isEnabled:!0});break;case t.productRentalStatus.canceledByLender:a||i||o.btns.push({text:"REVIEW_LENDER",BL:function(e){return u.startReviewFlow(e,!0)},isEnabled:!0});break;case t.productRentalStatus.criticalCancel:case t.productRentalStatus.moderateCancel:a&&o.btns.push({text:"REVIEW_BORROWER",BL:function(e){return u.startReviewFlow(e,!1)},isEnabled:!0});break;case t.productRentalStatus.started:a?o.btns.push({text:"END_RENTAL",BL:function(e){return s.endRental(e)},isEnabled:!0}):i&&o.btns.push({text:"BUY_NOW",BL:function(r){return e.$emit(t.busNavigation.paymentDetailed,{productId:r.Product_Id,purchase:!0,bookingId:r.Booking_Id})},isEnabled:!0});break;case t.productRentalStatus.ended:a?(n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByLender&&n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByBoth&&o.btns.push({text:"REVIEW_BORROWER",BL:function(e){return u.startReviewFlow(e,!1)},isEnabled:!0}),n.Lender_StripeAccount||o.btns.push({text:"CREATE_STRIPE_ACCOUNT",BL:function(e){return s.endRentalForStripeAccountOnly(e)},isEnabled:!0})):(n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByBorrower&&n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByBoth?o.btns.push({text:"REVIEW_LENDER",BL:function(e){return u.startReviewFlow(e,!0)},isEnabled:!0}):o.btns.push({text:"REQUEST_AGAIN",BL:function(r){return e.$emit(t.busNavigation.productDetailed,{product:r})},isEnabled:!0}),i&&o.btns.push({text:"BUY_NOW",BL:function(r){return e.$emit(t.busNavigation.paymentDetailed,{productId:r.Product_Id,purchase:!0,bookingId:r.Booking_Id})},isEnabled:!0}));break;case t.productRentalStatus.timeoutByBorrower:a&&o.btns.push({text:"REVIEW_BORROWER",BL:function(){return u.startReviewFlow(n,!1)},isEnabled:!0})}}(c,i,o.booking,o.booking.IsTryAndBuy)},o.ctaClicked=function(){},o.init()}}}]),angular.module("paladinApp").directive("chatCtaButton",["$rootScope","enums","apiService","appStateManager","toastService","chatService","$translate",function(e,t,r,o,a,n,i){return{restrict:"E",templateUrl:"./views/templates/chatCTAButton.tpl.html",scope:{product:"=",productBookingDetails:"=",booking:"=?"},link:function(r,s,u){r.userId=o.getUserId(),r.startChat=function(){r.isLoading=!0;var o=r.product,s=o.Chat_QBRoomId,u=o.Lender_UserId,c=o.Product_Id,l=o.Product_Title,d=r.productBookingDetails,g=d.Borrower_QBId,p=d.Lender_QBId,f=r.userId,h=void 0;r.booking&&(h=r.booking.Booking_Id,f=r.booking.Borrower_Id),n.createOrStartChat({lenderId:u,borrowerId:f,lenderQBId:p,borrowerQBId:g,chatRoomId:s,bookingId:h,productId:c,productName:l}).then(function(o){r.isLoading=!1,console.log(o),e.$emit(t.busNavigation.chat,{chatId:o.Chat_QBRoomId})}).catch(function(e){r.isLoading=!1,console.error(e),a.simpleToast(i.instant("DEFAULT_ERROR"))})}}}}]),angular.module("paladinApp").directive("bookingCoupon",["$rootScope","enums","apiService","appStateManager","ptUtils",function(e,t,r,o,a){return{restrict:"E",templateUrl:"./views/templates/bookingCoupon.tpl.html",scope:{onCouponValidation:"&"},link:function(e,t,a){e.isAddingCoupon=!1,e.isLoading=!1,e.error=null,e.coupon={code:""},e.addCoupon=function(){e.isAddingCoupon=!0},e.cancel=function(){e.isAddingCoupon=!1},e.validateCoupon=function(){e.isLoading=!0;var t=o.getUserId(),a=e.coupon.code;r.payments.verifyCoupon({userId:t,coupon:a}).then(function(t){e.isLoading=!1,e.onCouponValidation()(t.Data),e.isAddingCoupon=!1,e.coupon.code=""}).catch(function(t){e.isLoading=!1,e.error=t.data.Message||"PLEASE_INSERT_VALID_COUPON"})}}}}]),angular.module("paladinApp").directive("chatsList",["$rootScope","enums","chatService","appStateManager",function(e,t,r,o){return{restrict:"E",templateUrl:"./views/templates/chatsList.tpl.html",link:function(a,n,i){a.currentPage=0,a.isLoading=!0,a.canLoadMore=!0;var s=!1;a.chats=[],a.unreadDict={},a.selectedChatId=null,a.loadChatsList=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a.isLoading=!0,r.getChatList(o.getUserId(),a.currentPage).then(function(t){a.$evalAsync(function(){a.isLoading=!1,s=!1,e?(a.chats=t,a.currentPage=0,a.canLoadMore=!0):t.length>0?(a.chats=a.chats.concat(t),a.currentPage++):a.canLoadMore=!1}),r.getUnreadMessage().then(function(e){a.unreadDict=e||{}}).catch(function(){return a.unreadDict={}})}).catch(function(e){a.isLoading=!1})},a.onChatListItemClicked=function(r){console.log(r),a.selectedChatId!=r.Chat_QBRoomId&&(a.selectedChatId=r.Chat_QBRoomId,e.$emit(t.busChatEvents.detailedChatSelected,{chatId:r.Chat_QBRoomId}))},e.$on(t.busChatEvents.updateUnreadCount,function(e,t){a.unreadDict=t.detailedDict||{}});var u=[];u.push(e.$on(t.busChatEvents.selectPendingChat,function(e,t){a.selectedChatId=t.chatId})),a.loadMore=function(){a.canLoadMore&&(s||(s=!0,console.log("$scope.canLoadMore"),a.loadChatsList(!1)))},a.loadChatsList(!0),a.$on("$destroy",function(){for(;u.length>0;)u.pop()()})}}}]),angular.module("paladinApp").directive("chatDetailed",["$rootScope","apiService","appStateManager","enums","chatService","$mdSidenav","toastService","ptUtils",function(e,t,r,o,a,n,i,s){return{restrict:"E",templateUrl:"./views/templates/chatDetailed.tpl.html",scope:{chatId:"=?"},link:function(u,c,l){u.chat=null,u.bookingId=null,u.messages=[],u.compose={text:"",img:null},u.isUploadingMedia=!1,u.userImages={me:void 0,recipient:void 0},u.canLoadMoreMsgs=!0;var d=[];u.setSelectedChat=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?(e!=u.chatId||t)&&(u.chatId=e,u.chat&&u.chat.Chat_QBRoomId&&a.leaveChat(u.chat.Chat_QBRoomId),u.getDetailedChat()):u.chat&&u.chat.Chat_QBRoomId&&a.leaveChat(u.chat.Chat_QBRoomId)},u.goToProduct=function(){e.$emit(o.busNavigation.productDetailed,{product:u.product})},u.goToRental=function(){e.$emit(o.busNavigation.transactionDetailed,{bookingId:u.bookingId})},u.getDetailedChat=function(){u.bookingId=null,u.isLoading=!0,a.getChatDetailed(u.chatId).then(function(e){u.chat=e,e.BookingList&&e.BookingList.length>0&&e.BookingList[0].BookingId&&(u.bookingId=e.BookingList[0].BookingId),u.userImages.me=r.user.User_DisplayPicturePath,u.userImages.recipient=e.Lender_UserId==r.user.User_Id?e.Borrower_ProfileImage:e.Lender_ProfileImage,a.joinChat(u.chat.Chat_QBRoomId).then(function(){u.getDetailedProduct()}).catch(function(e){console.log("Failed to join chat",e),u.chat=null,u.chatId=null,u.isLoading=!1,i.simpleToast($translate.instant("FAILED_JOIN_CHAT"))})}).catch(function(e){u.isLoading=!1,u.chatId=null})},u.getDetailedProduct=function(){var e=u.chat.Product_Id;t.products.getDetailedProduct(e).then(function(e){u.product=e.Data,u.getChatHistory()}).catch(function(e){u.chat=null,u.isLoading=!1})},u.getChatHistory=function(){a.getChatHistory(u.chat.Chat_QBRoomId,0).then(function(e){a.clearUnreadBadgesForDialog(u.chat.Chat_QBRoomId),u.$evalAsync(function(){u.canLoadMoreMsgs=!0,u.messages=e,u.isLoading=!1})}).catch(function(e){u.$evalAsync(function(){u.messages=[],u.isLoading=!1})})},u.loadMoreMessages=function(){!u.isGettingMoreMsgs&&u.canLoadMoreMsgs&&(u.isGettingMoreMsgs=!0,console.log("loadMoreMessages"),a.getChatHistory(u.chat.Chat_QBRoomId,u.messages.length).then(function(e){0==e.length&&(u.canLoadMoreMsgs=!1),u.isGettingMoreMsgs=!1,u.messages=e.concat(u.messages)}).catch(function(e){u.isGettingMoreMsgs=!1}))},u.toggleNav=function(){n(o.inAppSideNavsIds.chatSideNav).toggle()},u.sendMessage=function(){a.sendMessage({dialogId:u.chat.Chat_QBRoomId,text:u.compose.text,productId:u.chat.Product_Id,input:null}),u.compose.text=""},u.keyPress=function(e){13!=e.which||e.shiftKey||(e.preventDefault(),""!=u.compose.text?u.sendMessage():s.playErrorSound())},u.uploadMedia=function(){u.$$postDigest(function(){angular.element(document.getElementById("chatMediaUpload"))[0].click()})},u.onUploaded=function(e){u.$evalAsync(function(){u.isUploadingMedia=!0,e&&e.files&&e.files.length>0&&a.sendMessage({dialogId:u.chat.Chat_QBRoomId,text:null,input:e}).then(function(){u.$evalAsync(function(){u.isUploadingMedia=!1})}).catch(function(e){u.$evalAsync(function(){u.isUploadingMedia=!1}),alert("error! upload again!")})})},d.push(e.$on(o.busChatEvents.detailedChatSelected,function(e,t){u.toggleNav(),t&&t.chatId?u.setSelectedChat(t.chatId):u.setSelectedChat(null)})),d.push(e.$on(o.busChatEvents.newMessage,function(e,t){u.messages.push(t),a.clearUnreadBadgesForDialog(u.chat.Chat_QBRoomId),u.$apply()})),d.push(e.$on(o.busChatEvents.selectPendingChat,function(e,t){u.setSelectedChat(t.chatId,!0)})),u.$on("$destroy",function(){for(;d.length>0;)d.pop()()})}}}]),angular.module("paladinApp").directive("chatListMessageItem",[function(){return{restrict:"E",templateUrl:"./views/templates/chatListMessageItem.tpl.html",scope:{myImage:"=?",recipientImage:"=?",message:"="},link:function(e,t,r){}}}]),angular.module("paladinApp").directive("whenScrolled",function(){return function(e,t,r){var o=t[0];t.bind("scroll",function(){if(Math.ceil(o.scrollTop+o.offsetHeight)>=o.scrollHeight-10)var t=setTimeout(function(){e.$apply(r.whenScrolled),clearTimeout(t),t=null},10)})}}),angular.module("paladinApp").directive("contactLenderOrBorrower",["$rootScope","enums","appStateManager",function(e,t,r){return{restrict:"E",templateUrl:"./views/templates/contactLenderOrBorrower.tpl.html",scope:{isTitleHidden:"=?",isDescriptionHidden:"=?",product:"=?",productBookingDetails:"=?",booking:"=?"},link:function(e,t,o){e.isTitleHidden=e.isTitleHidden||!1,e.isDescriptionHidden=e.isDescriptionHidden||!1,e.displayedUser={username:null,profilePic:null,id:null,stars:void 0,reviews:void 0};var a=function(){var t=e.product||{};e.isMyProduct=t.Lender_UserId==r.getUserId(),e.isCanStartChat=!e.isMyProduct||null!=e.booking,e.titleText=e.isMyProduct?"CONTACT_BORROWER":"CONTACT_LENDER",e.isMyProduct?e.booking?(e.displayedUser.username=e.booking.Borrower_Name,e.displayedUser.profilePic=e.booking.Borrower_Image,e.displayedUser.id=e.booking.Borrower_Id,e.displayedUser.stars=e.booking.Borrower_ReviewScore,e.displayedUser.reviews=e.booking.Borrower_ReviewCount):e.isCanStartChat=!1:e.product?(e.displayedUser.username=t.Lender_FullName,e.displayedUser.profilePic=t.Lender_User_DisplayPicturePath,e.displayedUser.id=t.Lender_UserId,e.displayedUser.stars=t.User_ReviewAsLender,e.displayedUser.reviews=t.User_ReviewCountAsLender):e.isCanStartChat=!1},n=[];n.push(e.$watch("product",function(){a()})),n.push(e.$watch("productBookingDetails",function(){a()})),n.push(e.$watch("booking",function(){a()})),a(),e.$on("$destroy",function(){for(;n.length;)n.pop()()})}}}]),angular.module("paladinApp").directive("authedAction",["$rootScope","enums","appStateManager","popupService",function(e,t,r,o){return{restrict:"A",link:function(a,n,i){var s=document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.height="100%",s.style.width="100%",s.style.cursor="pointer",s.onclick=function(){o.showLoginSignupPopup(!1).finally(function(){}),c=!0},n[0].classList.add("forceRelativePosition");var u=!1,c=!1,l=function(){r.getUserId()?u&&(u=!1,n[0].removeChild(s),c&&location.reload()):u||(u=!0,n[0].appendChild(s))};l();var d=[];d.push(e.$on(t.busEvents.updatedUser,function(e,t){l()})),a.$on("$destroy",function(){for(;d.length;)d.pop()()})}}}]),angular.module("paladinApp").directive("focusMe",["$timeout",function(e){return{restrict:"A",link:function(t,r,o){e(function(){r[0].disabled||r[0].focus()},300)}}}]),angular.module("paladinApp").directive("copyTextToClipboard",["$mdToast",function(e){return{restrict:"A",link:function(t,r,o){$(r).click(function(){var t=o.copyTextToClipboard;if(document.selection)(r=document.body.createTextRange()).moveToElementText(document.getElementById(t)),r.select().createTextRange(),document.execCommand("copy"),e.showSimple("Text copied to clipboard");else if(window.getSelection){var r;(r=document.createRange()).selectNode(document.getElementById(t)),window.getSelection().addRange(r),document.execCommand("copy"),console.info("text copied"),e.showSimple("Text copied to clipboard")}})}}}]),angular.module("paladinPopups").controller("confirmPopup",["$scope","$mdDialog","locals",function(e,t,r){e.title=r.title,e.message=r.message,e.isConfirm=r.isConfirm,e.isConfirm?(e.yesButton=r.yesButton,e.noButton=r.noButton):e.okBtn=r.okBtn||"POPUP_OK",e.closeDialog=function(e){e?t.hide():t.cancel()}}]),angular.module("paladinPopups").controller("loginSignUpPopup",["$scope","$rootScope","$mdDialog","enums","apiService","$translate","ptLog","appStateManager","popupService","$timeout","locals","ptUtils","gtmService","referralsService",function(e,t,r,o,a,n,i,s,u,c,l,d,g,p){e.selectedTab=l.selectedTab,e.currentLang=n.proposedLanguage()?n.proposedLanguage():n.preferredLanguage(),t.currentLang&&(e.currentLang=t.currentLang),e.loginMessage="",e.loginFacebookMessage="",e.signupFacebookMessage="",e.signupFacebookStatus="",e.signupMessage="",e.signupStatus="",e.registerFacebookStatus="",e.btnStatus=10,e.isLoading=!1,e.isFacebookApiLoaded=t.facebookApiLoaded;var f=p.getReferralData(),h=f.code;e.promoMessage=p.getReferralData().code?n.instant("PROMO_MESSAGE_REGISTER_REFERRED",{ambassadorUserName:f.userName}):window.globals.IS_PROMO?n.instant("PROMO_MESSAGE_REGISTER_PROMO",{startDate:window.globals.START_DATE,endDate:window.globals.END_DATE,couponValue:window.globals.COUPON_VALUE}):n.instant("PROMO_MESSAGE_REGISTER"),e.register=function(t,r,o,n){var c="it"===s.currentLang?"it-IT":s.currentLang;if(!d.regexPatterns.minMaxLength(6).test(r))return e.signupStatus="error",void(e.signupMessage="SIGN_UP_ERROR_PASSWORD_RESTRICTION");e.btnStatus=1,a.users.signUp({email:o,username:t,password:r,location:n,currentLang:c,referralCode:h}).then(function(t){e.btnStatus=10,e.signupMessage=t.Message,e.signupStatus=t.Status,u.showAlert("ACTIVATION_EMAIL_SENT_TITLE","ACTIVATION_EMAIL_SENT_DESCR"),i.log(JSON.stringify(t)),g.trackEvent("registration","click-on-sign-up-button","email signup")}).catch(function(t){e.btnStatus=10,e.signupMessage=t.data.Message,e.signupStatus=t.data.Status,i.error(JSON.stringify(t))})},e.login=function(n,u){var c="it"===s.currentLang?"it-IT":s.currentLang;e.isLoading=!0;var l={username:n,password:u,currentLang:c};d.regexPatterns.email.test(n)&&(delete l.username,l.email=n),a.users.login(l).then(function(a){e.isLoading=!1,i.log(JSON.stringify(a)),t.$emit(o.busEvents.userLogin,a.Data),r.hide()}).catch(function(t){e.isLoading=!1,e.loginStatus=t.data.Status,e.loginMessage=t.data.Message,i.error(JSON.stringify(t))})},e.registerFacebook=function(){t.facebookApiLoaded?(e.btnStatus=1,a.users.signupFacebook({facebookName:t.facebook_user.name,email:t.facebook_user.email,address:t.facebook_user.address,currentLang:s.getCurrentLang(),facebookUserId:t.facebook_user.id,referralCode:h}).then(function(a){e.btnStatus=10,e.signupFacebookStatus=a.Status,i.log(JSON.stringify(a)),t.$emit(o.busEvents.userLogin,a.Data),r.hide(),a.Data.FbSignup&&1==a.Data.FbSignup&&g.trackEvent("registration","click-on-facebook-signup","facebook signup")}).catch(function(t){e.btnStatus=10,e.signupFacebookStatus=t.data.Status,e.signupFacebookMessage=t.data.Message})):(e.signupFacebookStatus="error",e.signupFacebookMessage=n.instant("FACEBOOK_LOADING"),c(function(){e.registerFacebook()},2e3))},e.cancel=function(){r.hide()},e.showTabDialogForgotPassword=function(){u.showForgotPassword()};var m=[];m.push(t.$on(o.busEvents.facebookApiLoad),function(e,t){}),e.$on("$destroy",function(){for(;m.length;)m.pop()()})}]),angular.module("paladinPopups").controller("forgotPasswordPopup",["$scope","$rootScope","$mdDialog","enums","apiService","$translate","ptLog","appStateManager",function(e,t,r,o,a,n,i,s){e.forgotPasswordMessage="",e.forgotpasswordStatus="",e.btnForgotPasswordStatus=10,e.forgotPassword=function(t){e.btnForgotPasswordStatus=1,a.users.forgotPassword({email:t,currentLang:s.getCurrentLang()}).then(function(t){e.btnForgotPasswordStatus=10,e.forgotpasswordStatus=t.Status,e.forgotPasswordMessage=t.Message,i.log(JSON.stringify(t))}).catch(function(t){e.btnForgotPasswordStatus=10,e.forgotpasswordStatus=t.data.Status,e.forgotPasswordMessage=t.data.Message,i.error(JSON.stringify(t))})},e.cancel=function(){r.cancel()}}]),angular.module("paladinPopups").controller("shareToSocialMediaPopup",["$scope","$mdDialog","locals","ptUtils",function(e,t,r,o){e.referralLink=r.referralLink,e.isMobile=o.isMobile.any(),e.cancel=function(){t.cancel()}}]),angular.module("paladinPopups").controller("idVerificationFailureHandlerPopup",["$scope","$mdDialog","$translate","locals",function(e,t,r,o){e.popupTitle=r.instant("ID_VERIFY_FAIL_POPUP_TITLE"),e.isProcessing=!1,e.isSuccess=!0,e.message=o.message,e.cancel=function(){t.cancel()},e.retry=function(){o.retryClb(),e.cancel()},e.sendToManualVerification=function(){o.sendToManualClb(),e.cancel()}}]),angular.module("paladinPopups").controller("emailVerificationPopup",["$scope","$rootScope","$mdDialog","enums","apiService","$translate","ptLog","appStateManager","locals",function(e,t,r,o,a,n,i,s,u){e.welcome_message_dialog=n.instant("WELCOME"),e.isProcessing=!0,e.isSuccess=!0,e.message=n.instant("PLEASE_WAIT"),e.hide=function(){r.hide()},e.cancel=function(){r.cancel()},e.answer=function(e){r.hide(e)},e.retry=function(){e.verifyUser()},e.verifyUser=function(){e.message=n.instant("PLEASE_WAIT"),e.isProcessing=!0,e.isSuccess=!0,a.users.emailVerification({userId:u.userId}).then(function(r){e.isProcessing=!1,e.isSuccess=!0,e.message=n.instant("REGISTRATION_SUCCESS"),t.$emit(o.busEvents.userLogin,r.Data)}).catch(function(t){e.isProcessing=!1,e.isSuccess=!1,e.message=n.instant("REGISTRATION_ERROR")})},e.verifyUser()}]),angular.module("paladinPopups").controller("changePasswordPopup",["$scope","$mdDialog","locals","appStateManager","apiService",function(e,t,r,o,a){e.isProcessing=!1,e.statusError=null,e.changePassModel={oldPassword:"",newPassword:"",newPasswordConfirmation:""},e.cancel=function(){t.cancel()},e.validator=function(){var t=!0;return e.changePassModel.oldPassword&&e.changePassModel.newPassword&&e.changePassModel.newPasswordConfirmation?e.changePassModel.newPassword!=e.changePassModel.newPasswordConfirmation&&(t=!1,e.statusError="PASSES_DONT_MATCH"):(e.statusError="FILL_ALL_FIELDS",t=!1),t},e.changePass=function(){e.statusError=null,e.validator()&&(e.isProcessing=!0,a.users.changePassword({newPassword:e.changePassModel.newPassword,oldPassword:e.changePassModel.oldPassword,userId:o.getUserId()}).then(function(e){t.hide()}).catch(function(t){e.statusError=t.data.Message||"DEFAULT_ERROR",e.isProcessing=!1}))}}]),angular.module("paladinPopups").controller("transactionStatusChangePopup",["$scope","$mdDialog","locals",function(e,t,r){e.title=r.title,e.apiMethod=r.apiMethod,e.isLoading=!0,e.runApiMethod=function(){e.apiMethod().then(function(e){t.hide(e)}).catch(function(e){t.cancel(e)})},e.runApiMethod()}]),angular.module("paladinPopups").controller("inputFieldPopup",["$scope","$mdDialog","locals",function(e,t,r){e.isInvalid=!1,e.message=r.message,e.title=r.title,e.inputRegexValidation=r.inputRegexValidation,e.validationErrorMessage=r.validationErrorMessage,e.inputField={value:r.value},e.closeDialog=function(r){r?e.inputRegexValidation&&e.inputRegexValidation.test(e.inputField.value)?t.hide(e.inputField):e.isInvalid=!0:t.cancel()}}]),angular.module("paladinPopups").controller("loaderPopup",["$rootScope","$scope",function(e,t){t.loadingText=void 0}]),angular.module("paladinPopups").controller("bookingTrackerInfoMobilePopup",["$scope","enums","ptUtils","locals","appStateManager","$mdDialog","$mdColors",function(e,t,r,o,a,n,i){e.userId=a.getUserId(),e.isLender=e.userId==o.booking.Lender_Id,e.isTryAndBuy=o.booking.IsTryAndBuy,e.currentStatusId=o.booking.BookingStatus[o.booking.BookingStatus.length-1].Status_TrackId,e.popupDescription=r.parseBookingStepTutorialHTMLTemplateForTranslationId(r.getTranslationIdForBookingStatus(e.currentStatusId,e.isLender,e.isTryAndBuy)),e.close=function(){return n.hide()};e.$$postDigest(function(){!function(){document.getElementById("bookingTrackerInfoMobilePopupId").parentNode.classList.add("md-dialog-booking-tracker-class"),document.querySelector("#bookingTrackerInfoMobilePopupId div>div").className="flex-100 layout-column layout-align-center-center";var e=document.querySelector("#bookingTrackerInfoMobilePopupId div>div>span");e.className="fontWeight450 font20pt md-padding",i.applyThemeColors(angular.element(e),{color:"default-primary-A300"}),document.querySelector("#bookingTrackerInfoMobilePopupId div>div>ol").className="md-padding",document.querySelectorAll("#bookingTrackerInfoMobilePopupId div>div>ol>li").forEach(function(e){e.className="font12pt",i.applyThemeColors(angular.element(e),{color:"default-primary-A400"})})}()})}]),angular.module("paladinApp").controller("homeController",["$scope","$http","$location","$cookies","$rootScope","$sce","$route","Filters","$translate","ZendeskWidget","ngMeta","$mdDialog","enums","$state","$stateParams","popupService","$timeout","appStateManager",function(e,t,r,o,a,n,i,s,u,c,l,d,g,p,f,h,m,_){e.verificationMessage="Processing ...";var v=f.category,y=v&&v.toString().replace(/-/g," ")!=u.instant("ACTG")?v:u.instant("ACTG"),I=f.subCategory?f.subCategory:"",S=p.params.sortBy||void 0,C=p.params.pageIndex||1,P=f.city||(a.filter||{}).glCity||void 0,b=f.languageCode;a.lang=b,u.use(b),c.setLocale(b);var D=e;function k(e){var t=g.ngMetaValues.currentUrl(e);if(e!=b){var o="/"+e+"/categorie/";null==D.filter.category.selectedCategoryId?o+=g.allCategories[e].replace(/ /g,"-")+"/":o+=s.getCategoryById(D.filter.category.selectedCategoryId,e).Category_Name.replace(/ /g,"-"),D.filter.category.selectedSubCategoryId&&null!=D.filter.category.selectedSubCategoryId&&(o+="/"+s.getSubcategoryById(D.filter.category.selectedSubCategoryId,e).SubCategory_Name.replace(/ /g,"-"),P&&(o+="/"+P)),l.setTag(t,r.absUrl().split("/"+b+"/")[0]+o)}else l.setTag(t,r.absUrl())}function T(e){D.filter.gl=e,D.filter.search.lat=e.geometry.location.lat(),D.filter.search.lng=e.geometry.location.lng(),D.filter.glCity=function(e){for(var t="",r=0;r<e.address_components.length;r++)for(var o=e.address_components[r].types,a=0;a<o.length;a++){var n=o[a];if("country"==n||"political"==n){e.address_components[r].long_name;break}if("administrative_area_level_1"==n){e.address_components[r].long_name;break}if("administrative_area_level_2"==n&&!t||"locality"==n){t=e.address_components[r].long_name;break}}return t}(e),D.filter.glString=e.formatted_address}void 0!=p.params.search?a.searchKey=p.params.search:void 0!=r.search().search&&(a.searchKey=r.search().search),f.isResetSearch&&(a.searchKey=""),a.isTryAndBuy=f.isTryAndBuy,D.filter={categories:[],languageCode:b,priceRange:[0,1e3],search:{lat:void 0,lng:void 0,searchStr:""},currentPage:1,distanceRange:P?10:null,sortBy:g.productsSortOptions.bestProduct,sortByCode:g.productsSortByTextCode.SortByBestProduct,category:{defaultCategoryName:u.instant("ACTG"),defaultCategoryDesc:u.instant("ACTG"),selectedCategoryName:u.instant("ACTG"),isTryAndBuy:a.isTryAndBuy,selectedCategoryBannerImage:window.globals.IS_PROMO?g.categoriesBannersPaths.promo:g.categoriesBannersPaths.all[b],selectedSubCategoryName:null},gl:null,glString:"",glCity:""},D.prepareUrl=function(){var e=a.isTryAndBuy?"/"+_.currentLang+"/categorie":"/"+_.currentLang+"/categorie/privato";return D.filter.category.selectedCategoryName&&D.filter.category.selectedCategoryName.toString()&&(e+="/"+D.filter.category.selectedCategoryName.toString(),D.filter.category.selectedSubCategoryName&&D.filter.category.selectedSubCategoryName.toString()&&(e+="/"+D.filter.category.selectedSubCategoryName.toString(),P&&(e+="/"+P))),e.split(" ").join("-")},D.prepareQuery=function(){var e={};return D.filter.search.searchStr&&(e.search=D.filter.search.searchStr),D.filter.sortBy&&(e.sortBy=D.filter.sortBy),D.filter.currentPage&&(e.pageIndex=D.filter.currentPage),e},D.findLatLong=function(){D.filter.glString?D.geocodeNow(null,null,D.filter.glString):P?D.geocodeNow(null,null,null):navigator.geolocation?(D.geocodeNow(null,null,null),navigator.geolocation.getCurrentPosition(function(e){D.geocodeNow(e.coords.latitude,e.coords.longitude,null)},function(){D.geocodeNow(null,null,null)})):D.geocodeNow(null,null,null)},D.geocodeNow=function(e,t,r){var o={};e&&t?(o.location={},o.location.lat=e,o.location.lng=t):o.address=r||("it"==b||"en"==b?"milan italy":"berlin germany"),(new google.maps.Geocoder).geocode(o,function(e,t){e&&e.length>0&&T(e[0]),a.$broadcast("filtersUpdated",D.filter)})},D.selectCategory=function(){D.filter.categories=a.categoriesMap.get(b);var e=s.getCategoryByName(y,b,a.isTryAndBuy),t=D.filter.category;if(e){if(t.selectedCategoryId=e.Category_Id,t.selectedCategoryDesc=n.trustAsHtml(e.Category_Description),t.selectedCategoryName=e.Category_Name,t.selectedCategoryImagePath=e.Category_ImagePath,t.selectedCategoryBannerImage=e.Category_BannerPath,e.Category_SubCatrgories&&e.Category_SubCatrgories.length>0)for(var r=0;r<e.Category_SubCatrgories.length;r++){var o=e.Category_SubCatrgories[r];if(t.selectedSubCategoryId=void 0,t.selectedSubCategoryDesc=void 0,t.selectedSubCategoryName=void 0,t.selectedSubCategoryImagePath=void 0,t.selectedSubCategoryBannerImage=void 0,o.SubCategory_Name.toLowerCase().replace(/ /g,"-")==I.toLowerCase()){t.selectedSubCategoryId=o.SubCategory_Id,t.selectedSubCategoryDesc=n.trustAsHtml(o.SubCategory_Description),t.selectedSubCategoryName=o.SubCategory_Name,t.selectedSubCategoryImagePath=o.SubCategory_ImagePath,t.selectedSubCategoryBannerImage=o.SubCategory_BannerPath;break}}}else t.selectedCategoryId=null,t.selectedCategoryDesc=n.trustAsHtml(y),t.selectedCategoryName=u.instant("ACTG"),t.selectedCategoryImagePath=null,t.selectedCategoryBannerImage=window.globals.IS_PROMO?g.categoriesBannersPaths.promo:g.categoriesBannersPaths.all[b],t.selectedSubCategoryId=void 0,t.selectedSubCategoryDesc=void 0,t.selectedSubCategoryName=void 0,t.selectedSubCategoryImagePath=void 0,t.selectedSubCategoryBannerImage=void 0,t.isTryAndBuy=a.isTryAndBuy;if(D.filter.category=t,P){a.$broadcast("distanceChanged",{l_id:3,distance:10,name:"IC"})}L()};var w=[];function L(){w.push(D.$watchGroup(["filter.languageCode","filter.sortBy","filter.currentPage","filter.category.selectedCategoryName","filter.category.selectedSubCategoryName","search.lat","search.lng"],function(e){e&&(a.filter=D.filter,r.search(D.prepareQuery()),r.update_path(D.prepareUrl(),!1),k("it"),k("en"))}))}S?(D.filter.sortBy=S,D.filter.sortByCode=g.productsSortByTextCode[S],f.isResetSearch&&(D.filter.search.searchStr=a.searchKey,D.filter.search.currentSearchStr=a.searchKey)):void 0!=a.searchKey&&(D.filter.search.searchStr=a.searchKey,D.filter.search.currentSearchStr=a.searchKey),C&&(D.filter.currentPage=C),a.filter?(D.filter=a.filter,S?(D.filter.sortBy=S,D.filter.sortByCode=g.productsSortByTextCode[S],f.isResetSearch&&(D.filter.search.searchStr="",D.filter.search.currentSearchStr="")):void 0!=a.searchKey&&(D.filter.search.searchStr=a.searchKey,D.filter.search.currentSearchStr=a.searchKey),L(),D.selectCategory(),D.findLatLong()):a.categoriesMap?(D.selectCategory(),D.findLatLong()):(a.categoriesMap=new Map,s.get("it",function(e){a.categoriesMap.set("it",e.data.Data),s.get("en",function(e){a.categoriesMap.set("en",e.data.Data),D.selectCategory(),D.findLatLong()})})),D.promoTimeout=m(function(){null!=_.user||angular.element(document.body).hasClass("md-dialog-is-showing")||h.showLoginSignupPopup(!0)},window.globals.PROMO_SIGNUP_TIMER),w.push(a.$on(g.busEvents.googlePlacesAutocompletePlaceChanged,function(e,t){t&&t.place&&("search-location-bar-desktop"==t.elementId||"search-location-bar-mobile"==t.elementId)&&(T(t.place),P=null,a.$broadcast("filtersUpdated",D.filter))})),w.push(D.$on("languageChanged",function(e,t){D.filter.languageCode=t,c.setLocale(t)})),e.$on("$destroy",function(){for(;w.length;)w.pop()();m.cancel(D.promoTimeout)})}]),angular.module("paladinApp").directive("googleplaceAutocomplete",["$rootScope","enums",function(e,t){return{restrict:"A",require:"ngModel",scope:{googleplaceAutocompletePlace:"=?",googleplaceAutocomplete:"="},link:function(r,o,a,n){var i=r.googleplaceAutocomplete||{};i.placeholder="",i.componentRestrictions={country:"it"};var s=new google.maps.places.Autocomplete(o[0],i);delete o[0].placeholder,google.maps.event.addListener(s,"place_changed",function(){delete o[0].placeholder,r.$apply(function(){r.googleplaceAutocompletePlace=s.getPlace(),n.$setViewValue(o.val()),e.$emit(t.busEvents.googlePlacesAutocompletePlaceChanged,{place:r.googleplaceAutocompletePlace,elementId:o[0].attributes.id.nodeValue})})}),r.$on("$destroy",function(){google.maps.event.clearInstanceListeners(o[0])})}}}]),angular.module("paladinApp").controller("homeV2Controller",["$rootScope","$scope","enums","apiService","appStateManager","$mdToast","$translate","popupService","ngMeta","$timeout","referralsService","validReferralCode",function(e,t,r,o,a,n,i,s,u,c,l,d){t.isLoading=!0,t.isPromo=window.globals.IS_PROMO,t.lendTutorial={title:i.instant("MAKE_MONEY"),description:"ITEMS_ARE_INSURED",imgUrl:"/assets/lend_tutorial_image.png",steps:["UPLOAD_AN_ITEM","WAIT_FOR_REQUEST","LEND_YOUR_ITEM"]},t.borrowTutorial={title:i.instant("SAVE_MONEY"),description:"ITEMS_ARE_INSURED",imgUrl:"/assets/browse-banner-hp.jpg",steps:["FIND_THE_ITEM","MAKE_A_REQUEST","PICK_UP_OR_DELIVER"]},t.promoFixCoupon1={title:i.instant("PROMO_TITLE_1"),description:i.instant("OFERTA_VALIDA",{couponValue:window.globals.COUPON_VALUE}),imgUrl:"/assets/promo1.jpg",steps:["STEP1",i.instant("STEP2",{couponCode:window.globals.COUPON_CODE}),"STEP3"]},t.promoFixCoupon2={title:i.instant("PROMO_TITLE_2"),description:i.instant("OFERTA_VALIDA",{couponValue:window.globals.COUPON_VALUE}),imgUrl:"/assets/promo2.jpg",steps:["STEP1",i.instant("STEP2",{couponCode:window.globals.COUPON_CODE}),"STEP3"]},t.productTeasers={tryAndBuy:{description:"TRY_AND_BUY_INFO",link:"https://paladintrue.com/"+a.currentLang+"/"+window.globals.SUPPORTED_LANGS.find(function(e){return a.currentLang==e.code}).tryAndBuyWordPressPath+"/"},homeAppliance:{categoryId:r.categoriesIds.homeAppliance},smartMobility:{categoryId:r.categoriesIds.smartMobility},hiTech:{categoryId:r.categoriesIds.hiTech},outdoor:{categoryId:r.categoriesIds.outdoor}},t.takingAboutUsImages=[{img:"assets/talkingAboutUs/nuvola_testata-black-white_squared.jpg",link:"http://nuvola.corriere.it/2017/04/26/paladin-lapp-di-noleggio-di-oggetti-tra-privati/"},{img:"assets/talkingAboutUs/corriere-sera-square-1.jpg",link:"http://www.corriere.it/tecnologia/app-software/17_aprile_27/paladin-l-app-mettere-noleggio-oggetti-che-non-usiamo-750154f0-2b76-11e7-9442-4fba01914cee.shtml"},{img:"assets/talkingAboutUs/deejay_Logo-black-white.jpg",link:"https://www.deejay.it/audio/20170430-4/520066/"},{img:"assets/talkingAboutUs/green-me-black-white.jpg",link:"https://www.greenme.it/tecno/cellulari/23899-paladin-app-affitto-oggetti"},{img:"assets/talkingAboutUs/webnews-black-white.jpg",link:"http://www.webnews.it/2017/05/05/paladin-sharing-applicazione-economia-startup/"},{img:"assets/talkingAboutUs/logo-lifegate-radio-black-white.jpeg",link:"https://www.lifegate.it/radio-sound"},{img:"assets/talkingAboutUs/logo-radio-popolare-black-white.jpeg",link:"http://www.radiopopolare.it/podcast/pionieri-di-lun-2310/"},{img:"assets/talkingAboutUs/green-planner-black-white.jpeg",link:"https://www.greenplanner.it/2017/10/10/paladin-noleggio-strumenti/"},{img:"assets/talkingAboutUs/logo-Rai3-black-white.jpeg",link:"http://www.rai.it/rai3/"}],t.getHomePageData=function(){t.isLoading=!0,o.pages.getHomePageData([t.productTeasers.hiTech.categoryId,t.productTeasers.smartMobility.categoryId,t.productTeasers.homeAppliance.categoryId,t.productTeasers.outdoor.categoryId]).then(function(e){t.isLoading=!1,t.data=e.Data}).catch(function(e){t.isLoading=!1,t.data={}})},t.getCategoryName=function(e){var r=t.data.Categories.find(function(t){return t.CategoryId==e});if(r)return r.CategoryName},t.getProductList=function(e,r){if(0==e)return r?t.data.TryAndBuyProducts:t.data.P2PProducts;var o=t.data.Categories.find(function(t){return t.CategoryId==e});return o?o.ProductList:void 0},t.getPopularTryAndBuy=function(){t.isLoading=!0,o.products.getPopularTryAndBuy().then(function(e){t.isLoading=!1,t.tryAndBuy=e.Data}).catch(function(e){t.isLoading=!1,t.tryAndBuy=[]})},t.getHomePageData(),u.setTitle(i.instant("HOME_TITLE")),u.setTag("description",i.instant("DEFAULT_META_DESC")),u.setTag("imagePath","../../assets/paladin-logo-300x300.png"),t.promoTimeout=c(function(){t.isCrawler()||null!=a.user||angular.element(document.body).hasClass("md-dialog-is-showing")||s.showLoginSignupPopup(!0)},l.referralCode?0:window.globals.PROMO_SIGNUP_TIMER),t.isCrawler=function(){return/bot|prerender|googlebot|crawler|spider|robot|crawling/i.test(navigator.userAgent)},t.$on("$destroy",function(){c.cancel(t.promoTimeout)}),t.showToast=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;n.show(n.simple().textContent(e).hideDelay(t))}}]),angular.module("paladinApp").controller("PreviewController",["$scope","$sce","$window","$rootScope","$translate","$stateParams","$location","Products","ngMeta","$filter","$anchorScroll","ZendeskWidget","Filters","enums",function(e,t,r,o,a,n,i,s,u,c,l,d,g,p){var f=e;f.getCurrentLanguageCode=function(){return a.proposedLanguage()?a.proposedLanguage():a.preferredLanguage()},f.rating=0,f.ratingRounded=0,f.profileDefaultImage="../../assets/profile.png";var h=n.productId.split("-")[n.productId.split("-").length-1],m=n.languageCode?n.languageCode:f.getCurrentLanguageCode();u.setTag("currentUrl_en",i.absUrl().replace("/"+m+"/","/en/")),u.setTag("currentUrl_it",i.absUrl().replace("/"+m+"/","/it/")),u.setTag("currentUrl_de",i.absUrl().replace("/"+m+"/","/de/")),a.use(m),o.lang=m,d.setLocale(m),o.$broadcast("updateLanguage",m);o.searchedLocation;function _(){f.productDetail.Product_CategoryId&&(f.selectedCategoryName=g.getCategoryById(f.productDetail.Product_CategoryId,m).Category_Name),f.productDetail.Product_SubCategoryId&&(f.selectedSubCategoryName=g.getSubcategoryById(f.productDetail.Product_SubCategoryId,m).SubCategory_Name)}f.allCategory=a.instant("ACTG"),f.allCategory==f.selectedCategoryName&&(f.selectedCategoryName=null),f.selectedSubCategoryName=o.subcategory,f.productDetail={},f.productImageBaseUrl=window.globals.PRODUCT_IMAGE_URL,f.userImageBaseUrl=window.globals.PROFILE_IMAGE_URL,f.rentNowUrl=window.globals.RENT_NOW_URL,f.h1="",f.h2="",f.productAddress="",f.sample=1,f.fetchProductAddress=function(){var e={location:{}};e.location.lat=Number(f.productDetail.Product_Latitude),e.location.lng=Number(f.productDetail.Product_Longitude),geocoder=new google.maps.Geocoder;geocoder.geocode(e,function(e,t){e&&e.length>0&&(f.productLocation=e[0],f.setProductAddress(e[0]))})},f.setProductAddress=function(t){e.productDetail.productAddress=t.formatted_address,f.sample=2,f.productLocation=t,f.updateMetaTags(),e.$apply()},f.getCity=function(e){for(var t="",r=0;r<e.address_components.length;r++)for(var o=e.address_components[r].types,a=0;a<o.length;a++){var n=o[a];if("country"==n||"political"==n){e.address_components[r].long_name;break}if("administrative_area_level_1"==n){e.address_components[r].long_name;break}if("administrative_area_level_2"==n&&!t||"locality"==n){t=e.address_components[r].long_name;break}}return t},f.$on("languageChanged",function(e,t){i.update_path(i.path().replace("/"+m+"/","/"+t+"/"),!0),m=t,f.refreshProductDetail(),d.setLocale(m),_()}),f.getPageTitle=function(){var e=a.instant("RENT")+" ";return f.selectedCategoryName&&!f.selectedSubCategoryName?e+=f.selectedCategoryName+" ":f.selectedSubCategoryName&&(e+=f.selectedSubCategoryName+" "),f.productDetail&&f.productDetail.Product_Title&&(e+=f.productDetail.Product_Title+"  "),f.productLocation&&(e+=a.instant("IN")+" "+f.getCity(f.productLocation)),e},f.getMetaTags=function(){var e=a.instant("RENT")+" ";return f.selectedCategoryName&&(e+=f.selectedCategoryName+" "),f.selectedSubCategoryName&&(e+=f.selectedSubCategoryName+" "),f.productDetail&&f.productDetail.Product_Title&&(e+=f.productDetail.Product_Title+"  "),f.productLocation&&(e+=a.instant("IN")+" "+f.getCity(f.productLocation)),e},f.updateH1=function(){f.h1=a.instant("RENT")+" ",f.productDetail&&f.productDetail.Product_Title&&(f.h1+='<span class="greenText">'+f.productDetail.Product_Title+"</span> "),f.productLocation&&(f.h1+=a.instant("IN")+" "+f.getCity(f.productLocation)),f.h1=t.trustAsHtml(f.h1)},f.updateH2=function(){f.h2=f.getPageTitle()},f.updateMetaTags=function(){f.productDetail&&(u.setTitle(f.getPageTitle()),u.setTag("description",f.getMetaTags()),u.setTag("imagePath",window.globals.PRODUCT_IMAGE_URL+f.productDetail.ProductImage_Image1),f.updateH1(),v())},f.refreshProductDetail=function(){h&&s.getDetail(h,m,function(e){f.productDetail=e.data.Data,f.rating=f.productDetail.User_ReviewAsLender>0?parseFloat(f.productDetail.User_ReviewAsLender/2).toFixed(1):0,f.ratingRounded=Math.round(f.rating),f.fetchProductAddress(),o.categoriesMap?_():(o.categoriesMap=new Map,g.get("it",function(e){o.categoriesMap.set("it",e.data.Data),g.get("en",function(e){o.categoriesMap.set("en",e.data.Data),g.get("de",function(e){o.categoriesMap.set("de",e.data.Data),_(),f.updateMetaTags()})})}))})},f.goToAllCategory=function(){o.filter&&(o.filter.category.selectedCategoryId=null,o.filter.category.selectedCategoryDesc=null,o.filter.category.selectedCategoryName=a.instant("ACTG"),o.filter.category.selectedCategoryImagePath=null,o.filter.category.selectedCategoryBannerImage=p.categoriesBannersPaths.all,o.filter.category.selectedSubCategoryId=null,o.filter.category.selectedSubCategoryDesc=null,o.filter.category.selectedSubCategoryName=null,o.filter.category.selectedSubCategoryImagePath=null,o.filter.category.selectedSubCategoryBannerImage=null,o.filter.currentPage=1),i.search("key",null),i.url("/"+m+"/"+a.instant("ACTG").replace(/ /g,"-"))},f.goToCategory=function(){if(o.filter){var e=g.getCategoryById(f.productDetail.Product_CategoryId,m);o.filter.category.selectedCategoryId=f.productDetail.Product_CategoryId,o.filter.category.selectedCategoryDesc=t.trustAsHtml(e.Category_Description),o.filter.category.selectedCategoryName=e.Category_Name,o.filter.category.selectedCategoryImagePath=e.Category_ImagePath,o.filter.category.selectedCategoryBannerImage=e.Category_BannerPath,o.filter.category.selectedSubCategoryId=null,o.filter.category.selectedSubCategoryDesc=null,o.filter.category.selectedSubCategoryName=null,o.filter.category.selectedSubCategoryImagePath=null,o.filter.category.selectedSubCategoryBannerImage=null,o.filter.currentPage=1}i.search("key",null),i.url("/"+m+"/"+f.selectedCategoryName.replace(/ /g,"-"))},f.goToSubCategory=function(){if(o.filter){var e=g.getCategoryById(f.productDetail.Product_CategoryId,m);o.filter.category.selectedCategoryId=f.productDetail.Product_CategoryId,o.filter.category.selectedCategoryDesc=t.trustAsHtml(e.Category_Description),o.filter.category.selectedCategoryName=e.Category_Name,o.filter.category.selectedCategoryImagePath=e.Category_ImagePath,o.filter.category.selectedCategoryBannerImage=e.Category_BannerPath;var r=g.getSubcategoryById(f.productDetail.Product_SubCategoryId,m);o.filter.category.selectedSubCategoryId=f.productDetail.Product_SubCategoryId,o.filter.category.selectedSubCategoryDesc=t.trustAsHtml(r.SubCategory_Description),o.filter.category.selectedSubCategoryName=r.SubCategory_Name,o.filter.category.selectedSubCategoryImagePath=r.SubCategory_ImagePath,o.filter.category.selectedSubCategoryBannerImage=r.SubCategory_BannerPath,o.filter.currentPage=1}i.search("key",null),i.url("/"+m+"/"+f.selectedCategoryName.replace(/ /g,"-")+"/"+f.selectedSubCategoryName.replace(/ /g,"-"))},f.go=function(e){i.$$search={},i.path(e)},f.rentNow=function(){var e=f.rentNowUrl.replace("{0}",m).replace("{1}",f.productDetail.Product_Id);r.location.href=e},f.rentNowDesktop=function(){r.location.href=a.instant("URL_DOWNLOAD")};var v=function(){var e=i.hash();i.hash("breadcrumb-pr-detail"),l(),i.hash(e)};f.refreshProductDetail()}]),angular.module("paladinApp").controller("productDetailedController",["$rootScope","$scope","enums","apiService","$stateParams","toastService","appStateManager","dataService","$sce","NgMap","popupService","$timeout","moment","ngMeta","$translate","ptUtils","$anchorScroll","$location","referralsService",function(e,t,r,o,a,n,i,s,u,c,l,d,g,p,f,h,m,_,v){t.isLoading=!1,a.productNameAndId&&(t.productId=a.productNameAndId.split("-")[a.productNameAndId.split("-").length-1]),t.category=null,t.subCategory=null,t.rentPickersIds={mobile:"rental-request-picker-mobile",desktop:"rental-request-picker-desktop"},t.productAddress={address:void 0,lat:void 0,lng:void 0},t.productBookingDetails=null,t.isLoggedInUser=function(){return i.getUserId()},t.updateMetaTags=function(){t.product&&(p.setTitle(t.getPageTitle()),p.setTag("description",t.getPageTitle()),p.setTag("imagePath",window.globals.PRODUCT_IMAGE_URL+t.product.ProductImage_Image1))},t.getPageTitle=function(){var e=f.instant("RENT")+" ";return t.product&&t.product.Product_Title&&(e+=t.product.Product_Title+"  "),e+"| Paladintrue"},t.fetchDetailedProduct=function(){t.isLoading=!0,o.products.getDetailedProduct(t.productId).then(function(e){t.product=e.Data,t.isMyProduct=t.product.Lender_UserId==i.getUserId(),t.product.Product_Description=u.trustAsHtml(t.product.Product_Description),h.extractAndGeoLocateAddressFromObjectForFieldNames({object:t.product,addressFieldName:"Product_Address",latFieldName:"Product_Latitude",lngFieldName:"Product_Longitude"}).then(function(e){t.productAddress=e}),i.getUserId()&&t.fetchBookingDetails(),t.getCategory(),t.updateMetaTags(),t.isLoading=!1}).catch(function(e){t.isLoading=!1,n.simpleToast(JSON.stringify(e)),console.error(e)})},t.fetchBookingDetails=function(){o.products.getProductBookingDetails({productId:t.product.Product_Id,userId:i.getUserId()}).then(function(e){t.productBookingDetails=e.Data,t.isLoading=!1}).catch(function(e){t.isLoading=!1,console.error(e)})},t.getCategory=function(){if(!i.categoriesDict)return s.getCategories();if(t.product&&(t.category=i.categoriesDict[t.product.Product_CategoryId],t.category&&t.product.Product_SubCategoryId>0)){var e=t.category.Category_SubCatrgories.find(function(e){return e.SubCategory_Id==t.product.Product_SubCategoryId});e&&(t.subCategory=e)}},t.requestRentalDates=function(){l.showDateRangePicker(t.productBookingDetails,t.product).then(function(e){var r=g(e.dateStart),o=g(e.dateEnd),a=h.getRentalPeriodInDays({startRentDate:e.dateStart,endRentDate:e.dateEnd});if(t.product.MinRentalPeriod>0&&a<t.product.MinRentalPeriod)return l.showAlert("OOPS",f.instant("INVALID_MIN_RENTAL_PERIOD",{days:t.product.MinRentalPeriod})).finally(function(){t.requestRentalDates()});t.onRequestRent({startDate:r,endDate:o})})},t.onRequestRent=function(o){var a=o.startDate,n=o.endDate;o.componentId;a&&n&&e.$emit(r.busNavigation.paymentDetailed,{startDate:a,endDate:n,productId:t.productId})},t.onDatesUpdated=function(o){var a=o.startDate,n=o.endDate,i=o.componentId==t.rentPickersIds.desktop?t.rentPickersIds.mobile:t.rentPickersIds.desktop;e.$emit(r.busEvents.rentalRequestPickerUpdateDates,{startDate:a,endDate:n,componentId:i})},t.browseCategory=function(t,o){e.$emit(r.busNavigation.browseCategory,{categoryName:t,subCategoryName:o})},t.getCategoriesUrl=function(e,r){return h.getCategoriesUrl(e,r,t.product.Product_TryAndBuy,f.use())},t.onStartEndDateSelected=function(e){e.startDate,e.endDate};var y=[];y.push(e.$on(r.busEvents.categoriesUpdate,function(e,r){t.getCategory()})),t.fetchDetailedProduct(),t.promoTimeout=d(function(){h.isCrawler()||null!=i.user||angular.element(document.body).hasClass("md-dialog-is-showing")||l.showLoginSignupPopup(!0)},v.referralCode?0:window.globals.PROMO_SIGNUP_TIMER),t.$on("$destroy",function(){for(;y.length;)y.pop()();d.cancel(t.promoTimeout)});var I=_.hash();_.hash("main-product-image"),m(),_.hash(I)}]),angular.module("paladinApp").controller("appController",["$scope","$rootScope","ZendeskWidget","enums","ptLog","appStateManager","dataService","$state","$location","$mdToast","$mdMedia",function(e,t,r,o,a,n,i,s,u,c,l){t.isAppOnline=!0,e.$on(o.busEvents.$routeChangeError,function(e,t,r,o){a.log("route change error"),a.log(o)}),s.includes("app.emailVerification")&&void 0!=Object.keys(u.search())[0]&&t.$emit(o.busEvents.triggerEmailValidation,{userId:Object.keys(u.search())[0]});var d=[];d.push(t.$on(o.busEvents.locationUpdate,function(e,t){})),d.push(t.$on(o.busEvents.scrollMainScrollerToTop,function(e,t){document.getElementById("main-ui-view").scrollTo(0,0)})),l("gt-sm")?r.show():r.hide(),d.push(e.$watch(function(){return l("gt-sm")},function(e){e?r.show():r.hide()})),e.$on("$destroy",function(){for(;d.length;)d.pop()()})}]),angular.module("paladinApp").controller("userProfileController",["$rootScope","$scope","appStateManager","apiService","$stateParams","$state","toastService","enums","popupService","$translate","ptLog","ptUtils",function(e,t,r,o,a,n,i,s,u,c,l,d){console.log("userProfileController $scope ",t),t.isLoading=!1,t.isMyProfile=!1,t.isEditing=!1,t.isUpdating=!1,t.userId=a.userId,t.editableProfile=null,t.tempBas64Image=null,n.includes("app.profiles.myProfile")?(t.isMyProfile=!0,t.userId||(r.getUserId()?t.userId=r.getUserId():n.go("app.home"))):t.userId==r.getUserId()&&n.go("app.profiles.myProfile",{userId:t.userId}),t.fetchUserProfile=function(){t.profile=null,t.isLoading=!0;var e=t.userId;o.users.getUserProfile({userId:e}).then(function(e){t.profile=e.Data,p(),d.extractAndGeoLocateAddressFromObjectForFieldNames({object:t.profile,addressFieldName:"User_Address",latFieldName:"User_Latitude",lngFieldName:"User_Longitude"}).then(function(e){t.profile.User_Address=e.address}),t.isLoading=!1}).catch(function(e){t.isLoading=!1,i.simpleToast(e.data.Message||c.instant("DEFAULT_ERROR"))})},t.editProfile=function(){var e=t.profile,r=(e.User_Address,e.User_FullName);t.editableProfile=angular.copy(t.profile);var o=r.split(" ");t.editableProfile.userFirstName=o[0],t.editableProfile.userLastName=o.length>1?o[1]:"",t.isEditing=!0},t.submitProfileEdit=function(){t.editableProfile.User_FullName=t.editableProfile.userFirstName+" "+(t.editableProfile.userLastName||"");var e=angular.copy(t.editableProfile);delete e.userFirstName,delete e.userLastName,t.isUpdating=!0,o.users.editProfile(e).then(function(){o.users.updateNotificaton({userId:t.userId,emailNotif:e.Notification_Email||!1,chatNotif:e.Notification_Chat||!1}).then(function(e){location.reload()}).catch(function(e){t.isUpdating=!1,i.simpleToast(e.data.Message),console.error(e)})}).catch(function(e){t.isUpdating=!1,i.simpleToast(e.data.Message)})},t.uploadImage=function(){angular.element(document.getElementById("uploadImageBtn"))[0].click()},t.onUploaded=function(e){i.simpleToast(c.instant("UPLOADING_IMAGE")),e&&e.files&&e.files.length>0&&canvasResize(e.files[0],{quality:75,isPreprocessing:!0,cardType:"",maxW:2048,maxH:2008,isiOS:d.isMobile.iOS(),callback:function(e,r,o){t.$evalAsync(function(){t.editableProfile.User_DisplayPicture=e.split(",")[1],t.tempBas64Image=e,i.simpleToast(c.instant("IMAGE_UPLOADED"))})}})},t.changePassword=function(){u.showChangePassword().then(function(){return i.simpleToast(c.instant("PASSWORD_SUCCESSFULLY_CHANGED"))}).catch(function(){return l.log("pass change Canceled")})},t.logout=function(){e.$emit(s.busEvents.userLogout)},t.deleteAccount=function(){u.showConfirm(c.instant("WARN"),c.instant("DEL_ACCOUNT_CONFIRM_MESSAGE")).then(function(){t.isLoading=!0,o.users.deleteAccount(t.userId).then(function(){t.isLoading=!1,u.showAlert(c.instant("DEL_ACCOUNT"),c.instant("DEL_ACCOUNT_SUCCESS")).finally(function(){e.$emit(s.busEvents.userLogout)})}).catch(function(e){t.isLoading=!1,u.showAlert(c.instant("DEL_ACCOUNT"),e.data.Message||c.instant("DEFAULT_ERROR")).finally(function(){})})}).catch(function(){})};var g=function(){console.log("open share referral link popup ",u," .. ",t.referralLink),u.showShareReferralLink(t.credit.ReferralCode)},p=function(){var e=t.userId;o.users.getUserCredit({userId:e}).then(function(e){console.log("user.credit ",e),t.credit=e.Data,t.credit.shareReferralLink=g},function(e){console.log("getUserCredit failed because: ",e)})};t.fetchUserProfile();var f=[];f.push(e.$on(s.busEvents.googlePlacesAutocompletePlaceChanged,function(e,r){if("editProfileAddressField"==r.elementId){var o=r.place,a=o.geometry;t.editableProfile.User_Latitude=a.location.lat(),t.editableProfile.User_Longitude=a.location.lng(),t.editableProfile.User_LocationId=o.id}})),t.$on("$destroy",function(){for(;f.length;)f.pop()()})}]),angular.module("paladinApp").controller("newProductController",["$rootScope","$scope","enums","appStateManager","apiService","uploadHandler","toastService","$translate","gtmService","ptUtils",function(e,t,r,o,a,n,i,s,u,c){t.isLoading=!0,t.emptyProductImage=r.categoriesBannersPaths.addProduct,t.subCategories=[],t.userAddress=void 0,t.isUseUserAddress={value:!1},t.newProductModel={Product_Title:"",Product_Description:"",Product_ItemCategory_Id:0,Product_SubCategoryId:0,Product_LenduserId:o.getUserId(),Product_TryAndBuy:!1,Product_IsShop:!1,Product_ShopURL:"",Product_Price_Perday:null,Product_City:"",Price7Day:null,Price15Day:null},t.onUploadClicked=function(){t.$$postDigest(function(){angular.element(document.getElementById("uploadImageBtn"))[0].click()})},t.onUploaded=function(e){i.simpleToast(s.instant("UPLOADING_IMAGE")),canvasResize(e.files[0],{quality:75,isPreprocessing:!0,cardType:"",maxW:2048,maxH:2008,isiOS:c.isMobile.iOS(),callback:function(e,r,o){t.$evalAsync(function(){t.tmpUlpoadedImg=e,t.newProductModel.ProductImage_Image1=e.split(",")[1],i.simpleToast(s.instant("IMAGE_UPLOADED"))})}})},t.validator=function(){var e=!0,r="";return t.newProductModel.Product_Title||(e=!1,r||(r=s.instant("PRODUCT_INVALID_TITLE"))),t.newProductModel.Product_Description||(e=!1,r||(r=s.instant("PRODUCT_INVALID_DESCRIPTION"))),t.newProductModel.Product_Latitude&&t.newProductModel.Product_Longitude||t.isUseUserAddress.value&&t.userAddress&&t.userAddress.lat&&t.userAddress.lng||(e=!1,r||(r=s.instant("PRODUCT_INVALID_ADDRESS"))),t.newProductModel.ProductImage_Image1||(e=!1,r||(r=s.instant("PRODUCT_INVALID_IMAGE"))),t.newProductModel.Product_ItemCategory_Id||(e=!1,r||(r=s.instant("PRODUCT_INVALID_CATEGORY"))),t.newProductModel.Product_Price_Perday||(e=!1,r||(r=s.instant("PRODUCT_INVALID_PRICE_PER_DAY"))),t.newProductModel.Product_TryAndBuy&&!t.newProductModel.Product_ShopURL&&(e=!1,r||(r=s.instant("PRODUCT_INVALID_TRY_AND_BUY_URL"))),e||i.simpleToast(r),e},t.onCategorySelected=function(e){if(t.subCategories=[],t.newProductModel.Product_SubCategoryId=0,t.categories){var r=t.categories.find(function(t){return t.Category_Id==e});r&&r.Category_SubCatrgories&&r.Category_SubCatrgories.length>0?t.subCategories=r.Category_SubCatrgories:t.subCategories=[]}},t.addProduct=function(){if(t.validator()){t.isLoading=!0;var n=angular.copy(t.newProductModel);t.isUseUserAddress.value&&(delete n.Product_LocationId,n.Product_Latitude=t.userAddress.lat,n.Product_Longitude=t.userAddress.lng),e.$emit(r.busEvents.scrollMainScrollerToTop),a.products.addProduct(n).then(function(n){u.trackEvent("add-product","new-product-added"),a.products.getUserProducts({userId:o.getUserId(),productsFilter:r.userProductsFilter.myProductsToBorrow}).then(function(o){if(t.isLoading=!1,o&&o.Data&&o.Data.User_AllProducts&&o.Data.User_AllProducts.length>0){var a=o.Data.User_AllProducts[o.Data.User_AllProducts.length-1];e.$emit(r.busNavigation.productDetailed,{product:a})}console.log(o)}).catch(function(e){t.isLoading=!1,console.error(e)})}).catch(function(e){t.isLoading=!1})}};var l=function(){if(o.user&&o.user.User_Address&&o.user.User_Latitude&&o.user.User_Longitude&&!t.userAddress&&(t.userAddress={address:o.user.User_Address,lat:o.user.User_Latitude,lng:o.user.User_Longitude}),o.categoriesDict&&!t.categories){var e=[],r=0;Object.values(o.categoriesDict).forEach(function(t){t.IsTryAndBuy||(e[r++]=t)}),t.categories=e}};l(),t.isLoading=!1;var d=[];d.push(e.$on(r.busEvents.categoriesUpdate,function(){l()})),d.push(e.$on(r.busEvents.updatedUser,function(){l()})),d.push(e.$on(r.busEvents.googlePlacesAutocompletePlaceChanged,function(e,r){if("newProductAddress"==r.elementId){var o=r.place,a=o.geometry;t.newProductModel.Product_Latitude=a.location.lat(),t.newProductModel.Product_Longitude=a.location.lng(),t.newProductModel.Product_LocationId=o.id}})),t.$on("$destroy",function(){for(;d.length;)d.pop()()})}]),angular.module("paladinApp").controller("myListingsController",["$rootScope","$scope","enums","appStateManager","apiService","$mdMedia",function(e,t,r,o,a,n){t.isLoading=!1,t.userId=o.getUserId(),t.addNewItem=function(){e.$emit(r.busNavigation.newProduct)},t.isGtMd=n("gt-md");var i=[];i.push(t.$watch(function(){return n("gt-md")},function(e){t.isGtMd=e})),t.$on("$destroy",function(){for(;i.length;)i.pop()()})}]),angular.module("paladinApp").controller("productReviewController",["$scope","$state","$location","$rootScope","appStateManager","apiService","productReviewService","toastService","$translate",function(e,t,r,o,a,n,i,s,u){var c={review:{text:null,rating:null}};c.booking=i.getBookingToReview(),c.isLoading=!1,c.onRating=function(e){c.review.rating=e},c.submitReview=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(c.booking)if(void 0!==c.review.stars)if(null!==c.review.text){var t={Review_Precnt:2*c.review.stars,Review_ProductId:c.booking.Product_Id,Review_UserId:c.booking.Borrower_Id,LanguageCode:a.getCurrentLang(),ReviewDetail_Comment:c.review.text||"",Review_BookingId:c.booking.Booking_Id};n.reviews.submitTransactionReview(t).then(function(e){console.log("submit review result ",e),s.simpleToast(u.instant("REVIEW_ADDED_SUCCESS"))},function(e){s.simpleToast(u.instant("REVIEW_ADDED_FAILED")),console.error(e)}),e.vm.closeProductReview()}else s.simpleToast(u.instant("REVIEW_VALIDATION_NO_COMMENT"));else s.simpleToast(u.instant("REVIEW_VALIDATION_NO_STARS"));else console.error("Invalid booking: ",c.booking)},c.closeProductReview=function(){i.leaveProductReviewPage()},e.vm=c}]);var mockDummyData={Status:"success",Data:{User_Booking_Borrower:[{Product_Id:11425,Booking_Id:736,Borrower_Id:11736,Borrower_Name:"milalou2 milalou2-last",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11608,Lender_Name:"Marc Ferrer",Lender_StripeAccount:"acct_1AJTHYAN9BUpHCOJ",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/26/2018",EndDate:"4/27/2018",FullStartDate:"2018-04-26T00:00:00Z",FullEndDate:"2018-04-27T00:00:00Z",Lender_Image:"qSzR0g6M0HFiwOZaTm42D5a4stKjQj",Borrower_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Chat_Id:0,NoOfdays:2,Product_Title:"retina screen",Lender_BillingAddress:null,Product_Image:"lFYnTHaa7yI4kboCpsrT5a4stKjQj",Product_PricePerDay:"5",BorrowerCusotmerId:"",RentAmount:10,Discount:0,AmountCharge:10,Status:"timeout",Booking_ReadId:2,Delivery_Latitude:"",Delivery_Longitude:"",Delivery_Address:"",Booking_PickupProduct:!1,BookingStatus:[{StatusName:"requested",CreatedDate:"10/04/2018",Status_TrackId:1,CreatedTime:"05:46"},{StatusName:"verified",CreatedDate:"10/04/2018",Status_TrackId:3,CreatedTime:"05:46"},{StatusName:"timeout",CreatedDate:"10/04/2018",Status_TrackId:4,CreatedTime:"06:00"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11510,Booking_Id:730,Borrower_Id:11736,Borrower_Name:"milalou2 milalou2-last",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11624,Lender_Name:"Muhammad Ali",Lender_StripeAccount:"acct_1CCQcZLXqrrI6AjN",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/19/2018",EndDate:"4/21/2018",FullStartDate:"2018-04-19T00:00:00Z",FullEndDate:"2018-04-21T00:00:00Z",Lender_Image:"yTj58mdeStrfU5QoJBmtD5a4stKjQj",Borrower_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Chat_Id:0,NoOfdays:3,Product_Title:"Plastic bottle",Lender_BillingAddress:null,Product_Image:"Iti4Fsg9gJl2db5XWKAseD5a4stKjQj",Product_PricePerDay:"14",BorrowerCusotmerId:"",RentAmount:7,Discount:0,AmountCharge:7,Status:"timeout",Booking_ReadId:2,Delivery_Latitude:"",Delivery_Longitude:"",Delivery_Address:"",Booking_PickupProduct:!1,BookingStatus:[{StatusName:"requested",CreatedDate:"09/04/2018",Status_TrackId:1,CreatedTime:"20:16"},{StatusName:"verified",CreatedDate:"09/04/2018",Status_TrackId:3,CreatedTime:"20:16"},{StatusName:"timeout",CreatedDate:"09/04/2018",Status_TrackId:4,CreatedTime:"20:30"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11535,Booking_Id:689,Borrower_Id:11736,Borrower_Name:"milalou2 milalou2-last",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11735,Lender_Name:"milalou4",Lender_StripeAccount:"",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/19/2018",EndDate:"4/20/2018",FullStartDate:"2018-04-19T00:00:00Z",FullEndDate:"2018-04-20T00:00:00Z",Lender_Image:"NXxMyDfZn2ZHu0dUvLJeT5a4stKjQj",Borrower_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Chat_Id:0,NoOfdays:2,Product_Title:"tennis sport",Lender_BillingAddress:null,Product_Image:"3rQf5vmj3KTZmJ2y5Notj5a4stKjQj",Product_PricePerDay:"3",BorrowerCusotmerId:"",RentAmount:6,Discount:0,AmountCharge:6,Status:"timeout",Booking_ReadId:3,Delivery_Latitude:"",Delivery_Longitude:"",Delivery_Address:"",Booking_PickupProduct:!1,BookingStatus:[{StatusName:"requested",CreatedDate:"09/04/2018",Status_TrackId:1,CreatedTime:"14:25"},{StatusName:"verified",CreatedDate:"09/04/2018",Status_TrackId:3,CreatedTime:"14:25"},{StatusName:"timeout",CreatedDate:"09/04/2018",Status_TrackId:4,CreatedTime:"14:40"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11545,Booking_Id:688,Borrower_Id:11736,Borrower_Name:"milalou2 milalou2-last",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11746,Lender_Name:"milalou3",Lender_StripeAccount:"acct_1CDbR1BB9Tg1dJD4",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/20/2018",EndDate:"4/20/2018",FullStartDate:"2018-04-20T00:00:00Z",FullEndDate:"2018-04-20T00:00:00Z",Lender_Image:null,Borrower_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Chat_Id:0,NoOfdays:1,Product_Title:"little mu",Lender_BillingAddress:null,Product_Image:"dQgiMmnnpqeikt2ASslLj5a4stKjQj",Product_PricePerDay:"5",BorrowerCusotmerId:"",RentAmount:5,Discount:0,AmountCharge:5,Status:"card_not_verified_timeout",Booking_ReadId:2,Delivery_Latitude:"",Delivery_Longitude:"",Delivery_Address:"",Booking_PickupProduct:!1,BookingStatus:[{StatusName:"requested",CreatedDate:"09/04/2018",Status_TrackId:1,CreatedTime:"14:18"},{StatusName:"notverified",CreatedDate:"09/04/2018",Status_TrackId:2,CreatedTime:"14:18"},{StatusName:"card_not_verified_timeout",CreatedDate:"09/04/2018",Status_TrackId:13,CreatedTime:"18:35"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11535,Booking_Id:556,Borrower_Id:11736,Borrower_Name:"milalou2 milalou2-last",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11735,Lender_Name:"milalou4",Lender_StripeAccount:"",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/26/2018",EndDate:"4/28/2018",FullStartDate:"2018-04-26T00:00:00Z",FullEndDate:"2018-04-28T00:00:00Z",Lender_Image:"NXxMyDfZn2ZHu0dUvLJeT5a4stKjQj",Borrower_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Chat_Id:0,NoOfdays:3,Product_Title:"tennis sport",Lender_BillingAddress:null,Product_Image:"3rQf5vmj3KTZmJ2y5Notj5a4stKjQj",Product_PricePerDay:"3",BorrowerCusotmerId:"",RentAmount:9,Discount:0,AmountCharge:9,Status:"started",Booking_ReadId:2,Delivery_Latitude:"",Delivery_Longitude:"",Delivery_Address:"",Booking_PickupProduct:!1,BookingStatus:[{StatusName:"requested",CreatedDate:"03/04/2018",Status_TrackId:1,CreatedTime:"20:15"},{StatusName:"verified",CreatedDate:"03/04/2018",Status_TrackId:3,CreatedTime:"20:15"},{StatusName:"accepted",CreatedDate:"03/04/2018",Status_TrackId:7,CreatedTime:"20:16"},{StatusName:"started",CreatedDate:"09/04/2018",Status_TrackId:8,CreatedTime:"21:13"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11537,Booking_Id:526,Borrower_Id:11736,Borrower_Name:"milalou2 milalou2-last",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11737,Lender_Name:"milalou5",Lender_StripeAccount:"acct_1CClL3HkZgZyGSpV",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!0,StartDate:"4/19/2018",EndDate:"4/21/2018",FullStartDate:"2018-04-19T00:00:00Z",FullEndDate:"2018-04-21T00:00:00Z",Lender_Image:null,Borrower_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Chat_Id:0,NoOfdays:3,Product_Title:"sock",Lender_BillingAddress:null,Product_Image:"GCdCsbMYjJAIQ3CnJQ93Mj5a4stKjQj",Product_PricePerDay:"7",BorrowerCusotmerId:"",RentAmount:21,Discount:0,AmountCharge:21,Status:"ended",Booking_ReadId:3,Delivery_Latitude:"",Delivery_Longitude:"",Delivery_Address:"",Booking_PickupProduct:!1,BookingStatus:[{StatusName:"requested",CreatedDate:"03/04/2018",Status_TrackId:1,CreatedTime:"08:38"},{StatusName:"verified",CreatedDate:"03/04/2018",Status_TrackId:3,CreatedTime:"08:38"},{StatusName:"accepted",CreatedDate:"03/04/2018",Status_TrackId:7,CreatedTime:"08:46"},{StatusName:"started",CreatedDate:"03/04/2018",Status_TrackId:8,CreatedTime:"08:47"},{StatusName:"ended",CreatedDate:"03/04/2018",Status_TrackId:9,CreatedTime:"08:48"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null}],User_Booking_Lender:[{Product_Id:11533,Booking_Id:756,Borrower_Id:11735,Borrower_Name:"milalou4",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11736,Lender_Name:"milalou2 milalou2-last",Lender_StripeAccount:"acct_1CCujsKRD1g5AQ99",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/20/2018",EndDate:"4/20/2018",FullStartDate:"2018-04-20T00:00:00Z",FullEndDate:"2018-04-20T00:00:00Z",Lender_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Borrower_Image:"NXxMyDfZn2ZHu0dUvLJeT5a4stKjQj",Chat_Id:0,NoOfdays:1,Product_Title:"pen blue ",Lender_BillingAddress:null,Product_Image:"ezPAZU9e8Z3LaNECKB8FQT5a4stKjQj",Product_PricePerDay:"3",BorrowerCusotmerId:"",RentAmount:3,Discount:0,AmountCharge:3,Status:"timeout",Booking_ReadId:3,Delivery_Latitude:"0",Delivery_Longitude:"0",Delivery_Address:"",Booking_PickupProduct:!0,BookingStatus:[{StatusName:"requested",CreatedDate:"10/04/2018",Status_TrackId:1,CreatedTime:"10:28"},{StatusName:"verified",CreatedDate:"10/04/2018",Status_TrackId:3,CreatedTime:"10:28"},{StatusName:"timeout",CreatedDate:"10/04/2018",Status_TrackId:4,CreatedTime:"10:40"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11533,Booking_Id:755,Borrower_Id:11735,Borrower_Name:"milalou4",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11736,Lender_Name:"milalou2 milalou2-last",Lender_StripeAccount:"acct_1CCujsKRD1g5AQ99",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/19/2018",EndDate:"4/22/2018",FullStartDate:"2018-04-19T00:00:00Z",FullEndDate:"2018-04-22T00:00:00Z",Lender_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Borrower_Image:"NXxMyDfZn2ZHu0dUvLJeT5a4stKjQj",Chat_Id:0,NoOfdays:4,Product_Title:"pen blue ",Lender_BillingAddress:null,Product_Image:"ezPAZU9e8Z3LaNECKB8FQT5a4stKjQj",Product_PricePerDay:"3",BorrowerCusotmerId:"",RentAmount:12,Discount:0,AmountCharge:12,Status:"cancelled",Booking_ReadId:2,Delivery_Latitude:"0",Delivery_Longitude:"0",Delivery_Address:"",Booking_PickupProduct:!0,BookingStatus:[{StatusName:"requested",CreatedDate:"10/04/2018",Status_TrackId:1,CreatedTime:"10:26"},{StatusName:"verified",CreatedDate:"10/04/2018",Status_TrackId:3,CreatedTime:"10:26"},{StatusName:"cancelled",CreatedDate:"10/04/2018",Status_TrackId:6,CreatedTime:"10:26"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11533,Booking_Id:735,Borrower_Id:11735,Borrower_Name:"milalou4",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11736,Lender_Name:"milalou2 milalou2-last",Lender_StripeAccount:"acct_1CCujsKRD1g5AQ99",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/26/2018",EndDate:"4/26/2018",FullStartDate:"2018-04-26T00:00:00Z",FullEndDate:"2018-04-26T00:00:00Z",Lender_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Borrower_Image:"NXxMyDfZn2ZHu0dUvLJeT5a4stKjQj",Chat_Id:0,NoOfdays:1,Product_Title:"pen blue ",Lender_BillingAddress:null,Product_Image:"ezPAZU9e8Z3LaNECKB8FQT5a4stKjQj",Product_PricePerDay:"3",BorrowerCusotmerId:"",RentAmount:3,Discount:0,AmountCharge:3,Status:"accepted",Booking_ReadId:2,Delivery_Latitude:"0",Delivery_Longitude:"0",Delivery_Address:"",Booking_PickupProduct:!0,BookingStatus:[{StatusName:"requested",CreatedDate:"09/04/2018",Status_TrackId:1,CreatedTime:"21:44"},{StatusName:"verified",CreatedDate:"09/04/2018",Status_TrackId:3,CreatedTime:"21:44"},{StatusName:"accepted",CreatedDate:"09/04/2018",Status_TrackId:7,CreatedTime:"21:44"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11533,Booking_Id:734,Borrower_Id:11735,Borrower_Name:"milalou4",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11736,Lender_Name:"milalou2 milalou2-last",Lender_StripeAccount:"acct_1CCujsKRD1g5AQ99",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/21/2018",EndDate:"4/22/2018",FullStartDate:"2018-04-21T00:00:00Z",FullEndDate:"2018-04-22T00:00:00Z",Lender_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Borrower_Image:"NXxMyDfZn2ZHu0dUvLJeT5a4stKjQj",Chat_Id:0,NoOfdays:2,Product_Title:"pen blue ",Lender_BillingAddress:null,Product_Image:"ezPAZU9e8Z3LaNECKB8FQT5a4stKjQj",Product_PricePerDay:"3",BorrowerCusotmerId:"",RentAmount:6,Discount:0,AmountCharge:6,Status:"cancelled",Booking_ReadId:2,Delivery_Latitude:"0",Delivery_Longitude:"0",Delivery_Address:"",Booking_PickupProduct:!0,BookingStatus:[{StatusName:"requested",CreatedDate:"09/04/2018",Status_TrackId:1,CreatedTime:"20:58"},{StatusName:"verified",CreatedDate:"09/04/2018",Status_TrackId:3,CreatedTime:"20:58"},{StatusName:"cancelled",CreatedDate:"09/04/2018",Status_TrackId:6,CreatedTime:"20:59"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11533,Booking_Id:733,Borrower_Id:11735,Borrower_Name:"milalou4",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11736,Lender_Name:"milalou2 milalou2-last",Lender_StripeAccount:"acct_1CCujsKRD1g5AQ99",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/21/2018",EndDate:"4/22/2018",FullStartDate:"2018-04-21T00:00:00Z",FullEndDate:"2018-04-22T00:00:00Z",Lender_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Borrower_Image:"NXxMyDfZn2ZHu0dUvLJeT5a4stKjQj",Chat_Id:0,NoOfdays:2,Product_Title:"pen blue ",Lender_BillingAddress:null,Product_Image:"ezPAZU9e8Z3LaNECKB8FQT5a4stKjQj",Product_PricePerDay:"3",BorrowerCusotmerId:"",RentAmount:6,Discount:0,AmountCharge:6,Status:"cancelled",Booking_ReadId:3,Delivery_Latitude:"0",Delivery_Longitude:"0",Delivery_Address:"",Booking_PickupProduct:!0,BookingStatus:[{StatusName:"requested",CreatedDate:"09/04/2018",Status_TrackId:1,CreatedTime:"20:56"},{StatusName:"verified",CreatedDate:"09/04/2018",Status_TrackId:3,CreatedTime:"20:56"},{StatusName:"cancelled",CreatedDate:"09/04/2018",Status_TrackId:6,CreatedTime:"20:58"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11533,Booking_Id:732,Borrower_Id:11735,Borrower_Name:"milalou4",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11736,Lender_Name:"milalou2 milalou2-last",Lender_StripeAccount:"acct_1CCujsKRD1g5AQ99",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!0,StartDate:"4/11/2018",EndDate:"4/11/2018",FullStartDate:"2018-04-11T00:00:00Z",FullEndDate:"2018-04-11T00:00:00Z",Lender_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Borrower_Image:"NXxMyDfZn2ZHu0dUvLJeT5a4stKjQj",Chat_Id:0,NoOfdays:1,Product_Title:"pen blue ",Lender_BillingAddress:null,Product_Image:"ezPAZU9e8Z3LaNECKB8FQT5a4stKjQj",Product_PricePerDay:"3",BorrowerCusotmerId:"",RentAmount:3,Discount:0,AmountCharge:3,Status:"ended",Booking_ReadId:1,Delivery_Latitude:"0",Delivery_Longitude:"0",Delivery_Address:"",Booking_PickupProduct:!0,BookingStatus:[{StatusName:"requested",CreatedDate:"09/04/2018",Status_TrackId:1,CreatedTime:"20:47"},{StatusName:"verified",CreatedDate:"09/04/2018",Status_TrackId:3,CreatedTime:"20:47"},{StatusName:"accepted",CreatedDate:"09/04/2018",Status_TrackId:7,CreatedTime:"20:47"},{StatusName:"started",CreatedDate:"09/04/2018",Status_TrackId:8,CreatedTime:"20:55"},{StatusName:"ended",CreatedDate:"09/04/2018",Status_TrackId:9,CreatedTime:"20:55"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11532,Booking_Id:668,Borrower_Id:11737,Borrower_Name:"milalou5",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11736,Lender_Name:"milalou2 milalou2-last",Lender_StripeAccount:"acct_1CCujsKRD1g5AQ99",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/19/2018",EndDate:"4/21/2018",FullStartDate:"2018-04-19T00:00:00Z",FullEndDate:"2018-04-21T00:00:00Z",Lender_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Borrower_Image:null,Chat_Id:0,NoOfdays:3,Product_Title:"napkins ",Lender_BillingAddress:null,Product_Image:"o8R3Gnu6yT2mVGdKix4Iz5a4stKjQj",Product_PricePerDay:"6",BorrowerCusotmerId:"",RentAmount:3,Discount:0,AmountCharge:3,Status:"card_not_verified_timeout",Booking_ReadId:1,Delivery_Latitude:"52.4746643",Delivery_Longitude:"13.4244634",Delivery_Address:"WeisestraÃŸe 26",Booking_PickupProduct:!1,BookingStatus:[{StatusName:"requested",CreatedDate:"09/04/2018",Status_TrackId:1,CreatedTime:"08:09"},{StatusName:"notverified",CreatedDate:"09/04/2018",Status_TrackId:2,CreatedTime:"08:09"},{StatusName:"card_not_verified_timeout",CreatedDate:"09/04/2018",Status_TrackId:13,CreatedTime:"18:35"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11533,Booking_Id:555,Borrower_Id:11737,Borrower_Name:"milalou5",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11736,Lender_Name:"milalou2 milalou2-last",Lender_StripeAccount:"acct_1CCujsKRD1g5AQ99",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!0,StartDate:"4/19/2018",EndDate:"4/21/2018",FullStartDate:"2018-04-19T00:00:00Z",FullEndDate:"2018-04-21T00:00:00Z",Lender_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Borrower_Image:null,Chat_Id:0,NoOfdays:3,Product_Title:"pen blue ",Lender_BillingAddress:null,Product_Image:"ezPAZU9e8Z3LaNECKB8FQT5a4stKjQj",Product_PricePerDay:"3",BorrowerCusotmerId:"",RentAmount:9,Discount:0,AmountCharge:9,Status:"ended",Booking_ReadId:2,Delivery_Latitude:"0",Delivery_Longitude:"0",Delivery_Address:"",Booking_PickupProduct:!0,BookingStatus:[{StatusName:"requested",CreatedDate:"03/04/2018",Status_TrackId:1,CreatedTime:"18:25"},{StatusName:"verified",CreatedDate:"03/04/2018",Status_TrackId:3,CreatedTime:"18:25"},{StatusName:"accepted",CreatedDate:"03/04/2018",Status_TrackId:7,CreatedTime:"18:26"},{StatusName:"started",CreatedDate:"03/04/2018",Status_TrackId:8,CreatedTime:"18:28"},{StatusName:"ended",CreatedDate:"03/04/2018",Status_TrackId:9,CreatedTime:"18:29"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null},{Product_Id:11533,Booking_Id:525,Borrower_Id:11735,Borrower_Name:"milalou4",Borrower_ReviewScore:0,Borrower_ReviewCount:0,Borrower_QBId:null,Lender_Id:11736,Lender_Name:"milalou2 milalou2-last",Lender_StripeAccount:"acct_1CCujsKRD1g5AQ99",Lender_ReviewScore:0,Lender_ReviewCount:0,Lender_QBId:null,Booking_PaidToLender:!1,StartDate:"4/3/2018",EndDate:"4/3/2018",FullStartDate:"2018-04-03T00:00:00Z",FullEndDate:"2018-04-03T00:00:00Z",Lender_Image:"JoyyjhIuu7zFjvau4s6HT5a4stKjQj",Borrower_Image:"NXxMyDfZn2ZHu0dUvLJeT5a4stKjQj",Chat_Id:0,NoOfdays:1,Product_Title:"pen blue ",Lender_BillingAddress:null,Product_Image:"ezPAZU9e8Z3LaNECKB8FQT5a4stKjQj",Product_PricePerDay:"3",BorrowerCusotmerId:"",RentAmount:3,Discount:0,AmountCharge:3,Status:"timeout",Booking_ReadId:3,Delivery_Latitude:"0",Delivery_Longitude:"0",Delivery_Address:"",Booking_PickupProduct:!0,BookingStatus:[{StatusName:"requested",CreatedDate:"03/04/2018",Status_TrackId:1,CreatedTime:"08:09"},{StatusName:"verified",CreatedDate:"03/04/2018",Status_TrackId:3,CreatedTime:"08:09"},{StatusName:"timeout",CreatedDate:"03/04/2018",Status_TrackId:4,CreatedTime:"08:15"}],Booking_ReviewStatus:null,DeliveryAndPickupDetail:null}],User_ReviewScore:[{User_ReviewScore:8,User_TotalReviews:1,User_ReviewAsLender:8,User_ReviewAsBorrower:7,User_ReviewCountAsLender:1,User_ReviewCountAsBorrower:1}]},Message:"User Bookings"};angular.module("paladinApp").controller("userBookingsController",["$rootScope","$scope","apiService","enums","appStateManager","ptLog","$mdMedia","ptUtils","moment",function(e,t,r,o,a,n,i,s,u){t.isLoading=!1,t.tabs=[{title:"BORROWED",content:"I am tab borrowed content",bookings:[]},{title:"LENT",content:"I am tab lent content",bookings:[]}],t.fetchUserBookings=function(){t.isLoading=!0,r.bookings.getUserBookings(a.getUserId()).then(function(e){t.tabs[0].bookings=e.Data.User_Booking_Borrower.map(function(e){return e.lastModified=new Date(1e3*e.Last_Modified),e}).sort(s.sorters.bookingLastModifiedEpoch),t.tabs[1].bookings=e.Data.User_Booking_Lender.map(function(e){return e.lastModified=new Date(1e3*e.Last_Modified),e}).sort(s.sorters.bookingLastModifiedEpoch),t.isLoading=!1}).catch(function(e){t.isLoading=!1,n.error(e)})},t.fetchUserBookings(),t.bookingListItemClick=function(t){e.$emit(o.busNavigation.transactionDetailed,{bookingId:t.Booking_Id})},t.addNewItem=function(){e.$emit(o.busNavigation.newProduct)},t.isGtMd=i("gt-md");var c=[];c.push(t.$watch(function(){return i("gt-md")},function(e){t.isGtMd=e})),t.$on("$destroy",function(){for(;c.length;)c.pop()()})}]),angular.module("paladinApp").controller("bookingDetailedController",["$rootScope","$scope","enums","appStateManager","apiService","$stateParams","ptLog","popupService","ptUtils","$sce",function(e,t,r,o,a,n,i,s,u,c){t.isLoading=!1,t.bookingId=n.bookingId,t.booking=null,t.address={title:void 0,address:void 0,lat:void 0,lng:void 0},t.fetchDetailedBooking=function(){t.isLoading=!0,a.bookings.getBookingDetailed({bookingId:t.bookingId,userId:o.getUserId()}).then(function(e){t.booking=e.Data,t.booking.Product_Description=c.trustAsHtml(t.booking.Product_Description),t.fetchProduct()}).catch(function(e){i.error(JSON.stringify(e))})},t.fetchProduct=function(){a.products.getDetailedProduct(t.booking.Product_Id).then(function(e){t.product=e.Data,t.fetchProductBookingDetails()}).catch(function(e){i.error(JSON.stringify(e))})},t.fetchProductBookingDetails=function(){a.products.getProductBookingDetails({productId:t.product.Product_Id,userId:o.getUserId()}).then(function(e){t.productBookingDetails=e.Data,u.getAddressToDisplayForBooking({product:t.product,productBookingDetails:t.productBookingDetails,booking:t.booking}).then(function(e){t.$evalAsync(function(){t.address=e,t.isLoading=!1,u.isMobile.any()&&s.showBookingTrackerInfoMobilePopup(t.booking)})}).catch(function(e){t.$evalAsync(function(){t.isLoading=!1})})}).catch(function(e){i.error(e)})},t.goToProduct=function(){e.$emit(r.busNavigation.productDetailed,{product:t.booking})},t.fetchDetailedBooking();var l=[];l.push(e.$on(r.busEvents.reloadDetailedBooking,function(e,r){r.bookingId==t.bookingId&&t.fetchDetailedBooking()})),t.$on("$destroy",function(){for(;l.length;)l.pop()()})}]),angular.module("paladinApp").controller("paymentDetailedController",["$rootScope","$scope","apiService","appStateManager","enums","$stateParams","popupService","toastService","$sce","stripeService","creditcards","menusService","ptUtils","moment","geoLocationService","ptLog","$translate","gtmService",function(e,t,r,o,a,n,i,s,u,c,l,d,g,p,f,h,m,_){var v,y,I=this;if(t.isLoading=!0,t.isHaveSavedCC=!1,t.isTryAndBuy=!1,t.isNewCardLayoutOpen=!1,t.isBuy=!1,n.startDate&&n.startDate&&n.productId)t.rentStartDate=n.startDate,t.rentEndDate=n.endDate,t.productId=n.productId;else{if(!n.productId||!n.purchase&&!n.bookingId)return void i.showAlert("Ops",m.instant("INVALID_PAGE")).finally(function(){e.$emit(a.busNavigation.homePage)});t.isBuy=n.purchase,t.bookingId=n.bookingId,t.productId=n.productId}t.prices=[],t.userSavedCard=null,t.coupon=null,t.statusError=null,t.ccModel={number:"",type:"",expiration:"",exp_month:"",exp_year:"",cvc:"",name:"",isTermsAndConditionsAccepted:!1,isSaveCardForFutureTransactions:!0,isDelivery:!0,deliveryAddress:"",deliveryName:"",deliveryPhone:"",deliveryBell:""},t.forms={},t.ccIcon={MasterCard:"fa-cc-mastercard",Visa:"fa-cc-visa","American Express":"fa-cc-amex",Discover:"fa-cc-discover",undefined:"fa-credit-card",Unknown:"fa-credit-card",Maestro:"fa-credit-card",JCB:"fa-cc-jcb",Diners:"fa-cc-diners","Diners Club":"fa-cc-diners-club"},t.fetchProduct=function(){t.isLoading=!0,r.products.getDetailedProduct(t.productId).then(function(e){t.product=e.Data,t.product.Product_Description=u.trustAsHtml(t.product.Product_Description),g.extractAndGeoLocateAddressFromObjectForFieldNames({object:t.product,addressFieldName:"Lender_User_Address",latFieldName:"Product_Latitude",lngFieldName:"Product_Longitude"}).then(function(e){t.product.Lender_User_Address=e}),t.isTryAndBuy=g.isProductTryAndBuy(t.product),t.fetchBookingDetails()}).catch(function(e){t.isLoading=!1,s.simpleToast(JSON.stringify(e)),h.error(JSON.stringify(e))})},t.fetchBookingDetails=function(){r.products.getProductBookingDetails({productId:t.product.Product_Id,userId:o.getUserId()}).then(function(e){t.productBookingDetails=e.Data,t.calculatePrices();var r=t.productBookingDetails.UserCustomerDetail.User_CustomerId;r?t.fetchStripeUserCard(r):t.isLoading=!1}).catch(function(e){t.isLoading=!1,console.error(e)})},t.fetchProduct(),t.toggleNewCardLayout=function(){t.isNewCardLayoutOpen=!t.isNewCardLayoutOpen,t.userSavedCard=null,t.isHaveSavedCC=!1},t.gotoTermsAndConditions=function(){var e=d.commonMenus.linksMenu.list[1].link;window.open(e,"_blank").focus()},t.fetchStripeUserCard=function(e){c.getCustomerSources(e).then(function(e){if(200===e.status&&null!=e.data){var r=e.data,o=r.data;if("list"==r.object&&o&&o.length>0){var a=o.find(function(e){return"card"==e.object});a&&(t.userSavedCard=a,t.isHaveSavedCC=!0)}}t.isLoading=!1}).catch(function(e){t.isLoading=!1,console.error(e)})},t.calculatePrices=function(){t.prices=[],t.statusError=void 0,t.userCredit=null;var e=o.getUserId();r.users.getUserCredit({userId:e}).then(function(e){var r,o,a,n,i,s,u;t.userCredit=e.Data,r=t.product,o=t.productBookingDetails,a=t.rentStartDate,n=t.rentEndDate,i=t.userCredit,s=t.coupon,u=t.ccModel,g.calculatePricingListForProduct(a,n,r,o,u.isDelivery,i,s,t.isBuy).then(function(e){t.$evalAsync(function(){t.prices=e})}).catch(function(e){t.$evalAsync(function(){e&&e.message&&(t.statusError=e.message)})})}).catch(function(e){console.error("getuserCredit failed ",e)})},t.onDatesSelected=function(e){var r=e.startDate,o=e.endDate;t.rentStartDate=r,t.rentEndDate=o,t.calculatePrices()},t.couponValidated=function(e){t.coupon=e,t.calculatePrices()},t.deleteCoupon=function(){t.coupon=null,t.calculatePrices()},t.isDeliveryStatusChange=function(){t.calculatePrices()},t.bookingValidator=function(){t.statusError=void 0;var e=t.ccModel,r=t.forms.ccForm,o=t.isHaveSavedCC,a=t.userSavedCard,n=t.isNewCardLayoutOpen,i=!0,u="";return e.isTermsAndConditionsAccepted?o&&void 0!=a&&!n?i=!0:!r.$invalid&&r.$valid&&r.$dirty||(i=!1,u="INVALID_CC_FORM"):(i=!1,u="NEED_TO_ACCEPT_TERMS_AND_CONDITIONS"),t.isTryAndBuy&&e.isDelivery&&(e.deliveryAddress&&e.productLat&&e.productLng?e.deliveryName?e.deliveryPhone?e.deliveryBell||(i=!1,u="ADD_RING_BELL_NAME_MISSING"):(i=!1,u="ADD_PHONE_NUMBER_MISSING"):(i=!1,u="ADD_BILLING_NAME_MISSING"):(i=!1,u="INVALID_DELIVERY_ADDRESS")),!i&&u&&(s.simpleToast(m.instant(u)),t.statusError=u),i},t.bookNow=_asyncToGenerator(regeneratorRuntime.mark(function r(){var n,u,c,l,d,g,p,f,h,v,y,S,C,P,b;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(angular.copy(t.ccModel),n=t.product,u=t.isHaveSavedCC,c=t.userSavedCard,l=t.productBookingDetails,d=t.isNewCardLayoutOpen,g=l.UserCustomerDetail,p=g.User_CustomerId,!t.bookingValidator()){r.next=34;break}if(i.showLoader(),r.prev=6,f=o.user,h=f.User_IsVerfied,v=f.User_Email,y=null,p&&u&&c&&!d){r.next=19;break}return r.next=12,t.createNewCardToken();case 12:return S=r.sent,r.next=15,t.createStripeCustomer(S.id,v);case 15:y=r.sent,console.log(y),r.next=20;break;case 19:y=p;case 20:return r.next=22,t.chargeCard(y,v);case 22:(C=r.sent)&&C.Data?(i.hideLoader(),t.isBuy?_.trackEvent("purchase","purchase-submitted"):_.trackEvent("booking","booking-request-submitted",C.Data.Booking_Id,.78*C.Data.AmountCharge),console.log(C),P=C.Data.Booking_Id,t.isBuy?(t.bookingId?e.$emit(a.busNavigation.transactionDetailed,{bookingId:P,replace:!0}):e.$emit(a.busNavigation.productDetailed,{product:n}),i.showAlert("PURCHASE_SUCCESSFUL_TITLE","PURCHASE_SUCCESSFUL").finally(function(){t.bookingId?e.$emit(a.busNavigation.transactionDetailed,{bookingId:t.bookingId,replace:!0}):e.$emit(a.busNavigation.productDetailed,{product:n})})):h||1===t.productBookingDetails.UserCustomerDetail.User_VerifyingStatus?e.$emit(a.busNavigation.transactionDetailed,{bookingId:P,replace:!0}):e.$emit(a.busNavigation.idVerification,{bookingId:P,replace:!0})):i.hideLoader(),r.next=34;break;case 26:r.prev=26,r.t0=r.catch(6),b=null,b=r.t0.data&&r.t0.data.error&&r.t0.data.error.code?m.instant(r.t0.data.error.code):(r.t0.data||{}).Message||r.t0.message||"DEFAULT_ERROR",console.error(r.t0),i.hideLoader(),t.statusError=b,s.simpleToast(m.instant(b));case 34:case"end":return r.stop()}},r,I,[[6,26]])})),t.createNewCardToken=_asyncToGenerator(regeneratorRuntime.mark(function e(){var r,o,a,n,i,s,u,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.ccModel,o=r.number,a=r.exp_month,n=r.exp_year,i=r.cvc,s=r.name,e.next=3,c.createToken({number:o,exp_month:a,exp_year:n,cvc:i,name:s});case 3:if(!(u=e.sent).data){e.next=14;break}if(l=u.data,l.id,d=l.card,!(!t.isBuy&&d&&"credit"==d.funding||t.isBuy&&d)){e.next=11;break}return e.abrupt("return",l);case 11:throw new Error("DEBIT_CARD_NOT_SUPPORTED");case 12:e.next=15;break;case 14:throw new Error("CANT_CHARGE_CC");case 15:case"end":return e.stop()}},e,I)})),t.createStripeCustomer=(v=_asyncToGenerator(regeneratorRuntime.mark(function e(t,o){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.payments.createStripeCustomer({cardToken:t,email:o});case 2:if(!(a=e.sent)||!a.Data){e.next=8;break}return console.log(JSON.stringify(a.Data)),e.abrupt("return",a.Data);case 8:throw new Error("COULD_CREATE_STRIPE_CUSTOMER");case 9:case"end":return e.stop()}},e,I)})),function(e,t){return v.apply(this,arguments)}),t.chargeCard=(y=_asyncToGenerator(regeneratorRuntime.mark(function e(a,n){var i,s,u,c,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.product,s=t.rentStartDate,u=t.rentEndDate,c=t.ccModel,l=t.coupon,t.isBuy){e.next=8;break}return d=g.getRentalPeriodInDays({startRentDate:s,endRentDate:u}),e.next=5,r.bookings.bookProduct({stripeEmail:n,borrowerId:Number(o.getUserId()),lenderId:i.Lender_UserId,productId:i.Product_Id,startDate:p(s).format("MM/DD/YYYY"),endDate:p(u).format("MM/DD/YYYY"),stripeCustomerId:a,noOfDays:d,isSaveCard:c.isSaveCardForFutureTransactions,isPickUp:!c.isDelivery,deliveryAddress:c.isDelivery?c.deliveryAddress:void 0,deliveryLat:c.isDelivery?c.productLat:void 0,deliveryLng:c.isDelivery?c.productLng:void 0,deliveryName:c.isDelivery?c.deliveryName:void 0,deliveryPhone:c.isDelivery?c.deliveryPhone:void 0,deliveryBell:c.isDelivery?c.deliveryBell:void 0,coupon:void 0!=l?l.Coupon:void 0,idVerified:o.user.User_IsVerfied,isTryAndBuy:i.Product_TryAndBuy});case 5:return e.abrupt("return",e.sent);case 8:return e.next=10,r.purchase.buyProduct({stripeEmail:n,bookingId:t.bookingId||void 0,borrowerId:Number(o.getUserId()),purchaseAmount:i.Product_PurchasePrice+i.Product_Process_Fee,lenderId:i.Lender_UserId,productId:i.Product_Id,stripeCustomerId:a,isSaveCard:c.isSaveCardForFutureTransactions,isPickUp:!c.isDelivery,deliveryAddress:c.isDelivery?c.deliveryAddress:void 0,deliveryLat:c.isDelivery?c.productLat:void 0,deliveryLng:c.isDelivery?c.productLng:void 0,deliveryName:c.isDelivery?c.deliveryName:void 0,deliveryPhone:c.isDelivery?c.deliveryPhone:void 0,deliveryBell:c.isDelivery?c.deliveryBell:void 0});case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e,I)})),function(e,t){return y.apply(this,arguments)});var S=[];S.push(e.$on(a.busEvents.googlePlacesAutocompletePlaceChanged,function(e,r){if("productDeliveryAddress"==r.elementId){var o=r.place,a=o.geometry;t.ccModel.productLat=a.location.lat(),t.ccModel.productLng=a.location.lng(),t.ccModel.productLocationId=o.id}}));var C=function(e){event.returnValue="are you sure?"};window.addEventListener("beforeunload",C),t.$on("$destroy",function(){for(;S.length;)S.pop()();window.removeEventListener("beforeunload",C)})}]),angular.module("paladinApp").controller("userVerificationController",["$rootScope","$scope","enums","apiService","appStateManager","toastService","uploadHandler","$timeout","ptUtils","acuantService","dataService","$stateParams","popupService","$base64","$translate","gtmService",function(e,t,r,o,a,n,i,s,u,c,l,d,g,p,f,h){var m=this;d.bookingId&&(t.bookingId=d.bookingId),t.isLoading=!1,t.statusError=null,t.selectedUploadMethod=r.idVerificationMethod.passport,t.uploadMethods=[{title:"UPLOAD_METHOD_PASS",value:r.idVerificationMethod.passport},{title:"UPLOAD_METHOD_DL",value:r.idVerificationMethod.driverLicense},{title:"UPLOAD_METHOD_NATIONAL_ID",value:r.idVerificationMethod.id}],t.uploadData={};var _=[{elementId:"passportUpload",title:"TAP_TO_UPLOAD_PASS",imgData:null,isProcessingImg:!1,cardType:"Passport"},{elementId:"idSelfie",title:"TAKE_SELFIE",imgData:null,isProcessingImg:!1,cardType:""}],v=[{elementId:"driverLicenseFront",title:"DL_FRONT",imgData:null,isProcessingImg:!1,cardType:"DriversLicenseDuplex"},{elementId:"driverLicenseBack",title:"DL_BACK",imgData:null,isProcessingImg:!1,cardType:"DriversLicenseDuplex"},{elementId:"driverLicenseSelfie",title:"TAKE_SELFIE",imgData:null,isProcessingImg:!1,cardType:""}],y=[{elementId:"idFront",title:"NATIONAL_ID_FRONT",imgData:null,isProcessingImg:!1,cardType:"DriversLicenseDuplex"},{elementId:"idBack",title:"NATIONAL_ID_BACK",imgData:null,isProcessingImg:!1,cardType:"DriversLicenseDuplex"},{elementId:"idSelfie",title:"TAKE_SELFIE",imgData:null,isProcessingImg:!1,cardType:""}];t.selectUploadMethod=function(e){t.selectedUploadMethod=e},t.clickToUpload=function(e){t.$$postDigest(function(){angular.element(document.getElementById(e))[0].click()})};var I=function(){t.uploadData[r.idVerificationMethod.passport]=angular.copy(_),t.uploadData[r.idVerificationMethod.driverLicense]=angular.copy(v),t.uploadData[r.idVerificationMethod.id]=angular.copy(y)};I(),t.verifyId=_asyncToGenerator(regeneratorRuntime.mark(function e(){var i,s,l,d,g,p,_,v,y,S,C,P,b,D,k,T,w,L,A,R,B,E,U,N,M,O,$,F,x,j,V,G,K,H,q,Q,W,z,Y;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.uploadData,s=t.selectedUploadMethod,l=!0,i[s].forEach(function(e){l=l&&void 0!=e.imgData&&void 0!=e.imgBlob}),l){e.next=6;break}return n.simpleToast(f.instant("UPLOAD_MISSING_DOCS")),e.abrupt("return");case 6:if(t.isLoading=!0,t.statusError=null,e.prev=8,s!==r.idVerificationMethod.passport){e.next=44;break}return d=i[s][1].imgBlob,e.next=13,c.processPassportImage({imageToProcess:i[s][0].imgBlob,imageSource:r.acuantImageSource.Other,usePreprocessing:!0});case 13:if(!(g=e.sent)||!g.data){e.next=41;break}if(p=g.data,_=p.WebResponseCode,v=p.WebResponseDescription,y=p.FaceImage,1!=_){e.next=38;break}if(null!=y&&""!=y){e.next=21;break}throw new Error("COULD_NOT_EXTRACT_IMAGE_FROM_DATA");case 21:return S=goog.crypt.base64.encodeByteArray(y),C=u.dataUrlToBlob("data:image/jpg;base64,"+S),e.next=25,c.processFacialMatch({idFaceImage:C,selfie:d});case 25:if(P=e.sent,b=P.data,D=b.ResponseCodeAuthorization,k=b.ResponseMessageAuthorization,T=b.WebResponseCode,w=b.WebResponseDescription,!(D<0)){e.next=31;break}throw new Error(k);case 31:if(!(T<0)){e.next=35;break}throw new Error(w);case 35:t.uploadVerifiedImageToPaladinServers();case 36:e.next=39;break;case 38:throw new Error(v);case 39:e.next=42;break;case 41:throw new Error("DEFAULT_ERROR");case 42:e.next=91;break;case 44:if(s!==r.idVerificationMethod.driverLicense&&s!==r.idVerificationMethod.id){e.next=90;break}return L=i[s][0].imgBlob,A=i[s][1].imgBlob,R=i[s][2].imgBlob,e.next=50,c.processNICDLDuplexImage({frontImage:L,backImage:A,selectedRegion:r.acuantRegions.Europe,imageSource:r.acuantImageSource.Other,usePreprocessing:!0});case 50:if(B=e.sent,E=B.data,U=E.ResponseCodeAuthorization,N=E.ResponseMessageAuthorization,M=E.ResponseCodeAutoDetectState,O=E.ResponseCodeAutoDetectStateDesc,$=E.ResponseCodeProcState,F=E.ResponseCodeProcessStateDesc,x=E.WebResponseCode,j=E.WebResponseDescription,V=E.FaceImage,!(U<0)){e.next=56;break}throw new Error(N);case 56:if(!(M<0)){e.next=60;break}throw new Error(O);case 60:if(!($<0)){e.next=64;break}throw new Error(F);case 64:if(!(x<0)){e.next=68;break}throw new Error(j);case 68:if(null!=V&&""!=V){e.next=72;break}throw new Error("COULD_NOT_EXTRACT_IMAGE_FROM_DATA");case 72:return G=goog.crypt.base64.encodeByteArray(V),K=u.dataUrlToBlob("data:image/jpg;base64,"+G),e.next=76,c.processFacialMatch({idFaceImage:K,selfie:R});case 76:if(H=e.sent,q=H.data,Q=q.ResponseCodeAuthorization,W=q.ResponseMessageAuthorization,z=q.WebResponseCode,Y=q.WebResponseDescription,!(Q<0)){e.next=82;break}throw new Error(W);case 82:if(!(z<0)){e.next=86;break}throw new Error(Y);case 86:t.uploadVerifiedImageToPaladinServers(),h.trackEvent("id-verification","id-verification-successful");case 88:e.next=91;break;case 90:new Error("Operation not supported");case 91:e.next=100;break;case 93:e.prev=93,e.t0=e.catch(8),t.isLoading=!1,h.trackEvent("id-verification","id-verification-failed"),console.log("requestManualVerification ",t),s===r.idVerificationMethod.passport?o.verification.sendToManualVerification({passportImage:i[s][0].imgData.split(",")[1],selfie:i[s][1].imgData.split(",")[1],userId:a.getUserId(),bookingId:t.bookingId}).then(function(e){t.finishVerificationManual(),n.simpleToast(f.instant("ID_VERIFY_FAIL_POPUP_ON_SUCCESS"))},function(e){console.log("sendToManualVerification error",e),I(),n.simpleToast(f.instant("ID_VERIFY_FAIL_POPUP_ON_FAIL"))}):s!==r.idVerificationMethod.driverLicense&&s!==r.idVerificationMethod.id||o.verification.sendToManualVerification({NICDLFront:i[s][0].imgData.split(",")[1],NICDLBack:i[s][1].imgData.split(",")[1],selfie:i[s][2].imgData.split(",")[1],userId:a.getUserId(),bookingId:t.bookingId}).then(function(e){t.finishVerificationManual(),n.simpleToast(f.instant("ID_VERIFY_FAIL_POPUP_ON_SUCCESS"))},function(e){console.log("sendToManualVerification err",e),I(),n.simpleToast(f.instant("ID_VERIFY_FAIL_POPUP_ON_FAIL"))}),t.$apply();case 100:case"end":return e.stop()}},e,m,[[8,93]])})),t.uploadVerifiedImageToPaladinServers=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,i,s,u,c,l,d,g,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.uploadData,(i=t.selectedUploadMethod)!==r.idVerificationMethod.passport){e.next=14;break}return s=n[i][0].imgData.split(",")[1],u=n[i][1].imgData.split(",")[1],e.next=6,o.verification.uploadPassport({passportImage:s,selfie:u,userId:a.getUserId()});case 6:if(!(c=e.sent)||"success"!==c.Status){e.next=11;break}t.finishVerification(),e.next=12;break;case 11:throw new Error(c.Message||"DEFAULT_ERROR");case 12:e.next=26;break;case 14:if(i!==r.idVerificationMethod.driverLicense&&i!==r.idVerificationMethod.id){e.next=26;break}return l=n[i][0].imgData.split(",")[1],d=n[i][1].imgData.split(",")[1],g=n[i][2].imgData.split(",")[1],e.next=20,o.verification.uploadNICDL({NICDLFront:l,NICDLBack:d,selfie:g,userId:a.getUserId()});case 20:if(!(p=e.sent)||"success"!==p.Status){e.next=25;break}t.finishVerification(),e.next=26;break;case 25:throw new Error(p.Message||"DEFAULT_ERROR");case 26:case"end":return e.stop()}},e,m)})),t.finishVerification=function(){t.isLoading=!1,t.statusError=null,g.showAlert("SUCCESS","ID_SUCCESSFULLY_VERIFIED").finally(function(){t.bookingId?e.$emit(r.busNavigation.transactionDetailed,{bookingId:t.bookingId,replace:!0}):e.$emit(r.busNavigation.userProfile,{userId:a.getUserId()})})},t.finishVerificationManual=function(){t.isLoading=!1,t.statusError=null,u.isMobile.any()?t.bookingId?e.$emit(r.busNavigation.transactionDetailed,{bookingId:t.bookingId,replace:!0}):e.$emit(r.busNavigation.userProfile,{userId:a.getUserId()}):g.showAlert("ID_VER_MANUAL_POPUP","ID_VER_MANUAL_POPUP_TEXT").finally(function(){t.bookingId?e.$emit(r.busNavigation.transactionDetailed,{bookingId:t.bookingId,replace:!0}):e.$emit(r.busNavigation.userProfile,{userId:a.getUserId()})})},t.skipVerification=function(){e.$emit(r.busNavigation.transactionDetailed,{bookingId:t.bookingId,replace:!0})},t.onUploaded=function(e){if(e.files&&e.files.length>0){var r=t.uploadData,o=t.selectedUploadMethod,a=r[o].findIndex(function(t){return t.elementId===e.id});void 0!=a&&t.$evalAsync(function(){r[o][a].isProcessingImg=!0,canvasResize(e.files[0],{quality:75,isPreprocessing:!0,cardType:r[o][a].cardType,maxW:2048,maxH:2008,isiOS:u.isMobile.iOS(),callback:function(e,n,i){t.$evalAsync(function(){r[o][a].imgData=e,r[o][a].imgBlob=u.dataUrlToBlob(e),r[o][a].isProcessingImg=!1})}})})}},t.showToast=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;$mdToast.show($mdToast.simple().textContent(e).hideDelay(t))}}]),angular.module("paladinApp").controller("chatController",["$rootScope","$scope","$mdMedia","$mdSidenav","appStateManager","enums","$stateParams","chatService","$mdMedia",function(e,t,r,o,a,n,i,s){t.isLoading=!1,t.isChatCollapsed=!1,t.preSelectedchat={value:void 0},t.isGtMd=r("gt-md"),t.isGtSM=r("gt-sm"),i.chatId&&s.activateChatWhenReady(i.chatId),t.toggleNav=function(){o("chat-list-side-nav").toggle()};var u=[];u.push(t.$watch(function(){return r("gt-md")},function(e){t.isGtMd=e,t.isChatCollapsed=e})),u.push(t.$watch(function(){return r("gt-sm")},function(e){t.isGtSM=e})),t.$on("$destroy",function(){for(;u.length;)u.pop()()})}]);