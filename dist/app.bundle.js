(window.webpackJsonpPaladin=window.webpackJsonpPaladin||[]).push([[0],Array(266).concat([function(e,t){!function(e){let t={ENV:"prod",IS_PROMO:!0,START_DATE:"18",END_DATE:"19 Novembre",COUPON_VALUE:"25",COUPON_CODE:"WEEKEND25",PROMO_VERSION:"2",isProd:()=>"prod"===t.ENV,SUPPORTED_LANGS:[{code:"en",name:"English",defaultLocation:"milan italy",tryAndBuyWordPressPath:"try-our-brands"},{code:"it",name:"Italiano",defaultLocation:"milan italy",tryAndBuyWordPressPath:"prova-i-nostri-brand"}],RENT_NOW_URL:"https://qx87h.app.goo.gl/?link=https://paladintrue.com/{0}/?product-detail?{1}&apn=com.a2l.paladin&isi=1129780407&ibi=com.a2l.paladin&efr=1",RENT_URL:"https://qx87h.app.goo.gl/?link=https://paladintrue.com/it&apn=com.a2l.paladin&isi=1129780407&ibi=com.a2l.paladin"};"prod"===t.ENV?(t.ROOT_PATH="https://rent.paladintrue.com/",t.BASE_URL="https://live.v1.paladintrue.com/",t.PROFILE_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/livepaladinimages/ProfileImage/",t.PRODUCT_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/livepaladinimages/ProductImage/",t.CATEGORY_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/livepaladinimages/CategoryImage/",t.LOG_LEVEL="none",t.STRIPE_SK="sk_live_n1ODuFHO82iZulfbRIBQ0WUa"):(t.ROOT_PATH="https://webtest.paladintrue.com/",t.BASE_URL="https://staging.paladintrue.com/",t.PROFILE_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/staggingimages/ProfileImage/",t.PRODUCT_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/staggingimages/ProductImage/",t.CATEGORY_IMAGE_URL="https://s3.eu-central-1.amazonaws.com/staggingimages/CategoryImage/",t.LOG_LEVEL="verbose",t.STRIPE_SK="sk_test_Qxfl7rPTVALyVnrMRUkb2l3F"),t.API_URL=t.BASE_URL+"api/Paladin/",t.TOKEN_URL=t.BASE_URL+"Token",t.STRIPE_URL="https://api.stripe.com/v1",t.PROMO_SIGNUP_TIMER=1e4,e.globals=t}(window)},function(e,t){angular.module("paladinApp",["ui.router","ngMeta","zendeskWidget","pascalprecht.translate","paladinPopups","angularReverseGeocode","ngLocationUpdate","ngMaterial","ngMessages","material.svgAssetsCache","ngCookies","uiGmapgoogle-maps","ngMap","base64","ngRoute","angularMoment","ngMaterialDateRangePicker","credit-cards","jkAngularRatingStars"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider","ZendeskWidgetProvider","$mdThemingProvider","enums",function(e,t,o,a,r,n,i){const s=n.extendPalette("green",{500:"#69C187",200:"#01b3eb",A200:"rgba(255,255,255,0.05)",A300:"#484848",A400:"rgba(72,72,72,0.5)",A500:"#ffffff",A600:"#f6f6f6",A700:"#000"});n.definePalette("rentOrderStatusTheme",{50:"#69C187",100:"#fb814a",200:"#ee4e4a",300:"#4ec07e",400:"#0d87f6",500:"#8d72f4",600:"#fff",700:"#fff",800:"#fff",900:"#fff",A100:"#fff",A200:"#fff",A400:"#fff",A700:"#000000"});n.definePalette("paladinTheme",s),n.theme("default").primaryPalette("paladinTheme").accentPalette("paladinTheme"),n.theme("rentOrderStatus").primaryPalette("rentOrderStatusTheme").accentPalette("rentOrderStatusTheme"),r.init({accountUrl:"paladintrue.zendesk.com",beforePageLoad:function(e){e.hide()}}),a.html5Mode(!0),delete o.defaults.headers.common["X-Requested-With"],e.state("app",{url:"/:languageCode",templateUrl:"./views/routes/app.html",controller:"appController",isPublic:!0,abstract:!0,params:{languageCode:localStorage.getItem(i.localStorageKeys.preferredLanguage)||"it"}}).state("app.home",{url:"/",templateUrl:"./views/routes/homeV2.html",controller:"homeV2Controller",isPublic:!0,data:{isCollapsingHeader:!0},resolve:{validReferralCode:()=>!1}}).state("app.emailVerification",{url:"/email-validation",templateUrl:"./views/routes/homeV2.html",controller:"homeV2Controller",isPublic:!0,data:{isCollapsingHeader:!0}}).state("app.referredRegistration",{url:"/r/:referralNameCode",templateUrl:"./views/routes/homeV2.html",controller:"homeV2Controller",isPublic:!0,resolve:{validReferralCode:["$stateParams","appStateManager","referralsService",function(e,t,o){return o.validateReferralCode(e.referralNameCode)}]}}).state("app.browse",{url:"/categorie/:category/:subCategory/:city?search&sortBy&pageIndex",templateUrl:"./views/routes/home.html",controller:"homeController",reloadOnSearch:!1,isPublic:!0,isCustomSEO:!0,params:{category:{squash:!0,value:null},subCategory:{squash:!0,value:null},city:{squash:!0,value:null},search:{squash:!0,value:null},sortBy:{squash:!0,value:null},pageIndex:{squash:!0,value:null},isTryAndBuy:!0,isResetSearch:!1}}).state("app.browsePrivate",{url:"/categorie/privato/:category/:subCategory/:city?search&sortBy&pageIndex",templateUrl:"./views/routes/home.html",controller:"homeController",reloadOnSearch:!1,isPublic:!0,isCustomSEO:!0,params:{category:{squash:!0,value:null},subCategory:{squash:!0,value:null},city:{squash:!0,value:null},search:{squash:!0,value:null},sortBy:{squash:!0,value:null},pageIndex:{squash:!0,value:null},isTryAndBuy:!1,isResetSearch:!1}}).state("app.products",{url:"/product",abstract:!0}).state("app.products.selectedProduct",{url:"/:productNameAndId",templateUrl:"./views/routes/productDetailed.html",controller:"productDetailedController",isPublic:!0,params:{productNameAndId:void 0,productId:0}}).state("app.products.newProduct",{url:"/new",templateUrl:"./views/routes/newProduct.html",controller:"newProductController"}).state("app.products.productReview",{url:"/review/:bookingId",templateUrl:"./views/routes/productReview.html",controller:"productReviewController",isPublic:!0,resolve:{prereqData:["$stateParams","appStateManager",function(e,t){return console.log("$state productReview params",e),{userId:e.Borrower_Id,productId:null,currentLang:t.getCurrentLang()}}]}}).state("app.profiles",{url:"/profiles",abstract:!0}).state("app.profiles.myProfile",{url:"/myProfile",templateUrl:"./views/routes/userProfile.html",controller:"userProfileController",params:{userId:null}}).state("app.profiles.publicProfile",{url:"/:userId",templateUrl:"./views/routes/userProfile.html",controller:"userProfileController",isPublic:!0,params:{userId:null}}).state("app.myListings",{url:"/myListings",templateUrl:"./views/routes/myListings.html",controller:"myListingsController",isPublic:!0}).state("app.bookings",{url:"/my-rentals",abstract:!0}).state("app.bookings.userBookings",{url:"",templateUrl:"./views/routes/userBookings.html",controller:"userBookingsController"}).state("app.bookings.bookingDetailed",{url:"/:bookingId",templateUrl:"./views/routes/bookingDetailed.html",controller:"bookingDetailedController",params:{bookingId:null}}).state("app.bookings.paymentDetailed",{url:"/payment",templateUrl:"./views/routes/paymentDetailed.html",controller:"paymentDetailedController",params:{productId:{squash:!0,value:null},startDate:{squash:!0,value:null},endDate:{squash:!0,value:null},purchase:{squash:!0,value:null},bookingId:{squash:!0,value:null}}}).state("verification",{url:"/:languageCode/verification",params:{languageCode:localStorage.getItem(i.localStorageKeys.preferredLanguage)||"it"},template:'<div ui-view flex="100" layout="row" layout-align="start center" layout-fill></div>'}).state("verification.user",{url:"/verifyMe/:bookingId",templateUrl:"./views/routes/userVerification.html",controller:"userVerificationController",params:{bookingId:null}}).state("app.chat",{url:"/messaging/:chatId",params:{languageCode:localStorage.getItem(i.localStorageKeys.preferredLanguage)||"it",chatId:null},templateUrl:"./views/routes/chat.html",controller:"chatController",data:{isHeaderHidden:!0}}),t.rule(function(e,t){let o=t.path(),a=o.split("/")[1],r=window.globals.SUPPORTED_LANGS.find(e=>e.code===a.toLowerCase());return r?r.code!=localStorage.getItem(i.localStorageKeys.preferredLanguage)?(localStorage.setItem(i.localStorageKeys.preferredLanguage,r.code),location.reload(),o.replace(a,r.code)):void 0:`/${localStorage.getItem(i.localStorageKeys.preferredLanguage)||"it"}${o}`}),t.otherwise(function(e,t){if(t.path().includes("/blog"))return;let o=t.path().split("/")[1],a=window.globals.SUPPORTED_LANGS.find(e=>e.code===o.toLowerCase());return`/${localStorage.getItem(i.localStorageKeys.preferredLanguage)||a||"it"}/`})}]).run(["ngMeta","$window","$rootScope","$location","facebook","enums","$trace","$transitions","$state","navigationService","dataService","chatService","appStateManager",function(e,t,o,a,r,n,i,s,l,c,d,u,g){e.init(),d.init(),u.init(),o.facebook_user={},o.facebookApiLoaded=!1,o.$emit(n.busEvents.facebookApiLoad,{isLoaded:!1}),t.fbAsyncInit=function(){FB.init({appId:"1156274361103964",channelUrl:"app/channel.html",status:!0,cookie:!0,xfbml:!0,version:"v2.12"}),FB.Event.subscribe("auth.authResponseChange",function(e){"connected"===e.status&&FB.api("/me",{fields:["first_name","last_name","email","id","address","location","name"]},function(e){o.$emit(n.busEvents.facebookApiLoad,{isLoaded:!0}),o.$apply(function(){o.facebook_user=e,o.facebookApiLoaded=!0})})})},o.stateData={isCollapsingHeader:!0,isHeaderHidden:!1},window.globals.isProd()||(i.enable("TRANSITION"),s.onStart({},function(e){console.log("$transitions.onStart",e)}),o.$on("$stateChangeStart",function(){console.log("$stateChangeStart",arguments)})),s.onBefore({},function(e){if(!e.to().isPublic&&!g.getUserId())return d.forceLogin(e),e.router.stateService.target("app.home")}),s.onSuccess({},function(e){const t=e.to();o.isMenuOpen={value:!1},o.currentState={value:l.current.name},l.current.data&&(o.stateData.isCollapsingHeader=l.current.data.isCollapsingHeader||!1,o.stateData.isHeaderHidden=l.current.data.isHeaderHidden||!1),t.isCustomSEO||d.updateGeneralSEO()})}]),angular.module("paladinApp").factory("facebook",function(){return"done"}),angular.module("paladinApp").directive("fbButton",function(){return{restrict:"A",link:function(e,t,o){var a="en_EN";"it"==e.currentLang?a="it_IT":"de"==e.currentLang&&(a="de_DE"),function(e){var o,r="facebook-jssdk",n=e.getElementsByTagName("script")[0];((o=e.createElement("script")).id=r,o.async=!0,o.src="//connect.facebook.net/"+a+"/sdk.js",e.getElementById(r))?(n.parentNode.replaceChild(o,e.getElementById(r)),document.getElementsByTagName("head")[0].appendChild(o)):n.parentNode.insertBefore(o,n);"undefined"!=typeof FB&&FB&&FB.XFBML.parse(t[0].parent)}(document)}}}),angular.module("paladinApp").run(["$route","$rootScope","$location",function(e,t,o){var a=o.path;o.path=function(r,n){if(!1===n)var i=e.current,s=t.$on("$locationChangeSuccess",function(){e.current=i,s()});return a.apply(o,[r])}}])},function(e,t){angular.module("paladinApp").constant("enums",{busEvents:{onAppOnlineState:"PT_BE_onAppOnlineState",$routeChangeError:"$routeChangeError",userLogin:"PT_BE_userLogin",userSignup:"PT_BE_userSignup",userLogout:"PT_BE_userLogout",preferredLanguageChange:"PT_BE_preferredLanguageChange",updatedUser:"PT_BE_updatedUser",facebookApiLoad:"PT_BE_facebookApiLoad",tokenRefresh:"PT_BE_tokenRefresh",triggerEmailValidation:"PT_BE_triggerEmailValidation",locationUpdate:"PT_BE_locationUpdate",categoriesUpdate:"PT_BE_categoriesUpdate",googlePlacesAutocompletePlaceChanged:"PT_BE_googlePlacesAutocompletePlaceChanged",reloadDetailedBooking:"PT_BE_reloadDetailedBooking",footerExtraHeight:"PT_BE_footerExtraHeight",scrollMainScrollerToTop:"PT_BE_scrollMainScrollerToTop",rentalRequestPickerUpdateDates:"PT_BE_rentalRequestPicker"},busNavigation:{homePage:"PT_BN_homePage",productDetailed:"PT_BN_productDetailed",browseCategory:"PT_BN_browseCategory",browseKeyword:"PT_BN_browseKeyword",browseSort:"PT_BN_browseSort",switchBrowseMode:"PT_BN_browseModeSwitch",userProfile:"PT_BN_userProfile",userListings:"PT_BN_userListings",newProduct:"PT_BN_newProduct",rentals:"PT_BN_rentals",transactionDetailed:"PT_BN_transactionDetailed",idVerification:"PT_BN_idVerification",userReview:"PT_BN_userReview",paymentDetailed:"PT_BN_paymentDetailed",chat:"PT_BN_chat"},busChatEvents:{updateUnreadCount:"PT_BCE_updateUnreadCount",newMessage:"PT_BCE_newMessage",detailedChatSelected:"PT_BCE_detailedChatSelected",startNewMessagesPoller:"PT_BCE_startNewMessagesPoller",selectPendingChat:"PT_BCE_selectPendingChat"},ngMetaValues:{currentUrl:e=>`currentUrl_${e}`},categoriesBannersPaths:{all:{en:"/assets/banner-try-and-buy-en.jpg",it:"/assets/banner-try-and-buy-it.jpg"},promo:"/assets/promo-banner-"+window.globals.PROMO_VERSION+".jpg",promo1:"/assets/promo1-"+window.globals.PROMO_VERSION+".jpg",promo2:"/assets/promo2-"+window.globals.PROMO_VERSION+".jpg",addProduct:"/assets/all-categories-banner-3.png",allP2P:"/assets/all-categories-banner-3.png"},localStorageKeys:{jwtToken:"PT_LSK_jwt_token",refreshToken:"PT_LSK_refreshToken",preferredLanguage:"PT_LSK_preferredLanguage",userId:"PT_persistAuth",locationLatLong:"PT_LSK_locationLatLong",pendingPrivateState:"PT_LSK_pendingPrivateState"},allCategories:{en:"All Categories",it:"Tutte le Categorie",de:"Alle Kategorien"},secret:"d05ac55661e27663c025aca7047c825908ae1562",inAppSideNavsIds:{mainMobileNav:"main-mobile-side-nav",chatSideNav:"chat-list-side-nav"},categoriesIds:{tryAndBuy:window.globals.isProd()?11:15,outdoor:window.globals.isProd()?20:12,homeAppliance:window.globals.isProd()?18:8,hiTech:window.globals.isProd()?17:2,smartMobility:window.globals.isProd()?19:4,kids:window.globals.isProd()?22:16},productsSortOptions:{geoLocation:"SortByGeoLocation",popularity:"SortByPopularity",bestProduct:"SortByBestProduct",review:"SortByReview",lowPrice:"SortByLowPrice",highPrice:"SortByHighPrice",recent:"SortByRecent"},productsSortByTextCode:{SortByPopularity:"POPULARITY",SortByRecent:"MREC",SortByGeoLocation:"NEAREST",SortByBestProduct:"RELEVANCE",SortByLowPrice:"LP",SortByHighPrice:"HP"},userProductsFilter:{borrowedProducts:"BorrowedProduct",lentProduct:"LentProduct",allProducts:"AllProduct",myProductsToBorrow:"MyProductsToBorrow"},productRentalStatus:{available:-1,requested:1,notVerified:2,verified:3,timeout:4,denied:5,canceled:6,accepted:7,started:8,ended:9,criticalCancel:10,moderateCancel:11,canceledByLender:12,timeoutByBorrower:13,verifying:14,booked:15},productRentalStatusNames:{requested:"requested",notVerified:"notverified",verified:"verified",timeout:"timeout",denied:"denied",cancelled:"cancelled",criticalCancel:"cancellation-Critical",moderateCancel:"cancellation-Moderate",accepted:"accepted",started:"started",ended:"ended",canceledByLender:"cancelled-By-Lender",timeoutByBorrower:"card_not_verified_timeout"},trackingStep:{pending:0,success:1,failure:2},bookingReviewStatus:{noReview:0,reviewByBorrower:1,reviewByLender:2,reviewByBoth:3},idVerificationMethod:{passport:"passport",driverLicense:"driverLicense",id:"id"},acuantImageSource:{mobileCropped:101,scanShellTwain:102,SnapShell:103,Other:105},acuantRegions:{USA:0,Canada:1,SouthAmerica:2,Europe:3,Australia:4,Asia:5,GeneralDocs:6,Africa:7}})},function(e,t,o){"use strict";angular.module("paladinApp").service("acuantService",["$rootScope","$http","$base64",function(e,t,o){const a="https://cssnwebservices.com/CSSNService/CardProcessor",r=o.encode(window.globals.isProd()?"A0E66E952D88":"E265037472E6"),n=(e,o)=>t({method:"POST",url:a+e,headers:{"Content-Type":"application/octet-stream; charset=utf-8;",Authorization:`LicenseKey ${r}`},dataType:"json",data:o});return{processPassportImage:({imageToProcess:e,imageSource:t,usePreprocessing:o})=>n(`/ProcessPassport/true/true/true/0/150/${o.toString()}/${t.toString()}/true/false`,e),processNICDLDuplexImage:({frontImage:e,backImage:o,selectedRegion:n,imageSource:i,usePreprocessing:s})=>{const l=new FormData;return l.append("frontImage",e),l.append("backImage",o),((e,o)=>t({method:"POST",url:a+e,transformRequest:angular.identity,headers:{"Content-Type":void 0,Authorization:`LicenseKey ${r}`},dataType:"json",data:o}))(`/ProcessDLDuplex/${n}/true/-1/true/false/true/0/150/${i.toString()}/${s.toString()}/true/false`,l)},processFacialMatch:({idFaceImage:e,selfie:t})=>{const o=new FormData;return o.append("idFaceImage",e),o.append("selfie",t),n("/FacialMatch",o)},processDriversLicense:({imageToProcess:e,selectedRegion:t,imageSource:o,usePreprocessing:a})=>n(`/ProcessDriversLicense/${t}/true/-1/true/true/true/0/150/${a.toString()}/${o.toString()}/true/false`,e)}}])},function(e,t){angular.module("paladinApp").service("apiService",["$rootScope","$q","$http","$base64","enums","ptLog","appStateManager",function(e,t,o,a,r,n,i){const s=this;s.ENV=window.globals.API_URL.slice(0,-1),s.timeoutCounter=0,s.maxTimeouts=5,s.raiseTimeout=function(){s.timeoutCounter<=s.maxTimeouts&&(s.timeoutCounter+=1),s.timeoutCounter>s.maxTimeouts&&e.isAppOnline&&e.$emit(r.busEvents.onAppOnlineState,!1)},s.loweTimeout=function(){s.timeoutCounter>0&&(s.timeoutCounter-=1),s.timeoutCounter<s.maxTimeouts&&!e.isAppOnline&&e.$emit(r.busEvents.onAppOnlineState,!0)},s.getHttpConfig=function(e,t){let o={headers:{"Access-Control-Allow-Origin":"*","X-Requested":null,"Content-Type":"application/json; charset=utf-8","Access-Control-Allow-Methods":"GET, POST, PATCH, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin, Content-Type, X-Auth-Token"}};return localStorage.getItem(r.localStorageKeys.jwtToken)&&(o.headers.Authorization=localStorage.getItem(r.localStorageKeys.jwtToken)),t&&Object.keys(t).forEach(e=>{o.headers[e]=t[e]}),e&&(o.params=e),o},s.getDefaultParams=(()=>({LanguageCode:i.getCurrentLang()}));return s.getRequest=function(a,i,l,c){let d=t.defer();return o.get(s.ENV+a,s.getHttpConfig(i,l)).then(function(e){s.loweTimeout(),e&&e.data&&"error"!=e.data.Status?d.resolve(e.data):d.reject(e)},function(t){if(!t)return console.warn("R_U"),void d.reject();if(401===t.status&&localStorage.getItem(r.localStorageKeys.refreshToken))n.log("Refreshing Token"),s.apiMethods.users.refreshToken(localStorage.getItem(r.localStorageKeys.refreshToken)).then(t=>{n.log("Refreshing Token success"),e.$emit(r.busEvents.tokenRefresh,t.data),setTimeout(()=>{s.getRequest(a,i,l,c).then(d.resolve).catch(d.reject)},500)}).catch(d.reject);else if(423===t.status)if(c||(c=0),c<5){c++,setTimeout(()=>{s.getRequest(a,i,l,c).then(e=>d.resolve(e.data)).catch(d.reject)},500*c)}else d.reject(t);else 0!==t.status&&-1!==t.status||s.raiseTimeout(),d.reject(t)}),d.promise},s.postRequest=function(a,i,l,c){let d=t.defer();return o.post(s.ENV+a,i,s.getHttpConfig(null,l)).then(function(e){s.loweTimeout(),e&&e.data&&"error"!=e.data.Status?d.resolve(e.data):d.reject(e)},function(t){if(!t)return console.warn("R_U"),void d.reject();if(401===t.status&&localStorage.getItem(r.localStorageKeys.refreshToken))n.log("Refreshing Token"),s.apiMethods.users.refreshToken(localStorage.getItem(r.localStorageKeys.refreshToken)).then(t=>{n.log("Refreshing Token success"),e.$emit(r.busEvents.tokenRefresh,t.data),setTimeout(()=>{s.postRequest(a,i,l,c).then(d.resolve).catch(d.reject)},500)}).catch(d.reject);else if(423===t.status)if(c||(c=0),c<5){c++,setTimeout(()=>{s.postRequest(a,i,l,c).then(e=>d.resolve(e.data)).catch(d.reject)},500*c)}else d.reject(t);else 0!==t.status&&-1!==t.status||s.raiseTimeout(),d.reject(t)}),d.promise},s.putRequest=function(a,i,l,c){let d=t.defer();return o.put(s.ENV+a,i,s.getHttpConfig(null,l)).then(function(e){s.loweTimeout(),e&&e.data&&"error"!=e.data.Status?d.resolve(e.data):d.reject(e)},function(t){if(!t)return console.warn("R_U"),void d.reject();if(401===t.status&&localStorage.getItem(r.localStorageKeys.refreshToken))n.log("Refreshing Token"),s.apiMethods.users.refreshToken(localStorage.getItem(r.localStorageKeys.refreshToken)).then(t=>{n.log("Refreshing Token success"),e.$emit(r.busEvents.tokenRefresh,t.data),setTimeout(()=>{s.postRequest(a,i,l,c).then(d.resolve).catch(d.reject)},500)}).catch(d.reject);else if(423===t.status)if(c||(c=0),c<5){c++,setTimeout(()=>{s.putRequest(a,i,l,c).then(e=>d.resolve(e.data)).catch(d.reject)},500*c)}else d.reject(t);else 0!==t.status&&-1!==t.status||s.raiseTimeout(),d.reject(t)}),d.promise},s.apiMethods={categories:{getCategories:function(){return s.getRequest(`/GetCategories?LanguageCode=${i.getCurrentLang()}`)}},pages:{getHomePageData:function(e){let t={};return t.LanguageCode=i.getCurrentLang(),t.Categories=e,s.getRequest("/GetHomePageData",t)},getProductDetailData:function(e){let t={};t.LanguageCode=i.getCurrentLang(),t.Product_Id=e;const o=i.getUserId();return o&&(t.User_Id=o),s.getRequest("/GetProductDetailData",t)}},products:{getSearchedProducts:function({keyword:e,isShop:t,categoryId:o,subCategoryId:a,sortBy:r,minPriceRange:n,maxPriceRange:l,city:c,lat:d,lng:u,range:g,page:p,productPerPage:h,isWeb:m,productIDs:f,isTryAndBuy:y}){let S={LanguageCode:i.getCurrentLang()};e&&(S.KeywordProduct=encodeURIComponent(e));const I=i.getUserId();return null!=i.user&&null!=I&&(S.User_Id=I),o&&(S.Category_Id=o),a&&(S.SubCategory_Id=a),t&&(S.IsShop=t),r&&(S[r]=!0),n&&(S.MinPriceRange=n),l&&(S.MaxPriceRange=l),d&&u&&(S.Latitude=d,S.Longitude=u),c&&(S.Product_City=c),g&&(S.Range=g),m&&(S.IsWeb=m),p&&(S.PageIndex=p),h&&(S.productPerPage=h),f&&(S.productIDs=f),y&&(S.isTryAndBuy=y),s.getRequest("/GetSearchedProduct",S)},getPopularTryAndBuy:function(){return s.apiMethods.products.getSearchedProducts({productPerPage:20,sortBy:r.productsSortOptions.bestProduct,isTryAndBuy:!0})},getSuggestions:function(e){let t=s.getDefaultParams();return t.Keyword=encodeURIComponent(e),s.getRequest("/Suggestion",t)},getDetailedProduct:function(e){let t={Product_Id:e,...s.getDefaultParams()};const o=i.getUserId();return o&&(t.User_Id=o),s.getRequest("/GetProductDetail",t)},getUserProducts:function({userId:e,productsFilter:t,pageIndex:o=0}){let a={...s.getDefaultParams(),User_Id:e,PageIndex:o};return a[t]=!0,s.getRequest("/GetMyProducts",a)},getProductBookingDetails:function({productId:e,userId:t}){let o={...s.getDefaultParams(),User_Id:t,Product_Id:e};return s.getRequest("/ProductBookingDetail",o)},addProduct:function({Product_ItemCategory_Id:e,Product_Title:t,Product_Description:o,Product_Price_Perday:a,Product_IsShop:r,Product_City:n,Product_ShopURL:i,Price1Day:l,Price15Day:c,Product_TryAndBuy:d,MinRentalPeriod:u,MaxRentalPeriod:g,Product_Longitude:p,Product_Latitude:h,ProductImage_Image1:m,Product_LenduserId:f}){const y={...s.getDefaultParams(),Product_ItemCategory_Id:e,Product_Title:t,Product_Description:o,Product_Price_Perday:a,Product_IsShop:r,Product_City:n,Product_ShopURL:i,Price1Day:l,Price15Day:c,Product_TryAndBuy:d,MinRentalPeriod:u,MaxRentalPeriod:g,Product_Longitude:p,Product_Latitude:h,ProductImage_Image1:m,Product_LenduserId:f};return s.postRequest("/AddProduct",y)}},reviews:{submitTransactionReview:e=>s.postRequest("/AddBookingReview",e)},users:{signUp:function({email:e,username:t,password:o,location:a,currentLang:r,referralCode:n}){const i={User_UserName:t,User_Email:e,User_Address:a,User_Password:o,User_UDIDType:3,LanguageCode:r,ReferralCode:n};return s.postRequest("/SignUp",i)},signupFacebook:function({facebookName:e,email:t,address:o,currentLang:a,facebookUserId:r,referralCode:n}){const i={User_UserName:e.replace(" ","-"),User_Email:t,User_Address:o,User_Password:"",User_UDIDType:3,LanguageCode:a,User_DisplayPicturePath:"https://graph.facebook.com/"+r+"/picture?type=large",User_DisplayPicture:"https://graph.facebook.com/"+r+"/picture?type=large",User_FacebookId:r,User_FullName:e,User_QBId:"",ReferralCode:n};return s.postRequest("/Signup",i)},signUpReferred:function(e){const t={ReferralCode:e,LanguageCode:i.getCurrentLang()};return s.getRequest("/VerifyReferralCode",t)},login:function({username:e="",email:t="",password:o,currentLang:a}){const r={User_UserName:e,User_Email:t,User_Mobile:"",User_UDIDType:3,User_Password:o,User_FacebookId:"",LanguageCode:a};return s.postRequest("/Login",r)},forgotPassword:function({email:e,currentLang:t}){const o={...s.getDefaultParams(),User_Email:e};return s.postRequest("/ForgetPassword",o,{Authorization:a.encode("Paladin:Paladin123")})},changePassword:function({userId:e,newPassword:t,oldPassword:o}){const a={...s.getDefaultParams(),User_Id:e,User_NewPassword:t,User_OldPassword:o};return s.postRequest("/ChangePassword",a)},emailVerification:function({userId:e}){return s.getRequest(`/EmailVerfication/?User_Id=${e}`,void 0,{Authorization:a.encode("Paladin:Paladin123")})},getUserProfile:function({userId:e}){let t={...s.getDefaultParams(),User_Id:e};return s.getRequest("/GetUserProfile",t)},getUserCredit:function({userId:e}){let t={...s.getDefaultParams(),User_Id:e};return s.getRequest("/GetUserCredit",t)},refreshToken:function(e){return o({method:"POST",url:window.globals.TOKEN_URL,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){let t=[];for(let o in e)t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")},data:{grant_type:"refresh_token",refresh_token:e}})},editProfile:function(e){let t={...s.getDefaultParams(),...e};return s.putRequest("/EditProfile",t)},updateNotificaton:({userId:e,emailNotif:t,chatNotif:o})=>{let a={...s.getDefaultParams(),Notification_Chat:o,Notification_Push:o,Notification_Email:t,Notification_UserId:e};return s.postRequest("/UpdateNotification",a)},deleteAccount:function(e){let t={...s.getDefaultParams(),User_Id:e};return s.getRequest("/DeleteUser",t)}},bookings:{getUserBookings:function(e){let t={...s.getDefaultParams(),User_Id:e};return s.getRequest("/GetUserBookings",t)},getBookingDetailed:function({bookingId:e,userId:t}){let o={...s.getDefaultParams(),User_Id:t,BookingId:e};return s.getRequest("/GetBookingDetail",o)},acceptBookingRequest:function({bookingId:e,userId:t}){let o={...s.getDefaultParams(),Lender_Id:t,BookingId:e};return s.getRequest("/AcceptBookingRequest",o)},rejectBookingRequest:function({bookingId:e,userId:t}){let o={...s.getDefaultParams(),User_Id:t,BookingId:e};return s.getRequest("/RejectBookingRequest",o)},cancelBookingRequest:function({bookingId:e,userId:t,reason:o}){let a={...s.getDefaultParams(),User_Id:t,BookingId:e,Reason:o};return s.getRequest("/CancelBookingRequest",a)},startRental:function({bookingId:e,userId:t}){let o={...s.getDefaultParams(),User_Id:t,BookingId:e};return s.getRequest("/StartRentalBookingRequest",o)},endRental:function({bookingId:e,userId:t}){let o={...s.getDefaultParams(),User_Id:t,BookingId:e};return s.getRequest("/EndRentalBookingRequest",o)},bookProduct:function({stripeEmail:e,borrowerId:t,lenderId:o,productId:a,startDate:r,endDate:n,noOfDays:i,coupon:l,stripeCustomerId:c,isSaveCard:d,idVerified:u,isPickUp:g,deliveryLat:p,deliveryLng:h,deliveryAddress:m,deliveryName:f,deliveryPhone:y,deliveryBell:S,isTryAndBuy:I}){const C={...s.getDefaultParams(),Stripe_Email:e,Borrower_UserId:t,Lender_UserId:o,Product_Id:a,StartDate:r,EndDate:n,NoOfDays:i,CouponNumber:l,CustomerAccountId:c,SaveCard:d,IdVerfied:u,Booking_PickupProduct:g,Delivery_Latitude:p,Delivery_Longitude:h,Delivery_Address:m,Complete_Borrower_Name:f,Phone_Number:y,House_Name:S};return s.postRequest(I?"/BookTryAndBuyProduct":"/BookProduct",C)}},payments:{createUserStripeAccount:function({userId:e,bookingId:t,email:o,country:a}){const r={...s.getDefaultParams(),User_Id:e,Booking_Id:t,User_Email:o,User_Country:a};return s.postRequest("/CreateBookingStripeAccount",r)},verifyCoupon:function({coupon:e,userId:t}){const o={...s.getDefaultParams(),Coupon:e,User_Id:t};return s.getRequest("/VerifyCoupon",o)},createStripeCustomer:function({email:e,cardToken:t}){const o={...s.getDefaultParams(),Email:t,TokenId:e};return s.getRequest("/CreateStripeCustomer",o)}},purchase:{buyProduct:function({stripeEmail:e,bookingId:t,purchaseAmount:o,borrowerId:a,lenderId:r,productId:n,stripeCustomerId:i,isSaveCard:l,isPickUp:c,deliveryLat:d,deliveryLng:u,deliveryAddress:g,deliveryName:p,deliveryPhone:h,deliveryBell:m}){const f={...s.getDefaultParams(),Stripe_Email:e,Borrower_UserId:a,Lender_UserId:r,Stripe_Amount:o,Product_Id:n,Booking_Id:t,CustomerAccountId:i,SaveCard:l,Booking_PickupProduct:c,Delivery_Latitude:d,Delivery_Longitude:u,Delivery_Address:g,Complete_Borrower_Name:p,Phone_Number:h,House_Name:m};return s.postRequest("/BuyProduct",f)}},verification:{uploadPassport:({passportImage:e,selfie:t,userId:o})=>{const a={...s.getDefaultParams(),PassPort:e,User_Selfie:t,User_Id:o};return s.postRequest("/IDVerficationDocument",a)},sendToManualVerification:e=>{const t={...s.getDefaultParams(),PassPort:e.passportImage,User_Id:e.userId,NICFront:e.NICDLFront,NICBack:e.NICDLBack,User_Selfie:e.selfie,BookingId:e.bookingId};return s.postRequest("/IDManualVerficationDocument",t)},uploadNICDL:({NICDLFront:e,NICDLBack:t,selfie:o,userId:a})=>{const r={...s.getDefaultParams(),User_Id:a,NICFront:e,NICBack:t,User_Selfie:o};return s.postRequest("/IDVerficationDocument",r)}},chats:{getChatsList:({userId:e,pageIndex:t=0})=>{const o={...s.getDefaultParams(),User_Id:e,PageIndex:t};return s.getRequest("/GetChatList",o)},getChatDetailed:({chatId:e})=>{const t={...s.getDefaultParams(),Chat_Id:e,ChatDone:0};return s.getRequest("/GetChatDetail",t)},getChatByQBId:({chatQbId:e})=>{const t={...s.getDefaultParams(),Chat_QBRoomId:e,ChatDone:0};return s.getRequest("/GetChatInfoByQBId",t)},startBookingChat:({lenderId:e,borrowerId:t,productId:o,chatRoomId:a=null,bookingId:r=null})=>{let n={...s.getDefaultParams(),User_UDIDType:3,Lender_Id:e,Borrower_Id:t,Product_Id:o,BookingId:r,Chat_QBRoomId:a};return s.postRequest("/StartBookingChat",n)}}},s.apiMethods}])},function(e,t){angular.module("paladinApp").service("appStateManager",["enums","$base64",function(e,t){let o={currentLang:localStorage.getItem(e.localStorageKeys.preferredLanguage)||"it",getCurrentLang:()=>"it"==o.currentLang?"it-IT":o.currentLang,user:null,chatUser:null,getUserId:()=>{let o;const a=localStorage.getItem(e.localStorageKeys.userId);return o=t.decode(a).split(":")[1]||void 0},location:null,categoriesDict:null};return o}])},function(e,t,o){"use strict";angular.module("paladinApp").service("chatService",["$rootScope","appStateManager","apiService","enums","$base64","toastService",function(e,t,o,a,r,n){const i=this;i.CHAT_HASH="ZDA1YWM1NTY2MWUyNzY2M2MwMjVhY2E3MDQ3YzgyNTkwOGFlMTU2MjpQYWxhZGluXzEyMzEyMzEyMw==",i.userDialogs={},window.globals.isProd()?(i.kApplicationID=48979,i.kAuthKey="s64NxQBAMrmGYXz",i.kAuthSecret="wxqqXZAfdYpsEvd",i.kAccountKey="7awzEayyEjqP2LQuppJj"):(i.kApplicationID=58169,i.kAuthKey="u3n3guWwktMpCsU",i.kAuthSecret="yV26WrfkrBMZC2n",i.kAccountKey="7awzEayyEjqP2LQuppJj");const s=(t,o)=>{if(o&&o.body){let r=o;r.isMe=t==i.chatUser.id,r.message=o.body,r._id=o.id,"attachment"===r.message&&r.extension&&r.extension.attachments&&r.extension.attachments.length>0&&(r.message="",r.img=QB.content.privateUrl(r.extension.attachments[0].uid)),e.$emit(a.busChatEvents.newMessage,r)}},l=()=>{console.warn("onDisconnectedListener")},c=()=>{console.warn("onReconnectListener")},d=()=>new Promise((e,t)=>{i.chatAppSession?e(i.chatAppSession):QB.createSession(function(o,a){console.log(o,a),a&&a.token?(i.chatAppSession=a,e(a)):t("could not create app session")})}),u=()=>{const e=r.decode(i.CHAT_HASH).split(":")[1],{user:o}=t,{User_Email:a,User_FacebookId:n,User_UserName:s}=o;return void 0!=n&&""!=n?{login:n,password:e}:{login:s,password:e}},g=()=>new Promise((e,t)=>{d().then(o=>{let a={...u(),token:o.token};QB.users.create(a,function(o,a){console.log(o,a),a?(i.chatUser=a,e(a),p()):t(o)})}).catch(t)}),p=()=>{o.users.editProfile({User_QBId:i.chatUser.id,User_Id:t.getUserId()}).then(e=>console.log("SUCCESSFULLY UPDATED PROFILE")).catch(e=>console.error("ERROR UPDATING PROFILE"))},h=()=>new Promise((e,t)=>{const o=Object.keys(i.userDialogs);Promise.all(o.map(e=>m(e))).then(t=>{t.forEach(e=>{i.userDialogs[e.dialogId]=e.count||0}),e(i.userDialogs)}).catch(e=>{t(e)})}),m=e=>new Promise(t=>{QB.chat.message.unreadCount({chat_dialog_ids:e},(o,a)=>{t(o?0:{dialogId:e,count:(a||{})[e]||0})})});return{init:()=>{QB.init(i.kApplicationID,i.kAuthKey,i.kAuthSecret,{debug:{mode:window.globals.isProd()?0:1},chatProtocol:{active:2}}),QB.chat.onDisconnectedListener=l,QB.chat.onReconnectListener=c,QB.chat.onMessageListener=s,d()},loginToChat:()=>new Promise((e,t)=>{d().then(o=>{let a={...u(),token:o.token};QB.login(a,(o,a)=>{o?401===o.code?g().then(e).catch(t):t(o):(i.chatUser=a,e(a),p())})}).catch(t)}),createOrStartChat:({lenderId:e,borrowerId:t,lenderQBId:a,borrowerQBId:r,productId:n,productName:i,chatRoomId:s=null,bookingId:l=null})=>new Promise((c,d)=>{if(s)o.chats.startBookingChat({lenderId:e,borrowerId:t,productId:n,chatRoomId:s,bookingId:l}).then(e=>{c(e.Data)}).catch(e=>{d(e)});else{let s={name:i,type:2,occupants_ids:[a,r]};QB.chat.dialog.create(s,(a,r)=>{if(a)d(a);else{const a=r._id;o.chats.startBookingChat({lenderId:e,borrowerId:t,productId:n,chatRoomId:a,bookingId:l}).then(e=>{c(e.Data)}).catch(e=>{r(e)})}})}}),setUserTyping:(e,t)=>new Promise(o=>{o(`${e} is now ${t?"Typing..":"Idle"}`)}),uploadMedia:e=>new Promise(e=>{e("Media file uploaded!")}),getChatList:(r,n=0)=>new Promise((s,l)=>{o.chats.getChatsList({userId:r,pageIndex:n}).then(o=>{if(o.Data){let r=o.Data.Chat_Borrow.concat(o.Data.Chat_Lent).map(e=>(e.thumbnail=e.Lender_UserId==t.user.User_Id?e.Borrower_ProfileImage:e.Lender_ProfileImage,e.recipient=e.Lender_UserId==t.user.User_Id?e.Borrower_FullName:e.Lender_FullName,e.initialBadge=(i.userDialogs||{})[e.Chat_QBRoomId]||0,e.lastUpdatedDate=new Date(e.ChatLastUpdated),e.isLent=e.Lender_UserId==t.user.User_Id,e));r=r.sort((e,t)=>e.lastUpdatedDate-t.lastUpdatedDate),s(r),i.pendingChatToJoin&&(e.$emit(a.busChatEvents.selectPendingChat,{chatId:i.pendingChatToJoin}),i.pendingChatToJoin=void 0)}else l(Error("No data"))}).catch(l)}),getChatDetailed:e=>new Promise((t,a)=>{o.chats.getChatByQBId({chatQbId:e}).then(e=>t(e.Data)).catch(a)}),getChatHistory:(e,t=0)=>new Promise((o,a)=>{QB.chat.message.list({chat_dialog_id:e,skip:t,limit:10,sort_desc:"date_sent"},(e,t)=>{if(e)a(e);else{const e=t.items.map(e=>(e.isMe=e.sender_id==i.chatUser.id,e.thumbnail="tofyk5Tv55ghu7pacsjz5a4stKjQj",e.dateSent=new Date(1e3*e.date_sent),"attachment"===e.message&&e.attachments&&e.attachments.length>0&&(e.message="",e.img=QB.content.privateUrl(e.attachments[0].uid)),e));o(e.reverse())}})}),signupToChat:g,connectToChat:()=>new Promise((t,o)=>{d().then(r=>{const n={...u(),token:r.token};QB.createSession(n,(r,s)=>{s?(i.userToken=s.token,QB.chat.connect({userId:i.chatUser.id,password:n.password},(r,n)=>{r?o(r):(t(n),i.pendingChatToJoin&&(e.$emit(a.busChatEvents.selectPendingChat,{chatId:i.pendingChatToJoin}),i.pendingChatToJoin=void 0))})):o(r)})}).catch(o)}),disconnectChat:()=>{QB.chat.disconnect()},syncDialogList:()=>new Promise((e,t)=>{QB.chat.dialog.list(null,(o,a)=>{a?(a.items.forEach(e=>{i.userDialogs[e._id]=i.userDialogs[e._id]||0}),h().then(e).catch(t)):t(o)})}),sendMessage:({dialogId:e,text:t,productId:o,input:a})=>new Promise((r,n)=>{const i=QB.chat.helpers.getRoomJidFromDialogId(e);if(a&&a.files.length>0){const t=a.files[0];let s={name:t.name,file:t,type:t.type,size:t.size,public:!1};QB.content.createAndUpload(s,function(t,a){if(t)console.error(t),n(t);else{const t=a.uid;let n={type:"groupchat",body:"attachment",ProductId:o,extension:{save_to_history:1,attachments:[{uid:t,type:"photo"}],ProductId:o,dialogID:e,isBot:"0"},markable:1};QB.chat.send(i,n),r()}})}else QB.chat.send(i,{type:"groupchat",body:t,extension:{save_to_history:1,ProductId:o,dialogID:e,isBot:"0"},markable:1}),r()}),joinChat:e=>{const t=QB.chat.helpers.getRoomJidFromDialogId(e);return new Promise((e,o)=>{QB.chat.muc.join(t,function(t){e()})})},leaveChat:e=>{const t=QB.chat.helpers.getRoomJidFromDialogId(e);return new Promise((e,o)=>{QB.chat.muc.leave(t,function(t){e()})})},notifyUser:({userId:e,dialogId:t,isNewChat:o=!1})=>new Promise((a,r)=>{let n={type:"chat",extension:{notification_type:o?1:2,_id:t}};QB.chat.send(e,n),a()}),getUnreadMessage:h,clearUnreadBadgesForDialog:t=>{i.userDialogs[t]=0;let o=0;Object.keys(i.userDialogs).forEach(e=>{o+=i.userDialogs[e]}),e.$emit(a.busChatEvents.updateUnreadCount,{total:o,detailedDict:i.userDialogs})},activateChatWhenReady:e=>{i.pendingChatToJoin=e}}}])},function(e,t){angular.module("paladinApp").service("dataService",["$rootScope","enums","appStateManager","$translate","ptLog","$base64","apiService","$state","popupService","$timeout","geoLocationService","chatService","$interval","ngMeta","$location",function(e,t,o,a,r,n,i,s,l,c,d,u,g,p,h){const m="dataService || ";let f=!1;const y=()=>{e.$on(t.busEvents.userLogin,(e,t)=>{let{oAuthToken:o}=t;P(o),C(t.User_Id),D()}),e.$on(t.busEvents.userSignup,(e,t)=>{}),e.$on(t.busEvents.tokenRefresh,(e,t)=>{P(t)}),e.$on(t.busEvents.preferredLanguageChange,(e,r)=>{localStorage.setItem(t.localStorageKeys.preferredLanguage,r.currentLang),o.currentLang=r.currentLang,a.preferredLanguage(r.currentLang),a.use(r.currentLang),a.refresh();const n=location.pathname.replace(location.pathname.split("/")[1],r.currentLang);location.replace(n)}),e.$on(t.busEvents.userLogout,a=>{u.disconnectChat(),localStorage.clear(),localStorage.setItem(t.localStorageKeys.preferredLanguage,o.currentLang),o.user=null,e.$emit(t.busEvents.updatedUser,null),s.go("app.home",{languageCode:o.currentLang})}),e.$on(t.busEvents.triggerEmailValidation,(e,t)=>{l.showEmailVerification(t.userId).then(()=>{s.go("app.home")}).catch(()=>{s.go("app.home")})}),e.$on("$destroy",()=>{console.log("ROOT SCOPE IS DEAD")})},S=()=>new Promise((e,t)=>{r.log(m,"Starting location update"),d.getLocation().then(t=>{I(t),r.log("Successfully got location"),e(t)}).catch(e=>{r.error(m,"error getting location",JSON.stringify(e)),t(e)})}),I=a=>{o.location=a;const r={lat:a.geometry.location.lat(),lng:a.geometry.location.lng()};localStorage.setItem(t.localStorageKeys.locationLatLong,JSON.stringify(r)),e.$emit(t.busEvents.locationUpdate,r)},C=e=>{localStorage.setItem(t.localStorageKeys.userId,n.encode(`${t.secret}:${e}`))},P=e=>{e&&e.access_token&&e.token_type&&e.refresh_token?(localStorage.setItem(t.localStorageKeys.jwtToken,`${e.token_type} ${e.access_token}`),localStorage.setItem(t.localStorageKeys.refreshToken,e.refresh_token)):r.error(m,"Sign up successful but access token was not provided!")},_=()=>o.getUserId();let b=void 0;const v=()=>{u.syncDialogList().then(o=>{console.log(o);let a=0;Object.keys(o).forEach(e=>{a+=o[e]}),e.$emit(t.busChatEvents.updateUnreadCount,{total:a,detailedDict:o})}).catch(o=>{404==o.code?e.$emit(t.busChatEvents.updateUnreadCount,{total:0,detailedDict:{}}):r.error(o)})},D=()=>{const a=_();a?i.users.getUserProfile({userId:a}).then(a=>{o.user=a.Data,r.log(m,"Fetched user profile"),e.$emit(t.busEvents.updatedUser,o.user),T(),u.loginToChat().then(()=>{u.connectToChat().then(()=>{u.syncDialogList(),(e=>{if(e){if(b)return new Error("message poller already active");b=g(v,3e4)}else{if(!b)return new Error("message poller already deactivated");g.cancel(b),b=void 0}})(!0)}).catch(e=>{console.error("Could not connect to chat",JSON.stringify(e))})})}).catch(e=>{r.error(m,JSON.stringify(e))}):r.log(m,"User Id not found")},w=e=>{if(e){const o=n.encode(`${t.secret}|:${JSON.stringify(e)}`);localStorage.setItem(t.localStorageKeys.pendingPrivateState,o)}else localStorage.removeItem(t.localStorageKeys.pendingPrivateState)},T=()=>{const e=localStorage.getItem(t.localStorageKeys.pendingPrivateState);if(e){const t=JSON.parse(n.decode(e).split("|:")[1]);t&&(w(null),s.go(t.name,t.params,t.options))}};return{init:function(){f||(f=!0,y()),a.preferredLanguage(localStorage.getItem(t.localStorageKeys.preferredLanguage)||"it"),_()&&D()},setUserId:C,getUserId:_,getCategories:()=>{i.categories.getCategories().then(a=>{let r={};a.Data.forEach(e=>r[e.Category_Id]=e),o.categoriesDict=r,e.$emit(t.busEvents.categoriesUpdate,r)}).catch(e=>{r.error(e)})},getGeoLocationForApp:()=>new Promise((e,a)=>{if(o.location)e(o.location);else if(localStorage.getItem(t.localStorageKeys.locationLatLong)){const{lat:o,lng:a}=JSON.parse(localStorage.getItem(t.localStorageKeys.locationLatLong));e({lat:o,lng:a})}else S().then(t=>{const o=t.geometry.location.lat(),a=t.geometry.location.lng();e({lat:o,lng:a})}).catch(a)}),forceLogin:e=>{const t=e.targetState();let o={name:t.identifier().name,params:t.params(),options:t.options().current()};w(o),l.showLoginSignupPopup(!1).catch(e=>{w(null)})},updateGeneralSEO:()=>{const e=o.currentLang;window.globals.SUPPORTED_LANGS.forEach(o=>{p.setTag(t.ngMetaValues.currentUrl(o.code),h.absUrl().replace(`/${e}/`,`/${o.code}/`))})}}}])},function(e,t){angular.module("paladinApp").factory("Filters",["$http","$base64","$rootScope","$q",function(e,t,o,a){var r={getHeaders:function(){return{"Access-Control-Allow-Origin":"*","X-Requested":null,"Content-Type":"application/json; charset=utf-8"}},get:function(t,a){o.categoriesMap&&o.categoriesMap.get(t)||e.get(window.globals.API_URL+"GetCategories?LanguageCode="+this.formatLanguageCode(t)).then(a)},getCategoryById:function(e,t){if(o.categoriesMap&&o.categoriesMap.get(t))for(var a=o.categoriesMap.get(t),r=0;r<a.length;r++)if(a[r].Category_Id==e)return a[r]},getSubcategoryById:function(e,t){if(o.categoriesMap&&o.categoriesMap.get(t))for(var a=o.categoriesMap.get(t),r=0;r<a.length;r++)for(var n=0;n<a[r].Category_SubCatrgories.length;n++)if(a[r].Category_SubCatrgories[n].SubCategory_Id==e)return a[r].Category_SubCatrgories[n]},getCategoryByName:function(e,t,a){if(o.categoriesMap&&o.categoriesMap.get(t))for(var r=o.categoriesMap.get(t),n=0;n<r.length;n++)if(a==r[n].IsTryAndBuy&&r[n].Category_Name&&r[n].Category_Name.toLowerCase().replace(/ /g,"-")==e.toLowerCase())return r[n]},getSubcategoryByName:function(e,t){if(o.categoriesMap&&o.categoriesMap.get(t))for(var a=o.categoriesMap.get(t),r=0;r<a.length;r++)for(var n=0;n<a[r].Category_SubCatrgories.length;n++)if(a[r].Category_SubCatrgories[n].SubCategory_Name&&a[r].Category_SubCatrgories[n].SubCategory_Name.toLowerCase().replace(/ /g,"-")==e.toLowerCase())return a[r].Category_SubCatrgories[n]},findByName:function(t,o,a){this.getHeaders();e.get(window.globals.API_URL+"GetCategories?LanguageCode="+this.formatLanguageCode(o)).then(function(e){for(var o=e.data.Data,r=0;r<o.length;r++){var n=o[r];if(n.Category_Name&&n.Category_Name.toLowerCase().replace(/ /g,"-")==t.toLowerCase())return void a(n)}a(null)})},getSuggestions:function(t,o){return e.get(window.globals.API_URL+"Suggestion?Keyword="+t+"&&LanguageCode="+this.formatLanguageCode(o)).then(function(e){return e.data.Data.map(function(e){return e.Keyword})})},getCategoriesUrl:(e,t,o,a)=>{let r=window.globals.ROOT_PATH+a+"/categorie/"+(o?"":"privato/");return null==t?r+=e:r=r+e+"/"+t+(filter.glCity?"/"+filter.glCity:""),r.split(" ").join("-")},formatLanguageCode:function(e){return"it"==e?"it-IT":e}};return r}])},function(e,t){angular.module("paladinApp").service("geoLocationService",["$rootScope","appStateManager","ptLog",function(e,t,o){const a="geoLocationService || ",r=new google.maps.Geocoder,n=e=>new Promise((t,o)=>{r.geocode(e,function(e,a){e&&e.length>0?t(e[0]):o({status:a})})}),i=()=>{const e=window.globals.SUPPORTED_LANGS.find(e=>e.code===t.currentLang);return e?{address:e.defaultLocation}:{address:"milan italy"}};return{getLocation:()=>new Promise((e,t)=>{o.log("GET USER LOCATION"),new Promise((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t):t({message:"goeLocation not supported by browser"})}).then(o=>{let a={location:{lat:o.coords.latitude,lng:o.coords.longitude}};n(a).then(t=>{e(t)}).catch(t)}).catch(r=>{o.error(a,JSON.stringify(r)),o.log(a,"Getting default location");const s=i();n(s).then(t=>{e(t)}).catch(t)})}),getUserCountryFromUserAddress:e=>new Promise((t,o)=>{r.geocode({address:e},(e,a)=>{if("OK"==a)if(e&&e.length>0){const{address_components:a}=e[0];if(a&&a.length>0){const e=a.find(e=>{const{types:t}=e;return!!(t&&t.length>0)&&"country"===t[0].toLowerCase()});e?t(e):o(new Error("Country not found"))}else o(new Error("Address not found"))}else o(new Error("No results found"));else o(new Error("Could not geocode address"))})}),getUserAddressFromCoordinates:({lat:e,lng:t})=>new Promise((o,a)=>{r.geocode({location:{lat:e,lng:t}},(e,t)=>{if("OK"===t)if(e&&e.length>0){const t=e.find(e=>{const{types:t}=e;return!!(t&&t.length>0)&&"street_address"===t[0].toLowerCase()});t?o(t.formatted_address):a(new Error("Address not found"))}else a(new Error("No results found"));else a(new Error("Could not geocode coordinates"))})})}}])},function(e,t,o){"use strict";angular.module("paladinApp").service("gtmService",["$window",function(e){this.trackEvent=function(t,o,a,r){if(window.globals.isProd()){if(void 0==t||void 0==o)throw Error("GTMService.trackEvent: Missing required property. Aborting hit.");e.dataLayer.push({event:"ngTrackEvent",attributes:{category:t,action:o,label:a||null,value:r||null,nonInteraction:!0}}),console.log("DataLayer Event fired "+t+" "+o)}}}])},function(e,t){angular.module("paladinApp").service("menusService",["$rootScope","appStateManager","$translate","popupService","$mdToast","$state","enums","ZendeskWidget",function(e,t,o,a,r,n,i,s){return{commonMenus:{aboutMenu:{title:"ABOUT",list:[{itemId:"menu-item-try-n-buy",title:"TRY_AND_BUY",link:`https://paladintrue.com/${t.currentLang}/${window.globals.SUPPORTED_LANGS.find(e=>t.currentLang==e.code).tryAndBuyWordPressPath}/`},{itemId:"menu-item-blog",title:"BLOG",link:`https://paladintrue.com/${t.currentLang}/blog/`},{itemId:"menu-item-faq",title:"FAQ",link:`https://paladintrue.com/${t.currentLang}/faq/`}]},accountLoggedOut:{title:"HEADER_MY_ACCOUNT",shouldHide:()=>null!=t.user,list:[{itemId:"menu-item-login",title:"HEADER_LOGIN",BL:()=>a.showLoginSignupPopup(!1)},{itemId:"menu-item-signup",title:"HEADER_SIGNUP",BL:()=>a.showLoginSignupPopup(!0)}]},accountLoggedIn:{title:"HEADER_MY_ACCOUNT",shouldHide:()=>null==t.user,list:[{itemId:"menu-item-my-profile",title:"MY_PROFILE",BL:()=>{e.$emit(i.busNavigation.userProfile,{userId:t.user.User_Id})}},{itemId:"menu-item-message",title:"MESSAGES",BL:()=>e.$emit(i.busNavigation.chat)},{itemId:"menu-item-logout",title:"HEADER_LOGOUT",BL:()=>e.$emit(i.busEvents.userLogout)}]},linksMenu:{title:"LINKS",list:[{itemId:"menu-item-contact",title:"CONTACT",link:o.instant("URL_CONTACT")},{itemId:"menu-item-terms-n-conditions",title:"TANDC",link:`https://paladintrue.com/${t.currentLang}/terms-and-conditions/`},{itemId:"menu-item-privacy-policy",title:"PRIVACY_POLICY",link:`https://paladintrue.com/${t.currentLang}/privacy-policy/`},{itemId:"menu-item-help-support",title:"SUPPORT",BL:()=>{s.activate()}}]},common:{title:"",list:[{itemId:"menu-item-browse",title:"BORROW",BL:()=>n.go("app.browse"),link:window.globals.ROOT_PATH+t.currentLang+"/categorie/"+("it"==t.currentLang?"Tutte-le-Categorie":"All-Categories")+"?sortBy=SortByBestProduct&pageIndex=1"},{itemId:"menu-item-lend",title:"LEND",BL:()=>{null==t.user?a.showLoginSignupPopup(!1):e.$emit(i.busNavigation.userListings)}},{itemId:"menu-item-my-rentals",title:"MY_RENTAL",BL:()=>{null==t.user?a.showLoginSignupPopup(!1):e.$emit(i.busNavigation.rentals)}}]}},menuClickHandlerMethod:e=>{e.BL?e.BL():e.link&&window.open(e.link,"_self")},shouldShowMenuItem:e=>void 0==e.shouldHide||!e.shouldHide()}}])},function(e,t){angular.module("paladinApp").factory("ngTranslateErrorHandler",["ptLog",function(e){return function(t,o){return e.warn(`Translation for key "${t}" not found when using: ${o}, using key instead`),t}}]),angular.module("paladinApp").config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"/translations/locale-",suffix:".json"}).preferredLanguage(localStorage.getItem("PT_LSK_preferredLanguage")||"it").useMissingTranslationHandler("ngTranslateErrorHandler").useSanitizeValueStrategy("escapeParameters")}])},function(e,t){angular.module("paladinApp").service("navigationService",["$rootScope","$state","enums","ptLog","ptUtils","toastService",function(e,t,o,a,r,n){e.$on(o.busNavigation.homePage,()=>t.go("app.home")),e.$on(o.busNavigation.productDetailed,(e,{product:n})=>{n?t.go("app.products.selectedProduct",{productNameAndId:r.getProductNameAndId(n)}):a.error("navigationService ||",o.busNavigation.productDetailed,"NO PRODUCT")}),e.$on(o.busNavigation.browseCategory,(e,{categoryId:a,subCategoryName:r,categoryName:n})=>{let i={};a?i.category=a:n&&(i.category=n.replace(/\ /g,"-")),r&&(i.subCategory=r.replace(/\ /g,"-")),i.sortBy=o.productsSortOptions.bestProduct,i.isResetSearch=!0,t.go("app.browse",i)}),e.$on(o.busNavigation.browseKeyword,(e,o)=>{t.go("app.browse",{search:o.keyword})}),e.$on(o.busNavigation.switchBrowseMode,(e,{isTryAndBuy:o})=>{o?t.go("app.browse"):t.go("app.browsePrivate")}),e.$on(o.busNavigation.browseSort,(e,o)=>{t.go("app.browse",{sortBy:o.sortBy,search:"",isResetSearch:!0})}),e.$on(o.busNavigation.userProfile,(e,{userId:o,replace:a})=>{t.go("app.profiles.publicProfile",{userId:o},a?{location:"replace"}:void 0)}),e.$on(o.busNavigation.userListings,()=>t.go("app.myListings")),e.$on(o.busNavigation.newProduct,()=>t.go("app.products.newProduct")),e.$on(o.busNavigation.rentals,()=>t.go("app.bookings.userBookings")),e.$on(o.busNavigation.transactionDetailed,(e,{bookingId:o,replace:a})=>{t.go("app.bookings.bookingDetailed",{bookingId:o},a?{location:"replace"}:void 0)}),e.$on(o.busNavigation.idVerification,(e,{bookingId:o,replace:a})=>{t.go("verification.user",{bookingId:o||void 0},a?{location:"replace"}:void 0)}),e.$on(o.busNavigation.userReview,(e,{bookingId:o,isLender:a})=>{t.go("app.products.productReview",{bookingId:booking.Booking_Id})}),e.$on(o.busNavigation.paymentDetailed,(e,{startDate:o,endDate:a,productId:r,purchase:n,bookingId:i})=>{t.go("app.bookings.paymentDetailed",{startDate:o,endDate:a,productId:r,purchase:n,bookingId:i})}),e.$on(o.busNavigation.chat,(e,o)=>{o&&o.chatId?t.go("app.chat",{chatId:o.chatId}):t.go("app.chat")})}])},function(e,t){angular.module("paladinApp").factory("pager",["$rootScope","$location",function(e,t){var o={GetPager:function(e,t,o){t=t||1;var a,r,n=e*(o=o||10);e<=10?(a=1,r=e):t<=6?(a=1,r=10):t+4>=e?(a=e-9,r=e):(a=t-5,r=t+4);var i=(t-1)*o;return{totalItems:n,currentPage:t,pageSize:o,totalPages:e,startPage:a,endPage:r,startIndex:i,endIndex:Math.min(i+o-1,n-1),pages:_.range(a,r+1)}}};return o}])},function(e,t){angular.module("paladinPopups",["ngMaterial","ngMessages","ngMaterialDateRangePicker","angularMoment","720kb.socialshare"]).config(["$mdDialogProvider",function(e){e.addPreset("confirmPreset",{options:function(){return{templateUrl:"./views/popups/confirm.popup.html",controller:"confirmPopup",bindToController:!0,controllerAs:"confirmCtrl",clickOutsideToClose:!0,escapeToClose:!0}}}),e.addPreset("loginSignup",{options:function(){return{templateUrl:"./views/popups/loginSignup.popup.html",controller:"loginSignUpPopup",bindToController:!0,controllerAs:"loginSignupCtrl",clickOutsideToClose:!0,escapeToClose:!0}}}),e.addPreset("forgotPassword",{options:function(){return{templateUrl:"./views/popups/forgotPassword.popup.html",controller:"forgotPasswordPopup",controllerAs:"forgotPasswordCtrl",clickOutsideToClose:!0,escapeToClose:!0}}}),e.addPreset("idVerificationFailureHandler",{options:function(){return{templateUrl:"./views/popups/idVerificationFailureHandler.popup.html",controller:"idVerificationFailureHandlerPopup",controllerAs:"idVerificationFailureHandlerPopup",clickOutsideToClose:!1,escapeToClose:!1}}}),e.addPreset("emailVerification",{options:function(){return{templateUrl:"./views/popups/emailVerification.popup.html",controller:"emailVerificationPopup",controllerAs:"emailVerificationCtrl",clickOutsideToClose:!1,escapeToClose:!1}}}),e.addPreset("shareReferralLink",{options:function(){return{templateUrl:"./views/popups/shareToSocialMedia.popup.html",controller:"shareToSocialMediaPopup",controllerAs:"shareToSocialMediaCtrl",clickOutsideToClose:!0,escapeToClose:!0}}}),e.addPreset("changePassword",{options:function(){return{templateUrl:"./views/popups/changePassword.popup.html",controller:"changePasswordPopup",controllerAs:"changePasswordCtrl",clickOutsideToClose:!0,escapeToClose:!0}}}),e.addPreset("transactionStatusChange",{options:function(){return{templateUrl:"./views/popups/transactionStatusChange.popup.html",controller:"transactionStatusChangePopup",controllerAs:"transactionStatusChangeCtrl",clickOutsideToClose:!1,escapeToClose:!1}}}),e.addPreset("inputField",{options:function(){return{templateUrl:"./views/popups/inputField.popup.html",controller:"inputFieldPopup",controllerAs:"inputFieldCtrl",clickOutsideToClose:!1,escapeToClose:!1}}}),e.addPreset("loader",{options:function(){return{templateUrl:"./views/popups/loader.popup.html",controller:"loaderPopup",controllerAs:"loaderCtrl",panelClass:"loaderOverlay",clickOutsideToClose:!1,escapeToClose:!1}}}),e.addPreset("bookingTrackerInfoMobile",{options:function(){return{templateUrl:"./views/popups/bookingTrackerInfoMobile.popup.html",controller:"bookingTrackerInfoMobilePopup",controllerAs:"bookingTrackerInfoMobilePopupCtrl",clickOutsideToClose:!1,escapeToClose:!1}}})}]).service("popupService",["$mdDialog","$mdDateRangePicker","moment","ptUtils",function(e,t,o,a){this.showAlert=function(t,o,a="POPUP_OK"){return new Promise((r,n)=>{const i=e.confirmPreset({locals:{title:t,message:o,isConfirm:!1,okBtn:a}});e.show(i).then(r).catch(n)})},this.showConfirm=function(t,o,a="POPUP_YES",r="POPUP_NO"){return new Promise((n,i)=>{const s=e.confirmPreset({locals:{title:t,message:o,yesButton:a,noButton:r,isConfirm:!0}});e.show(s).then(n).catch(i)})},this.showLoginSignupPopup=function(t=!1){return new Promise((o,a)=>{const r=e.loginSignup({locals:{selectedTab:t?1:0}});e.show(r).then(o).catch(a)})},this.showForgotPassword=function(){return new Promise((t,o)=>{e.show(e.forgotPassword()).then(t).catch(o)})},this.showIdVerificationFailureHandler=function(t){return console.log("idVerificationFailureHandler locals ",t),new Promise((o,a)=>{const r=e.idVerificationFailureHandler({locals:t});e.show(r).then(o).catch(a)})},this.showEmailVerification=function(t){return new Promise((o,a)=>{const r=e.emailVerification({locals:{userId:t}});e.show(r).then(o).catch(a)})},this.showShareReferralLink=function(t){return new Promise((o,a)=>{const r=e.shareReferralLink({locals:{referralLink:t}});e.show(r).then(o).catch(e=>{console.log("close modal err ",e)})})},this.showDateRangePicker=function(e,r){return new Promise((n,i)=>{const s=a.getBookedDateRanges(e);t.show({onePanel:!0,autoConfirm:!0,model:{},localizationMap:a.getTranslationDictForDatePicker(),maxRange:r.MaxRentalPeriod||void 0,isDisabledDate:e=>{const t=o(e);for(let e=0;e<s.length;e++)if(t.isBetween(s[e].startDate,s[e].endDate)||t.isSame(s[e].startDate)||t.isSame(s[e].endDate))return!0;return!o().isBefore(e)}}).then(e=>{n(e)}).catch(()=>{i()})})},this.showChangePassword=function(){return new Promise((t,o)=>{const a=e.changePassword({locals:{wot:"no"}});e.show(a).then(t).catch(o)})},this.showTransactionStatusChange=function({booking:t,apiMethod:o,title:a}){return new Promise((r,n)=>{const i=e.transactionStatusChange({locals:{booking:t,apiMethod:o,title:a}});e.show(i).then(r).catch(n)})},this.showInputField=function({title:t,message:o,initialValue:a,inputRegexValidation:r,validationErrorMessage:n="PLEASE_ENTER_A_VALID_INPUT"}){return new Promise((i,s)=>{const l=e.inputField({locals:{title:t,message:o,value:a,inputRegexValidation:r,validationErrorMessage:n}});e.show(l).then(i).catch(s)})},this.showLoader=function(){e.show(e.loader())},this.hideLoader=function(){e.hide()},this.showBookingTrackerInfoMobilePopup=function(t){return new Promise(o=>{const a=e.bookingTrackerInfoMobile({locals:{booking:t}});e.show(a).then(o).catch(o)})}}])},function(e,t){angular.module("paladinApp").service("productReviewService",["$state","$stateParams","$window","enums","apiService",function(e,t,o,a,r){let n=this;n.booking=null;return{startReviewFlow:(t,o)=>{n.booking=t,e.go("app.products.productReview",{bookingId:t.Booking_Id})},leaveProductReviewPage:(e=null)=>{o.history.back()},submitTransactionReview:e=>{r.reviews.submitTransactionReview(e).then(e=>{toastService.simpleToast($translate.instant("REVIEW_ADDED_SUCCESSFULLY"))})},getBookingToReview:()=>n.booking}}])},function(e,t){angular.module("paladinApp").factory("Products",["$http","$base64","enums",function(e,t,o){var a={getHeaders:function(){return{"Access-Control-Allow-Origin":"*","X-Requested":null,"Content-Type":"application/json; charset=utf-8"}},getAll:function(t){return t.languageCode||(t.languageCode="it-IT"),e.get(window.globals.API_URL+"GetBrowsePageProducts?"+this.searchProductParam(t))},getTotalPageCount:function(t){t.languageCode||(t.languageCode="en");this.getHeaders();return e.get(window.globals.API_URL+"GetPageCount?"+this.searchProductParam(t))},encryptProductURL:function(e){return e.trim().split(" ").join("-").split("/").join("-")},getDetail:function(t,o,r){this.getHeaders();o||(LanguageCode="en"),isNaN(t)?e.get(window.globals.API_URL+"GetProductDetail?User_Id=0&Product_Title="+encodeURIComponent(a.decryptProductURL(t))).then(r):e.get(window.globals.API_URL+"GetProductDetail?User_Id=0&Product_Id="+t).then(r)},formatLanguageCode:function(e){return"it"==e?"it-IT":e},searchProductParam:function(e){for(var t=Object.keys(e),a="",r=0;r<t.length;r++){var n=t[r],i=e[n];if("languageCode"==n&&i)a+="LanguageCode="+encodeURIComponent(this.formatLanguageCode(i));else if("category"==n&&i)i.selectedCategoryId&&(a+="Category_Id="+encodeURIComponent(i.selectedCategoryId)),i.selectedSubCategoryId&&(a+="&SubCategory_Id="+encodeURIComponent(i.selectedSubCategoryId)),void 0!=i.isTryAndBuy&&(a+="&"==a[a.length-1]?"isTryAndBuy="+encodeURIComponent(i.isTryAndBuy):"&isTryAndBuy="+encodeURIComponent(i.isTryAndBuy));else if("sortBy"==n&&i)"SortByPopularity"==i?a+="SortByPopularity=true":"SortByRecent"==i?a+="SortByRecent=true":"SortByGeoLocation"==i?a+="SortByGeoLocation=true":"SortByLowPrice"==i?a+="SortByLowPrice=true":"SortByHighPrice"==i?a+="SortByHighPrice=true":"SortByBestProduct"==i&&(a+="SortByBestProduct=true");else if("priceRange"==n&&i){var s=i[0],l=i[1];a+="MinPriceRange="+encodeURIComponent(s)+"&MaxPriceRange="+encodeURIComponent(l)}else if("currentPage"==n&&i)a+="PageIndex="+encodeURIComponent(i-1);else if("search"==n&&i){var c="";i.searchStr&&(c+="KeywordProduct="+encodeURIComponent(i.searchStr),i.lat&&(c+="&")),i.lat&&e.sortByCode==o.productsSortByTextCode.SortByGeoLocation&&(c+="Latitude="+encodeURIComponent(i.lat),i.lng&&(c+="&")),i.lng&&e.sortByCode==o.productsSortByTextCode.SortByGeoLocation&&(c+="Longitude="+encodeURIComponent(i.lng)),a+=c}else if("distanceRange"==n&&i&&e.sortByCode==o.productsSortByTextCode.SortByGeoLocation){i<=50&&(a+="Range="+encodeURIComponent(i))}else"currentPage"==n&&i&&(a+="PageIndex="+(i-1));r<t.length-1&&a&&"&"!=a.slice(-1)&&(a+="&")}return a.endsWith("&")&&(a=a.substring(0,a.length-1)),a+="&isWeb=true"}};return a}])},function(e,t){angular.module("paladinApp").service("ptLog",[function(){this.log=function(){"verbose"===window.globals.LOG_LEVEL&&console.log.apply(this,["PALADIN LOG:",...arguments])},this.warn=function(){"verbose"===window.globals.LOG_LEVEL&&console.warn.apply(this,["PALADIN WARN:",...arguments])},this.error=function(){console.error.apply(this,["PALADIN ERROR:",...arguments])}}])},function(e,t,o){"use strict";angular.module("paladinApp").service("ptUtils",["$rootScope","enums","moment","$translate","$timeout","ptLog","geoLocationService","$sce",function(e,t,o,a,r,n,i,s){const l=(e,o)=>{const{Price1Day:a,Price3Day:r,Price5Day:n,Price7Day:i,Price10Day:s,Price15Day:c,Product_TryAndBuy:d,Product_CategoryId:u,Product_Price_Perday:g}=e;let p=0;return t.categoriesIds.tryAndBuy==u||d?c>0&&o>=15?(p=o-15)>0?c+l(e,p):c:s>0&&o>=10?(p=o-10)>0?s+l(e,p):s:i>0&&o>=7?(p=o-7)>0?i+l(e,p):i:n>0&&o>=5?(p=o-5)>0?n+l(e,p):n:r>0&&o>=3?(p=o-3)>0?r+l(e,p):r:a>0&&o>=1?(p=o-1)>0?a+l(e,p):a:g*o:g*o},c=({startRentDate:e,endRentDate:t})=>{let a=o.isMoment(e)?e:o(new Date(e));return(o.isMoment(t)?t:o(new Date(t))).diff(a,"days")+1},d=e=>{const{ProductBookingDetail:t}=e;if(t&&t.length>0){let e=[];return t.forEach(t=>{e.push({endDate:o(t.EndDate),startDate:o(t.StartDate)})}),e}return[]},u=(e,t)=>e.isBetween(t.startDate,t.endDate)||e.isSame(t.startDate)||e.isSame(t.endDate),g={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return g.Android()||g.BlackBerry()||g.iOS()||g.Opera()||g.Windows()}},p=e=>{const{Product_CategoryId:o,Product_TryAndBuy:a}=e;return t.categoriesIds.tryAndBuy==o||a},h=e=>`${e.Product_Title} ${e.Product_Id}`.replace(/\ /g,"-"),m=({object:e,addressFieldName:t,latFieldName:o,lngFieldName:a})=>new Promise((r,n)=>{let s=e[t],l=Number(e[o]||0),c=Number(e[a]||0);!s&&l&&c?i.getUserAddressFromCoordinates({lat:l,lng:c}).then(e=>{r({address:e,lat:l,lng:c})}).catch(n):r({address:s,lat:l,lng:c})});return{stringToDate:(e,t="DD/MM/YYYY HH:mm",o="/",a=":",r=" ")=>{const n=-1!=t.indexOf("HH")&&-1!=t.indexOf("mm");let i=[e];n&&(i=e.split(r));const s=(n?t.split(r)[0]:t).split(o),l=(n?e.split(r)[0]:e).split(o);let c=s.indexOf(s.find(e=>-1!=e.indexOf("Y"))),d=s.indexOf("MM"),u=s.indexOf("DD"),g=void 0,p=void 0;if(n){const o=e.split(r)[1].split(a),n=t.split(r)[1].split(a);return g=n.indexOf("HH"),p=n.indexOf("mm"),new Date(l[c],parseInt(l[d])-1,l[u],o[g],o[p])}return new Date(l[c],parseInt(l[d])-1,l[u])},getDisplayDataForTransactionStatus:e=>{let o=void 0,a=void 0;switch(e){case t.productRentalStatus.available:o="PRODUCT_STATUS_AVAILABLE",a="rentOrderStatus-primary-50";break;case t.productRentalStatus.requested:a="rentOrderStatus-primary-100",o="PRODUCT_STATUS_REQUESTED";break;case t.productRentalStatus.timeout:case t.productRentalStatus.timeoutByBorrower:a="rentOrderStatus-primary-200",o="PRODUCT_STATUS_TIMEOUT";break;case t.productRentalStatus.canceled:case t.productRentalStatus.criticalCancel:case t.productRentalStatus.moderateCancel:case t.productRentalStatus.canceledByLender:a="rentOrderStatus-primary-200",o="PRODUCT_STATUS_CANCELED";break;case t.productRentalStatus.denied:a="rentOrderStatus-primary-200",o="PRODUCT_STATUS_DECLINED";break;case t.productRentalStatus.accepted:a="rentOrderStatus-primary-300",o="PRODUCT_STATUS_ACCEPTED";break;case t.productRentalStatus.started:a="rentOrderStatus-primary-400",o="PRODUCT_STATUS_STARTED";break;case t.productRentalStatus.ended:a="rentOrderStatus-primary-500",o="PRODUCT_STATUS_ENDED";break;case t.productRentalStatus.verified:a="rentOrderStatus-primary-50",o="PRODUCT_STATUS_VERIFIED";break;case t.productRentalStatus.notVerified:a="rentOrderStatus-primary-100",o="PRODUCT_STATUS_NOT_VERIFIED";break;case t.productRentalStatus.verifying:a="rentOrderStatus-primary-100",o="PRODUCT_STATUS_VERIFYING";break;case t.productRentalStatus.booked:a="rentOrderStatus-primary-300",o="PRODUCT_STATUS_BOOKED"}return{text:o,color:a}},getPriceForRentalPeriod:l,calculatePricingListForProduct:(e,o,r,n,i=!1,s=null,l,d=!1)=>new Promise((u,g)=>{if(e&&o&&!d){const d=c({startRentDate:e,endRentDate:o});let p=[];const{Product_CategoryId:h,Product_TryAndBuy:m,MinRentalPeriod:f,MaxRentalPeriod:y}=r,{DeliveryAndPickupDetail:S}=n,{Delivery_Fee:I,PickUp_Address:C}=S,P=t.categoriesIds.tryAndBuy==h||m;let _=((e,o)=>{const{Price3Day:a,Price5Day:r,Price7Day:n,Price10Day:i,Price15Day:s,Product_TryAndBuy:l,Product_CategoryId:c,Product_Price_Perday:d}=e;let u=0,g=void 0;return(t.categoriesIds.tryAndBuy==c||l)&&(s>0&&o>=15?(u=o-15,g=s):i>0&&o>=10?(u=o-10,g=i):n>0&&o>=7?(u=o-7,g=n):r>0&&o>=5?(u=o-5,g=r):a>0&&o>=3&&(u=o-3,g=a)),g?u>0?g+u*d:g:d*o})(r,d),b=""+d;if(P){if(f>0&&d<f)return g({code:-2,message:a.instant("INVALID_MIN_RENTAL_PERIOD",{days:f})});y>0&&d>y&&g({code:-3,message:a.instant("INVALID_MAX_RENTAL_PERIOD",{days:y})})}p=[{price:_,description:`${b} ${a.instant(1==d?"DAY":"DAYS")}`},{price:0,description:a.instant("SERVICE_FEE"),tooltip:a.instant("SERVICE_FEE_FREE")}],P&&i&&p.push({price:I||0,description:a.instant("DELIVERY_FEE")});let v=(P&&i&&I||0)+_;if(l){const{Coupon:e,CouponValue:t,CouponIsPercentage:o,CouponIsFixed:r}=l;if(r)v=t,p.push({description:a.instant("FIX_COUPON_DISCOUNT"),isCoupon:!0,price:`${t}`});else{let e=o?v*(t/100):t;(v-=e)<0&&(v=0),p.push({description:a.instant("COUPON"),isCoupon:!0,price:`-${e}`})}}else if(s&&s.User_Credit){const e=s.User_Credit;let t=e>=v-5?v-5:e;v-=t,p.push({description:a.instant("CREDIT"),isCredit:!1,price:`-${t}`})}p.push({description:a.instant("TOTAL"),price:v}),u(p)}else if(d){let e=[];e.push({description:a.instant("RETAIL_PRICE"),price:r.Product_PurchasePrice}),i&&e.push({description:a.instant("DELIVERY_FEE"),price:r.Product_Process_Fee});let t=r.Product_Process_Fee+r.Product_PurchasePrice;e.push({description:a.instant("TOTAL"),price:t}),u(e)}}),getPriceCalculatedDescriptionForRentalPeriod:(e,o)=>{const{Price1Day:a,Price3Day:r,Price5Day:n,Price7Day:i,Price10Day:s,Price15Day:l,Product_TryAndBuy:c,Product_CategoryId:d,Product_Price_Perday:u}=e;let g={};for(let e=o;e>0;){let o=0,p=0;t.categoriesIds.tryAndBuy==d||c?l>0&&e>=15?(o=15,p=l):s>0&&e>=10?(o=10,p=s):i>0&&e>=7?(o=7,p=i):n>0&&e>=5?(o=5,p=n):r>0&&e>=3?(o=3,p=r):a>0&&e>=1?(o=1,p=a):(o=1,p=u):(o=1,p=u),g[p]=(g[p]||0)+1,e-=o}let p="";for(let e in g)p+=(""===p?"":"+")+`${e}x${g[e]}`;return p},getBookedDateRanges:d,isBookingDateBookedForDateRange:u,getProductFirstAvailableDatesToRent:e=>{const t=d(e);let a={startDate:o(),endDate:o().add(1,"day")};for(let e=0;e<t.length;e++)(u(a.startDate,t[e])||u(a.endDate,t[e]))&&(a.startDate=o(t[e].endDate).add(1,"day"),a.endDate=o(a.startDate).add(1,"day"));return a},regexPatterns:{email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,numbersOnly:/^[0-9]+$/,minMaxLength:(e=2,t)=>new RegExp(`.{${e},${t||""}}`)},sorters:{bookingLastModifiedEpoch:(e,t)=>t.Last_Modified-e.Last_Modified},isProductTryAndBuy:p,playErrorSound:()=>{try{let e=new AudioContext,t=e.createOscillator(),o=e.createGain();t.type="sine",t.connect(o),o.connect(e.destination),t.start(),o.gain.exponentialRampToValueAtTime(1e-4,e.currentTime+1)}catch(e){n.error("AudioContext not supported")}},dataUrlToBlob:e=>{let t=atob(e.split(",")[1]),o=[];for(let e=0;e<t.length;e++)o.push(t.charCodeAt(e));return new Blob([new Uint8Array(o)],{type:"image/jpg"})},isMobile:g,isCrawler:()=>/bot|prerender|googlebot|crawler|spider|robot|crawling/i.test(navigator.userAgent),extractAndGeoLocateAddressFromObjectForFieldNames:m,getAddressToDisplayForBooking:({product:e,productBookingDetails:t,booking:o})=>new Promise((a,r)=>{const n=p(e);let i={title:"PICK_UP",address:void 0,lat:void 0,lng:void 0};if(!e)return r("product must not be undefined");if(i.address=e.Lender_User_Address,i.lat=e.Product_Latitude,i.lng=e.Product_Longitude,n&&t&&o){const{Booking_PickupProduct:e,Delivery_Latitude:a,Delivery_Longitude:r,Delivery_Address:n}=o;if(e){const{PickUp_Address:e,PickUp_Latitude:o,PickUp_Longitude:a}=t;i.address=e,i.lat=o,i.lng=a}else i.title="DELIVERY_ADDRESS",i.address=n,i.lat=a,i.lng=r}m({object:i,addressFieldName:"address",latFieldName:"lat",lngFieldName:"lng"}).then(e=>{a({...e,title:i.title})}).catch(r)}),getRentalPeriodInDays:c,calculatePriceingListForBooking:e=>new Promise(t=>{const{Booking_PickupProduct:o,FullEndDate:r,FullStartDate:n,Discount:i,DeliveryAndPickupDetail:s,RentAmount:l,Fix_Amount_Coupon:d,AmountCharge:u}=e,{Delivery_Fee:g}=s,p=c({startRentDate:new Date(n),endRentDate:new Date(r)}),h=!o;let m=[{price:h?l-g:l,description:`${""+p} ${a.instant(1==p?"DAY":"DAYS")}`},{price:0,description:a.instant("SERVICE_FEE"),tooltip:a.instant("SERVICE_FEE_FREE")}];h&&m.push({price:g||0,description:a.instant("DELIVERY_FEE")}),i&&m.push({price:-i,description:a.instant("DISCOUNT")}),d>0&&m.push({price:d,description:a.instant("FIX_COUPON_DISCOUNT")}),m.push({price:u,description:a.instant("TOTAL")}),t(m)}),parseBookingStepTutorialHTMLTemplateForTranslationId:e=>{const t=a.instant(e);if(-1!=t.indexOf("|")){let t="<div>";return a.instant(e).split("|").forEach((e,o)=>{t+=0==o?`<span>${e}</span> <ol>`:`<li>${e}</li>`}),t+="</ol><div>",s.trustAsHtml(t)}return n.warn("ptUtils","parseBookingStepTutorialHTMLTemplateForTranslationId","failed to parse translationId:",e),t},getTranslationIdForBookingStatus:(e,o,a)=>e===t.productRentalStatus.notVerified||e===t.productRentalStatus.verified?`BookingStatusNotVerified_${o?"Lender":"Borrower"}`:e===t.productRentalStatus.verifying?"BookingStatusVerifying_Borrower":e===t.productRentalStatus.requested?`BookingStatusRequested_${o?"Lender":"Borrower"}`:e===t.productRentalStatus.accepted?`BookingStatusAccepted_${o?"Lender":"Borrower"}`:e===t.productRentalStatus.booked?"BookingStatusBooked_Borrower":e===t.productRentalStatus.timeout?`BookingStatusTimeout_${o?"Lender":"Borrower"}`:e===t.productRentalStatus.denied?`BookingStatusDenied_${o?"Lender":"Borrower"}`:e===t.productRentalStatus.canceled?`BookingStatusCancelled_${o?"Lender":"Borrower"}`:e===t.productRentalStatus.criticalCancel?`BookingStatusCriticalCancelled_${o?"Lender":"Borrower"}`:e===t.productRentalStatus.moderateCancel?`BookingStatusModerateCancelled_${o?"Lender":"Borrower"}`:e===t.productRentalStatus.canceledByLender?`BookingStatusCancelledLender_${o?"Lender":"Borrower"}`:e===t.productRentalStatus.started?a?o?"BookingStatusStarted_Lender":"BookingStatusStarted_Borrower_TnB":`BookingStatusStarted_${o?"Lender":"Borrower"}`:e===t.productRentalStatus.ended?a?o?"BookingStatusEnded_Lender":"BookingStatusEnded_Borrower_TnB":`BookingStatusEnded_${o?"Lender":"Borrower"}`:void 0,getTranslationDictForDatePicker:()=>({Month:a.instant("Month"),Year:a.instant("Year"),"Date Range Template":a.instant("Date Range Template"),"Custom Date Range":a.instant("Custom Date Range"),Today:a.instant("Today"),Yesterday:a.instant("Yesterday"),"This Week":a.instant("Week"),"Last Week":a.instant("Week"),"This Month":a.instant("Month"),"Last Month":a.instant("Month"),"This Year":a.instant("Year"),"Last Year":a.instant("Year"),Cancel:a.instant("Cancel"),Clear:a.instant("Clear"),Ok:a.instant("Ok"),Sunday:a.instant("Sunday"),Monday:a.instant("Monday"),Tuesday:a.instant("Tuesday"),Wednesday:a.instant("Wednesday"),Thursday:a.instant("Thursday"),Friday:a.instant("Friday"),Saturday:a.instant("Saturday"),Sun:a.instant("Sunday"),Mon:a.instant("Monday"),Tue:a.instant("Tuesday"),Wed:a.instant("Wednesday"),Thu:a.instant("Thursday"),Fri:a.instant("Friday"),Sat:a.instant("Saturday"),January:a.instant("January"),February:a.instant("February"),March:a.instant("March"),April:a.instant("April"),May:a.instant("May"),June:a.instant("June"),July:a.instant("July"),August:a.instant("August"),September:a.instant("September"),October:a.instant("October"),November:a.instant("November"),December:a.instant("December"),Week:a.instant("Week")}),getProductDetailUrl:e=>window.globals.ROOT_PATH+a.use()+"/product/"+h(e),getProductNameAndId:h,getCategoriesUrl:(e,t,o,a)=>{let r=window.globals.ROOT_PATH+a+"/categorie/"+(o?"":"privato/");return null==t?r+=e:r=r+e+"/"+t,r.split(" ").join("-")}}}])},function(e,t){angular.module("paladinApp").service("referralsService",["$q","$location","apiService",function(e,t,o){this.userName=null,this.referralCode=null,this.validateReferralCode=(a=>{let r=this,n=a,i=a.split("-");i.pop();let s=i.join(" ");return e(function(e,a){return o.users.signUpReferred(n).then(function(t){r.userName=s,r.referralCode=n,e({userName:r.userName,referralCode:r.referralCode})},function(e){t.path("/"),a(e)})},function(e){console.info("Validating the referralCode was rejected with reason: ",e)})}),this.getReferralData=(()=>({userName:this.userName,code:this.referralCode}))}])},function(e,t,o){"use strict";angular.module("paladinApp").service("stripeService",["$rootScope","enums","appStateManager","$q","$http",function(e,t,o,a,r){const n=this;return n.ENV=window.globals.STRIPE_URL,n.JSON_to_URLEncoded=((e,t,o)=>{if(o=o||[],"object"==typeof e)for(let a in e)n.JSON_to_URLEncoded(e[a],t?t+"["+a+"]":a,o);else o.push(t+"="+encodeURIComponent(e));return o.join("&")}),n.getHttpConfig=((e,t)=>{let o={headers:{"Access-Control-Allow-Origin":"*","X-Requested":null,"Content-Type":"application/x-www-form-urlencoded; charset=utf-8","Access-Control-Allow-Methods":"GET, POST, PATCH, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin, Content-Type, X-Auth-Token",Authorization:`Bearer ${window.globals.STRIPE_SK}`}};return t&&Object.keys(t).forEach(e=>{o.headers[e]=t[e]}),e&&(o.params=e),o}),n.postRequest=function(e,t,o){const a=n.getHttpConfig(null,o);return r({method:"POST",url:n.ENV+e,headers:a.headers,params:a.params,transformRequest:function(e){return n.JSON_to_URLEncoded(e)},data:t})},n.getRequest=function(e,t,o){const a=n.getHttpConfig(null,o);return r({method:"GET",url:n.ENV+e,headers:a.headers,params:a.params,transformRequest:function(e){return n.JSON_to_URLEncoded(e)}})},n.apiMethods={createToken:function({number:e,exp_month:t,exp_year:o,cvc:a,name:r}){return n.postRequest("/tokens",{card:{number:e,exp_month:t,exp_year:o,cvc:a,name:r}})},getCustomer:function(e){return n.getRequest(`/customers/${e}`)},getCustomerSources:function(e){return n.getRequest(`/customers/${e}/sources`)}},n.apiMethods}])},function(e,t){angular.module("paladinApp").service("toastService",["$mdToast",function(e){this.simpleToast=function(t,o=3e3,a=!0){e.show(e.simple().textContent(t).hideDelay(o).position(a?"bottom right":"bottom left"))}}])},function(e,t,o){"use strict";angular.module("paladinApp").service("transactionService",["$rootScope","appStateManager","enums","apiService","popupService","geoLocationService","ptLog","ptUtils","$translate","gtmService","productReviewService","moment",function(e,t,o,a,r,n,i,s,l,c,d,u){const g=(e,o)=>new Promise((l,c)=>{const{user:d}=t,{User_Address:u,User_Email:p,User_Id:h}=d;if(!u)return c({isMissingAddress:!0});n.getUserCountryFromUserAddress(u).then(n=>{const{short_name:i}=n;a.payments.createUserStripeAccount({userId:h,email:void 0==o?p:o,bookingId:e.Booking_Id,country:i}).then(l).catch(o=>{r.showInputField({title:"ERROR",message:"BOOKING_END_RENTAL_STRIPE_ACCOUNT_DUPLICATE_ERROR",initialValue:t.user.User_Email,inputRegexValidation:s.regexPatterns.email}).then(t=>{r.showTransactionStatusChange({booking:e,apiMethod:()=>g(e,t.value),title:"END_RENTAL"}).then(l).catch(c)}).catch(c)})}).catch(e=>{i.error(`transactionService || , error getting user country, ${JSON.stringify(e)}`),c(e)})}),p=t=>{r.showAlert("ERROR","BOOKING_INVALID_OPERATION","REFRESH").finally(()=>{e.$emit(o.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id})})};return{acceptRental:t=>new Promise((n,i)=>{const s=()=>new Promise((n,i)=>{a.bookings.acceptBookingRequest({bookingId:t.Booking_Id,userId:t.Lender_Id}).then(a=>{c.trackEvent("rental-status","request-accepted"),r.showAlert("SUCCESS","BOOKING_ACCEPTED_SUCCESS").finally(()=>{e.$emit(o.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id}),n()})}).catch(e=>{if(e&&e.data&&e.data.Data&&403==e.data.Data)return p(t);r.showConfirm("ERROR","BOOKING_ACCEPTED_FAILURE","POPUP_TRY_AGAIN","POPUP_CANCEL").then(()=>{s().then(n).catch(i)}).catch(()=>{n()})})});r.showTransactionStatusChange({booking:t,apiMethod:s,title:"ACCEPT_REQUEST"}).then(n).catch(i)}),rejectRental:(t,n)=>new Promise((i,s)=>{const l=()=>new Promise((i,s)=>{const d=n?t.Lender_Id:t.Borrower_Id;a.bookings.rejectBookingRequest({bookingId:t.Booking_Id,userId:d,reason:""}).then(a=>{c.trackEvent("rental-status",n?"request-declined":"request-cancelled-prior-approval"),r.showAlert("SUCCESS","BOOKING_CANCELED_SUCCESS").finally(()=>{e.$emit(o.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id}),i()})}).catch(e=>{if(e&&e.data&&e.data.Data&&403==e.data.Data)return p(t);r.showConfirm("ERROR","BOOKING_CANCELED_FAILURE","POPUP_TRY_AGAIN","POPUP_CANCEL").then(()=>{l().then(i).catch(s)}).catch(()=>{i()})})});r.showConfirm("CONFIRM",n?"BOOKING_REJECT_WARNING":"CANCEL_REQUEST_WARNING").then(()=>{r.showTransactionStatusChange({booking:t,apiMethod:l,title:n?"DECLINE_REQUEST":"CANCEL_REQUEST"}).then(i).catch(e=>{console.log("...... ERR ",e," .... ",s),s()})}).catch(()=>{i()})}),cancelRental:(t,n)=>new Promise((i,s)=>{const l=()=>new Promise((i,s)=>{const d=n?t.Lender_Id:t.Borrower_Id;a.bookings.cancelBookingRequest({bookingId:t.Booking_Id,userId:d,reason:""}).then(a=>{c.trackEvent("rental-status",n?"booking-cancelled-by-lender":"booking-cancelled-by-borrower"),r.showAlert("SUCCESS","BOOKING_CANCELED_SUCCESS").finally(()=>{e.$emit(o.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id}),i()})}).catch(e=>{if(e&&e.data&&e.data.Data&&403==e.data.Data)return p(t);r.showConfirm("ERROR","BOOKING_CANCELED_FAILURE","POPUP_TRY_AGAIN","POPUP_CANCEL").then(()=>l().then(i).catch(s)).catch(()=>{i()})})}),{FullStartDate:d}=t;let g="BOOKING_CANCELLATION_MODERATE_WARNING";u(new Date(d)).diff(u(),"days")<=1&&(g="BOOKING_CANCELLATION_CRITICAL_WARNING"),r.showConfirm("CONFIRM",g).then(()=>{r.showTransactionStatusChange({booking:t,apiMethod:l,title:"CANCEL_REQUEST"}).then(i).catch(s)}).catch(()=>{i()})}),startRental:t=>new Promise((n,i)=>{const s=()=>new Promise((n,i)=>{a.bookings.startRental({bookingId:t.Booking_Id,userId:t.Borrower_Id}).then(()=>{c.trackEvent("rental-status","rental-started"),r.showAlert("SUCCESS","BOOKING_START_RENTAL_SUCCESS").finally(()=>{n(),e.$emit(o.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id})})}).catch(e=>{if(e&&e.data&&e.data.Data&&403==e.data.Data)return p(t);r.showConfirm("ERROR","BOOKING_START_RENTAL_FAILURE","POPUP_TRY_AGAIN","POPUP_CANCEL").then(()=>s().then(n).catch(i)).catch(i)})});r.showConfirm("CONFIRM","BOOKING_START_RENTAL_WARNING").then(()=>{r.showTransactionStatusChange({booking:t,apiMethod:s,title:"START_RENTAL"}).then(n).catch(i)})}),endRental:n=>new Promise((i,s)=>{const l=()=>new Promise((i,s)=>{const d=t.user;a.bookings.endRental({bookingId:n.Booking_Id,userId:n.Lender_Id}).then(t=>{c.trackEvent("rental-status","rental-ended"),d.User_StripeAccount?r.showAlert("SUCCESS","BOOKING_END_RENTAL_SUCCESS_PAYMENT").finally(()=>{i(),e.$emit(o.busEvents.reloadDetailedBooking,{bookingId:n.Booking_Id})}):g(n).then(t=>{c.trackEvent("rental-status","stripe-account-created"),r.showAlert("SUCCESS","BOOKING_END_RENTAL_SUCCESS_PAYMENT").finally(()=>{i(),e.$emit(o.busEvents.reloadDetailedBooking,{bookingId:n.Booking_Id})})}).catch(e=>{e&&e.isMissingAddress?r.showAlert("ERROR","PAYOUT_MISSING_ADDRESS").finally(()=>{s()}):s()})}).catch(e=>{if(e&&e.data&&e.data.Data&&403==e.data.Data)return p(n);r.showConfirm("ERROR","BOOKING_END_RENTAL_FAILURE").then(()=>l().then(i).catch(s)).catch(()=>{i()})})});r.showConfirm("CONFIRM","BOOKING_END_RENTAL_WARNING").then(()=>{r.showTransactionStatusChange({booking:n,apiMethod:l,title:"END_RENTAL"}).then(i).catch(s)})}),createUserStripeAccount:g,endRentalForStripeAccountOnly:t=>new Promise((a,n)=>{r.showTransactionStatusChange({booking:t,apiMethod:()=>g(t),title:"CREATE_STRIPE_ACCOUNT"}).then(()=>{c.trackEvent("rental-status","stripe-account-created"),r.showAlert("SUCCESS","CREATE_STRIPE_ACCOUNT_SUCCESS").then(()=>{e.$emit(o.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id}),a()})}).catch(n=>{n&&n.isMissingAddress?r.showAlert("ERROR","PAYOUT_MISSING_ADDRESS").finally(()=>{a()}):r.showAlert("ERROR","CREATE_STRIPE_ACCOUNT_FAILURE").then(()=>{e.$emit(o.busEvents.reloadDetailedBooking,{bookingId:t.Booking_Id}),a()})})})}}])},function(e,t){angular.module("paladinApp").service("uploadHandler",[function(){this.convertInputElementToBas64=function(t){return new Promise((o,a)=>{if(t&&t.files&&t.files.length>0)return e(t.files[0]).then(o).catch(a);a("no file uploaded")})};const e=e=>new Promise((t,o)=>{const a=new FileReader;a.onloadend=(()=>{if(a.result){const o=a.result.replace(`data:${e.type};base64,`,"");t({original64:a.result,serverParsed64:o})}else o("error uploading image")}),a.readAsDataURL(e)})}])},function(e,t){angular.module("paladinApp").controller("appController",["$scope","$rootScope","ZendeskWidget","enums","ptLog","appStateManager","dataService","$state","$location","$mdToast","$mdMedia",function(e,t,o,a,r,n,i,s,l,c,d){t.isAppOnline=!0,e.$on(a.busEvents.$routeChangeError,function(e,t,o,a){r.log("route change error"),r.log(a)}),s.includes("app.emailVerification")&&void 0!=Object.keys(l.search())[0]&&t.$emit(a.busEvents.triggerEmailValidation,{userId:Object.keys(l.search())[0]});let u=[];u.push(t.$on(a.busEvents.locationUpdate,(e,t)=>{})),u.push(t.$on(a.busEvents.scrollMainScrollerToTop,(e,t)=>{document.getElementById("main-ui-view").scrollTo(0,0)})),d("gt-sm")?o.show():o.hide(),u.push(e.$watch(function(){return d("gt-sm")},function(e){e?o.show():o.hide()})),e.$on("$destroy",function(){for(;u.length;)u.pop()()})}])},function(e,t,o){"use strict";angular.module("paladinApp").controller("bookingDetailedController",["$rootScope","$scope","enums","appStateManager","apiService","$stateParams","ptLog","popupService","ptUtils","$sce",function(e,t,o,a,r,n,i,s,l,c){t.isLoading=!1,t.bookingId=n.bookingId,t.booking=null,t.address={title:void 0,address:void 0,lat:void 0,lng:void 0},t.fetchDetailedBooking=(()=>{t.isLoading=!0,r.bookings.getBookingDetailed({bookingId:t.bookingId,userId:a.getUserId()}).then(e=>{t.booking=e.Data,t.booking.Product_Description=c.trustAsHtml(t.booking.Product_Description),t.fetchProduct()}).catch(e=>{i.error(JSON.stringify(e))})}),t.fetchProduct=(()=>{r.products.getDetailedProduct(t.booking.Product_Id).then(e=>{t.product=e.Data,t.fetchProductBookingDetails()}).catch(e=>{i.error(JSON.stringify(e))})}),t.fetchProductBookingDetails=(()=>{r.products.getProductBookingDetails({productId:t.product.Product_Id,userId:a.getUserId()}).then(e=>{t.productBookingDetails=e.Data,l.getAddressToDisplayForBooking({product:t.product,productBookingDetails:t.productBookingDetails,booking:t.booking}).then(e=>{t.$evalAsync(()=>{t.address=e,t.isLoading=!1,l.isMobile.any()&&s.showBookingTrackerInfoMobilePopup(t.booking)})}).catch(e=>{t.$evalAsync(()=>{t.isLoading=!1})})}).catch(e=>{i.error(e)})}),t.goToProduct=(()=>{e.$emit(o.busNavigation.productDetailed,{product:t.booking})}),t.fetchDetailedBooking();let d=[];d.push(e.$on(o.busEvents.reloadDetailedBooking,(e,{bookingId:o})=>{o==t.bookingId&&t.fetchDetailedBooking()})),t.$on("$destroy",()=>{for(;d.length;)d.pop()()})}])},function(e,t,o){"use strict";angular.module("paladinApp").controller("chatController",["$rootScope","$scope","$mdMedia","$mdSidenav","appStateManager","enums","$stateParams","chatService","$mdMedia",function(e,t,o,a,r,n,i,s){t.isLoading=!1,t.isChatCollapsed=!1,t.preSelectedchat={value:void 0},t.isGtMd=o("gt-md"),t.isGtSM=o("gt-sm"),i.chatId&&s.activateChatWhenReady(i.chatId),t.toggleNav=(()=>{a("chat-list-side-nav").toggle()});let l=[];l.push(t.$watch(function(){return o("gt-md")},function(e){t.isGtMd=e,t.isChatCollapsed=e})),l.push(t.$watch(function(){return o("gt-sm")},function(e){t.isGtSM=e})),t.$on("$destroy",()=>{for(;l.length;)l.pop()()})}])},function(e,t){angular.module("paladinApp").controller("homeController",["$scope","$http","$location","$cookies","$rootScope","$sce","$route","Filters","$translate","ZendeskWidget","ngMeta","$mdDialog","enums","$state","$stateParams","popupService","$timeout","appStateManager",function(e,t,o,a,r,n,i,s,l,c,d,u,g,p,h,m,f,y){let S;e.verificationMessage="Processing ...";const I=h.category;let C=I&&I.toString().replace(/-/g," ")!=l.instant("ACTG")?I:l.instant("ACTG"),P=h.subCategory?h.subCategory:"",_=p.params.sortBy||void 0,b=p.params.pageIndex||1,v=h.city||(r.filter||{}).glCity||void 0;const D=h.languageCode;r.lang=D,l.use(D),c.setLocale(D);var w=e;function T(e){const t=g.ngMetaValues.currentUrl(e);if(e!=D){var a="/"+e+"/categorie/";null==w.filter.category.selectedCategoryId?a+=g.allCategories[e].replace(/ /g,"-")+"/":a+=s.getCategoryById(w.filter.category.selectedCategoryId,e).Category_Name.replace(/ /g,"-"),w.filter.category.selectedSubCategoryId&&null!=w.filter.category.selectedSubCategoryId&&(a+="/"+s.getSubcategoryById(w.filter.category.selectedSubCategoryId,e).SubCategory_Name.replace(/ /g,"-"),v&&(a+="/"+v)),d.setTag(t,o.absUrl().split("/"+D+"/")[0]+a)}else d.setTag(t,o.absUrl())}function L(e){w.filter.gl=e,w.filter.search.lat=e.geometry.location.lat(),w.filter.search.lng=e.geometry.location.lng(),w.filter.glCity=function(e){for(var t="",o=0;o<e.address_components.length;o++)for(var a=e.address_components[o].types,r=0;r<a.length;r++){var n=a[r];if("country"==n||"political"==n){e.address_components[o].long_name;break}if("administrative_area_level_1"==n){e.address_components[o].long_name;break}if("administrative_area_level_2"==n&&!t||"locality"==n){t=e.address_components[o].long_name;break}}return t}(e),w.filter.glString=e.formatted_address}void 0!=p.params.search?r.searchKey=p.params.search:void 0!=o.search().search&&(r.searchKey=o.search().search),h.isResetSearch&&(r.searchKey=""),r.isTryAndBuy=h.isTryAndBuy,w.filter={categories:[],languageCode:D,priceRange:[0,1e3],search:{lat:void 0,lng:void 0,searchStr:""},currentPage:1,distanceRange:v?10:null,sortBy:g.productsSortOptions.bestProduct,sortByCode:g.productsSortByTextCode.SortByBestProduct,category:{defaultCategoryName:l.instant("ACTG"),defaultCategoryDesc:l.instant("ACTG"),selectedCategoryName:l.instant("ACTG"),isTryAndBuy:r.isTryAndBuy,selectedCategoryBannerImage:window.globals.IS_PROMO?g.categoriesBannersPaths.promo:g.categoriesBannersPaths.all[D],selectedSubCategoryName:null},gl:null,glString:"",glCity:""},w.prepareUrl=function(){let e=r.isTryAndBuy?`/${y.currentLang}/categorie`:`/${y.currentLang}/categorie/privato`;return w.filter.category.selectedCategoryName&&w.filter.category.selectedCategoryName.toString()&&(e+="/"+w.filter.category.selectedCategoryName.toString(),w.filter.category.selectedSubCategoryName&&w.filter.category.selectedSubCategoryName.toString()&&(e+="/"+w.filter.category.selectedSubCategoryName.toString(),v&&(e+="/"+v))),e.split(" ").join("-")},w.prepareQuery=(()=>{let e={};return w.filter.search.searchStr&&(e.search=w.filter.search.searchStr),w.filter.sortBy&&(e.sortBy=w.filter.sortBy),w.filter.currentPage&&(e.pageIndex=w.filter.currentPage),e}),w.findLatLong=function(){w.filter.glString?w.geocodeNow(null,null,w.filter.glString):v?w.geocodeNow(null,null,null):navigator.geolocation?(w.geocodeNow(null,null,null),navigator.geolocation.getCurrentPosition(function(e){w.geocodeNow(e.coords.latitude,e.coords.longitude,null)},function(){w.geocodeNow(null,null,null)})):w.geocodeNow(null,null,null)},w.geocodeNow=function(e,t,o){var a={};e&&t?(a.location={},a.location.lat=e,a.location.lng=t):a.address=o||("it"==D||"en"==D?"milan italy":"berlin germany"),(S=new google.maps.Geocoder).geocode(a,function(e,t){e&&e.length>0&&L(e[0]),r.$broadcast("filtersUpdated",w.filter)})},w.selectCategory=function(){w.filter.categories=r.categoriesMap.get(D);let e=s.getCategoryByName(C,D,r.isTryAndBuy),t=w.filter.category;if(e){if(t.selectedCategoryId=e.Category_Id,t.selectedCategoryDesc=n.trustAsHtml(e.Category_Description),t.selectedCategoryName=e.Category_Name,t.selectedCategoryImagePath=e.Category_ImagePath,t.selectedCategoryBannerImage=e.Category_BannerPath,e.Category_SubCatrgories&&e.Category_SubCatrgories.length>0)for(var o=0;o<e.Category_SubCatrgories.length;o++){var a=e.Category_SubCatrgories[o];if(t.selectedSubCategoryId=void 0,t.selectedSubCategoryDesc=void 0,t.selectedSubCategoryName=void 0,t.selectedSubCategoryImagePath=void 0,t.selectedSubCategoryBannerImage=void 0,a.SubCategory_Name.toLowerCase().replace(/ /g,"-")==P.toLowerCase()){t.selectedSubCategoryId=a.SubCategory_Id,t.selectedSubCategoryDesc=n.trustAsHtml(a.SubCategory_Description),t.selectedSubCategoryName=a.SubCategory_Name,t.selectedSubCategoryImagePath=a.SubCategory_ImagePath,t.selectedSubCategoryBannerImage=a.SubCategory_BannerPath;break}}}else t.selectedCategoryId=null,t.selectedCategoryDesc=n.trustAsHtml(C),t.selectedCategoryName=l.instant("ACTG"),t.selectedCategoryImagePath=null,t.selectedCategoryBannerImage=window.globals.IS_PROMO?g.categoriesBannersPaths.promo:g.categoriesBannersPaths.all[D],t.selectedSubCategoryId=void 0,t.selectedSubCategoryDesc=void 0,t.selectedSubCategoryName=void 0,t.selectedSubCategoryImagePath=void 0,t.selectedSubCategoryBannerImage=void 0,t.isTryAndBuy=r.isTryAndBuy;if(w.filter.category=t,v){let e={l_id:3,distance:10,name:"IC"};r.$broadcast("distanceChanged",e)}k()};let A=[];function k(){A.push(w.$watchGroup(["filter.languageCode","filter.sortBy","filter.currentPage","filter.category.selectedCategoryName","filter.category.selectedSubCategoryName","search.lat","search.lng"],function(e){e&&(r.filter=w.filter,o.search(w.prepareQuery()),o.update_path(w.prepareUrl(),!1),T("it"),T("en"))}))}_?(w.filter.sortBy=_,w.filter.sortByCode=g.productsSortByTextCode[_],h.isResetSearch&&(w.filter.search.searchStr=r.searchKey,w.filter.search.currentSearchStr=r.searchKey)):void 0!=r.searchKey&&(w.filter.search.searchStr=r.searchKey,w.filter.search.currentSearchStr=r.searchKey),b&&(w.filter.currentPage=b),r.filter?(w.filter=r.filter,//!important for not loading again all data
_?(w.filter.sortBy=_,w.filter.sortByCode=g.productsSortByTextCode[_],h.isResetSearch&&(w.filter.search.searchStr="",w.filter.search.currentSearchStr="")):void 0!=r.searchKey&&(w.filter.search.searchStr=r.searchKey,w.filter.search.currentSearchStr=r.searchKey),k(),w.selectCategory(),w.findLatLong()):r.categoriesMap?(w.selectCategory(),w.findLatLong()):(r.categoriesMap=new Map,s.get("it",function(e){r.categoriesMap.set("it",e.data.Data),s.get("en",function(e){r.categoriesMap.set("en",e.data.Data),w.selectCategory(),w.findLatLong()})})),w.promoTimeout=f(()=>{null!=y.user||angular.element(document.body).hasClass("md-dialog-is-showing")||m.showLoginSignupPopup(!0)},window.globals.PROMO_SIGNUP_TIMER),A.push(r.$on(g.busEvents.googlePlacesAutocompletePlaceChanged,function(e,t){t&&t.place&&("search-location-bar-desktop"==t.elementId||"search-location-bar-mobile"==t.elementId)&&(L(t.place),v=null,r.$broadcast("filtersUpdated",w.filter))})),A.push(w.$on("languageChanged",function(e,t){w.filter.languageCode=t,c.setLocale(t)})),e.$on("$destroy",()=>{for(;A.length;)A.pop()();f.cancel(w.promoTimeout)})}]),angular.module("paladinApp").directive("googleplaceAutocomplete",["$rootScope","enums",function(e,t){return{restrict:"A",require:"ngModel",scope:{googleplaceAutocompletePlace:"=?",googleplaceAutocomplete:"="},link:function(o,a,r,n){var i=o.googleplaceAutocomplete||{};i.placeholder="",i.componentRestrictions={country:"it"};var s=new google.maps.places.Autocomplete(a[0],i);delete a[0].placeholder,google.maps.event.addListener(s,"place_changed",function(){delete a[0].placeholder,o.$apply(function(){o.googleplaceAutocompletePlace=s.getPlace(),n.$setViewValue(a.val()),e.$emit(t.busEvents.googlePlacesAutocompletePlaceChanged,{place:o.googleplaceAutocompletePlace,elementId:a[0].attributes.id.nodeValue})})}),o.$on("$destroy",function(){google.maps.event.clearInstanceListeners(a[0])})}}}])},function(e,t){angular.module("paladinApp").controller("homeV2Controller",["$rootScope","$scope","enums","apiService","appStateManager","$mdToast","$translate","popupService","ngMeta","$timeout","referralsService","validReferralCode",function(e,t,o,a,r,n,i,s,l,c,d,u){t.isLoading=!0,t.isPromo=window.globals.IS_PROMO,t.lendTutorial={title:i.instant("MAKE_MONEY"),description:"ITEMS_ARE_INSURED",imgUrl:"/assets/lend_tutorial_image.png",steps:["UPLOAD_AN_ITEM","WAIT_FOR_REQUEST","LEND_YOUR_ITEM"]},t.borrowTutorial={title:i.instant("SAVE_MONEY"),description:"ITEMS_ARE_INSURED",imgUrl:"/assets/browse-banner-hp.jpg",steps:["FIND_THE_ITEM","MAKE_A_REQUEST","PICK_UP_OR_DELIVER"]},t.promoFixCoupon1={title:i.instant("PROMO_TITLE_1"),description:i.instant("OFERTA_VALIDA",{couponValue:window.globals.COUPON_VALUE}),imgUrl:o.categoriesBannersPaths.promo1,steps:["STEP1",i.instant("STEP2",{couponCode:window.globals.COUPON_CODE}),"STEP3"]},t.promoFixCoupon2={title:i.instant("PROMO_TITLE_2"),description:i.instant("OFERTA_VALIDA",{couponValue:window.globals.COUPON_VALUE}),imgUrl:o.categoriesBannersPaths.promo2,steps:["STEP1",i.instant("STEP2",{couponCode:window.globals.COUPON_CODE}),"STEP3"]},t.productTeasers={tryAndBuy:{description:"TRY_AND_BUY_INFO",link:`https://paladintrue.com/${r.currentLang}/${window.globals.SUPPORTED_LANGS.find(e=>r.currentLang==e.code).tryAndBuyWordPressPath}/`},homeAppliance:{categoryId:o.categoriesIds.homeAppliance},smartMobility:{categoryId:o.categoriesIds.smartMobility},hiTech:{categoryId:o.categoriesIds.hiTech},outdoor:{categoryId:o.categoriesIds.outdoor},kids:{categoryId:o.categoriesIds.kids}},t.takingAboutUsImages=[{img:"assets/talkingAboutUs/nuvola_testata-black-white_squared.jpg",link:"http://nuvola.corriere.it/2017/04/26/paladin-lapp-di-noleggio-di-oggetti-tra-privati/"},{img:"assets/talkingAboutUs/corriere-sera-square-1.jpg",link:"http://www.corriere.it/tecnologia/app-software/17_aprile_27/paladin-l-app-mettere-noleggio-oggetti-che-non-usiamo-750154f0-2b76-11e7-9442-4fba01914cee.shtml"},{img:"assets/talkingAboutUs/deejay_Logo-black-white.jpg",link:"https://www.deejay.it/audio/20170430-4/520066/"},{img:"assets/talkingAboutUs/green-me-black-white.jpg",link:"https://www.greenme.it/tecno/cellulari/23899-paladin-app-affitto-oggetti"},{img:"assets/talkingAboutUs/webnews-black-white.jpg",link:"http://www.webnews.it/2017/05/05/paladin-sharing-applicazione-economia-startup/"},{img:"assets/talkingAboutUs/logo-lifegate-radio-black-white.jpeg",link:"https://www.lifegate.it/radio-sound"},{img:"assets/talkingAboutUs/logo-radio-popolare-black-white.jpeg",link:"http://www.radiopopolare.it/podcast/pionieri-di-lun-2310/"},{img:"assets/talkingAboutUs/green-planner-black-white.jpeg",link:"https://www.greenplanner.it/2017/10/10/paladin-noleggio-strumenti/"},{img:"assets/talkingAboutUs/logo-Rai3-black-white.jpeg",link:"http://www.rai.it/rai3/"}],t.getHomePageData=(()=>{t.isLoading=!0,a.pages.getHomePageData([t.productTeasers.hiTech.categoryId,t.productTeasers.smartMobility.categoryId,t.productTeasers.homeAppliance.categoryId,t.productTeasers.outdoor.categoryId,t.productTeasers.kids.categoryId].toString()).then(e=>{t.isLoading=!1,t.data=e.Data}).catch(e=>{t.isLoading=!1,t.data={}})}),t.getCategoryName=(e=>{const o=t.data.Categories.find(t=>t.CategoryId==e);if(o)return o.CategoryName}),t.getProductList=((e,o)=>{if(0==e)return o?t.data.TryAndBuyProducts:t.data.P2PProducts;const a=t.data.Categories.find(t=>t.CategoryId==e);return a?a.ProductList:void 0}),t.getPopularTryAndBuy=(()=>{t.isLoading=!0,a.products.getPopularTryAndBuy().then(e=>{t.isLoading=!1,t.tryAndBuy=e.Data}).catch(e=>{t.isLoading=!1,t.tryAndBuy=[]})}),t.getHomePageData(),l.setTitle(i.instant("HOME_TITLE")),l.setTag("description",i.instant("DEFAULT_META_DESC")),l.setTag("imagePath","../../assets/paladin-logo-300x300.png"),t.promoTimeout=c(()=>{t.isCrawler()||null!=r.user||angular.element(document.body).hasClass("md-dialog-is-showing")||s.showLoginSignupPopup(!0)},d.referralCode?0:window.globals.PROMO_SIGNUP_TIMER),t.isCrawler=(()=>/bot|prerender|googlebot|crawler|spider|robot|crawling/i.test(navigator.userAgent)),t.$on("$destroy",()=>{c.cancel(t.promoTimeout)}),t.showToast=((e,t=3e3)=>{n.show(n.simple().textContent(e).hideDelay(t))})}])},function(e,t){angular.module("paladinApp").controller("myListingsController",["$rootScope","$scope","enums","appStateManager","apiService","$mdMedia",function(e,t,o,a,r,n){t.isLoading=!1,t.userId=a.getUserId(),t.addNewItem=(()=>{e.$emit(o.busNavigation.newProduct)}),t.isGtMd=n("gt-md");let i=[];i.push(t.$watch(function(){return n("gt-md")},function(e){t.isGtMd=e})),t.$on("$destroy",()=>{for(;i.length;)i.pop()()})}])},function(e,t){angular.module("paladinApp").controller("newProductController",["$rootScope","$scope","enums","appStateManager","apiService","uploadHandler","toastService","$translate","gtmService","ptUtils",function(e,t,o,a,r,n,i,s,l,c){t.isLoading=!0,t.emptyProductImage=o.categoriesBannersPaths.addProduct,t.subCategories=[],t.userAddress=void 0,t.isUseUserAddress={value:!1},t.newProductModel={Product_Title:"",Product_Description:"",Product_ItemCategory_Id:0,Product_SubCategoryId:0,Product_LenduserId:a.getUserId(),Product_TryAndBuy:!1,Product_IsShop:!1,Product_ShopURL:"",Product_Price_Perday:null,Product_City:"",Price7Day:null,Price15Day:null},t.onUploadClicked=(()=>{t.$$postDigest(()=>{angular.element(document.getElementById("uploadImageBtn"))[0].click()})}),t.onUploaded=(e=>{i.simpleToast(s.instant("UPLOADING_IMAGE")),canvasResize(e.files[0],{quality:75,isPreprocessing:!0,cardType:"",maxW:2048,maxH:2008,isiOS:c.isMobile.iOS(),callback:function(e,o,a){t.$evalAsync(()=>{t.tmpUlpoadedImg=e,t.newProductModel.ProductImage_Image1=e.split(",")[1],i.simpleToast(s.instant("IMAGE_UPLOADED"))})}})}),t.validator=(()=>{let e=!0,o="";return t.newProductModel.Product_Title||(e=!1,o||(o=s.instant("PRODUCT_INVALID_TITLE"))),t.newProductModel.Product_Description||(e=!1,o||(o=s.instant("PRODUCT_INVALID_DESCRIPTION"))),t.newProductModel.Product_Latitude&&t.newProductModel.Product_Longitude||t.isUseUserAddress.value&&t.userAddress&&t.userAddress.lat&&t.userAddress.lng||(e=!1,o||(o=s.instant("PRODUCT_INVALID_ADDRESS"))),t.newProductModel.ProductImage_Image1||(e=!1,o||(o=s.instant("PRODUCT_INVALID_IMAGE"))),t.newProductModel.Product_ItemCategory_Id||(e=!1,o||(o=s.instant("PRODUCT_INVALID_CATEGORY"))),t.newProductModel.Product_Price_Perday||(e=!1,o||(o=s.instant("PRODUCT_INVALID_PRICE_PER_DAY"))),t.newProductModel.Product_TryAndBuy&&!t.newProductModel.Product_ShopURL&&(e=!1,o||(o=s.instant("PRODUCT_INVALID_TRY_AND_BUY_URL"))),e||i.simpleToast(o),e}),t.onCategorySelected=(e=>{if(t.subCategories=[],t.newProductModel.Product_SubCategoryId=0,t.categories){const o=t.categories.find(t=>t.Category_Id==e);o&&o.Category_SubCatrgories&&o.Category_SubCatrgories.length>0?t.subCategories=o.Category_SubCatrgories:t.subCategories=[]}}),t.addProduct=(()=>{if(!t.validator())return;t.isLoading=!0;let n=angular.copy(t.newProductModel);t.isUseUserAddress.value&&(delete n.Product_LocationId,n.Product_Latitude=t.userAddress.lat,n.Product_Longitude=t.userAddress.lng),e.$emit(o.busEvents.scrollMainScrollerToTop),r.products.addProduct(n).then(n=>{l.trackEvent("add-product","new-product-added"),r.products.getUserProducts({userId:a.getUserId(),productsFilter:o.userProductsFilter.myProductsToBorrow}).then(a=>{if(t.isLoading=!1,a&&a.Data&&a.Data.User_AllProducts&&a.Data.User_AllProducts.length>0){const t=a.Data.User_AllProducts[a.Data.User_AllProducts.length-1];e.$emit(o.busNavigation.productDetailed,{product:t})}console.log(a)}).catch(e=>{t.isLoading=!1,console.error(e)})}).catch(e=>{t.isLoading=!1})});const d=()=>{if(a.user&&a.user.User_Address&&a.user.User_Latitude&&a.user.User_Longitude&&!t.userAddress&&(t.userAddress={address:a.user.User_Address,lat:a.user.User_Latitude,lng:a.user.User_Longitude}),a.categoriesDict&&!t.categories){let e=[],o=0;Object.values(a.categoriesDict).forEach(t=>{t.IsTryAndBuy||(e[o++]=t)}),t.categories=e}};d(),t.isLoading=!1;let u=[];u.push(e.$on(o.busEvents.categoriesUpdate,()=>{d()})),u.push(e.$on(o.busEvents.updatedUser,()=>{d()})),u.push(e.$on(o.busEvents.googlePlacesAutocompletePlaceChanged,(e,o)=>{if("newProductAddress"==o.elementId){let{place:e}=o,{geometry:a}=e;t.newProductModel.Product_Latitude=a.location.lat(),t.newProductModel.Product_Longitude=a.location.lng(),t.newProductModel.Product_LocationId=e.id}})),t.$on("$destroy",()=>{for(;u.length;)u.pop()()})}])},function(e,t,o){"use strict";angular.module("paladinApp").controller("paymentDetailedController",["$rootScope","$scope","apiService","appStateManager","enums","$stateParams","popupService","toastService","$sce","stripeService","creditcards","menusService","ptUtils","moment","geoLocationService","ptLog","$translate","gtmService",function(e,t,o,a,r,n,i,s,l,c,d,u,g,p,h,m,f,y){if(t.isLoading=!0,t.isHaveSavedCC=!1,t.isTryAndBuy=!1,t.isNewCardLayoutOpen=!1,t.isBuy=!1,n.startDate&&n.startDate&&n.productId)t.rentStartDate=n.startDate,t.rentEndDate=n.endDate,t.productId=n.productId;else{if(!n.productId||!n.purchase&&!n.bookingId)return void i.showAlert("Ops",f.instant("INVALID_PAGE")).finally(()=>{e.$emit(r.busNavigation.homePage)});t.isBuy=n.purchase,t.bookingId=n.bookingId,t.productId=n.productId}t.prices=[],t.userSavedCard=null,t.coupon=null,t.statusError=null,t.ccModel={number:"",type:"",expiration:"",exp_month:"",exp_year:"",cvc:"",name:"",isTermsAndConditionsAccepted:!1,isSaveCardForFutureTransactions:!0,isDelivery:!0,deliveryAddress:"",deliveryName:"",deliveryPhone:"",deliveryBell:""},t.forms={},t.ccIcon={MasterCard:"fa-cc-mastercard",Visa:"fa-cc-visa","American Express":"fa-cc-amex",Discover:"fa-cc-discover",undefined:"fa-credit-card",Unknown:"fa-credit-card",Maestro:"fa-credit-card",JCB:"fa-cc-jcb",Diners:"fa-cc-diners","Diners Club":"fa-cc-diners-club"},t.fetchProduct=(()=>{t.isLoading=!0,o.products.getDetailedProduct(t.productId).then(e=>{t.product=e.Data,t.product.Product_Description=l.trustAsHtml(t.product.Product_Description),g.extractAndGeoLocateAddressFromObjectForFieldNames({object:t.product,addressFieldName:"Lender_User_Address",latFieldName:"Product_Latitude",lngFieldName:"Product_Longitude"}).then(e=>{t.product.Lender_User_Address=e}),t.isTryAndBuy=g.isProductTryAndBuy(t.product),t.fetchBookingDetails()}).catch(e=>{t.isLoading=!1,s.simpleToast(JSON.stringify(e)),m.error(JSON.stringify(e))})}),t.fetchBookingDetails=(()=>{o.products.getProductBookingDetails({productId:t.product.Product_Id,userId:a.getUserId()}).then(e=>{t.productBookingDetails=e.Data,t.calculatePrices();const{UserCustomerDetail:o}=t.productBookingDetails;let{User_CustomerId:a}=o;a?t.fetchStripeUserCard(a):t.isLoading=!1}).catch(e=>{t.isLoading=!1,console.error(e)})}),t.fetchProduct(),t.toggleNewCardLayout=(()=>{t.isNewCardLayoutOpen=!t.isNewCardLayoutOpen,t.userSavedCard=null,t.isHaveSavedCC=!1}),t.gotoTermsAndConditions=(()=>{const e=u.commonMenus.linksMenu.list[1].link;window.open(e,"_blank").focus()}),t.fetchStripeUserCard=(e=>{c.getCustomerSources(e).then(e=>{if(200===e.status&&null!=e.data){const{data:o,object:a}=e.data;if("list"==a&&o&&o.length>0){const e=o.find(e=>"card"==e.object);e&&(t.userSavedCard=e,t.isHaveSavedCC=!0)}}t.isLoading=!1}).catch(e=>{t.isLoading=!1,console.error(e)})}),t.calculatePrices=(()=>{t.prices=[],t.statusError=void 0,t.userCredit=null;let e=a.getUserId();o.users.getUserCredit({userId:e}).then(e=>{t.userCredit=e.Data,(()=>{const{product:e,productBookingDetails:o,rentStartDate:a,rentEndDate:r,userCredit:n,coupon:i,ccModel:s}=t;g.calculatePricingListForProduct(a,r,e,o,s.isDelivery,n,i,t.isBuy).then(e=>{t.$evalAsync(()=>{t.prices=e})}).catch(e=>{t.$evalAsync(()=>{e&&e.message&&(t.statusError=e.message)})})})()}).catch(e=>{console.error("getuserCredit failed ",e)})}),t.onDatesSelected=(({startDate:e,endDate:o})=>{t.rentStartDate=e,t.rentEndDate=o,t.calculatePrices()}),t.couponValidated=(e=>{t.coupon=e,t.calculatePrices()}),t.deleteCoupon=(()=>{t.coupon=null,t.calculatePrices()}),t.isDeliveryStatusChange=(()=>{t.calculatePrices()}),t.bookingValidator=(()=>{t.statusError=void 0;const{ccModel:e,forms:o}=t,{ccForm:a}=o,{isHaveSavedCC:r,userSavedCard:n,isNewCardLayoutOpen:i}=t;let l=!0,c="";return e.isTermsAndConditionsAccepted?r&&void 0!=n&&!i?l=!0:!a.$invalid&&a.$valid&&a.$dirty||(l=!1,c="INVALID_CC_FORM"):(l=!1,c="NEED_TO_ACCEPT_TERMS_AND_CONDITIONS"),t.isTryAndBuy&&e.isDelivery&&(e.deliveryAddress&&e.productLat&&e.productLng?e.deliveryName?e.deliveryPhone?e.deliveryBell||(l=!1,c="ADD_RING_BELL_NAME_MISSING"):(l=!1,c="ADD_PHONE_NUMBER_MISSING"):(l=!1,c="ADD_BILLING_NAME_MISSING"):(l=!1,c="INVALID_DELIVERY_ADDRESS")),!l&&c&&(s.simpleToast(f.instant(c)),t.statusError=c),l}),t.bookNow=(async()=>{angular.copy(t.ccModel);const{product:o,isHaveSavedCC:n,userSavedCard:l,productBookingDetails:c,isNewCardLayoutOpen:d}=t,{UserCustomerDetail:u}=c;let{User_CustomerId:g}=u;if(t.bookingValidator()){i.showLoader();try{const{User_IsVerfied:c,User_Email:u}=a.user;let p=null;if(g&&n&&l&&!d)p=g;else{const e=await t.createNewCardToken();p=await t.createStripeCustomer(e.id,u),console.log(p)}const h=await t.chargeCard(p,u);if(h&&h.Data){i.hideLoader(),t.isBuy?y.trackEvent("purchase","purchase-submitted"):y.trackEvent("booking","booking-request-submitted",h.Data.Booking_Id,.78*h.Data.AmountCharge),console.log(h);const a=h.Data.Booking_Id;t.isBuy?(t.bookingId?e.$emit(r.busNavigation.transactionDetailed,{bookingId:a,replace:!0}):e.$emit(r.busNavigation.productDetailed,{product:o}),i.showAlert("PURCHASE_SUCCESSFUL_TITLE","PURCHASE_SUCCESSFUL").finally(()=>{t.bookingId?e.$emit(r.busNavigation.transactionDetailed,{bookingId:t.bookingId,replace:!0}):e.$emit(r.busNavigation.productDetailed,{product:o})})):c||1===t.productBookingDetails.UserCustomerDetail.User_VerifyingStatus?e.$emit(r.busNavigation.transactionDetailed,{bookingId:a,replace:!0}):e.$emit(r.busNavigation.idVerification,{bookingId:a,replace:!0})}else i.hideLoader()}catch(e){let o=null;o=e.data&&e.data.error&&e.data.error.code?f.instant(e.data.error.code):(e.data||{}).Message||e.message||"DEFAULT_ERROR",console.error(e),i.hideLoader(),t.statusError=o,s.simpleToast(f.instant(o))}}}),t.createNewCardToken=(async()=>{const{number:e,exp_month:o,exp_year:a,cvc:r,name:n}=t.ccModel,i=await c.createToken({number:e,exp_month:o,exp_year:a,cvc:r,name:n});if(i.data){const{data:e}=i,{id:o,card:a}=e;if(!t.isBuy&&a&&"credit"==a.funding||t.isBuy&&a)return e;throw new Error("DEBIT_CARD_NOT_SUPPORTED")}throw new Error("CANT_CHARGE_CC")}),t.createStripeCustomer=(async(e,t)=>{const a=await o.payments.createStripeCustomer({cardToken:e,email:t});if(a&&a.Data)return console.log(JSON.stringify(a.Data)),a.Data;throw new Error("COULD_CREATE_STRIPE_CUSTOMER")}),t.chargeCard=(async(e,r)=>{const{product:n,rentStartDate:i,rentEndDate:s,ccModel:l,coupon:c}=t;if(t.isBuy)return await o.purchase.buyProduct({stripeEmail:r,bookingId:t.bookingId||void 0,borrowerId:Number(a.getUserId()),purchaseAmount:n.Product_PurchasePrice+n.Product_Process_Fee,lenderId:n.Lender_UserId,productId:n.Product_Id,stripeCustomerId:e,isSaveCard:l.isSaveCardForFutureTransactions,isPickUp:!l.isDelivery,deliveryAddress:l.isDelivery?l.deliveryAddress:void 0,deliveryLat:l.isDelivery?l.productLat:void 0,deliveryLng:l.isDelivery?l.productLng:void 0,deliveryName:l.isDelivery?l.deliveryName:void 0,deliveryPhone:l.isDelivery?l.deliveryPhone:void 0,deliveryBell:l.isDelivery?l.deliveryBell:void 0});{const t=g.getRentalPeriodInDays({startRentDate:i,endRentDate:s});return await o.bookings.bookProduct({stripeEmail:r,borrowerId:Number(a.getUserId()),lenderId:n.Lender_UserId,productId:n.Product_Id,startDate:p(i).format("MM/DD/YYYY"),endDate:p(s).format("MM/DD/YYYY"),stripeCustomerId:e,noOfDays:t,isSaveCard:l.isSaveCardForFutureTransactions,isPickUp:!l.isDelivery,deliveryAddress:l.isDelivery?l.deliveryAddress:void 0,deliveryLat:l.isDelivery?l.productLat:void 0,deliveryLng:l.isDelivery?l.productLng:void 0,deliveryName:l.isDelivery?l.deliveryName:void 0,deliveryPhone:l.isDelivery?l.deliveryPhone:void 0,deliveryBell:l.isDelivery?l.deliveryBell:void 0,coupon:void 0!=c?c.Coupon:void 0,idVerified:a.user.User_IsVerfied,isTryAndBuy:n.Product_TryAndBuy})}});let S=[];S.push(e.$on(r.busEvents.googlePlacesAutocompletePlaceChanged,(e,o)=>{if("productDeliveryAddress"==o.elementId){let{place:e}=o,{geometry:a}=e;t.ccModel.productLat=a.location.lat(),t.ccModel.productLng=a.location.lng(),t.ccModel.productLocationId=e.id}}));const I=e=>{event.returnValue="are you sure?"};window.addEventListener("beforeunload",I),t.$on("$destroy",()=>{for(;S.length;)S.pop()();window.removeEventListener("beforeunload",I)})}])},function(e,t,o){"use strict";angular.module("paladinPopups").controller("bookingTrackerInfoMobilePopup",["$scope","enums","ptUtils","locals","appStateManager","$mdDialog","$mdColors",function(e,t,o,a,r,n,i){e.userId=r.getUserId(),e.isLender=e.userId==a.booking.Lender_Id,e.isTryAndBuy=a.booking.IsTryAndBuy,e.currentStatusId=a.booking.BookingStatus[a.booking.BookingStatus.length-1].Status_TrackId,e.popupDescription=o.parseBookingStepTutorialHTMLTemplateForTranslationId(o.getTranslationIdForBookingStatus(e.currentStatusId,e.isLender,e.isTryAndBuy)),e.close=(()=>n.hide());e.$$postDigest(()=>{(()=>{document.getElementById("bookingTrackerInfoMobilePopupId").parentNode.classList.add("md-dialog-booking-tracker-class"),document.querySelector("#bookingTrackerInfoMobilePopupId div>div").className="flex-100 layout-column layout-align-center-center";let e=document.querySelector("#bookingTrackerInfoMobilePopupId div>div>span");e.className="fontWeight450 font20pt md-padding",i.applyThemeColors(angular.element(e),{color:"default-primary-A300"}),document.querySelector("#bookingTrackerInfoMobilePopupId div>div>ol").className="md-padding",document.querySelectorAll("#bookingTrackerInfoMobilePopupId div>div>ol>li").forEach(e=>{e.className="font12pt",i.applyThemeColors(angular.element(e),{color:"default-primary-A400"})})})()})}])},function(e,t){angular.module("paladinPopups").controller("changePasswordPopup",["$scope","$mdDialog","locals","appStateManager","apiService",function(e,t,o,a,r){e.isProcessing=!1,e.statusError=null,e.changePassModel={oldPassword:"",newPassword:"",newPasswordConfirmation:""},e.cancel=(()=>{t.cancel()}),e.validator=(()=>{let t=!0;return e.changePassModel.oldPassword&&e.changePassModel.newPassword&&e.changePassModel.newPasswordConfirmation?e.changePassModel.newPassword!=e.changePassModel.newPasswordConfirmation&&(t=!1,e.statusError="PASSES_DONT_MATCH"):(e.statusError="FILL_ALL_FIELDS",t=!1),t}),e.changePass=(()=>{e.statusError=null,e.validator()&&(e.isProcessing=!0,r.users.changePassword({newPassword:e.changePassModel.newPassword,oldPassword:e.changePassModel.oldPassword,userId:a.getUserId()}).then(e=>{t.hide()}).catch(t=>{e.statusError=t.data.Message||"DEFAULT_ERROR",e.isProcessing=!1}))})}])},function(e,t){angular.module("paladinPopups").controller("confirmPopup",["$scope","$mdDialog","locals",function(e,t,o){e.title=o.title,e.message=o.message,e.isConfirm=o.isConfirm,e.isConfirm?(e.yesButton=o.yesButton,e.noButton=o.noButton):e.okBtn=o.okBtn||"POPUP_OK",e.closeDialog=(e=>{e?t.hide():t.cancel()})}])},function(e,t){angular.module("paladinPopups").controller("emailVerificationPopup",["$scope","$rootScope","$mdDialog","enums","apiService","$translate","ptLog","appStateManager","locals",function(e,t,o,a,r,n,i,s,l){e.welcome_message_dialog=n.instant("WELCOME"),e.isProcessing=!0,e.isSuccess=!0,e.message=n.instant("PLEASE_WAIT"),e.hide=function(){o.hide()},e.cancel=function(){o.cancel()},e.answer=function(e){o.hide(e)},e.retry=function(){e.verifyUser()},e.verifyUser=(()=>{e.message=n.instant("PLEASE_WAIT"),e.isProcessing=!0,e.isSuccess=!0,r.users.emailVerification({userId:l.userId}).then(o=>{e.isProcessing=!1,e.isSuccess=!0,e.message=n.instant("REGISTRATION_SUCCESS"),t.$emit(a.busEvents.userLogin,o.Data)}).catch(t=>{e.isProcessing=!1,e.isSuccess=!1,e.message=n.instant("REGISTRATION_ERROR")})}),e.verifyUser()}])},function(e,t){angular.module("paladinPopups").controller("forgotPasswordPopup",["$scope","$rootScope","$mdDialog","enums","apiService","$translate","ptLog","appStateManager",function(e,t,o,a,r,n,i,s){e.forgotPasswordMessage="",e.forgotpasswordStatus="",e.btnForgotPasswordStatus=10,e.forgotPassword=(t=>{e.btnForgotPasswordStatus=1,r.users.forgotPassword({email:t,currentLang:s.getCurrentLang()}).then(t=>{e.btnForgotPasswordStatus=10,e.forgotpasswordStatus=t.Status,e.forgotPasswordMessage=t.Message,i.log(JSON.stringify(t))}).catch(t=>{e.btnForgotPasswordStatus=10,e.forgotpasswordStatus=t.data.Status,e.forgotPasswordMessage=t.data.Message,i.error(JSON.stringify(t))})}),e.cancel=(()=>{o.cancel()})}])},function(e,t){angular.module("paladinPopups").controller("idVerificationFailureHandlerPopup",["$scope","$mdDialog","$translate","locals",function(e,t,o,a){e.popupTitle=o.instant("ID_VERIFY_FAIL_POPUP_TITLE"),e.isProcessing=!1,e.isSuccess=!0,e.message=a.message,e.cancel=function(){t.cancel()},e.retry=function(){a.retryClb(),e.cancel()},e.sendToManualVerification=(()=>{a.sendToManualClb(),e.cancel()})}])},function(e,t,o){"use strict";angular.module("paladinPopups").controller("inputFieldPopup",["$scope","$mdDialog","locals",function(e,t,o){e.isInvalid=!1,e.message=o.message,e.title=o.title,e.inputRegexValidation=o.inputRegexValidation,e.validationErrorMessage=o.validationErrorMessage,e.inputField={value:o.value},e.closeDialog=(o=>{o?e.inputRegexValidation&&e.inputRegexValidation.test(e.inputField.value)?t.hide(e.inputField):e.isInvalid=!0:t.cancel()})}])},function(e,t,o){"use strict";angular.module("paladinPopups").controller("loaderPopup",["$rootScope","$scope",function(e,t){t.loadingText=void 0}])},function(e,t){angular.module("paladinPopups").controller("loginSignUpPopup",["$scope","$rootScope","$mdDialog","enums","apiService","$translate","ptLog","appStateManager","popupService","$timeout","locals","ptUtils","gtmService","referralsService",function(e,t,o,a,r,n,i,s,l,c,d,u,g,p){e.selectedTab=d.selectedTab,e.currentLang=n.proposedLanguage()?n.proposedLanguage():n.preferredLanguage(),t.currentLang&&(e.currentLang=t.currentLang),e.loginMessage="",e.loginFacebookMessage="",e.signupFacebookMessage="",e.signupFacebookStatus="",e.signupMessage="",e.signupStatus="",e.registerFacebookStatus="",e.btnStatus=10,e.isLoading=!1,e.isFacebookApiLoaded=t.facebookApiLoaded;let h=p.getReferralData(),m=h.code;e.promoMessage=p.getReferralData().code?n.instant("PROMO_MESSAGE_REGISTER_REFERRED",{ambassadorUserName:h.userName}):window.globals.IS_PROMO?n.instant("PROMO_MESSAGE_REGISTER_PROMO",{startDate:window.globals.START_DATE,endDate:window.globals.END_DATE,couponValue:window.globals.COUPON_VALUE}):n.instant("PROMO_MESSAGE_REGISTER"),e.register=((t,o,a,n)=>{const c="it"===s.currentLang?"it-IT":s.currentLang;if(!u.regexPatterns.minMaxLength(6).test(o))return e.signupStatus="error",void(e.signupMessage="SIGN_UP_ERROR_PASSWORD_RESTRICTION");e.btnStatus=1,r.users.signUp({email:a,username:t,password:o,location:n,currentLang:c,referralCode:m}).then(t=>{e.btnStatus=10,e.signupMessage=t.Message,e.signupStatus=t.Status,l.showAlert("ACTIVATION_EMAIL_SENT_TITLE","ACTIVATION_EMAIL_SENT_DESCR"),i.log(JSON.stringify(t)),g.trackEvent("registration","click-on-sign-up-button","email signup")}).catch(t=>{e.btnStatus=10,e.signupMessage=t.data.Message,e.signupStatus=t.data.Status,i.error(JSON.stringify(t))})}),e.login=((n,l)=>{const c="it"===s.currentLang?"it-IT":s.currentLang;e.isLoading=!0;let d={username:n,password:l,currentLang:c};u.regexPatterns.email.test(n)&&(delete d.username,d.email=n),r.users.login(d).then(r=>{e.isLoading=!1,i.log(JSON.stringify(r)),t.$emit(a.busEvents.userLogin,r.Data),o.hide()}).catch(t=>{e.isLoading=!1,e.loginStatus=t.data.Status,e.loginMessage=t.data.Message,i.error(JSON.stringify(t))})}),e.registerFacebook=(()=>{t.facebookApiLoaded?(e.btnStatus=1,r.users.signupFacebook({facebookName:t.facebook_user.name,email:t.facebook_user.email,address:t.facebook_user.address,currentLang:s.getCurrentLang(),facebookUserId:t.facebook_user.id,referralCode:m}).then(r=>{e.btnStatus=10,e.signupFacebookStatus=r.Status,i.log(JSON.stringify(r)),t.$emit(a.busEvents.userLogin,r.Data),o.hide(),r.Data.FbSignup&&1==r.Data.FbSignup&&g.trackEvent("registration","click-on-facebook-signup","facebook signup")}).catch(t=>{e.btnStatus=10,e.signupFacebookStatus=t.data.Status,e.signupFacebookMessage=t.data.Message})):(e.signupFacebookStatus="error",e.signupFacebookMessage=n.instant("FACEBOOK_LOADING"),c(()=>{e.registerFacebook()},2e3))}),e.cancel=(()=>{o.hide()}),e.showTabDialogForgotPassword=(()=>{l.showForgotPassword()});let f=[];f.push(t.$on(a.busEvents.facebookApiLoad),(e,t)=>{}),e.$on("$destroy",function(){for(;f.length;)f.pop()()})}])},function(e,t,o){"use strict";angular.module("paladinPopups").controller("shareToSocialMediaPopup",["$scope","$mdDialog","locals","ptUtils",function(e,t,o,a){e.referralLink=o.referralLink,e.isMobile=a.isMobile.any(),e.cancel=(()=>{t.cancel()})}])},function(e,t,o){"use strict";angular.module("paladinPopups").controller("transactionStatusChangePopup",["$scope","$mdDialog","locals",function(e,t,o){e.title=o.title,e.apiMethod=o.apiMethod,e.isLoading=!0,e.runApiMethod=(()=>{e.apiMethod().then(e=>{t.hide(e)}).catch(e=>{t.cancel(e)})}),e.runApiMethod()}])},function(e,t){angular.module("paladinApp").controller("productDetailedController",["$rootScope","$scope","enums","apiService","$stateParams","toastService","appStateManager","dataService","$sce","NgMap","popupService","$timeout","moment","ngMeta","$translate","ptUtils","$anchorScroll","$location","referralsService",function(e,t,o,a,r,n,i,s,l,c,d,u,g,p,h,m,f,y,S){t.isLoading=!1,r.productNameAndId&&(t.productId=r.productNameAndId.split("-")[r.productNameAndId.split("-").length-1]),t.category=null,t.subCategory=null,t.rentPickersIds={mobile:"rental-request-picker-mobile",desktop:"rental-request-picker-desktop"},t.productAddress={address:void 0,lat:void 0,lng:void 0},t.productBookingDetails=null,t.isLoggedInUser=(()=>i.getUserId()),t.updateMetaTags=(()=>{t.product&&(p.setTitle(t.getPageTitle()),p.setTag("description",t.getPageTitle()),p.setTag("imagePath",window.globals.PRODUCT_IMAGE_URL+t.product.ProductImage_Image1))}),t.getPageTitle=(()=>{var e=h.instant("RENT")+" ";return t.product&&t.product.Product_Title&&(e+=t.product.Product_Title+"  "),e+"| Paladintrue"}),t.fetchDetailedProduct=(()=>{t.isLoading=!0,a.pages.getProductDetailData(t.productId).then(e=>{t.product=e.Data,t.isMyProduct=t.product.Lender_UserId==i.getUserId(),t.product.Product_Description=l.trustAsHtml(t.product.Product_Description),m.extractAndGeoLocateAddressFromObjectForFieldNames({object:t.product,addressFieldName:"Product_Address",latFieldName:"Product_Latitude",lngFieldName:"Product_Longitude"}).then(e=>{t.productAddress=e}),i.getUserId()&&(t.productBookingDetails=t.product.UserData_ProductBooking),t.getCategory(),t.updateMetaTags(),t.isLoading=!1}).catch(e=>{t.isLoading=!1,n.simpleToast(JSON.stringify(e)),console.error(e)})}),t.getCategory=(()=>{if(!i.categoriesDict)return s.getCategories();if(t.product&&(t.category=i.categoriesDict[t.product.Product_CategoryId],t.category&&t.product.Product_SubCategoryId>0)){const e=t.category.Category_SubCatrgories.find(e=>e.SubCategory_Id==t.product.Product_SubCategoryId);e&&(t.subCategory=e)}}),t.requestRentalDates=(()=>{d.showDateRangePicker(t.productBookingDetails,t.product).then(e=>{const o=g(e.dateStart),a=g(e.dateEnd),r=m.getRentalPeriodInDays({startRentDate:e.dateStart,endRentDate:e.dateEnd});if(t.product.MinRentalPeriod>0&&r<t.product.MinRentalPeriod)return d.showAlert("OOPS",h.instant("INVALID_MIN_RENTAL_PERIOD",{days:t.product.MinRentalPeriod})).finally(()=>{t.requestRentalDates()});t.onRequestRent({startDate:o,endDate:a})})}),t.onRequestRent=function({startDate:a,endDate:r,componentId:n}){a&&r&&e.$emit(o.busNavigation.paymentDetailed,{startDate:a,endDate:r,productId:t.productId})},t.onDatesUpdated=(({startDate:a,endDate:r,componentId:n})=>{const i=n==t.rentPickersIds.desktop?t.rentPickersIds.mobile:t.rentPickersIds.desktop;e.$emit(o.busEvents.rentalRequestPickerUpdateDates,{startDate:a,endDate:r,componentId:i})}),t.browseCategory=((t,a)=>{e.$emit(o.busNavigation.browseCategory,{categoryName:t,subCategoryName:a})}),t.getCategoriesUrl=((e,o)=>m.getCategoriesUrl(e,o,t.product.Product_TryAndBuy,h.use())),t.onStartEndDateSelected=(({startDate:e,endDate:t})=>{});let I=[];I.push(e.$on(o.busEvents.categoriesUpdate,(e,o)=>{t.getCategory()})),t.fetchDetailedProduct(),t.promoTimeout=u(()=>{m.isCrawler()||null!=i.user||angular.element(document.body).hasClass("md-dialog-is-showing")||d.showLoginSignupPopup(!0)},S.referralCode?0:window.globals.PROMO_SIGNUP_TIMER),t.$on("$destroy",()=>{for(;I.length;)I.pop()();u.cancel(t.promoTimeout)});var C=y.hash();y.hash("main-product-image"),f(),y.hash(C)}])},function(e,t){angular.module("paladinApp").controller("PreviewController",["$scope","$sce","$window","$rootScope","$translate","$stateParams","$location","Products","ngMeta","$filter","$anchorScroll","ZendeskWidget","Filters","enums",function(e,t,o,a,r,n,i,s,l,c,d,u,g,p){var h=e;h.getCurrentLanguageCode=function(){return r.proposedLanguage()?r.proposedLanguage():r.preferredLanguage()},h.rating=0,h.ratingRounded=0,h.profileDefaultImage="../../assets/profile.png";var m=n.productId.split("-")[n.productId.split("-").length-1],f=n.languageCode?n.languageCode:h.getCurrentLanguageCode();l.setTag("currentUrl_en",i.absUrl().replace("/"+f+"/","/en/")),l.setTag("currentUrl_it",i.absUrl().replace("/"+f+"/","/it/")),l.setTag("currentUrl_de",i.absUrl().replace("/"+f+"/","/de/")),r.use(f),a.lang=f,u.setLocale(f),a.$broadcast("updateLanguage",f);a.searchedLocation;function y(){h.productDetail.Product_CategoryId&&(h.selectedCategoryName=g.getCategoryById(h.productDetail.Product_CategoryId,f).Category_Name),h.productDetail.Product_SubCategoryId&&(h.selectedSubCategoryName=g.getSubcategoryById(h.productDetail.Product_SubCategoryId,f).SubCategory_Name)}h.allCategory=r.instant("ACTG"),h.allCategory==h.selectedCategoryName&&(h.selectedCategoryName=null),h.selectedSubCategoryName=a.subcategory,h.productDetail={},h.productImageBaseUrl=window.globals.PRODUCT_IMAGE_URL,h.userImageBaseUrl=window.globals.PROFILE_IMAGE_URL,h.rentNowUrl=window.globals.RENT_NOW_URL,h.h1="",h.h2="",h.productAddress="",h.sample=1,h.fetchProductAddress=function(){var e={location:{}};e.location.lat=Number(h.productDetail.Product_Latitude),e.location.lng=Number(h.productDetail.Product_Longitude),geocoder=new google.maps.Geocoder;geocoder.geocode(e,function(e,t){e&&e.length>0&&(h.productLocation=e[0],h.setProductAddress(e[0]))})},h.setProductAddress=function(t){e.productDetail.productAddress=t.formatted_address,h.sample=2,h.productLocation=t,h.updateMetaTags(),e.$apply()},h.getCity=function(e){for(var t="",o=0;o<e.address_components.length;o++)for(var a=e.address_components[o].types,r=0;r<a.length;r++){var n=a[r];if("country"==n||"political"==n){e.address_components[o].long_name;break}if("administrative_area_level_1"==n){e.address_components[o].long_name;break}if("administrative_area_level_2"==n&&!t||"locality"==n){t=e.address_components[o].long_name;break}}return t},h.$on("languageChanged",function(e,t){i.update_path(i.path().replace("/"+f+"/","/"+t+"/"),!0),f=t,h.refreshProductDetail(),u.setLocale(f),y()}),h.getPageTitle=function(){var e=r.instant("RENT")+" ";return h.selectedCategoryName&&!h.selectedSubCategoryName?e+=h.selectedCategoryName+" ":h.selectedSubCategoryName&&(e+=h.selectedSubCategoryName+" "),h.productDetail&&h.productDetail.Product_Title&&(e+=h.productDetail.Product_Title+"  "),h.productLocation&&(e+=r.instant("IN")+" "+h.getCity(h.productLocation)),e},h.getMetaTags=function(){var e=r.instant("RENT")+" ";return h.selectedCategoryName&&(e+=h.selectedCategoryName+" "),h.selectedSubCategoryName&&(e+=h.selectedSubCategoryName+" "),h.productDetail&&h.productDetail.Product_Title&&(e+=h.productDetail.Product_Title+"  "),h.productLocation&&(e+=r.instant("IN")+" "+h.getCity(h.productLocation)),e},h.updateH1=function(){h.h1=r.instant("RENT")+" ",h.productDetail&&h.productDetail.Product_Title&&(h.h1+='<span class="greenText">'+h.productDetail.Product_Title+"</span> "),h.productLocation&&(h.h1+=r.instant("IN")+" "+h.getCity(h.productLocation)),h.h1=t.trustAsHtml(h.h1)},h.updateH2=function(){h.h2=h.getPageTitle()},h.updateMetaTags=function(){h.productDetail&&(l.setTitle(h.getPageTitle()),l.setTag("description",h.getMetaTags()),l.setTag("imagePath",window.globals.PRODUCT_IMAGE_URL+h.productDetail.ProductImage_Image1),h.updateH1(),S())},h.refreshProductDetail=function(){m&&s.getDetail(m,f,function(e){h.productDetail=e.data.Data,h.rating=h.productDetail.User_ReviewAsLender>0?parseFloat(h.productDetail.User_ReviewAsLender/2).toFixed(1):0,h.ratingRounded=Math.round(h.rating),h.fetchProductAddress(),a.categoriesMap?y():(a.categoriesMap=new Map,g.get("it",function(e){a.categoriesMap.set("it",e.data.Data),g.get("en",function(e){a.categoriesMap.set("en",e.data.Data),g.get("de",function(e){a.categoriesMap.set("de",e.data.Data),y(),h.updateMetaTags()})})}))})},h.goToAllCategory=function(){a.filter&&(a.filter.category.selectedCategoryId=null,a.filter.category.selectedCategoryDesc=null,a.filter.category.selectedCategoryName=r.instant("ACTG"),a.filter.category.selectedCategoryImagePath=null,a.filter.category.selectedCategoryBannerImage=p.categoriesBannersPaths.all,a.filter.category.selectedSubCategoryId=null,a.filter.category.selectedSubCategoryDesc=null,a.filter.category.selectedSubCategoryName=null,a.filter.category.selectedSubCategoryImagePath=null,a.filter.category.selectedSubCategoryBannerImage=null,a.filter.currentPage=1),i.search("key",null),i.url("/"+f+"/"+r.instant("ACTG").replace(/ /g,"-"))},h.goToCategory=function(){if(a.filter){var e=g.getCategoryById(h.productDetail.Product_CategoryId,f);a.filter.category.selectedCategoryId=h.productDetail.Product_CategoryId,a.filter.category.selectedCategoryDesc=t.trustAsHtml(e.Category_Description),a.filter.category.selectedCategoryName=e.Category_Name,a.filter.category.selectedCategoryImagePath=e.Category_ImagePath,a.filter.category.selectedCategoryBannerImage=e.Category_BannerPath,a.filter.category.selectedSubCategoryId=null,a.filter.category.selectedSubCategoryDesc=null,a.filter.category.selectedSubCategoryName=null,a.filter.category.selectedSubCategoryImagePath=null,a.filter.category.selectedSubCategoryBannerImage=null,a.filter.currentPage=1}i.search("key",null),i.url("/"+f+"/"+h.selectedCategoryName.replace(/ /g,"-"))},h.goToSubCategory=function(){if(a.filter){var e=g.getCategoryById(h.productDetail.Product_CategoryId,f);a.filter.category.selectedCategoryId=h.productDetail.Product_CategoryId,a.filter.category.selectedCategoryDesc=t.trustAsHtml(e.Category_Description),a.filter.category.selectedCategoryName=e.Category_Name,a.filter.category.selectedCategoryImagePath=e.Category_ImagePath,a.filter.category.selectedCategoryBannerImage=e.Category_BannerPath;var o=g.getSubcategoryById(h.productDetail.Product_SubCategoryId,f);a.filter.category.selectedSubCategoryId=h.productDetail.Product_SubCategoryId,a.filter.category.selectedSubCategoryDesc=t.trustAsHtml(o.SubCategory_Description),a.filter.category.selectedSubCategoryName=o.SubCategory_Name,a.filter.category.selectedSubCategoryImagePath=o.SubCategory_ImagePath,a.filter.category.selectedSubCategoryBannerImage=o.SubCategory_BannerPath,a.filter.currentPage=1}i.search("key",null),i.url("/"+f+"/"+h.selectedCategoryName.replace(/ /g,"-")+"/"+h.selectedSubCategoryName.replace(/ /g,"-"))},h.go=function(e){i.$$search={},i.path(e)},h.rentNow=function(){var e=h.rentNowUrl.replace("{0}",f).replace("{1}",h.productDetail.Product_Id);o.location.href=e},h.rentNowDesktop=function(){o.location.href=r.instant("URL_DOWNLOAD")};var S=function(){var e=i.hash();i.hash("breadcrumb-pr-detail"),d(),i.hash(e)};h.refreshProductDetail()}])},function(e,t){angular.module("paladinApp").controller("productReviewController",["$scope","$state","$location","$rootScope","appStateManager","apiService","productReviewService","toastService","$translate",function(e,t,o,a,r,n,i,s,l){let c={review:{text:null,rating:null}};c.booking=i.getBookingToReview(),c.isLoading=!1,c.onRating=(e=>{c.review.rating=e}),c.submitReview=((t=null)=>{if(!c.booking)return void console.error("Invalid booking: ",c.booking);if(void 0===c.review.stars)return void s.simpleToast(l.instant("REVIEW_VALIDATION_NO_STARS"));if(null===c.review.text)return void s.simpleToast(l.instant("REVIEW_VALIDATION_NO_COMMENT"));let o={Review_Precnt:2*c.review.stars,Review_ProductId:c.booking.Product_Id,Review_UserId:c.booking.Borrower_Id,LanguageCode:r.getCurrentLang(),ReviewDetail_Comment:c.review.text||"",Review_BookingId:c.booking.Booking_Id};n.reviews.submitTransactionReview(o).then(e=>{console.log("submit review result ",e),s.simpleToast(l.instant("REVIEW_ADDED_SUCCESS"))},e=>{s.simpleToast(l.instant("REVIEW_ADDED_FAILED")),console.error(e)}),e.vm.closeProductReview()}),c.closeProductReview=(()=>{i.leaveProductReviewPage()}),e.vm=c}])},function(e,t,o){"use strict";angular.module("paladinApp").controller("userBookingsController",["$rootScope","$scope","apiService","enums","appStateManager","ptLog","$mdMedia","ptUtils","moment",function(e,t,o,a,r,n,i,s,l){t.isLoading=!1,t.tabs=[{title:"BORROWED",content:"I am tab borrowed content",bookings:[]},{title:"LENT",content:"I am tab lent content",bookings:[]}],t.fetchUserBookings=(()=>{t.isLoading=!0,o.bookings.getUserBookings(r.getUserId()).then(e=>{t.tabs[0].bookings=e.Data.User_Booking_Borrower.map(e=>(e.lastModified=new Date(1e3*e.Last_Modified),e)).sort(s.sorters.bookingLastModifiedEpoch),t.tabs[1].bookings=e.Data.User_Booking_Lender.map(e=>(e.lastModified=new Date(1e3*e.Last_Modified),e)).sort(s.sorters.bookingLastModifiedEpoch),t.isLoading=!1}).catch(e=>{t.isLoading=!1,n.error(e)})}),t.fetchUserBookings(),t.bookingListItemClick=(t=>{e.$emit(a.busNavigation.transactionDetailed,{bookingId:t.Booking_Id})}),t.addNewItem=(()=>{e.$emit(a.busNavigation.newProduct)}),t.isGtMd=i("gt-md");let c=[];c.push(t.$watch(function(){return i("gt-md")},function(e){t.isGtMd=e})),t.$on("$destroy",()=>{for(;c.length;)c.pop()()})}])},function(e,t){angular.module("paladinApp").controller("userProfileController",["$rootScope","$scope","appStateManager","apiService","$stateParams","$state","toastService","enums","popupService","$translate","ptLog","ptUtils",function(e,t,o,a,r,n,i,s,l,c,d,u){console.log("userProfileController $scope ",t),t.isLoading=!1,t.isMyProfile=!1,t.isEditing=!1,t.isUpdating=!1,t.userId=r.userId,t.editableProfile=null,t.tempBas64Image=null,n.includes("app.profiles.myProfile")?(t.isMyProfile=!0,t.userId||(o.getUserId()?t.userId=o.getUserId():n.go("app.home"))):t.userId==o.getUserId()&&n.go("app.profiles.myProfile",{userId:t.userId}),t.fetchUserProfile=(()=>{t.profile=null,t.isLoading=!0;let{userId:e}=t;a.users.getUserProfile({userId:e}).then(e=>{t.profile=e.Data,p(),u.extractAndGeoLocateAddressFromObjectForFieldNames({object:t.profile,addressFieldName:"User_Address",latFieldName:"User_Latitude",lngFieldName:"User_Longitude"}).then(e=>{t.profile.User_Address=e.address}),t.isLoading=!1}).catch(e=>{t.isLoading=!1,i.simpleToast(e.data.Message||c.instant("DEFAULT_ERROR"))})}),t.editProfile=(()=>{let{User_Address:e,User_FullName:o}=t.profile;t.editableProfile=angular.copy(t.profile);const a=o.split(" ");t.editableProfile.userFirstName=a[0],t.editableProfile.userLastName=a.length>1?a[1]:"",t.isEditing=!0}),t.submitProfileEdit=(()=>{t.editableProfile.User_FullName=t.editableProfile.userFirstName+" "+(t.editableProfile.userLastName||"");const e=angular.copy(t.editableProfile);delete e.userFirstName,delete e.userLastName,t.isUpdating=!0,a.users.editProfile(e).then(()=>{a.users.updateNotificaton({userId:t.userId,emailNotif:e.Notification_Email||!1,chatNotif:e.Notification_Chat||!1}).then(e=>{location.reload()}).catch(e=>{t.isUpdating=!1,i.simpleToast(e.data.Message),console.error(e)})}).catch(e=>{t.isUpdating=!1,i.simpleToast(e.data.Message)})}),t.uploadImage=(()=>{angular.element(document.getElementById("uploadImageBtn"))[0].click()}),t.onUploaded=(e=>{i.simpleToast(c.instant("UPLOADING_IMAGE")),e&&e.files&&e.files.length>0&&canvasResize(e.files[0],{quality:75,isPreprocessing:!0,cardType:"",maxW:2048,maxH:2008,isiOS:u.isMobile.iOS(),callback:function(e,o,a){t.$evalAsync(()=>{t.editableProfile.User_DisplayPicture=e.split(",")[1],t.tempBas64Image=e,i.simpleToast(c.instant("IMAGE_UPLOADED"))})}})}),t.changePassword=(()=>{l.showChangePassword().then(()=>i.simpleToast(c.instant("PASSWORD_SUCCESSFULLY_CHANGED"))).catch(()=>d.log("pass change Canceled"))}),t.logout=(()=>{e.$emit(s.busEvents.userLogout)}),t.deleteAccount=(()=>{l.showConfirm(c.instant("WARN"),c.instant("DEL_ACCOUNT_CONFIRM_MESSAGE")).then(()=>{t.isLoading=!0,a.users.deleteAccount(t.userId).then(()=>{t.isLoading=!1,l.showAlert(c.instant("DEL_ACCOUNT"),c.instant("DEL_ACCOUNT_SUCCESS")).finally(()=>{e.$emit(s.busEvents.userLogout)})}).catch(e=>{t.isLoading=!1,l.showAlert(c.instant("DEL_ACCOUNT"),e.data.Message||c.instant("DEFAULT_ERROR")).finally(()=>{})})}).catch(()=>{})});let g=()=>{console.log("open share referral link popup ",l," .. ",t.referralLink),l.showShareReferralLink(t.credit.ReferralCode)},p=()=>{let{userId:e}=t;a.users.getUserCredit({userId:e}).then(e=>{console.log("user.credit ",e),t.credit=e.Data,t.credit.shareReferralLink=g},e=>{console.log("getUserCredit failed because: ",e)})};t.fetchUserProfile();let h=[];h.push(e.$on(s.busEvents.googlePlacesAutocompletePlaceChanged,(e,o)=>{if("editProfileAddressField"==o.elementId){let{place:e}=o,{geometry:a}=e;t.editableProfile.User_Latitude=a.location.lat(),t.editableProfile.User_Longitude=a.location.lng(),t.editableProfile.User_LocationId=e.id}})),t.$on("$destroy",()=>{for(;h.length;)h.pop()()})}])},function(e,t,o){"use strict";angular.module("paladinApp").controller("userVerificationController",["$rootScope","$scope","enums","apiService","appStateManager","toastService","uploadHandler","$timeout","ptUtils","acuantService","dataService","$stateParams","popupService","$base64","$translate","gtmService",function(e,t,o,a,r,n,i,s,l,c,d,u,g,p,h,m){u.bookingId&&(t.bookingId=u.bookingId),t.isLoading=!1,t.statusError=null,t.selectedUploadMethod=o.idVerificationMethod.passport,t.uploadMethods=[{title:"UPLOAD_METHOD_PASS",value:o.idVerificationMethod.passport},{title:"UPLOAD_METHOD_DL",value:o.idVerificationMethod.driverLicense},{title:"UPLOAD_METHOD_NATIONAL_ID",value:o.idVerificationMethod.id}],t.uploadData={};let f=[{elementId:"passportUpload",title:"TAP_TO_UPLOAD_PASS",imgData:null,isProcessingImg:!1,cardType:"Passport"},{elementId:"idSelfie",title:"TAKE_SELFIE",imgData:null,isProcessingImg:!1,cardType:""}],y=[{elementId:"driverLicenseFront",title:"DL_FRONT",imgData:null,isProcessingImg:!1,cardType:"DriversLicenseDuplex"},{elementId:"driverLicenseBack",title:"DL_BACK",imgData:null,isProcessingImg:!1,cardType:"DriversLicenseDuplex"},{elementId:"driverLicenseSelfie",title:"TAKE_SELFIE",imgData:null,isProcessingImg:!1,cardType:""}],S=[{elementId:"idFront",title:"NATIONAL_ID_FRONT",imgData:null,isProcessingImg:!1,cardType:"DriversLicenseDuplex"},{elementId:"idBack",title:"NATIONAL_ID_BACK",imgData:null,isProcessingImg:!1,cardType:"DriversLicenseDuplex"},{elementId:"idSelfie",title:"TAKE_SELFIE",imgData:null,isProcessingImg:!1,cardType:""}];t.selectUploadMethod=(e=>{t.selectedUploadMethod=e}),t.clickToUpload=(e=>{t.$$postDigest(()=>{angular.element(document.getElementById(e))[0].click()})});const I=()=>{t.uploadData[o.idVerificationMethod.passport]=angular.copy(f),t.uploadData[o.idVerificationMethod.driverLicense]=angular.copy(y),t.uploadData[o.idVerificationMethod.id]=angular.copy(S)};I(),t.verifyId=(async()=>{const{uploadData:e,selectedUploadMethod:i}=t;let s=!0;if(e[i].forEach(e=>{s=s&&void 0!=e.imgData&&void 0!=e.imgBlob}),s){t.isLoading=!0,t.statusError=null;try{if(i===o.idVerificationMethod.passport){const a=e[i][1].imgBlob,r=await c.processPassportImage({imageToProcess:e[i][0].imgBlob,imageSource:o.acuantImageSource.Other,usePreprocessing:!0});if(!r||!r.data)throw new Error("DEFAULT_ERROR");{const{WebResponseCode:e,WebResponseDescription:o,FaceImage:n}=r.data;if(1!=e)throw new Error(o);if(null==n||""==n)throw new Error("COULD_NOT_EXTRACT_IMAGE_FROM_DATA");{const e=goog.crypt.base64.encodeByteArray(n),o=l.dataUrlToBlob(`data:image/jpg;base64,${e}`),r=await c.processFacialMatch({idFaceImage:o,selfie:a}),{ResponseCodeAuthorization:i,ResponseMessageAuthorization:s,WebResponseCode:d,WebResponseDescription:u}=r.data;if(i<0)throw new Error(s);if(d<0)throw new Error(u);t.uploadVerifiedImageToPaladinServers()}}}else if(i===o.idVerificationMethod.driverLicense||i===o.idVerificationMethod.id){const a=e[i][0].imgBlob,r=e[i][1].imgBlob,n=e[i][2].imgBlob,s=await c.processNICDLDuplexImage({frontImage:a,backImage:r,selectedRegion:o.acuantRegions.Europe,imageSource:o.acuantImageSource.Other,usePreprocessing:!0}),{ResponseCodeAuthorization:d,ResponseMessageAuthorization:u,ResponseCodeAutoDetectState:g,ResponseCodeAutoDetectStateDesc:p,ResponseCodeProcState:h,ResponseCodeProcessStateDesc:f,WebResponseCode:y,WebResponseDescription:S,FaceImage:I}=s.data;if(d<0)throw new Error(u);if(g<0)throw new Error(p);if(h<0)throw new Error(f);if(y<0)throw new Error(S);if(null==I||""==I)throw new Error("COULD_NOT_EXTRACT_IMAGE_FROM_DATA");{const e=goog.crypt.base64.encodeByteArray(I),o=l.dataUrlToBlob(`data:image/jpg;base64,${e}`),a=await c.processFacialMatch({idFaceImage:o,selfie:n}),{ResponseCodeAuthorization:r,ResponseMessageAuthorization:i,WebResponseCode:s,WebResponseDescription:d}=a.data;if(r<0)throw new Error(i);if(s<0)throw new Error(d);t.uploadVerifiedImageToPaladinServers(),m.trackEvent("id-verification","id-verification-successful")}}else new Error("Operation not supported")}catch(s){t.isLoading=!1,m.trackEvent("id-verification","id-verification-failed"),console.log("requestManualVerification ",t),i===o.idVerificationMethod.passport?a.verification.sendToManualVerification({passportImage:e[i][0].imgData.split(",")[1],selfie:e[i][1].imgData.split(",")[1],userId:r.getUserId(),bookingId:t.bookingId}).then(e=>{t.finishVerificationManual(),n.simpleToast(h.instant("ID_VERIFY_FAIL_POPUP_ON_SUCCESS"))},e=>{console.log("sendToManualVerification error",e),I(),n.simpleToast(h.instant("ID_VERIFY_FAIL_POPUP_ON_FAIL"))}):i!==o.idVerificationMethod.driverLicense&&i!==o.idVerificationMethod.id||a.verification.sendToManualVerification({NICDLFront:e[i][0].imgData.split(",")[1],NICDLBack:e[i][1].imgData.split(",")[1],selfie:e[i][2].imgData.split(",")[1],userId:r.getUserId(),bookingId:t.bookingId}).then(e=>{t.finishVerificationManual(),n.simpleToast(h.instant("ID_VERIFY_FAIL_POPUP_ON_SUCCESS"))},e=>{console.log("sendToManualVerification err",e),I(),n.simpleToast(h.instant("ID_VERIFY_FAIL_POPUP_ON_FAIL"))}),t.$apply()}}else n.simpleToast(h.instant("UPLOAD_MISSING_DOCS"))}),t.uploadVerifiedImageToPaladinServers=(async()=>{const{uploadData:e,selectedUploadMethod:n}=t;if(n===o.idVerificationMethod.passport){const o=e[n][0].imgData.split(",")[1],i=e[n][1].imgData.split(",")[1],s=await a.verification.uploadPassport({passportImage:o,selfie:i,userId:r.getUserId()});if(!s||"success"!==s.Status)throw new Error(s.Message||"DEFAULT_ERROR");t.finishVerification()}else if(n===o.idVerificationMethod.driverLicense||n===o.idVerificationMethod.id){const o=e[n][0].imgData.split(",")[1],i=e[n][1].imgData.split(",")[1],s=e[n][2].imgData.split(",")[1],l=await a.verification.uploadNICDL({NICDLFront:o,NICDLBack:i,selfie:s,userId:r.getUserId()});if(!l||"success"!==l.Status)throw new Error(l.Message||"DEFAULT_ERROR");t.finishVerification()}}),t.finishVerification=(()=>{t.isLoading=!1,t.statusError=null,g.showAlert("SUCCESS","ID_SUCCESSFULLY_VERIFIED").finally(()=>{t.bookingId?e.$emit(o.busNavigation.transactionDetailed,{bookingId:t.bookingId,replace:!0}):e.$emit(o.busNavigation.userProfile,{userId:r.getUserId()})})}),t.finishVerificationManual=(()=>{t.isLoading=!1,t.statusError=null,l.isMobile.any()?t.bookingId?e.$emit(o.busNavigation.transactionDetailed,{bookingId:t.bookingId,replace:!0}):e.$emit(o.busNavigation.userProfile,{userId:r.getUserId()}):g.showAlert("ID_VER_MANUAL_POPUP","ID_VER_MANUAL_POPUP_TEXT").finally(()=>{t.bookingId?e.$emit(o.busNavigation.transactionDetailed,{bookingId:t.bookingId,replace:!0}):e.$emit(o.busNavigation.userProfile,{userId:r.getUserId()})})}),t.skipVerification=(()=>{e.$emit(o.busNavigation.transactionDetailed,{bookingId:t.bookingId,replace:!0})}),t.onUploaded=(e=>{if(e.files&&e.files.length>0){const{uploadData:o,selectedUploadMethod:a}=t,r=o[a].findIndex(t=>t.elementId===e.id);void 0!=r&&t.$evalAsync(()=>{o[a][r].isProcessingImg=!0,canvasResize(e.files[0],{quality:75,isPreprocessing:!0,cardType:o[a][r].cardType,maxW:2048,maxH:2008,isiOS:l.isMobile.iOS(),callback:function(e,n,i){t.$evalAsync(()=>{o[a][r].imgData=e,o[a][r].imgBlob=l.dataUrlToBlob(e),o[a][r].isProcessingImg=!1})}})})}}),t.showToast=((e,t=3e3)=>{$mdToast.show($mdToast.simple().textContent(e).hideDelay(t))})}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("authedAction",["$rootScope","enums","appStateManager","popupService",function(e,t,o,a){return{restrict:"A",link:function(r,n,i){const s=document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.height="100%",s.style.width="100%",s.style.cursor="pointer",s.onclick=(()=>{a.showLoginSignupPopup(!1).finally(()=>{}),c=!0}),n[0].classList.add("forceRelativePosition");let l=!1,c=!1;const d=()=>{o.getUserId()?l&&(l=!1,n[0].removeChild(s),c&&location.reload()):l||(l=!0,n[0].appendChild(s))};d();let u=[];u.push(e.$on(t.busEvents.updatedUser,(e,t)=>{d()})),r.$on("$destroy",()=>{for(;u.length;)u.pop()()})}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("bookingCoupon",["$rootScope","enums","apiService","appStateManager","ptUtils",function(e,t,o,a,r){return{restrict:"E",templateUrl:"./views/templates/bookingCoupon.tpl.html",scope:{onCouponValidation:"&"},link:function(e,t,r){e.isAddingCoupon=!1,e.isLoading=!1,e.error=null,e.coupon={code:""},e.addCoupon=(()=>{e.isAddingCoupon=!0}),e.cancel=(()=>{e.isAddingCoupon=!1}),e.validateCoupon=(()=>{e.isLoading=!0;const t=a.getUserId(),r=e.coupon.code;o.payments.verifyCoupon({userId:t,coupon:r}).then(t=>{e.isLoading=!1,e.onCouponValidation()(t.Data),e.isAddingCoupon=!1,e.coupon.code=""}).catch(t=>{e.isLoading=!1,e.error=t.data.Message||"PLEASE_INSERT_VALID_COUPON"})})}}}])},function(e,t){angular.module("paladinApp").directive("bookingDatePicker",["$rootScope","moment","popupService","ptUtils","$mdMedia",function(e,t,o,a,r){return{restrict:"E",templateUrl:"./views/templates/bookingDatePicker.tpl.html",scope:{resultCallback:"&",defaultValue:"=?",startDate:"=?",endDate:"=?",dateRange:"=?",productBookingDetails:"=?",product:"=?"},link:function(e,n,i){const s=()=>{null!=e.productBookingDetails&&(l=a.getBookedDateRanges(e.productBookingDetails))};let l=[];s(),e.isDateAvailable=(e=>{const o=t(e);for(let e=0;e<l.length;e++)if(o.isBetween(l[e].startDate,l[e].endDate)||o.isSame(l[e].startDate)||o.isSame(l[e].endDate))return!0;return!t().isBefore(e)}),e.startDate=e.startDate||void 0,e.endDate=e.endDate||void 0,e.dateRange={},e.advancedModel={selectedTemplate:"Last 3 Days"},e.pickerModel={selectedTemplate:!1,dateStart:e.startDate,dateEnd:void 0},e.pickerTranslations=a.getTranslationDictForDatePicker(),e.selectDate=(()=>{r("gt-sm")?e.$$postDigest(()=>{angular.element(document.querySelector(`#${n[0].id} #desktopPicker span.md-select-value`))[0].click()}):o.showDateRangePicker(e.productBookingDetails,e.product).then(o=>{e.resultCallback&&e.resultCallback()({startDate:t(o.dateStart),endDate:t(o.dateEnd)})}).catch(()=>console.log("canceled date picking"))}),e.onDesktopSelect=(o=>{if(o&&o.length>0){const a=t(o[0]),r=t(o[o.length-1]);e.pickerModel.dateStart=void 0,e.pickerModel.dateEnd=void 0,e.resultCallback&&e.resultCallback()({startDate:t(a),endDate:t(r)})}});let c=[];c.push(e.$watch("productBookingDetails",()=>{s()})),e.$on("$destroy",()=>{for(;c.length;)c.pop()()})}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("bookingDetailedCtaButton",["$rootScope","enums","appStateManager","apiService","ptUtils","toastService","ptLog","transactionService","productReviewService",function(e,t,o,a,r,n,i,s,l){return{restrict:"E",templateUrl:"./views/templates/bookingDetailedCTAButton.tpl.html",scope:{booking:"="},link:function(a,n,i){a.btns=[];a.init=(()=>{const n=o.getUserId(),i=a.booking.Lender_Id==n,c=a.booking.BookingStatus[a.booking.BookingStatus.length-1].Status_TrackId;let{color:d,text:u}=r.getDisplayDataForTransactionStatus(c);a.mainColor=d,((o,r,n,i)=>{switch(a.btns=[],o){case t.productRentalStatus.notVerified:r||a.btns.push({text:"VERIFY_ID",BL:o=>{e.$emit(t.busNavigation.idVerification,{bookingId:o.Booking_Id})},isEnabled:!0});break;case t.productRentalStatus.requested:r?(a.btns.push({text:"DECLINE_REQUEST",BL:e=>s.rejectRental(e,!0),isEnabled:!0,isDestructive:!0}),a.btns.push({text:"ACCEPT_REQUEST",BL:e=>s.acceptRental(e),isEnabled:!0})):a.btns.push({text:"CANCEL_REQUEST",BL:e=>s.rejectRental(e,!1),isEnabled:!0,isDestructive:!0});break;case t.productRentalStatus.canceled:r||a.btns.push({text:"REQUEST_AGAIN",BL:o=>e.$emit(t.busNavigation.productDetailed,{product:o}),isEnabled:!0});break;case t.productRentalStatus.accepted:r?a.btns.push({text:"CANCEL_BOOKING",BL:e=>s.cancelRental(e,!0),isEnabled:!0,isDestructive:!0}):(a.btns.push({text:"CANCEL_BOOKING",BL:e=>s.cancelRental(e,!1),isEnabled:!0,isDestructive:!0}),a.btns.push({text:"START_RENTAL",BL:e=>s.startRental(e),isEnabled:!0}));break;case t.productRentalStatus.timeout:r||(n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByBorrower&&n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByBoth?a.btns.push({text:"REVIEW_LENDER",BL:e=>l.startReviewFlow(e,!0),isEnabled:!0}):a.btns.push({text:"REQUEST_AGAIN",BL:o=>e.$emit(t.busNavigation.productDetailed,{product:o}),isEnabled:!0}));break;case t.productRentalStatus.denied:a.btns.push({text:"REQUEST_AGAIN",BL:o=>e.$emit(t.busNavigation.productDetailed,{product:o}),isEnabled:!0});break;case t.productRentalStatus.canceledByLender:r||i||a.btns.push({text:"REVIEW_LENDER",BL:e=>l.startReviewFlow(e,!0),isEnabled:!0});break;case t.productRentalStatus.criticalCancel:case t.productRentalStatus.moderateCancel:r&&a.btns.push({text:"REVIEW_BORROWER",BL:e=>l.startReviewFlow(e,!1),isEnabled:!0});break;case t.productRentalStatus.started:r?a.btns.push({text:"END_RENTAL",BL:e=>s.endRental(e),isEnabled:!0}):i&&a.btns.push({text:"BUY_NOW",BL:o=>e.$emit(t.busNavigation.paymentDetailed,{productId:o.Product_Id,purchase:!0,bookingId:o.Booking_Id}),isEnabled:!0});break;case t.productRentalStatus.ended:r?(n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByLender&&n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByBoth&&a.btns.push({text:"REVIEW_BORROWER",BL:e=>l.startReviewFlow(e,!1),isEnabled:!0}),n.Lender_StripeAccount||a.btns.push({text:"CREATE_STRIPE_ACCOUNT",BL:e=>s.endRentalForStripeAccountOnly(e),isEnabled:!0})):(n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByBorrower&&n.Booking_ReviewStatus!=t.bookingReviewStatus.reviewByBoth?a.btns.push({text:"REVIEW_LENDER",BL:e=>l.startReviewFlow(e,!0),isEnabled:!0}):a.btns.push({text:"REQUEST_AGAIN",BL:o=>e.$emit(t.busNavigation.productDetailed,{product:o}),isEnabled:!0}),i&&a.btns.push({text:"BUY_NOW",BL:o=>e.$emit(t.busNavigation.paymentDetailed,{productId:o.Product_Id,purchase:!0,bookingId:o.Booking_Id}),isEnabled:!0}));break;case t.productRentalStatus.timeoutByBorrower:r&&a.btns.push({text:"REVIEW_BORROWER",BL:()=>l.startReviewFlow(n,!1),isEnabled:!0})}})(c,i,a.booking,a.booking.IsTryAndBuy)}),a.ctaClicked=(()=>{}),a.init()}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("bookingDetailedStatus",["$rootScope","enums","appStateManager","apiService","ptUtils",function(e,t,o,a,r){return{restrict:"E",templateUrl:"./views/templates/bookingDetailedStatus.tpl.html",scope:{booking:"="},link:function(e,o,a){e.prices=[],e.youWontBeChargedText=void 0;e.booking&&e.booking.BookingStatus&&e.booking.BookingStatus.length>0&&(e.youWontBeChargedText=e.booking.BookingStatus[e.booking.BookingStatus.length-1].Status_TrackId==t.productRentalStatus.requested?"YOU_WONT_BE_CHARGED_MSG":void 0),r.calculatePriceingListForBooking(e.booking).then(t=>{e.$evalAsync(()=>{e.prices=t})})}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("bookingListItem",["$rootScope","enums","appStateManager",function(e,t,o){return{restrict:"E",templateUrl:"./views/templates/bookingsListItem.tpl.html",scope:{booking:"=",isLent:"=?"},link:function(e,t,a){e.isLent=o.getUserId()==e.booking.Lender_Id}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("bookingTrackerInfo",["$rootScope","enums","appStateManager","apiService","ptUtils","$sce","$translate","productReviewService",function(e,t,o,a,r,n,i,s){return{restrict:"E",templateUrl:"./views/templates/bookingTrackerInfo.tpl.html",scope:{booking:"="},link:function(e,a,n){const i=e=>r.parseBookingStepTutorialHTMLTemplateForTranslationId(e);e.getStaticBookingStepsP2P=(e=>e?[{label:"BOOKING_TRACK_INFO_REQUEST_RECEIVED",status:t.trackingStep.pending,description:i("BookingStatusRequested_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.requested]},{label:"BOOKING_TRACK_INFO_REQUEST_ACCEPTED",status:t.trackingStep.pending,description:i("BookingStatusAccepted_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.accepted]},{label:"BOOKING_TRACK_INFO_START",status:t.trackingStep.pending,description:i("BookingStatusStarted_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.started]},{label:"BOOKING_TRACK_INFO_END",status:t.trackingStep.pending,description:i("BookingStatusEnded_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.ended]}]:[{label:"BOOKING_TRACK_INFO_CARD_VERIFICATION",status:t.trackingStep.failure,description:i("BookingStatusNotVerified_Borrower"),date:void 0,isCurrent:!0,rentalStatus:[t.productRentalStatus.verified,t.productRentalStatus.verifying]},{label:"BOOKING_TRACK_INFO_REQUEST_SENT",status:t.trackingStep.pending,description:i("BookingStatusRequested_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.requested]},{label:"BOOKING_TRACK_INFO_AWAIT_ACCEPT",status:t.trackingStep.pending,description:i("BookingStatusAccepted_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.accepted]},{label:"BOOKING_TRACK_INFO_START",status:t.trackingStep.pending,description:i("BookingStatusStarted_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.started]},{label:"BOOKING_TRACK_INFO_END",status:t.trackingStep.pending,description:i("BookingStatusEnded_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.ended]}]),e.getStaticBookingStepsTnB=(e=>e?[{label:"BOOKING_TRACK_INFO_BOOKED",status:t.trackingStep.pending,description:i("BookingStatusBooked_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.booked]},{label:"BOOKING_TRACK_INFO_START",status:t.trackingStep.pending,description:i("BookingStatusStarted_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.started]},{label:"BOOKING_TRACK_INFO_END",status:t.trackingStep.pending,description:i("BookingStatusEnded_Lender"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.ended]}]:[{label:"BOOKING_TRACK_INFO_CARD_VERIFICATION",status:t.trackingStep.failure,description:i("BookingStatusNotVerified_Borrower_TnB"),date:void 0,isCurrent:!0,rentalStatus:[t.productRentalStatus.verified,t.productRentalStatus.verifying]},{label:"BOOKING_TRACK_INFO_BOOKED",status:t.trackingStep.pending,description:i("BookingStatusBooked_Borrower"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.booked]},{label:"BOOKING_TRACK_INFO_START",status:t.trackingStep.pending,description:i("BookingStatusStarted_Borrower_TnB"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.started]},{label:"BOOKING_TRACK_INFO_END",status:t.trackingStep.pending,description:i("BookingStatusEnded_Borrower_TnB"),date:void 0,isCurrent:!1,rentalStatus:[t.productRentalStatus.ended]}]);t.productRentalStatus.timeout,t.productRentalStatus.denied,t.productRentalStatus.canceled,t.productRentalStatus.criticalCancel,t.productRentalStatus.moderateCancel;e.setStaticStepAtIndexAsCurrent=((e,t)=>{e.forEach((e,o)=>{e.isCurrent=o===t})}),e.getCurrentStep=(()=>e.steps.find(e=>1==e.isCurrent)),e.updateSteps=(o=>{let a=e.booking.BookingStatus;if(a[a.length-1].Status_TrackId==t.productRentalStatus.verifying){let n=a[a.length-1];return o[0].status=t.trackingStep.pending,o[0].date=r.stringToDate(`${n.CreatedDate} ${n.CreatedTime}`),o[0].label="BOOKING_TRACK_INFO_ID_VERIFICATION",o[0].description=i("BookingStatusVerifying_Borrower"),e.setStaticStepAtIndexAsCurrent(o,0),o}for(let n=0;n<a.length;n++){let i=a[n];for(let s=0;s<o.length;s++)if(o[s].rentalStatus.includes(i.Status_TrackId)){o[s].status=t.trackingStep.success,o[s].date=r.stringToDate(`${i.CreatedDate} ${i.CreatedTime}`),n==a.length-1&&e.setStaticStepAtIndexAsCurrent(o,s);break}}return o}),e.init=(()=>{e.userId=o.getUserId(),e.isLender=e.userId==e.booking.Lender_Id,e.isTryAndBuy=e.booking.IsTryAndBuy;let t=angular.copy(e.booking.IsTryAndBuy?e.getStaticBookingStepsTnB(e.isLender):e.getStaticBookingStepsP2P(e.isLender));e.steps=e.updateSteps(t)}),e.init()}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("chatCtaButton",["$rootScope","enums","apiService","appStateManager","toastService","chatService","$translate",function(e,t,o,a,r,n,i){return{restrict:"E",templateUrl:"./views/templates/chatCTAButton.tpl.html",scope:{product:"=",productBookingDetails:"=",booking:"=?"},link:function(o,s,l){o.userId=a.getUserId(),o.startChat=(()=>{o.isLoading=!0;const{Chat_QBRoomId:a,Lender_UserId:s,Product_Id:l,Product_Title:c}=o.product,{Borrower_QBId:d,Lender_QBId:u}=o.productBookingDetails;let g=o.userId,p=void 0;o.booking&&(p=o.booking.Booking_Id,g=o.booking.Borrower_Id),n.createOrStartChat({lenderId:s,borrowerId:g,lenderQBId:u,borrowerQBId:d,chatRoomId:a,bookingId:p,productId:l,productName:c}).then(a=>{o.isLoading=!1,console.log(a),e.$emit(t.busNavigation.chat,{chatId:a.Chat_QBRoomId})}).catch(e=>{o.isLoading=!1,console.error(e),r.simpleToast(i.instant("DEFAULT_ERROR"))})})}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("chatDetailed",["$rootScope","apiService","appStateManager","enums","chatService","$mdSidenav","toastService","ptUtils",function(e,t,o,a,r,n,i,s){return{restrict:"E",templateUrl:"./views/templates/chatDetailed.tpl.html",scope:{chatId:"=?"},link:function(l,c,d){l.chat=null,l.bookingId=null,l.messages=[],l.compose={text:"",img:null},l.isUploadingMedia=!1,l.userImages={me:void 0,recipient:void 0},l.canLoadMoreMsgs=!0;let u=[];l.setSelectedChat=((e,t=!1)=>{e?(e!=l.chatId||t)&&(l.chatId=e,l.chat&&l.chat.Chat_QBRoomId&&r.leaveChat(l.chat.Chat_QBRoomId),l.getDetailedChat()):l.chat&&l.chat.Chat_QBRoomId&&r.leaveChat(l.chat.Chat_QBRoomId)}),l.goToProduct=(()=>{e.$emit(a.busNavigation.productDetailed,{product:l.product})}),l.goToRental=(()=>{e.$emit(a.busNavigation.transactionDetailed,{bookingId:l.bookingId})}),l.getDetailedChat=(()=>{l.bookingId=null,l.isLoading=!0,r.getChatDetailed(l.chatId).then(e=>{l.chat=e,e.BookingList&&e.BookingList.length>0&&e.BookingList[0].BookingId&&(l.bookingId=e.BookingList[0].BookingId),l.userImages.me=o.user.User_DisplayPicturePath,l.userImages.recipient=e.Lender_UserId==o.user.User_Id?e.Borrower_ProfileImage:e.Lender_ProfileImage,r.joinChat(l.chat.Chat_QBRoomId).then(()=>{l.getDetailedProduct()}).catch(e=>{console.log("Failed to join chat",e),l.chat=null,l.chatId=null,l.isLoading=!1,i.simpleToast($translate.instant("FAILED_JOIN_CHAT"))})}).catch(e=>{l.isLoading=!1,l.chatId=null})}),l.getDetailedProduct=(()=>{const{Product_Id:e}=l.chat;t.products.getDetailedProduct(e).then(e=>{l.product=e.Data,l.getChatHistory()}).catch(e=>{l.chat=null,l.isLoading=!1})}),l.getChatHistory=(()=>{r.getChatHistory(l.chat.Chat_QBRoomId,0).then(e=>{r.clearUnreadBadgesForDialog(l.chat.Chat_QBRoomId),l.$evalAsync(()=>{l.canLoadMoreMsgs=!0,l.messages=e,l.isLoading=!1})}).catch(e=>{l.$evalAsync(()=>{l.messages=[],l.isLoading=!1})})}),l.loadMoreMessages=(()=>{!l.isGettingMoreMsgs&&l.canLoadMoreMsgs&&(l.isGettingMoreMsgs=!0,console.log("loadMoreMessages"),r.getChatHistory(l.chat.Chat_QBRoomId,l.messages.length).then(e=>{0==e.length&&(l.canLoadMoreMsgs=!1),l.isGettingMoreMsgs=!1,l.messages=e.concat(l.messages)}).catch(e=>{l.isGettingMoreMsgs=!1}))}),l.toggleNav=(()=>{n(a.inAppSideNavsIds.chatSideNav).toggle()}),l.sendMessage=(()=>{r.sendMessage({dialogId:l.chat.Chat_QBRoomId,text:l.compose.text,productId:l.chat.Product_Id,input:null}),l.compose.text=""}),l.keyPress=(e=>{13!=e.which||e.shiftKey||(e.preventDefault(),""!=l.compose.text?l.sendMessage():s.playErrorSound())}),l.uploadMedia=(()=>{l.$$postDigest(()=>{angular.element(document.getElementById("chatMediaUpload"))[0].click()})}),l.onUploaded=(e=>{l.$evalAsync(()=>{l.isUploadingMedia=!0,e&&e.files&&e.files.length>0&&r.sendMessage({dialogId:l.chat.Chat_QBRoomId,text:null,input:e}).then(()=>{l.$evalAsync(()=>{l.isUploadingMedia=!1})}).catch(e=>{l.$evalAsync(()=>{l.isUploadingMedia=!1}),alert("error! upload again!")})})}),u.push(e.$on(a.busChatEvents.detailedChatSelected,(e,t)=>{l.toggleNav(),t&&t.chatId?l.setSelectedChat(t.chatId):l.setSelectedChat(null)})),u.push(e.$on(a.busChatEvents.newMessage,(e,t)=>{l.messages.push(t),r.clearUnreadBadgesForDialog(l.chat.Chat_QBRoomId),l.$apply()})),u.push(e.$on(a.busChatEvents.selectPendingChat,(e,t)=>{l.setSelectedChat(t.chatId,!0)})),l.$on("$destroy",function(){for(;u.length>0;)u.pop()()})}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("chatListMessageItem",[function(){return{restrict:"E",templateUrl:"./views/templates/chatListMessageItem.tpl.html",scope:{myImage:"=?",recipientImage:"=?",message:"="},link:function(e,t,o){}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("chatsList",["$rootScope","enums","chatService","appStateManager",function(e,t,o,a){return{restrict:"E",templateUrl:"./views/templates/chatsList.tpl.html",link:function(r,n,i){r.currentPage=0,r.isLoading=!0,r.canLoadMore=!0;let s=!1;r.chats=[],r.unreadDict={},r.selectedChatId=null,r.loadChatsList=((e=!0)=>{r.isLoading=!0,o.getChatList(a.getUserId(),r.currentPage).then(t=>{r.$evalAsync(()=>{r.isLoading=!1,s=!1,e?(r.chats=t,r.currentPage=0,r.canLoadMore=!0):t.length>0?(r.chats=r.chats.concat(t),r.currentPage++):r.canLoadMore=!1}),o.getUnreadMessage().then(e=>{r.unreadDict=e||{}}).catch(()=>r.unreadDict={})}).catch(e=>{r.isLoading=!1})}),r.onChatListItemClicked=(o=>{console.log(o),r.selectedChatId!=o.Chat_QBRoomId&&(r.selectedChatId=o.Chat_QBRoomId,e.$emit(t.busChatEvents.detailedChatSelected,{chatId:o.Chat_QBRoomId}))}),e.$on(t.busChatEvents.updateUnreadCount,(e,t)=>{r.unreadDict=t.detailedDict||{}});let l=[];l.push(e.$on(t.busChatEvents.selectPendingChat,(e,t)=>{r.selectedChatId=t.chatId})),r.loadMore=(()=>{r.canLoadMore&&(s||(s=!0,console.log("$scope.canLoadMore"),r.loadChatsList(!1)))}),r.loadChatsList(!0),r.$on("$destroy",function(){for(;l.length>0;)l.pop()()})}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("contactLenderOrBorrower",["$rootScope","enums","appStateManager",function(e,t,o){return{restrict:"E",templateUrl:"./views/templates/contactLenderOrBorrower.tpl.html",scope:{isTitleHidden:"=?",isDescriptionHidden:"=?",product:"=?",productBookingDetails:"=?",booking:"=?"},link:function(e,t,a){e.isTitleHidden=e.isTitleHidden||!1,e.isDescriptionHidden=e.isDescriptionHidden||!1,e.displayedUser={username:null,profilePic:null,id:null,stars:void 0,reviews:void 0};const r=()=>{const t=e.product||{};e.isMyProduct=t.Lender_UserId==o.getUserId(),e.isCanStartChat=!e.isMyProduct||null!=e.booking,e.titleText=e.isMyProduct?"CONTACT_BORROWER":"CONTACT_LENDER",e.isMyProduct?e.booking?(e.displayedUser.username=e.booking.Borrower_Name,e.displayedUser.profilePic=e.booking.Borrower_Image,e.displayedUser.id=e.booking.Borrower_Id,e.displayedUser.stars=e.booking.Borrower_ReviewScore,e.displayedUser.reviews=e.booking.Borrower_ReviewCount):e.isCanStartChat=!1:e.product?(e.displayedUser.username=t.Lender_FullName,e.displayedUser.profilePic=t.Lender_User_DisplayPicturePath,e.displayedUser.id=t.Lender_UserId,e.displayedUser.stars=t.User_ReviewAsLender,e.displayedUser.reviews=t.User_ReviewCountAsLender):e.isCanStartChat=!1};let n=[];n.push(e.$watch("product",()=>{r()})),n.push(e.$watch("productBookingDetails",()=>{r()})),n.push(e.$watch("booking",()=>{r()})),r(),e.$on("$destroy",function(){for(;n.length;)n.pop()()})}}}])},function(e,t){angular.module("paladinApp").directive("copyTextToClipboard",["$mdToast",function(e){return{restrict:"A",link:function(t,o,a){$(o).click(()=>{let t=a.copyTextToClipboard;if(document.selection)(o=document.body.createTextRange()).moveToElementText(document.getElementById(t)),o.select().createTextRange(),document.execCommand("copy"),e.showSimple("Text copied to clipboard");else if(window.getSelection){var o;(o=document.createRange()).selectNode(document.getElementById(t)),window.getSelection().addRange(o),document.execCommand("copy"),console.info("text copied"),e.showSimple("Text copied to clipboard")}})}}}])},function(e,t,o){angular.module("paladinApp").component("filters",{bindings:{categories:"<",filter:"=",count:"="},controller:class{constructor(e,t,o,a,r,n,i){this.scope=e,this.Filters=o,this.translate=r,this.enums=i,this.rootScope=a,this.categoryImageBaseUrl=window.globals.CATEGORY_IMAGE_URL,this.location=n,this.sce=t,this.slider={},this.showCategoriesDiv=!1,this.slider.priceSliderOption={options:{orientation:"horizontal",min:0,max:240,step:10,range:!0}},this.slider.distanceSliderOption={options:{orientation:"horizontal",min:0,max:240,step:10,range:!1}}}$onInit(){this.scope.priceRange=[0,1e3],this.count=0,this.selectedTab=1==this.filter.category.isTryAndBuy?0:1,this.customCategoriesTnB=this.getCategories(!0),this.customCategoriesP2P=this.getCategories(!1);var e=this;this.scope.$watch("priceRange",function(){e.filter.priceRange[0]==e.scope.priceRange[0]&&e.filter.priceRange[1]==e.scope.priceRange[1]||(e.filter.priceRange=e.scope.priceRange,e.refreshProducts())}),this.scope.$on("languageChanged",function(t,o){e.filter.languageCode=e.getCurrentLanguageCode(),null!=e.filter.category.selectedSubCategoryId?e.refreshCategories(e.filter.category.selectedCategoryId,e.filter.category.selectedSubCategoryId,e.filter.languageCode):null!=e.filter.category.selectedCategoryId?e.refreshCategories(e.filter.category.selectedCategoryId,null,e.filter.languageCode):e.refreshCategories(null,null,e.filter.languageCode)})}selectCategories(e,t,o){null==e?this.selectCategory(this.enums.allCategories[o],!1):(this.selectCategory(this.Filters.getCategoryById(e,o),!1),null!=t&&this.selectSubCategory(this.Filters.getSubcategoryById(t,o),!1))}refreshCategories(e,t,o){this.filter.categories=this.rootScope.categoriesMap.get(o),this.selectCategories(e,t,o)}getCategories(e){let t={},o=0;return this.rootScope.categoriesMap.get(this.getCurrentLanguageCode()).forEach(a=>{(e&&a.IsTryAndBuy||!e&&!a.IsTryAndBuy)&&(t[o++]=a)}),t}toggleDiv(){this.showCategoriesDiv=!this.showCategoriesDiv}getCurrentLanguageCode(){return this.translate.use()}selectCategory(e,t){"string"!=typeof e?(this.filter.category.selectedCategoryId=e.Category_Id,this.filter.category.selectedCategoryDesc=this.sce.trustAsHtml(e.Category_Description),this.filter.category.selectedCategoryName=this.sce.trustAsHtml(e.Category_Name),this.filter.category.selectedCategoryImagePath=e.Category_ImagePath,this.filter.category.selectedCategoryBannerImage=e.Category_BannerPath,this.filter.category.isTryAndBuy=e.IsTryAndBuy,this.rootScope.category=this.filter.category.selectedCategoryName):(this.filter.category.selectedCategoryId=null,this.filter.category.selectedCategoryDesc=this.sce.trustAsHtml(e),this.filter.category.selectedCategoryName=e,this.filter.category.selectedCategoryImagePath=null,this.filter.category.isTryAndBuy=this.rootScope.isTryAndBuy,this.filter.category.selectedCategoryBannerImage=window.globals.IS_PROMO?this.enums.categoriesBannersPaths.promo:this.enums.categoriesBannersPaths.all[this.getCurrentLanguageCode()],this.rootScope.category=e),this.selectSubCategory(null,!1),t&&this.refreshProducts()}onTabSelected(){0==this.selectedTab?this.rootScope.$emit(this.enums.busNavigation.switchBrowseMode,{isTryAndBuy:!0}):this.rootScope.$emit(this.enums.busNavigation.switchBrowseMode,{isTryAndBuy:!1})}selectSubCategory(e,t){e?(this.filter.category.selectedSubCategoryId=e.SubCategory_Id,this.filter.category.selectedSubCategoryDesc=this.sce.trustAsHtml(e.SubCategory_Description),this.filter.category.selectedSubCategoryName=this.sce.trustAsHtml(e.SubCategory_Name),this.filter.category.selectedSubCategoryImagePath=e.SubCategory_ImagePath,this.filter.category.selectedSubCategoryBannerImage=e.SubCategory_BannerPath,this.rootScope.subcategory=this.filter.category.selectedSubCategoryName):(this.filter.category.selectedSubCategoryId=null,this.filter.category.selectedSubCategoryDesc=null,this.filter.category.selectedSubCategoryName=null,this.filter.category.selectedSubCategoryImagePath=null,this.filter.category.selectedSubCategoryBannerImage=null,this.rootScope.subcategory=null),this.filter.search.searchStr="",this.filter.search.currentSearchStr="",this.rootScope.searchKey=null,this.location.search("search",null),null!=this.rootScope.searchKey&&(this.rootScope.searchKey=null),this.filter.currentPage=1,t&&this.refreshProducts()}getCategoryUrl(e,t,o){return this.Filters.getCategoriesUrl(0==e?this.translate.instant("ACTG"):e.Category_Name,null==t?null:t.SubCategory_Name,o,this.translate.use())}refreshProducts(){this.rootScope.$broadcast("filtersUpdated",this.filter)}increment(){this.count++}decrement(){this.count--}},templateUrl:"./views/templates/filter.tpl.html"})},function(e,t,o){"use strict";angular.module("paladinApp").directive("focusMe",["$timeout",function(e){return{restrict:"A",link:function(t,o,a){e(()=>{o[0].disabled||o[0].focus()},300)}}}])},function(e,t){angular.module("paladinApp").directive("footer",["$rootScope","menusService","appStateManager","enums","$mdMedia","$state",function(e,t,o,a,r,n){return{restrict:"E",templateUrl:"./views/templates/footer.tpl.html",scope:{},link:function(i,s,l){i.extraStyle={height:"150px"},i.aboutMenu=t.commonMenus.aboutMenu,i.linksMenu=t.commonMenus.linksMenu,i.menuLists=[t.commonMenus.aboutMenu,t.commonMenus.accountLoggedIn,t.commonMenus.accountLoggedOut,t.commonMenus.linksMenu],i.supportedLanguages=window.globals.SUPPORTED_LANGS,i.selectedLanguage=i.supportedLanguages.find(e=>e.code===o.currentLang),i.menuClick=(e=>{t.menuClickHandlerMethod(e)}),i.getMenuItemLink=(e=>e.link||"#"),i.filterMenuItems=(e=>t.shouldShowMenuItem(e)),i.onSelectLanguage=function(t){i.selectedLanguage=i.supportedLanguages.find(e=>e.code===t),e.$emit(a.busEvents.preferredLanguageChange,{currentLang:t}),e.$broadcast("languageChanged",t)};let c=[];c.push(e.$on(a.busEvents.footerExtraHeight,(e,t)=>{i.extraStyle.height=t.height||i.extraStyle.height})),c.push(i.$watch(function(){return r("gt-sm")},function(e){let t="0";e||(n.includes("app.products.newProduct")||n.includes("app.products.selectedProduct")||n.includes("app.bookings.bookingDetailed")||n.includes("app.bookings.paymentDetailed")||n.includes("app.bookings.bookingDetailed")||n.includes("verification.user"))&&(t="150px"),(e=>{e!=i.extraStyle.height&&(i.extraStyle.height=e)})(t)})),i.$on("$destroy",()=>{for(;c.length;)c.pop()()})}}}])},function(e,t){angular.module("paladinApp").component("header",{bindings:{user:"="},controller:class{constructor(e,t,o,a,r,n,i,s,l,c){this.base64=e,this.scope=t,this.rootScope=o,this.translate=a,this.baseUrl=window.globals.API_URL,this.supportedLanguages=window.globals.SUPPORTED_LANGS,this.profileImageBaseUrl=window.globals.PROFILE_IMAGE_URL,this.mdDialog=r,this.http=n,this.btnStatus=10,this.signupMessage="",this.signupStatus="",this.signupFacebookStatus="",this.signupacebookMessage="",this.loginFacebookStatus="",this.loginFacebookMessage="",this.loginStatus="",this.loginMessage="",this.cookies=i,this.userStatus=!1,this.timeout=s,this.popupService=l,this.enums=c,this.user=null,this.registerBusEvents()}registerBusEvents(){let e=[];e.push(this.rootScope.$on(this.enums.busEvents.updatedUser,(e,t)=>{this.user=t,this.userStatus=null!=this.user})),this.scope.$on("$destroy",function(){for(;e.length;)e.pop()()})}$onInit(){this.profileDefaultImage="../../assets/profile.png";var e=this;this.currentLang=this.translate.proposedLanguage()?this.translate.proposedLanguage():this.translate.preferredLanguage(),this.currentLang=this.rootScope.lang,this.translate.use(this.rootScope.lang),this.scope.$on("updateLanguage",function(t,o){e.changeLanguage(o,!1)}),void 0!=this.cookies.getObject("globals")&&void 0!=this.cookies.getObject("globals").currentUser&&void 0!=this.cookies.getObject("globals").currentUser.username&&(this.userStatus=!0),this.rootScope.$on("registeredSuccess",function(t,o){e.userStatus=!0})}changeLanguage(e,t){this.rootScope.lang=e.code,this.translate.use(e.code),this.currentLang=e.code,t&&(this.rootScope.$broadcast("languageChanged",e.code),this.rootScope.$emit(this.enums.busEvents.preferredLanguageChange,{currentLang:e.code}))}hide(){this.mdDialog.hide()}cancel(){this.mdDialog.cancel()}answer(e){this.mdDialog.hide(e)}forgotPassword(e){this.btnForgotPasswordStatus=1;var t={User_Email:e,LanguageCode:"it"==this.currentLang?"it-IT":this.currentLang};this.http.defaults.headers.common.Authorization="Basic "+this.base64.encode("Paladin:Paladin123"),this.http.defaults.headers.common.Charset="UTF-8",this.http.defaults.headers.common["Content-Type"]="application/json",this.http.post(this.baseUrl+"ForgetPassword/",JSON.stringify(t)).then(e=>{this.btnForgotPasswordStatus=10,this.forgotpasswordStatus=e.data.Status,this.forgotPasswordMessage=e.data.Message})}showTabDialogForgotPassword(e){this.mdDialog.show({controller:()=>this,controllerAs:"ctrl",templateUrl:"tabDialogForgotPassword",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,http:this.http})}register(e,t,o,a){this.btnStatus=1;var r={User_UserName:e,User_Email:o,User_Address:a,User_Password:t,User_UDIDType:3,LanguageCode:"it"==this.currentLang?"it-IT":this.currentLang};this.http.post(this.baseUrl+"SignUp/",r).then(e=>{this.btnStatus=10,this.signupStatus=e.data.Status,"error"==e.data.Status&&(this.signupMessage=e.data.Message)})}registerFacebook(){if(this.rootScope.facebookApiLoaded){this.btnStatus=1;var e={User_UserName:this.rootScope.facebook_user.name.replace(" ","-"),User_Email:this.rootScope.facebook_user.email,User_Address:this.rootScope.facebook_user.address,User_Password:"",User_UDIDType:3,LanguageCode:"it"==this.currentLang?"it-IT":this.currentLang,User_DisplayPicturePath:"http://graph.facebook.com/"+this.rootScope.facebook_user.id+"/picture?type=small",User_DisplayPicture:"http://graph.facebook.com/"+this.rootScope.facebook_user.id+"/picture?type=small",User_FacebookId:this.rootScope.facebook_user.id,User_FullName:this.rootScope.facebook_user.name,User_QBId:""};this.http.post(this.baseUrl+"SignUp/",e).then(e=>{if(this.btnStatus=10,this.signupFacebookStatus=e.data.Status,"error"==e.data.Status)this.signupFacebookMessage=e.data.Message;else{this.rootScope.globals={currentUser:{username:e.data.Data.User_UserName,token_type:e.data.Data.oAuthToken.token_type,access_token:e.data.Data.oAuthToken.access_token,refresh_token:e.data.Data.oAuthToken.refresh_token,User_Id:e.data.Data.User_Id,User_DisplayPicturePath:"http://graph.facebook.com/"+this.rootScope.facebook_user.id+"/picture?type=small",User_DisplayPicture:"http://graph.facebook.com/"+this.rootScope.facebook_user.id+"/picture?type=small"}};var t=new Date;t.setDate(t.getDate()+e.data.Data.oAuthToken.expires_in),this.cookies.putObject("globals",this.rootScope.globals,{expires:t}),this.http.defaults.headers.common.Authorization=this.cookies.getObject("globals").currentUser.token_type+" "+this.cookies.getObject("globals").currentUser.access_token,this.hide(),this.userStatus=!0}})}else{this.signupFacebookStatus="error",this.signupFacebookMessage=this.translate.instant("FACEBOOK_LOADING");var t=this;this.timeout(function(){t.registerFacebook()},2e3)}}logout(){this.userStatus=!1,this.cookies.remove("globals"),this.http.defaults.headers.common.Authorization=""}login(e,t){this.btnStatus=1;var o={User_UserName:e,User_Email:"",User_Mobile:"",User_Password:t,User_FacebookId:"",LanguageCode:"it"==this.currentLang?"it-IT":this.currentLang};this.http.post(this.baseUrl+"Login/",o).then(e=>{if(this.btnStatus=10,"error"!=e.data.Status){this.loginStatus=e.data.Status,console.log(e.data.Data),this.rootScope.globals={currentUser:{username:e.data.Data.User_UserName,token_type:e.data.Data.oAuthToken.token_type,access_token:e.data.Data.oAuthToken.access_token,refresh_token:e.data.Data.oAuthToken.refresh_token,User_Id:e.data.Data.User_Id,User_DisplayPicturePath:e.data.Data.User_DisplayPicturePath}};var t=new Date;t.setDate(t.getDate()+e.data.Data.oAuthToken.expires_in),this.cookies.putObject("globals",this.rootScope.globals,{expires:t}),this.http.defaults.headers.common.Authorization=this.cookies.getObject("globals").currentUser.token_type+" "+this.cookies.getObject("globals").currentUser.access_token,this.http.get(this.baseUrl+"GetUserProfile?User_Id="+this.cookies.getObject("globals").currentUser.User_Id+"&LanguageCode="+this.currentLang).then(e=>{console.log(e),this.hide(),this.userStatus=!0})}else console.log(JSON.stringify(e,null,4)),this.loginStatus=e.data.Status,this.loginMessage=e.data.Message})}showTabDialog(e){this.popupService.showLoginSignupPopup()}},templateUrl:"./views/templates/header.tpl.html"})},function(e,t){angular.module("paladinApp").directive("headerV2",["$rootScope","appStateManager","popupService","$mdMenu","$translate","enums","$mdSidenav","$window","menusService","apiService","$state","$transitions","$mdComponentRegistry",function(e,t,o,a,r,n,i,s,l,c,d,u,g){return{restrict:"E",scope:{},templateUrl:"./views/templates/headerV2.tpl.html",link:function(a,s,p){a.isScrollOffsetZero=(d.current.data||{}).isCollapsingHeader||!1,a.searchText="",a.searchItems=["one","two","three","four","five"],a.unreadBadge=0,a.aboutMenu=l.commonMenus.aboutMenu.list,a.profileMenu=l.commonMenus.accountLoggedIn.list,a.loggedOutMenu=l.commonMenus.accountLoggedOut.list,a.commonMenu=l.commonMenus.common.list,a.linksMenu=l.commonMenus.linksMenu,a.loggedInMenu=[{title:r.instant("LENT_BORROWED"),BL:()=>alert(`Navigate to ${r.instant("LENT_BORROWED")}`)},{title:r.instant("LISTINGS"),BL:()=>alert(`Navigate to ${r.instant("LISTINGS")}`)},{title:r.instant("MESSAGES"),BL:()=>alert(`Navigate to ${r.instant("MESSAGES")}`)}],a.loginSignUpPopupClick=(e=>{o.showLoginSignupPopup(e)}),a.querySearch=(e=>{const t=e.toLowerCase();return c.products.getSuggestions(t).then(t=>[{Rank:1/0,Keyword:e},...t.Data.sort((e,t)=>t.Rank-e.Rank)])}),a.headerMenuClick=(e=>{a.close(),l.menuClickHandlerMethod(e)}),a.getMenuItemLink=(e=>e.link||"#"),a.initiateSearch=(t=>{t&&""!=t&&e.$emit(n.busNavigation.browseKeyword,{keyword:t})}),a.searchBarOnKeyPress=(e=>{13==e.which&&e.target.value&&""!=e.target.value&&(a.initiateSearch(e.target.value),e.preventDefault())}),a.toggleSideNav=(()=>{g.get(n.inAppSideNavsIds.chatSideNav)&&i(n.inAppSideNavsIds.chatSideNav).isOpen()&&i(n.inAppSideNavsIds.chatSideNav).toggle(),i(n.inAppSideNavsIds.mainMobileNav).toggle()}),a.close=(()=>{i(n.inAppSideNavsIds.mainMobileNav).close()}),t.user&&(a.user=t.user),a.updateCreditButton=(()=>{let e=t.getUserId();e&&c.users.getUserCredit({userId:e}).then(e=>{a.currentCredit=e.Data.User_Credit,a.currentCreditText=a.currentCredit&&a.currentCredit>0?r.instant("CREDIT_MENU_ITEM")+": "+a.currentCredit+"€":r.instant("GET_FREE_CREDIT")},e=>{console.log("getUserCredit failed because: ",e)})}),a.creditMenuClick=(()=>{a.close(),e.$emit(n.busNavigation.userProfile,{userId:a.user.User_Id})});let h=[];h.push(e.$on(n.busEvents.updatedUser,(e,o)=>{a.user=t.user,a.updateCreditButton()})),h.push(e.$on(n.busChatEvents.updateUnreadCount,(e,t)=>{a.unreadBadge=t.total||0,a.$apply()})),u.onSuccess({to:"app.**"},function(){a.isScrollOffsetZero=(d.current.data||{}).isCollapsingHeader||!1,a.hideSearch=d.includes("app.browse")}),angular.element(document.getElementById("main-ui-view")).bind("scroll",function(){const e=a.isScrollOffsetZero;let t;(t=!(this.scrollTop>50)&&((d.current.data||{}).isCollapsingHeader||!1))!==e&&a.$evalAsync(()=>{a.isScrollOffsetZero=t})}),a.$on("$destroy",()=>{for(angular.element(document.getElementById("main-ui-view")).unbind("scroll");h.length;)h.pop()()}),a.updateCreditButton()}}}])},function(e,t){angular.module("paladinApp").directive("homeStepsTutorial",["$rootScope","$sce",function(e,t){return{restrict:"E",scope:{stepsList:"<",imgUrl:"<",tutorialTitle:"<",tutorialDescription:"<"},templateUrl:"./views/templates/homeStepsTutorial.tpl.html",link:function(e,o,a){e.tutorialTitle=t.trustAsHtml(e.tutorialTitle)}}}])},function(e,t){angular.module("paladinApp").directive("lazyLoading",[function(){return{restrict:"A",link:function(e,t,o){const a=(e,t)=>{let a="";for(var r=1;r<=5;r++)t&&r%2==0||(a=a+e+o.lazyLoading+"_"+r+"00 "+r+"00w, ");return a.length>0&&(a=a+e+o.lazyLoading+" 600w"),a};angular.element(t)[0].src="/assets/empty-image.png";const r=()=>{let e="";return o.imageType&&("product"==o.imageType?e=window.globals.PRODUCT_IMAGE_URL:"profile"==o.imageType&&(e=o.lazyLoading.length>0?window.globals.PROFILE_IMAGE_URL:"/assets/profile.png")),e};const n=new IntersectionObserver(function(e){e.forEach(e=>{if(e.intersectionRatio>0){const t=r();e.target.src=t+o.lazyLoading,o.imageType&&("product"==o.imageType||"profile"==o.imageType&&o.lazyLoading.length>0)&&(e.target.srcset=a(t,"profile"==o.imageType))}})}),i=angular.element(t)[0];n.observe(i)}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("lazyLoadingManual",function(e,t){var o=function(){var t=[],o=null,a=10,r=$(e),n=angular.element(e),i=null,s=200,l=!1;function c(){if(!o){var t=angular.element(e);t!==n&&(n=t,g())}}function d(){for(var e=[],o=[],a=r.height(),n=r.scrollTop(),i=n+a,s=0;s<t.length;s++){var l=t[s];l.isVisible(n,i)?e.push(l):o.push(l)}for(s=0;s<e.length;s++)e[s].render();t=o,u(),t.length||p()}function u(){clearTimeout(o),o=null}function g(){o=setTimeout(d,a)}function p(){l=!1,r.off("resize.lazyLoading"),r.off("scroll.lazyLoading"),clearInterval(i)}function h(){o||g()}return{addImage:function(e){t.push(e),o||g(),l||(l=!0,r.on("resize.lazyLoading",h),r.on("scroll.lazyLoading",h),i=setInterval(c,s))},removeImage:function(e){for(var o=0;o<t.length;o++)if(t[o]===e){t.splice(o,1);break}t.length||(u(),p())}}}();return{link:function(e,t,a){var r=new function(e,t){var o="/assets/empty-image.png";e[0].src=o;var a="";t.imageType&&"product"==t.imageType&&(a=window.globals.PRODUCT_IMAGE_URL);var r=!1,n=null;function i(){e[0].src=a+o}return{isVisible:function(t,o){if(!e.is(":visible"))return!1;null===n&&(n=e.height());var a=e.offset().top,r=a+n;return a<=o&&a>=t||r<=o&&r>=t||a<=t&&r>=o},render:function(){r=!0,i()},setSource:function(e){o=e,r&&i()}}}(t,a);o.addImage(r),a.$observe("lazyLoading",function(e){r.setSource(e)}),e.$on("$destroy",function(){o.removeImage(r)})},restrict:"A"}})},function(e,t){angular.module("paladinApp").directive("loaderContainer",[function(){return{restrict:"E",transclude:!0,templateUrl:"./views/templates/loaderContainer.tpl.html",link:function(e,t,o){e.loaderSize=e.loaderSize||50}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("whenScrolled",function(){return function(e,t,o){var a=t[0];t.bind("scroll",function(){if(Math.ceil(a.scrollTop+a.offsetHeight)>=a.scrollHeight-10)var t=setTimeout(()=>{e.$apply(o.whenScrolled),clearTimeout(t),t=null},10)})}})},function(e,t){angular.module("paladinApp").directive("productImage",[function(){return{restrict:"A",link:function(e,t,o){angular.element(t)[0].src="/assets/blank-image.jpg";const a=new IntersectionObserver(function(e){e.forEach(e=>{e.intersectionRatio>0&&(e.target.src=window.globals.PRODUCT_IMAGE_URL+o.productImage)})}),r=angular.element(t)[0];a.observe(r)}}}])},function(e,t){angular.module("paladinApp").component("products",{bindings:{filter:"=",count:"<",loading:"<"},controller:class{constructor(e,t,o,a,r,n,i,s,l){this.scope=e,this.sce=t,this.Filters=o,this.rootScope=a,this.ngMeta=n,this.loading=!0,this.translate=i,this.window=s,this.location=l,this.enums=r}$onInit(){this.count=0,this.loading=!0;var e=this;this.scope.$on("showSpinner",function(t){e.loading=!0}),this.scope.$on("hideSpinner",function(t){e.loading=!1})}getCurrentCategory(){return this.translate.instant("ACTG")}isNotAllCategory(){return this.filter.category.defaultCategoryName!=this.filter.category.selectedCategoryName&&this.filter.category.selectedCategoryName!=this.getCurrentCategory()}refreshProducts(){this.rootScope.$broadcast("filtersUpdated",this.filter)}sortBy(e,t){this.filter.sortBy=e,this.filter.sortByCode=t,this.filter.currentPage=1,this.refreshProducts()}getBannerImageUrl(){return(this.isNotAllCategory()?window.globals.CATEGORY_IMAGE_URL:"")+(this.filter.category.selectedSubCategoryBannerImage?this.filter.category.selectedSubCategoryBannerImage:this.filter.category.selectedCategoryBannerImage)}getCategoryDescription(){if(this.filter.category.selectedCategoryId)return null!=this.filter.category.selectedSubCategoryId?this.filter.category.selectedSubCategoryDesc:this.filter.category.selectedCategoryDesc;var e=this.translate.instant("ALL_CATEGORIES_DESC");return e.length>0?this.sce.trustAsHtml(e):null}switchCategoryToAll(e){this.filter.category.selectedCategoryId=null,this.filter.category.selectedCategoryDesc=this.sce.trustAsHtml(this.translate.instant("ACTG")),this.filter.category.selectedCategoryName=this.translate.instant("ACTG"),this.filter.category.selectedCategoryImagePath=null,this.filter.category.selectedCategoryBannerImage=window.globals.IS_PROMO?this.enums.categoriesBannersPaths.promo:this.enums.categoriesBannersPaths.all[this.translate.use()],this.removeSubCategory(),this.refreshProducts()}getH1(){var e="",t=this.filter.category&&this.filter.category.selectedSubCategoryName?this.filter.category.selectedSubCategoryName:this.filter.category.selectedCategoryName;e+=this.isNotAllCategory()?this.translate.instant("FIND_THE_BEST")+" ":this.translate.instant("RENT")+" ",this.filter.search.currentSearchStr&&this.filter.search.currentSearchStr.length>0&&(e+='"'+this.filter.search.currentSearchStr+'" '+this.translate.instant("WITHIN")+" "),e+=t;var o=this.filter.glCity;return o&&(e+=this.translate.instant("IN")+" "+o.split(",")[0]),e}getH2(){var e=this.translate.instant("RENT_AT_BEST_PRICE")+" ";this.filter.category&&this.filter.category.selectedCategoryName&&!this.filter.category.selectedSubCategoryName?e+=this.filter.category.selectedCategoryName:this.filter.category&&this.filter.category.selectedSubCategoryName&&(e+=this.filter.category.selectedSubCategoryName);var t=this.filter.glCity;return t&&(e+=this.translate.instant("IN")+" "+t.split(",")[0]),e}getCategoriesUrl(e,t){return this.Filters.getCategoriesUrl(e,t,this.rootScope.isTryAndBuy,this.translate.use())}removeSubCategory(){this.filter.category.selectedSubCategoryId=null,this.filter.category.selectedSubCategoryDesc=null,this.filter.category.selectedSubCategoryName=null,this.filter.category.selectedSubCategoryImagePath=null,this.filter.category.selectedSubCategoryBannerImage=null}switchMainCategory(){this.removeSubCategory(),this.refreshProducts()}switchSubCategory(){this.refreshProducts()}},templateUrl:"./views/templates/products.tpl.html"})},function(e,t){angular.module("paladinApp").directive("productStatusLabel",["$rootScope","enums","ptUtils",function(e,t,o){return{restrict:"E",templateUrl:"./views/templates/productStatusLabel.tpl.html",scope:{statusId:"="},link:function(e,t,a){e.setDataForStatusId=(()=>{let{text:t,color:a}=o.getDisplayDataForTransactionStatus(e.statusId);e.mainColor=a,e.statusLabel=t}),e.setDataForStatusId()}}}])},function(e,t){angular.module("paladinApp").directive("productsTeaser",["$rootScope","apiService","enums","dataService","appStateManager","toastService","$timeout",function(e,t,o,a,r,n,i){return{restrict:"E",templateUrl:"./views/templates/productsTeaser.tpl.html",scope:{customTitle:"<?",categoryId:"<?",categoryName:"<?",subCategoryId:"<?",categoryDescription:"<?",descriptionLink:"<?",isPopularItems:"<?",isRecentItems:"<?",isTryAndBuy:"<?",productIds:"<?",userId:"<?",products:"<?",currentProductId:"<?"},link:function(n,s,l){n.isLoading=!0,n.isPopularItems=n.isPopularItems||!1,n.isRecentItems=n.isRecentItems||!1,n.category=null,n.products=n.products||[],n.scrollArrows={isRightVisible:!1,isLeftVisible:!1};const c=()=>{if(n.products)return n.isLoading=!1,void i(()=>{n.validateScrollingArrows()},300);if(n.categoryId){if(!r.categoriesDict)return a.getCategories();n.category=r.categoriesDict[n.categoryId]}d()},d=()=>{n.isLoading=!0,(()=>{if(!n.products){if(n.productIds)return t.products.getSearchedProducts({productPerPage:20,sortBy:o.productsSortOptions.bestProduct,productIDs:n.productIds});if(n.isTryAndBuy)return t.products.getPopularTryAndBuy();if(n.userId){let e={userId:n.userId,productsFilter:o.userProductsFilter.myProductsToBorrow};return t.products.getUserProducts(e).then(e=>({Data:[e.Data.User_AllProducts]}))}{let e={productPerPage:20};return n.categoryId?(e.categoryId=n.categoryId,e.sortBy=o.productsSortOptions.bestProduct,n.subCategoryId&&(e.subCategoryId=n.subCategoryId)):n.isPopularItems?e.sortBy=o.productsSortOptions.popularity:n.isRecentItems&&(e.sortBy=o.productsSortOptions.recent),t.products.getSearchedProducts(e)}}})().then(e=>{n.isLoading=!1,n.products=e.Data[0].filter(e=>e.Product_Id!=n.currentProductId),i(()=>{n.validateScrollingArrows()},300)}).catch(e=>{n.isLoading=!1,n.products=[]})};n.onSwipe=((e,t,o)=>{let a=o.current.parentElement.parentElement.parentElement;if(a){const t=0,r=a.clientWidth,i=a.scrollWidth-r,s=a.scrollLeft,l=o.current.clientWidth,c=r/l;let d=e?s+(r-l/c):s-(r-l/c);d>i?d=i:d<t&&(d=t);let u=30,g=0,p=(s>d?s-d:d-s)/u,h=s<d?s+p:s-p;const m=setInterval(()=>{h=s<d?h+p:h-p,a.scrollTo(h,a.scrollTop),g==u&&(clearInterval(m),n.validateScrollingArrows()),g++},.4*p)}}),n.onArrowClick=(e=>{const t=angular.element(document.querySelector(`#productTeaserItem-${n.products[0].Product_Id} .products-teaser-list-item-v2 .button-overlay`))[0];n.onSwipe(e,null,{current:t})}),n.validateScrollingArrows=(()=>{if(n.instantiateScroller(),n.products.length>0){angular.element(document.querySelector(`#productTeaserItem-${n.products[0].Product_Id} .products-teaser-list-item-v2 .button-overlay`))[0];const e=angular.element(document.getElementById("productsTeaserList"+(n.categoryId||(n.isRecentItems?"Recent":n.isPopularItems?"Popular":""))));if(e[0]){const t=e[0].clientWidth,o=e[0].scrollWidth-t,a=e[0].scrollLeft;n.$evalAsync(()=>{n.scrollArrows.isLeftVisible=0!=Math.round(a),n.scrollArrows.isRightVisible=Math.round(a)!=o})}}else n.$evalAsync(()=>{n.scrollArrows.isLeftVisible=!1,n.scrollArrows.isRightVisible=!1})}),n.seeAll=(()=>{n.categoryId?e.$emit(o.busNavigation.browseCategory,{categoryName:n.categoryName}):n.isPopularItems||n.isRecentItems?e.$emit(o.busNavigation.browseSort,{sortBy:n.isRecentItems?o.productsSortOptions.recent:o.productsSortOptions.popularity}):n.userId?e.$emit(o.busNavigation.userProfile,{userId:n.userId}):void 0!=n.isTryAndBuy&&e.$emit(o.busNavigation.switchBrowseMode,{isTryAndBuy:n.isTryAndBuy})}),n.getHrefLink=(()=>{let e="";return n.categoryId?e=window.globals.ROOT_PATH+r.currentLang+"/categorie/"+n.categoryName:void 0!=n.isTryAndBuy?e=window.globals.ROOT_PATH+r.currentLang+"/categorie/"+(n.isTryAndBuy?"":"privato/")+("it"==r.currentLang?"Tutte-le-Categorie":"All-Categories")+"?sortBy=SortByBestProduct&pageIndex=1":n.userId,e.length>0?e.split(" ").join("-"):"javascript:void(0);"}),n.instantiateScroller=(()=>{n.scroller||(n.scroller=angular.element(document.getElementById("productsTeaserList"+(n.categoryId||(n.isRecentItems?"Recent":n.isPopularItems?"Popular":"")))),n.scroller.bind("resize",function(){n.validateScrollingArrows()}))});let u=[];u.push(e.$on(o.busEvents.categoriesUpdate,(e,t)=>{c()})),n.$on("$destroy",function(){for(n.scroller&&n.scroller.unbind("resize");u.length;)u.pop()()}),c()}}}])},function(e,t){angular.module("paladinApp").directive("productTeaserListItem",["$rootScope","enums","ptUtils",function(e,t,o){return{restrict:"E",scope:{product:"<",onSwipe:"&"},templateUrl:"./views/templates/productTeaserListItem.tpl.html",link:function(a,r,n){a.onItemClick=(()=>{e.$emit(t.busNavigation.productDetailed,{product:a.product})}),a.getProductUrl=(()=>a.product?o.getProductDetailUrl(a.product):"#"),a.onItemSwipe=((e,t,o)=>{a.onSwipe&&a.onSwipe()(e,t,o)})}}}])},function(e,t){angular.module("paladinApp").component("productlist",{bindings:{filter:"=",pages:"<",totalPages:"<",productsList:"=?",count:"<",isLoading:"=?"},controller:class{constructor(e,t,o,a,r,n,i,s,l,c){this.rootScope=t,this.scope=e,this.Products=a,this.profileImageBaseUrl=window.globals.PROFILE_IMAGE_URL,this.productImageBaseUrl=window.globals.PRODUCT_IMAGE_URL,this.ngMeta=r,this.pager=n,this.anchorScroll=i,this.translate=s,this.location=o,this.enums=l,this.ptUtils=c}$onInit(){this.count=0,this.totalPages=0,this.productsList=null,this.isLoading=!1,this.anchorScroll.yOffset=0,this.profileDefaultImage="../../assets/profile.png";var e=this;this.scope.$on("filtersUpdated",function(t){e.onFilterChange(!1)}),this.scope.$on("languageChanged",function(t,o){e.filter.languageCode=o,e.onFilterChange(!1)}),this.rootScope.filter&&this.onFilterChange(!1)}updateMetaTags(){this.ngMeta.setTitle(this.getPageTitle()),this.ngMeta.setTag("description",this.getMetaTags()),this.ngMeta.setTag("imagePath","../../assets/paladin-logo-300x300.png")}getPageTitle(){if(!this.filter.category.selectedCategoryId)return this.translate.instant("HOME_TITLE");var e=this.translate.instant("RENT")+" ";this.filter.category&&this.filter.category.selectedCategoryName&&!this.filter.category.selectedSubCategoryName?e+=this.filter.category.selectedCategoryName:this.filter.category&&this.filter.category.selectedSubCategoryName&&(e+=this.filter.category.selectedSubCategoryName);var t=this.filter.glCity;return t&&(e+=this.translate.instant("IN")+" "+t.split(",")[0]),e}getPricePerDayLabel(){return this.translate.instant(window.innerWidth<768?"PD":"PPD")}getMetaTags(){if(this.filter.category.selectedCategoryName==this.enums.allCategories[this.filter.languageCode])return this.translate.instant("DEFAULT_META_DESC");var e=this.translate.instant("RENT_AND_LEND")+" ";this.filter.category&&this.filter.category.selectedCategoryName?e+=this.filter.category.selectedCategoryName:this.filter.category&&this.filter.category.selectedSubCategoryName&&(e+=this.filter.category.selectedSubCategoryName);var t=this.filter.glCity;return t&&(e+=this.translate.instant("IN")+" "+t.split(",")[0]),e+=" "+this.translate.instant("WITH")+" Paladin!"}getDistanceLabel(e){return"< "+Math.ceil(this.getDistanceFromLatLonInKm(e.Product_Latitude,e.Product_Longitude,this.rootScope.filter.search.lat,this.rootScope.filter.search.lng))+" "+this.translate.instant("KM_FROM_YOU")}getDistanceFromLatLonInKm(e,t,o,a){var r=this.deg2rad(o-e),n=this.deg2rad(a-t),i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(o))*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}deg2rad(e){return e*(Math.PI/180)}navigateToProduct(e){this.rootScope.$emit(this.enums.busNavigation.productDetailed,{product:e})}getProductDetailUrl(e){var t="/";return e&&(t+=this.filter.languageCode?this.filter.languageCode:"",t+="/product",t+="/"+this.Products.encryptProductURL(e.Product_Id),t+="-"+e.Product_Id),t}goToProductPage(e){this.location.url(getProductDetailUrl(e))}goTo(e){this.filter.currentPage=e,this.onFilterChange(!0)}isFirstPage(){return 1==this.filter.currentPage}setPage(e){e>=1&&e<=this.totalPages&&(this.filter.currentPage=e,this.refreshPageList(),this.onFilterChange(!0))}refreshPageList(){this.pages=this.pager.GetPager(this.totalPages,this.filter.currentPage,5),this.isLoading=!1,this.ngMeta.setTag("prevUrl",void 0),this.ngMeta.setTag("nextUrl",void 0),this.filter.currentPage>1&&this.ngMeta.setTag("prevUrl",this.location.absUrl().replace("pageIndex="+this.filter.currentPage,"pageIndex="+(this.filter.currentPage-1))),this.filter.currentPage<this.totalPages&&this.ngMeta.setTag("nextUrl",this.location.absUrl().replace("pageIndex="+this.filter.currentPage,"pageIndex="+(this.filter.currentPage+1)))}scrollToAnchor(){var e=this.location.hash();this.location.hash("breadcrumb"),this.anchorScroll(),this.location.hash(e)}getProductUrl(e){return e?this.ptUtils.getProductDetailUrl(e):"#"}isParentCategorySelected(){return this.filter.category.selectedCategoryId&&null==this.filter.category.selectedSubCategoryId}onFilterChange(e){(this.rootScope.filter&&!this.isParentCategorySelected()&&window.innerWidth<768||e)&&this.scrollToAnchor(),this.isLoading=!0,this.productsList=[],this.updateMetaTags(),this.scope.$evalAsync(()=>{this.productsList=[],Promise.all([this.Products.getAll(this.filter),this.Products.getTotalPageCount(this.filter)]).then(e=>{this.scope.$evalAsync(()=>{this.isLoading=!1,this.productsList=e[0].data.Data[0],this.totalPages=e[1].data.Data,this.refreshPageList()})}).catch(e=>{this.scope.$evalAsync(()=>{this.isLoading=!1,this.productsList=[],this.totalPages=0})})})}increment(){this.count++}decrement(){this.count--}},templateUrl:"./views/templates/product_list.tpl.html"})},function(e,t){angular.module("paladinApp").directive("profileImage",[function(){return{restrict:"A",link:function(e,t,o){const a=()=>{t&&t[0]&&(""==o.profileImage?t[0].src="/assets/profile.png":t[0].src=window.globals.PROFILE_IMAGE_URL+o.profileImage)};a();let r=[];r.push(e.$watch("profileImage",()=>{a()})),e.$on("$destroy",()=>{for(;r.length;)r.pop()()})}}}])},function(e,t){angular.module("paladinApp").directive("ratingView",[function(){return{restrict:"E",scope:{rating:"=",count:"<?",readOnly:"<?",onRating:"&"},templateUrl:"./views/templates/ratingView.tpl.html",link:function(e,t,o){e.onRatingSet=(t=>{e.onRating&&e.onRating({rating:t})})}}}])},function(e,t){angular.module("paladinApp").directive("rentalRequestHowTo",[function(){return{restrict:"E",templateUrl:"./views/templates/rentalRequestHowTo.tpl.html",scope:{isTryAndBuy:"=?",isBuy:"=?"},link:function(e,t,o){}}}])},function(e,t,o){"use strict";angular.module("paladinApp").directive("rentalRequestPicker",["$rootScope","appStateManager","enums","apiService","moment","$translate","ptUtils","gtmService",function(e,t,o,a,r,n,i,s){return{restrict:"E",templateUrl:"./views/templates/rentalRequestPicker.tpl.html",scope:{product:"=",productBookingDetails:"=",onRequestRent:"&",onDatesUpdated:"&"},link:function(r,n,l){console.log("rentalRequestPicker: ",n[0].id),r.userCredit=null,r.calculatePrice=((e=!0)=>{r.statusError=void 0;let o=t.getUserId();o&&a.users.getUserCredit({userId:o}).then(t=>{r.userCredit=t.Data,i.calculatePricingListForProduct(r.startDate,r.endDate,r.product,r.productBookingDetails,!0,r.userCredit).then(e=>{r.$evalAsync(()=>{r.statusError=void 0,r.prices=e})}).catch(t=>{r.$evalAsync(()=>{r.prices=[],e&&t&&t.message&&(r.statusError=t.message)})})}).catch(e=>{console.error("getuserCredit failed ",e)})}),r.bookingPickerId=l.id+"-bookingPicker",r.init=(()=>{r.statusError=void 0,r.startDate=void 0,r.endDate=void 0,r.calculatePrice(!1)}),r.onDatesSelected=(({startDate:e,endDate:t})=>{r.startDate==e&&r.endDate==t||(r.startDate=e,r.endDate=t,r.calculatePrice(),r.onDatesUpdated&&r.onDatesUpdated()({startDate:r.startDate,endDate:r.endDate,componentId:n[0].id}))}),r.onBuyBtnClicked=(()=>{e.$emit(o.busNavigation.paymentDetailed,{productId:r.product.Product_Id,purchase:!0})}),r.onRequestRentBtnClicked=(()=>{void 0!=r.prices&&0!=r.prices.length?(r.onRequestRent()({startDate:r.startDate,endDate:r.endDate,componentId:n[0].id}),s.trackEvent("booking","request-now-button-post-calendar","productDetailpage","value")):r.$$postDigest(()=>{angular.element(document.querySelector(`#${n[0].id} #desktopPicker span.md-select-value`))[0].click()})}),r.init();let c=[];c.push(e.$on(o.busEvents.rentalRequestPickerUpdateDates,(e,t)=>{t&&t.startDate&&t.endDate&&t.componentId==n[0].id&&r.onDatesSelected(t)})),r.$on("$destroy",()=>{for(;c.length;)c.pop()()})}}}])},function(e,t){angular.module("paladinApp").directive("reviewsList",["$rootScope","appStateManager",function(e,t){return{restrict:"E",templateUrl:"./views/templates/reviewsList.tpl.html",scope:{reviews:"="},link:function(e,t,o){}}}])},function(e,t){angular.module("paladinApp").directive("reviewsListItem",["$rootScope",function(e){return{restrict:"E",templateUrl:"./views/templates/reviewsListItem.tpl.html",scope:{review:"="},link:function(e,t,o){}}}])},function(e,t){angular.module("paladinApp").component("search",{bindings:{filter:"="},controller:class{constructor(e,t,o,a,r){this.scope=e,this.rootScope=t,this.translate=o,this.apiService=a,this.enums=r}$onInit(){var e=this;this.scope.distanceDropDown=[{l_id:1,distance:1,name:"VC"},{l_id:2,distance:5,name:"NB"},{l_id:3,distance:10,name:"IC"},{l_id:4,distance:50,name:"IA"},{l_id:5,distance:200,name:"FA"}],this.scope.distanceRange=200,this.selectedRange={l_id:5,distance:200,name:"FA"},this.scope.myModelVal=this.scope.distanceDropDown[4],this.scope.$on("distanceChanged",function(t,o){o&&e.changeDistanceFilter(),e.loading=!1}),this.selectedItem=""}initiateSearch(e){e&&""!=e&&(this.filter.search.searchStr=e,this.applySearch())}onSearchTextChange(){""==this.filter.search.searchStr&&this.applySearch()}searchBarOnKeyPress(e){if(this.filter.search.searchStr=e.target.value||"",13==e.which&&e.target.value){this.initiateSearch(e.target.value);var t=document.getElementById("search-bar-browse-page").firstElementChild;angular.element(t).scope().$mdAutocompleteCtrl.hidden=!0,e.preventDefault()}}querySearch(e){if(e&&""!=e){const t=e.toLowerCase();return this.apiService.products.getSuggestions(t).then(t=>[{Rank:1/0,Keyword:e},...t.Data.sort((e,t)=>t.Rank-e.Rank)])}}showLocation(){return this.filter.sortBy===this.enums.productsSortOptions.geoLocation}onSelectedSuggestion(e,t,o,a){this.filter.search.searchStr=e,a.stopPropagation()}onKeyPressed(e,t){13==e.keyCode&&applySearch(),38!=e.keyCode&&40!=e.keyCode||(this.filter.search.searchStr=t)}changeDistanceFilter(){this.filter&&(this.filter.distanceRange=this.selectedRange.distance,this.applySearch())}applySearch(){this.filter.currentPage=1,this.filter.search.currentSearchStr=this.filter.search.searchStr,this.rootScope.$broadcast("filtersUpdated")}addSuggestionToSearch(e,t){this.filter.search.searchStr=e,applySearch()}smallScreen(){return window.innerWidth<768}},templateUrl:"./views/templates/search.tpl.html"})},function(e,t){angular.module("paladinApp").directive("searchBar",[function(){return{restrict:"E",scope:{isOpen:"=?",isGreenBackground:"=?"},templateUrl:"./views/templates/searchBar.tpl.html",link:function(e,t,o){}}}])},function(e,t){angular.module("paladinApp").directive("userAvatar",[function(){return{restrict:"E",scope:{user:"<?",userId:"<?",picSize:"<?",userImage:"<?"},templateUrl:"./views/templates/userAvatar.tpl.html",link:function(e,t,o){const a=()=>{e.picSize=e.picSize||30,e.picSizeParsed=e.picSize+"px",e.sizeStyle=`width: ${e.picSize}px; height: ${e.picSize}px;`,e.imgServerPath=window.globals.PROFILE_IMAGE_URL;const t=e.userImage;e.userImage="",e.user?e.userImage=e.user.User_DisplayPicturePath:t&&(e.userImage=t)};a();let r=[];r.push(e.$watch("userImage",()=>{a()})),r.push(e.$watch("user",()=>{a()})),e.$on("destroy",()=>{for(;r.length;)r.pop()()})}}}])},function(e,t){angular.module("paladinApp").directive("userItem",["$rootScope","enums","appStateManager",function(e,t,o){return{restrict:"E",templateUrl:"./views/templates/userItem.tpl.html",scope:{userId:"=?",userName:"=?",userImage:"=?",reviews:"=?",stars:"=?",picSize:"=?"},link:function(o,a,r){o.picSize=o.picSize||50,o.goToProfile=(()=>{o.userId&&e.$emit(t.busNavigation.userProfile,{userId:o.userId})})}}}])},function(e,t){angular.module("paladinApp").directive("userListingsList",["$rootScope","enums","apiService",function(e,t,o){return{restrict:"E",templateUrl:"./views/templates/userListingsList.tpl.html",scope:{userId:"=",isMinified:"=?"},link:function(a,r,n){a.isMinified=a.isMinified||!1,a.isLoading=!1,a.userProducts=[],a.fetchUserListings=(()=>{a.isLoading=!0,o.products.getUserProducts({productsFilter:t.userProductsFilter.lentProduct,userId:a.userId}).then(e=>{a.userProducts=e.Data.User_AllProducts,a.isLoading=!1})}),a.listItemClick=(o=>{e.$emit(t.busNavigation.productDetailed,{product:o})}),a.fetchUserListings()}}}])},function(e,t){angular.module("paladinApp").directive("userListingsListItem",["$rootScope","enums",function(e,t){return{restrict:"E",templateUrl:"./views/templates/userListingsListItem.tpl.html",scope:{product:"<",isMinified:"=?"},link:function(e,t,o){e.isMinified=e.isMinified||!1}}}])},function(e,t){angular.module("paladinApp").filter("capitalize",function(){return function(e){if(e){if(-1!==e.indexOf(" ")){var t,o;for(t=(e=e.toLowerCase()).split(" "),o=0;o<t.length;o++)t[o]=a(t[o].trim());return t.toString().replace(/,/g," ")}return a(e=e.toLowerCase())}function a(e){return e.substring(0,1).toUpperCase()+e.substring(1)}return e}})},function(e,t){angular.module("paladinApp").filter("ptCurrency",function(){return function(e){return"€ "+e}})},function(e,t){angular.module("paladinApp").filter("ptHtmlToPlainText",function(){return function(e){return e?String(e).replace(/<[^>]+>/gm,""):e}})},function(e,t){angular.module("paladinApp").filter("ptTruncate",function(){return function(e,t){return e&&e.length>t?e.slice(0,t-3)+"...":e}})},,function(e,t,o){"use strict";o.r(t);o(266),o(267),o(268),o(269),o(270),o(271),o(272),o(273),o(274),o(275),o(276),o(277),o(278),o(279),o(280),o(281),o(282),o(283),o(284),o(285),o(286),o(287),o(288),o(289),o(290),o(291),o(292),o(293),o(294),o(295),o(296),o(297),o(298),o(299),o(300),o(301),o(302),o(303),o(304),o(305),o(306),o(307),o(308),o(309),o(310),o(311),o(312),o(313),o(314),o(315),o(316),o(317),o(318),o(319),o(320),o(321),o(322),o(323),o(324),o(325),o(326),o(327),o(328),o(329),o(330),o(331),o(332),o(333),o(334),o(335),o(336),o(337),o(338),o(339),o(340),o(341),o(342),o(343),o(344),o(345),o(346),o(347),o(348),o(349),o(350),o(351),o(352),o(353),o(354),o(355),o(356),o(357),o(358),o(359),o(360)}])]);
//# sourceMappingURL=app.bundle.js.map